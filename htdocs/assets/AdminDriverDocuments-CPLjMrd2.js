var ze=Object.defineProperty,$e=Object.defineProperties;var Ee=Object.getOwnPropertyDescriptors;var pe=Object.getOwnPropertySymbols;var Ue=Object.prototype.hasOwnProperty,Ge=Object.prototype.propertyIsEnumerable;var ge=(m,t,c)=>t in m?ze(m,t,{enumerable:!0,configurable:!0,writable:!0,value:c}):m[t]=c,h=(m,t)=>{for(var c in t||(t={}))Ue.call(t,c)&&ge(m,c,t[c]);if(pe)for(var c of pe(t))Ge.call(t,c)&&ge(m,c,t[c]);return m},u=(m,t)=>$e(m,Ee(t));var H=(m,t,c)=>new Promise((D,q)=>{var C=j=>{try{v(c.next(j))}catch(y){q(y)}},I=j=>{try{v(c.throw(j))}catch(y){q(y)}},v=j=>j.done?D(j.value):Promise.resolve(j.value).then(C,I);v((c=c.apply(m,t)).next())});import{j as e}from"./ui-vendor-DMUr7mTx.js";import{r as x}from"./react-vendor-BvqlMsL5.js";import{u as He,l as We,ab as Je,ac as Xe,ad as Ye,ae as Ze,af as Ke,B as o,e as b,C as T,d as V,I as W,L as i,S as g,q as N,r as f,t as w,v as l,D as J,m as X,n as Y,o as Z,p as Ne,T as fe,G as K}from"./index-ZwIgorfy.js";import{u as Qe}from"./useDrivers-BY9VTvBN.js";import{T as we,Z as es,a0 as ss,E as as,a2 as rs,a5 as is,a6 as ts,a7 as ls,a8 as ns,a9 as cs,g as ye,J as De,aa as Q,F as ds,ab as os,I as xs,ag as Ce,Y as ms,ah as hs,af as us,ai as js}from"./icons-vendor-b0I7fGSL.js";import{f as ee}from"./utils-vendor-B2FlkASS.js";import"./supabase-vendor-B984m0TI.js";import"./query-vendor-B2F_wWlc.js";import"./router-vendor-CEyBJ8vK.js";import"./ui-components-7w1-MJre.js";const ks=()=>{var he,ue,je,ve;He();const{toast:m}=We(),[t,c]=x.useState(""),[D,q]=x.useState("all"),[C,I]=x.useState("all"),[v,j]=x.useState("all"),[y,_e]=x.useState("list"),[se,be]=x.useState("dueDate"),[P,Se]=x.useState("asc"),[ae,ke]=x.useState(!1),[a,B]=x.useState(null),[Re,F]=x.useState(!1),[qe,A]=x.useState(!1),[Fe,z]=x.useState(!1),[r,p]=x.useState({name:"",category:"",description:"",driver_id:"",due_date:"",priority:"medium",is_urgent:!1}),[_,$]=x.useState({status:"approved",notes:""}),{data:re=[],isLoading:Ae,error:Me,refetch:Le}=Je(),{data:ie=[]}=Qe(),{data:Oe=[]}=Xe(),E=Ye(),U=Ze();Ke();const te=[...re.filter(s=>{var S,k,R;const d=s.name.toLowerCase().includes(t.toLowerCase())||((S=s.description)==null?void 0:S.toLowerCase().includes(t.toLowerCase()))||s.category.toLowerCase().includes(t.toLowerCase())||`${(k=s.driver)==null?void 0:k.first_name} ${(R=s.driver)==null?void 0:R.last_name}`.toLowerCase().includes(t.toLowerCase()),n=D==="all"||s.status===D,L=C==="all"||s.category===C,O=v==="all"||s.driver_id===v;return d&&n&&L&&O})].sort((s,d)=>{var L,O,S,k;let n=0;switch(se){case"name":n=s.name.localeCompare(d.name);break;case"dueDate":!s.due_date&&!d.due_date?n=0:s.due_date?d.due_date?n=new Date(s.due_date).getTime()-new Date(d.due_date).getTime():n=-1:n=1;break;case"status":n=s.status.localeCompare(d.status);break;case"priority":const R={critical:4,high:3,medium:2,low:1};n=R[s.priority]-R[d.priority];break;case"driver":const Pe=`${(L=s.driver)==null?void 0:L.first_name} ${(O=s.driver)==null?void 0:O.last_name}`,Be=`${(S=d.driver)==null?void 0:S.first_name} ${(k=d.driver)==null?void 0:k.last_name}`;n=Pe.localeCompare(Be);break}return P==="asc"?n:-n}),G=s=>{switch(s){case"approved":return"bg-green-100 text-green-800 border-green-200";case"uploaded":return"bg-blue-100 text-blue-800 border-blue-200";case"pending_review":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"required":return"bg-red-100 text-red-800 border-red-200";case"expired":return"bg-gray-100 text-gray-800 border-gray-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},le=s=>{switch(s){case"approved":return e.jsx(js,{className:"w-4 h-4"});case"uploaded":return e.jsx(us,{className:"w-4 h-4"});case"pending_review":return e.jsx(hs,{className:"w-4 h-4"});case"required":return e.jsx(ms,{className:"w-4 h-4"});case"expired":return e.jsx(Ce,{className:"w-4 h-4"});case"rejected":return e.jsx(Ce,{className:"w-4 h-4"});default:return e.jsx(xs,{className:"w-4 h-4"})}},ne=s=>{switch(s){case"critical":return"bg-red-500";case"high":return"bg-orange-500";case"medium":return"bg-yellow-500";case"low":return"bg-green-500";default:return"bg-gray-500"}},Te=()=>H(void 0,null,function*(){if(!r.name||!r.category||!r.driver_id){m({title:"Missing required fields",description:"Please fill in all required fields.",variant:"destructive"});return}try{yield E.mutateAsync({name:r.name,category:r.category,description:r.description,driver_id:r.driver_id,due_date:r.due_date||void 0,priority:r.priority,is_urgent:r.is_urgent}),F(!1),p({name:"",category:"",description:"",driver_id:"",due_date:"",priority:"medium",is_urgent:!1})}catch(s){console.error("Failed to request document:",s)}}),Ve=()=>H(void 0,null,function*(){if(a)try{yield U.mutateAsync({documentId:a.id,status:_.status,notes:_.notes}),A(!1),$({status:"approved",notes:""}),B(null)}catch(s){console.error("Failed to review document:",s)}}),ce=s=>{B(s),z(!0)},de=s=>{B(s),A(!0)},oe=[{id:"License",name:"License Documents"},{id:"Medical",name:"Medical Certificates"},{id:"Training",name:"Training Certificates"},{id:"Insurance",name:"Insurance Documents"},{id:"Background",name:"Background Checks"},{id:"Other",name:"Other Documents"}],Ie=[{id:"required",name:"Required"},{id:"uploaded",name:"Uploaded"},{id:"pending_review",name:"Pending Review"},{id:"approved",name:"Approved"},{id:"rejected",name:"Rejected"},{id:"expired",name:"Expired"}],M=te.filter(s=>s.is_urgent||s.status==="required"),xe=te.filter(s=>!s.is_urgent&&s.status!=="required"),me=Oe.filter(s=>!s.is_read);return Ae?e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading driver documents..."})]})}):Me?e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(we,{className:"h-8 w-8 text-red-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Failed to load driver documents."}),e.jsxs(o,{onClick:()=>Le(),className:"mt-4",children:[e.jsx(es,{className:"w-4 h-4 mr-2"}),"Retry"]})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Driver Documents Management"}),e.jsxs("p",{className:"text-gray-600",children:[re.length," total documents • ",M.length," require attention"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[me.length>0&&e.jsxs(b,{variant:"destructive",className:"flex items-center space-x-1",children:[e.jsx(ss,{className:"w-3 h-3"}),e.jsx("span",{children:me.length})]}),e.jsxs(o,{onClick:()=>F(!0),children:[e.jsx(as,{className:"w-4 h-4 mr-2"}),"Request Document"]})]})]}),e.jsx(T,{children:e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(rs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(W,{placeholder:"Search documents, drivers...",value:t,onChange:s=>c(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>ke(!ae),children:[e.jsx(is,{className:"w-4 h-4 mr-2"}),"Filters"]}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>_e(y==="list"?"grid":"list"),children:y==="list"?e.jsx(ts,{className:"w-4 h-4"}):e.jsx(ls,{className:"w-4 h-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>Se(P==="asc"?"desc":"asc"),children:P==="asc"?e.jsx(ns,{className:"w-4 h-4"}):e.jsx(cs,{className:"w-4 h-4"})})]}),ae&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Category"}),e.jsxs(g,{value:C,onValueChange:I,children:[e.jsx(N,{children:e.jsx(f,{placeholder:"All Categories"})}),e.jsxs(w,{children:[e.jsx(l,{value:"all",children:"All Categories"}),oe.map(s=>e.jsx(l,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Status"}),e.jsxs(g,{value:D,onValueChange:q,children:[e.jsx(N,{children:e.jsx(f,{placeholder:"All Status"})}),e.jsxs(w,{children:[e.jsx(l,{value:"all",children:"All Status"}),Ie.map(s=>e.jsx(l,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Driver"}),e.jsxs(g,{value:v,onValueChange:j,children:[e.jsx(N,{children:e.jsx(f,{placeholder:"All Drivers"})}),e.jsxs(w,{children:[e.jsx(l,{value:"all",children:"All Drivers"}),ie.map(s=>e.jsxs(l,{value:s.id,children:[s.first_name," ",s.last_name]},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Sort By"}),e.jsxs(g,{value:se,onValueChange:s=>be(s),children:[e.jsx(N,{children:e.jsx(f,{})}),e.jsxs(w,{children:[e.jsx(l,{value:"name",children:"Name"}),e.jsx(l,{value:"dueDate",children:"Due Date"}),e.jsx(l,{value:"status",children:"Status"}),e.jsx(l,{value:"priority",children:"Priority"}),e.jsx(l,{value:"driver",children:"Driver"})]})]})]})]})]})})}),M.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-red-700 flex items-center",children:[e.jsx(we,{className:"w-5 h-5 mr-2"}),"Requires Attention (",M.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:M.map(s=>{var d,n;return e.jsx(T,{className:"border-red-200 bg-red-50",children:e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:`w-3 h-3 rounded-full ${ne(s.priority)}`})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[s.category," • ",s.description]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Driver: ",(d=s.driver)==null?void 0:d.first_name," ",(n=s.driver)==null?void 0:n.last_name]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(b,{className:G(s.status),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[le(s.status),e.jsx("span",{className:"text-xs",children:s.status.replace("_"," ")})]})}),s.is_urgent&&e.jsx(b,{variant:"destructive",className:"text-xs",children:"Urgent"})]}),e.jsx("div",{className:"flex items-center space-x-4 text-xs text-gray-500 mt-2",children:s.due_date&&e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(ye,{className:"w-3 h-3"}),e.jsxs("span",{children:["Due: ",ee(new Date(s.due_date),"MMM dd, yyyy")]})]})})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[s.status==="uploaded"&&e.jsx(o,{variant:"default",size:"sm",onClick:()=>de(s),className:"bg-blue-600 hover:bg-blue-700",children:e.jsx(De,{className:"w-4 h-4"})}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>ce(s),className:"p-1",children:e.jsx(Q,{className:"w-4 h-4"})})]})]})})]})})},s.id)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"All Documents"}),xe.length===0?e.jsx(T,{children:e.jsxs(V,{className:"p-8 text-center",children:[e.jsx(ds,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:t||C!=="all"||D!=="all"||v!=="all"?"No documents match your filters":"No other documents available"})]})}):e.jsx("div",{className:y==="grid"?"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4":"space-y-4",children:xe.map(s=>{var d,n;return e.jsx(T,{children:e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:`w-3 h-3 rounded-full ${ne(s.priority)}`})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[s.category," • ",s.description]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Driver: ",(d=s.driver)==null?void 0:d.first_name," ",(n=s.driver)==null?void 0:n.last_name]}),e.jsx("div",{className:"flex items-center space-x-2 mt-2",children:e.jsx(b,{className:G(s.status),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[le(s.status),e.jsx("span",{className:"text-xs",children:s.status.replace("_"," ")})]})})}),e.jsx("div",{className:"flex items-center space-x-4 text-xs text-gray-500 mt-2",children:s.due_date&&e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(ye,{className:"w-3 h-3"}),e.jsxs("span",{children:["Due: ",ee(new Date(s.due_date),"MMM dd, yyyy")]})]})})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[s.status==="uploaded"&&e.jsx(o,{variant:"default",size:"sm",onClick:()=>de(s),className:"bg-blue-600 hover:bg-blue-700",children:e.jsx(De,{className:"w-4 h-4"})}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>ce(s),className:"p-1",children:e.jsx(Q,{className:"w-4 h-4"})})]})]})})]})})},s.id)})})]}),e.jsx(J,{open:Re,onOpenChange:F,children:e.jsxs(X,{className:"max-w-md",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Request Document from Driver"}),e.jsx(Ne,{children:"Create a new document request for a driver."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Document Name *"}),e.jsx(W,{value:r.name,onChange:s=>p(u(h({},r),{name:s.target.value})),placeholder:"e.g., Driver License"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Category *"}),e.jsxs(g,{value:r.category,onValueChange:s=>p(u(h({},r),{category:s})),children:[e.jsx(N,{children:e.jsx(f,{placeholder:"Select category"})}),e.jsx(w,{children:oe.map(s=>e.jsx(l,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Driver *"}),e.jsxs(g,{value:r.driver_id,onValueChange:s=>p(u(h({},r),{driver_id:s})),children:[e.jsx(N,{children:e.jsx(f,{placeholder:"Select driver"})}),e.jsx(w,{children:ie.map(s=>e.jsxs(l,{value:s.id,children:[s.first_name," ",s.last_name]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Description"}),e.jsx(fe,{value:r.description,onChange:s=>p(u(h({},r),{description:s.target.value})),placeholder:"Document description...",rows:3})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Due Date"}),e.jsx(W,{type:"date",value:r.due_date,onChange:s=>p(u(h({},r),{due_date:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Priority"}),e.jsxs(g,{value:r.priority,onValueChange:s=>p(u(h({},r),{priority:s})),children:[e.jsx(N,{children:e.jsx(f,{})}),e.jsxs(w,{children:[e.jsx(l,{value:"low",children:"Low"}),e.jsx(l,{value:"medium",children:"Medium"}),e.jsx(l,{value:"high",children:"High"}),e.jsx(l,{value:"critical",children:"Critical"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"urgent",checked:r.is_urgent,onChange:s=>p(u(h({},r),{is_urgent:s.target.checked})),className:"rounded"}),e.jsx(i,{htmlFor:"urgent",children:"Mark as urgent"})]})]}),e.jsxs(K,{children:[e.jsx(o,{variant:"outline",onClick:()=>F(!1),children:"Cancel"}),e.jsx(o,{onClick:Te,disabled:E.isPending,children:E.isPending?"Creating...":"Request Document"})]})]})}),e.jsx(J,{open:qe,onOpenChange:A,children:e.jsxs(X,{className:"max-w-md",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Review Document"}),e.jsx(Ne,{children:"Review and approve or reject the uploaded document."})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Driver: ",(he=a.driver)==null?void 0:he.first_name," ",(ue=a.driver)==null?void 0:ue.last_name]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Category: ",a.category]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Status"}),e.jsxs(g,{value:_.status,onValueChange:s=>$(u(h({},_),{status:s})),children:[e.jsx(N,{children:e.jsx(f,{})}),e.jsxs(w,{children:[e.jsx(l,{value:"approved",children:"Approve"}),e.jsx(l,{value:"rejected",children:"Reject"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Notes"}),e.jsx(fe,{value:_.notes,onChange:s=>$(u(h({},_),{notes:s.target.value})),placeholder:"Add review notes...",rows:3})]})]}),e.jsxs(K,{children:[e.jsx(o,{variant:"outline",onClick:()=>A(!1),children:"Cancel"}),e.jsx(o,{onClick:Ve,disabled:U.isPending,children:U.isPending?"Reviewing...":"Submit Review"})]})]})}),e.jsx(J,{open:Fe,onOpenChange:z,children:e.jsxs(X,{className:"max-w-2xl",children:[e.jsx(Y,{children:e.jsx(Z,{children:"Document Details"})}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Document Name"}),e.jsx("p",{className:"text-sm",children:a.name})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Category"}),e.jsx("p",{className:"text-sm",children:a.category})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Driver"}),e.jsxs("p",{className:"text-sm",children:[(je=a.driver)==null?void 0:je.first_name," ",(ve=a.driver)==null?void 0:ve.last_name]})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Status"}),e.jsx(b,{className:G(a.status),children:a.status.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Priority"}),e.jsx(b,{variant:"outline",children:a.priority})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Due Date"}),e.jsx("p",{className:"text-sm",children:a.due_date?ee(new Date(a.due_date),"MMM dd, yyyy"):"Not set"})]})]}),a.description&&e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Description"}),e.jsx("p",{className:"text-sm",children:a.description})]}),a.file_url&&e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"File"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>window.open(a.file_url,"_blank"),children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"View File"]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>window.open(a.file_url,"_blank"),children:[e.jsx(os,{className:"w-4 h-4 mr-2"}),"Download"]})]})]}),a.driver_notes&&e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Driver Notes"}),e.jsx("p",{className:"text-sm",children:a.driver_notes})]}),a.admin_notes&&e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Admin Notes"}),e.jsx("p",{className:"text-sm",children:a.admin_notes})]})]}),e.jsx(K,{children:e.jsx(o,{variant:"outline",onClick:()=>z(!1),children:"Close"})})]})})]})};export{ks as default};
