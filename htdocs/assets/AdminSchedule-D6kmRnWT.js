import{j as e}from"./ui-vendor-DMUr7mTx.js";import{r as u}from"./react-vendor-BvqlMsL5.js";import{u as H,S as d,q as x,r as h,t as o,v as a,D as q,F as U,B as n,m as W,n as Y,o as G,p as K,L as r,I as m,C as l,d as t,h as Q,i as X,j as v,k as p,a as N,b as y,e as j}from"./index-ZwIgorfy.js";import{u as Z,a as ee,b as se}from"./useSchedules-P7CgD3AR.js";import{u as ae}from"./useDrivers-BY9VTvBN.js";import{u as le}from"./useVehicles-uD3YILF5.js";import{u as te}from"./useRoutes-CuFbmWya.js";import{N as _}from"./router-vendor-CEyBJ8vK.js";import{aJ as c,E as re,M as T,J as ie,j as R,a as f,f as b,aa as ne,Y as M}from"./icons-vendor-b0I7fGSL.js";import{f as w}from"./utils-vendor-B2FlkASS.js";import"./supabase-vendor-B984m0TI.js";import"./query-vendor-B2F_wWlc.js";import"./ui-components-7w1-MJre.js";const fe=()=>{const{user:V,profile:S,loading:k}=H(),[C,E]=u.useState(new Date),[L,A]=u.useState("week"),[F,I]=u.useState(!1);u.useState({driver_id:"",vehicle_id:"",route_id:"",start_time:"",end_time:"",job_type:"school_run",status:"scheduled",notes:""});const{data:D=[],isLoading:O,error:ce}=Z(),g=ee(),{data:B=[]}=ae(),{data:P=[]}=le();if(te(),se(),k||O)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading schedule..."})]})});if(!V||!S)return e.jsx(_,{to:"/auth",replace:!0});if(!["admin","council"].includes(S.role))return e.jsx(_,{to:"/unauthorized",replace:!0});const i={totalRoutes:g.total,completedRoutes:g.completed,activeRoutes:g.in_progress,scheduledMaintenance:g.by_job_type.maintenance||0,availableDrivers:B.filter(s=>s.is_active).length,availableVehicles:P.filter(s=>s.status==="active").length},J=s=>{switch(s){case"scheduled":return e.jsx(j,{className:"bg-blue-100 text-blue-800 hover:bg-blue-100",children:"Scheduled"});case"in_progress":return e.jsx(j,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"In Progress"});case"completed":return e.jsx(j,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"Completed"});case"cancelled":return e.jsx(j,{className:"bg-red-100 text-red-800 hover:bg-red-100",children:"Cancelled"});default:return e.jsx(j,{variant:"secondary",children:s})}},z=s=>{switch(s){case"school_run":case"route":return e.jsx(T,{className:"w-4 h-4"});case"maintenance":return e.jsx(f,{className:"w-4 h-4"});case"training":return e.jsx(b,{className:"w-4 h-4"});default:return e.jsx(c,{className:"w-4 h-4"})}},$=s=>{switch(s){case"school_run":case"route":return"bg-blue-500";case"maintenance":return"bg-orange-500";case"training":return"bg-green-500";default:return"bg-gray-500"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:justify-between lg:items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl lg:text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(c,{className:"w-6 h-6 lg:w-8 lg:h-8 text-red-600"}),"Resource Scheduling"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage driver schedules, vehicle assignments, and maintenance"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(d,{value:L,onValueChange:A,children:[e.jsx(x,{className:"w-32",children:e.jsx(h,{})}),e.jsxs(o,{children:[e.jsx(a,{value:"day",children:"Day View"}),e.jsx(a,{value:"week",children:"Week View"}),e.jsx(a,{value:"month",children:"Month View"})]})]}),e.jsxs(q,{open:F,onOpenChange:I,children:[e.jsx(U,{asChild:!0,children:e.jsxs(n,{className:"bg-red-600 hover:bg-red-700",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Schedule Event"]})}),e.jsxs(W,{className:"max-w-md","aria-describedby":"dialog-description",children:[e.jsxs(Y,{children:[e.jsx(G,{children:"Schedule New Event"}),e.jsx(K,{id:"dialog-description",children:"Create a new schedule event for drivers, vehicles, or maintenance."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"event-type",children:"Event Type"}),e.jsxs(d,{children:[e.jsx(x,{children:e.jsx(h,{placeholder:"Select event type"})}),e.jsxs(o,{children:[e.jsx(a,{value:"route",children:"Route Assignment"}),e.jsx(a,{value:"maintenance",children:"Vehicle Maintenance"}),e.jsx(a,{value:"training",children:"Driver Training"}),e.jsx(a,{value:"meeting",children:"Team Meeting"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"title",children:"Title"}),e.jsx(m,{id:"title",placeholder:"Event title"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"start-time",children:"Start Time"}),e.jsx(m,{id:"start-time",type:"time"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"end-time",children:"End Time"}),e.jsx(m,{id:"end-time",type:"time"})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"date",children:"Date"}),e.jsx(m,{id:"date",type:"date"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"driver",children:"Assign Driver"}),e.jsxs(d,{children:[e.jsx(x,{children:e.jsx(h,{placeholder:"Select driver"})}),e.jsxs(o,{children:[e.jsx(a,{value:"john",children:"John Smith"}),e.jsx(a,{value:"sarah",children:"Sarah Johnson"}),e.jsx(a,{value:"mike",children:"Mike Davis"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"vehicle",children:"Assign Vehicle"}),e.jsxs(d,{children:[e.jsx(x,{children:e.jsx(h,{placeholder:"Select vehicle"})}),e.jsxs(o,{children:[e.jsx(a,{value:"LSR-001",children:"LSR-001"}),e.jsx(a,{value:"LSR-002",children:"LSR-002"}),e.jsx(a,{value:"LSR-003",children:"LSR-003"})]})]})]}),e.jsx(n,{className:"w-full bg-red-600 hover:bg-red-700",children:"Create Event"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-6 gap-6",children:[e.jsx(l,{children:e.jsx(t,{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-blue-100 rounded-lg flex-shrink-0",children:e.jsx(T,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-600 truncate",children:"Total Routes"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:i.totalRoutes})]})]})})}),e.jsx(l,{children:e.jsx(t,{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-green-100 rounded-lg flex-shrink-0",children:e.jsx(ie,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-600 truncate",children:"Completed"}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:i.completedRoutes})]})]})})}),e.jsx(l,{children:e.jsx(t,{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-yellow-100 rounded-lg flex-shrink-0",children:e.jsx(R,{className:"w-4 h-4 text-yellow-600"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-600 truncate",children:"Active"}),e.jsx("p",{className:"text-lg font-bold text-yellow-600",children:i.activeRoutes})]})]})})}),e.jsx(l,{children:e.jsx(t,{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-orange-100 rounded-lg flex-shrink-0",children:e.jsx(f,{className:"w-4 h-4 text-orange-600"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-600 truncate",children:"Maintenance"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:i.scheduledMaintenance})]})]})})}),e.jsx(l,{children:e.jsx(t,{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-purple-100 rounded-lg flex-shrink-0",children:e.jsx(b,{className:"w-4 h-4 text-purple-600"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-600 truncate",children:"Available Drivers"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:i.availableDrivers})]})]})})}),e.jsx(l,{children:e.jsx(t,{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-blue-100 rounded-lg flex-shrink-0",children:e.jsx(f,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-600 truncate",children:"Available Vehicles"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:i.availableVehicles})]})]})})})]}),e.jsxs(Q,{defaultValue:"timeline",className:"space-y-6",children:[e.jsxs(X,{className:"grid w-full grid-cols-2 lg:grid-cols-4",children:[e.jsx(v,{value:"timeline",children:"Timeline View"}),e.jsx(v,{value:"calendar",children:"Calendar View"}),e.jsx(v,{value:"resources",children:"Resource Planning"}),e.jsx(v,{value:"conflicts",children:"Conflict Resolution"})]}),e.jsx(p,{value:"timeline",className:"space-y-4",children:e.jsxs(l,{children:[e.jsxs(N,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),"Today's Schedule - ",w(new Date,"EEEE, MMMM do, yyyy")]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"w-4 h-4 text-gray-500"}),e.jsx(m,{type:"date",value:C?w(C,"yyyy-MM-dd"):w(new Date,"yyyy-MM-dd"),onChange:s=>E(new Date(s.target.value)),className:"w-48"})]}),e.jsxs(d,{children:[e.jsx(x,{className:"w-48",children:e.jsx(h,{placeholder:"Filter by type"})}),e.jsxs(o,{children:[e.jsx(a,{value:"all",children:"All Events"}),e.jsx(a,{value:"route",children:"Routes Only"}),e.jsx(a,{value:"maintenance",children:"Maintenance Only"}),e.jsx(a,{value:"training",children:"Training Only"})]})]})]})]}),e.jsx(t,{children:e.jsx("div",{className:"space-y-4",children:D.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(c,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Schedules Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"No scheduled events for today. Create your first schedule to get started."})]}):D.map(s=>e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4 p-4 border rounded-lg hover:bg-gray-50",children:[e.jsx("div",{className:`w-1 h-16 rounded ${$(s.job_type)}`}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[z(s.job_type),e.jsx("h3",{className:"font-medium",children:s.job_type==="school_run"?"School Transport":s.job_type==="maintenance"?"Vehicle Maintenance":s.job_type==="training"?"Driver Training":s.job_type}),J(s.status)]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[new Date(s.start_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," - ",new Date(s.end_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{className:"flex gap-4 text-xs text-gray-500",children:[s.driver&&e.jsxs("span",{children:["Driver: ",s.driver.first_name," ",s.driver.last_name]}),s.vehicle&&e.jsxs("span",{children:["Vehicle: ",s.vehicle.vehicle_number]}),s.route&&e.jsxs("span",{children:["Route: ",s.route.name||`${s.route.start_location} → ${s.route.end_location}`]}),s.notes&&e.jsxs("span",{children:["Notes: ",s.notes]})]})]}),e.jsx(n,{variant:"outline",size:"sm",children:e.jsx(ne,{className:"w-4 h-4"})})]},s.id))})})]})}),e.jsx(p,{value:"calendar",className:"space-y-4",children:e.jsxs(l,{children:[e.jsx(N,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(c,{className:"w-5 h-5"}),"Calendar View"]})}),e.jsx(t,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(c,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Full Calendar Integration"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Interactive calendar view with drag-and-drop scheduling capabilities."}),e.jsx(n,{className:"bg-red-600 hover:bg-red-700",children:"Open Full Calendar"})]})})]})}),e.jsx(p,{value:"resources",className:"space-y-4",children:e.jsxs(l,{children:[e.jsx(N,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5"}),"Resource Availability"]})}),e.jsx(t,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(b,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Resource Planning"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"View driver and vehicle availability, manage assignments, and optimize resource allocation."}),e.jsx(n,{className:"bg-red-600 hover:bg-red-700",children:"Manage Resources"})]})})]})}),e.jsx(p,{value:"conflicts",className:"space-y-4",children:e.jsxs(l,{children:[e.jsx(N,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5"}),"Schedule Conflicts"]})}),e.jsx(t,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(M,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Conflicts Detected"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"All scheduled events are properly assigned without conflicts."}),e.jsx(n,{variant:"outline",children:"Run Conflict Check"})]})})]})})]})]})};export{fe as default};
