var T=(g,m,n)=>new Promise((w,u)=>{var v=t=>{try{j(n.next(t))}catch(p){u(p)}},c=t=>{try{j(n.throw(t))}catch(p){u(p)}},j=t=>t.done?w(t.value):Promise.resolve(t.value).then(v,c);j((n=n.apply(g,m)).next())});import{j as e}from"./ui-vendor-DMUr7mTx.js";import{r as i}from"./react-vendor-BvqlMsL5.js";import{u as J,l as K,s as M,B as o,C as x,d as h,a as R,b as z,L as r,I as Q,S as D,q as F,r as L,t as I,v as a,e as y,D as W,F as X,m as Z,n as k,o as ee}from"./index-ZwIgorfy.js";import{T as V,S as se,a5 as re,a2 as ae,a0 as le,b7 as te,U as ie,h as ne,j as ce,aa as de}from"./icons-vendor-b0I7fGSL.js";import"./supabase-vendor-B984m0TI.js";import"./utils-vendor-B2FlkASS.js";import"./query-vendor-B2F_wWlc.js";import"./router-vendor-CEyBJ8vK.js";import"./ui-components-7w1-MJre.js";function ye(){const{profile:g}=J(),{toast:m}=K(),[n,w]=i.useState([]),[u,v]=i.useState(!0);i.useState(null);const[c,j]=i.useState(""),[t,p]=i.useState("all"),[b,q]=i.useState("all"),[S,O]=i.useState("all"),B={low:"bg-green-100 text-green-800",medium:"bg-yellow-100 text-yellow-800",high:"bg-orange-100 text-orange-800",urgent:"bg-red-100 text-red-800"},H={low:"ðŸŸ¢",medium:"ðŸŸ¡",high:"ðŸŸ ",urgent:"ðŸ”´"},Y={open:"bg-blue-100 text-blue-800",in_progress:"bg-yellow-100 text-yellow-800",resolved:"bg-green-100 text-green-800",closed:"bg-gray-100 text-gray-800"};i.useEffect(()=>{C()},[]);const C=()=>T(this,null,function*(){try{v(!0);const{data:s,error:l}=yield M.from("support_tickets").select("*").order("created_at",{ascending:!1});if(l)throw l;w(s||[])}catch(s){console.error("Error fetching tickets:",s),m({title:"Error",description:"Failed to fetch support tickets.",variant:"destructive"})}finally{v(!1)}}),N=(s,l)=>T(this,null,function*(){try{const{error:d}=yield M.from("support_tickets").update({status:l,resolved_at:l==="resolved"?new Date().toISOString():null}).eq("id",s);if(d)throw d;m({title:"Success",description:`Ticket status updated to ${l}.`}),C()}catch(d){console.error("Error updating ticket:",d),m({title:"Error",description:"Failed to update ticket status.",variant:"destructive"})}}),_=n.filter(s=>{var E,U,P,A;const l=(((E=s.subject)==null?void 0:E.toLowerCase())||"").includes(c.toLowerCase())||(((U=s.user_name)==null?void 0:U.toLowerCase())||"").includes(c.toLowerCase())||(((P=s.user_email)==null?void 0:P.toLowerCase())||"").includes(c.toLowerCase())||(((A=s.ticket_id)==null?void 0:A.toLowerCase())||"").includes(c.toLowerCase()),d=t==="all"||s.status===t,$=b==="all"||s.type===b,G=S==="all"||s.priority===S;return l&&d&&$&&G}),f=(()=>{const s={open:0,in_progress:0,resolved:0,closed:0};return n.forEach(l=>{l.status&&s.hasOwnProperty(l.status)&&s[l.status]++}),s})();return!g||!["admin","council"].includes(g.role)?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(V,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-muted-foreground",children:"You don't have permission to view support tickets."})]})}):e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Support Tickets"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage support requests and feature suggestions"})]}),e.jsxs(o,{onClick:C,disabled:u,children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(x,{children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),e.jsx("span",{className:"text-sm font-medium",children:"Open"})]}),e.jsx("p",{className:"text-2xl font-bold",children:f.open})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),e.jsx("span",{className:"text-sm font-medium",children:"In Progress"})]}),e.jsx("p",{className:"text-2xl font-bold",children:f.in_progress})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-sm font-medium",children:"Resolved"})]}),e.jsx("p",{className:"text-2xl font-bold",children:f.resolved})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-500 rounded-full"}),e.jsx("span",{className:"text-sm font-medium",children:"Closed"})]}),e.jsx("p",{className:"text-2xl font-bold",children:f.closed})]})})]}),e.jsxs(x,{children:[e.jsx(R,{children:e.jsxs(z,{className:"flex items-center space-x-2",children:[e.jsx(re,{className:"w-5 h-5"}),e.jsx("span",{children:"Filters"})]})}),e.jsx(h,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"search",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(Q,{id:"search",placeholder:"Search tickets...",value:c,onChange:s=>j(s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"status",children:"Status"}),e.jsxs(D,{value:t,onValueChange:p,children:[e.jsx(F,{children:e.jsx(L,{})}),e.jsxs(I,{children:[e.jsx(a,{value:"all",children:"All Status"}),e.jsx(a,{value:"open",children:"Open"}),e.jsx(a,{value:"in_progress",children:"In Progress"}),e.jsx(a,{value:"resolved",children:"Resolved"}),e.jsx(a,{value:"closed",children:"Closed"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"type",children:"Type"}),e.jsxs(D,{value:b,onValueChange:q,children:[e.jsx(F,{children:e.jsx(L,{})}),e.jsxs(I,{children:[e.jsx(a,{value:"all",children:"All Types"}),e.jsx(a,{value:"support",children:"Support"}),e.jsx(a,{value:"suggestion",children:"Suggestion"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"priority",children:"Priority"}),e.jsxs(D,{value:S,onValueChange:O,children:[e.jsx(F,{children:e.jsx(L,{})}),e.jsxs(I,{children:[e.jsx(a,{value:"all",children:"All Priorities"}),e.jsx(a,{value:"low",children:"Low"}),e.jsx(a,{value:"medium",children:"Medium"}),e.jsx(a,{value:"high",children:"High"}),e.jsx(a,{value:"urgent",children:"Urgent"})]})]})]})]})})]}),e.jsxs(x,{children:[e.jsx(R,{children:e.jsxs(z,{children:["Tickets (",_.length,")"]})}),e.jsx(h,{children:u?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):_.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(le,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No tickets found."})]}):e.jsx("div",{className:"space-y-4",children:_.map(s=>e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[(s.type||"support")==="support"?e.jsx(V,{className:"w-4 h-4 text-red-600"}):e.jsx(te,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium",children:s.subject||"No Subject"}),e.jsx(y,{variant:"outline",className:"text-xs",children:s.ticket_id||"No ID"})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground mb-2",children:[e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(ie,{className:"w-3 h-3"}),e.jsx("span",{children:s.user_name||"Unknown User"})]}),e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(ne,{className:"w-3 h-3"}),e.jsx("span",{children:s.user_email||"No Email"})]}),e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(ce,{className:"w-3 h-3"}),e.jsx("span",{children:s.created_at?new Date(s.created_at).toLocaleDateString():"Unknown Date"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(y,{className:B[s.priority]||"bg-gray-100 text-gray-800",children:[H[s.priority]||"âšª"," ",s.priority||"unknown"]}),e.jsx(y,{className:Y[s.status]||"bg-gray-100 text-gray-800",children:(s.status||"unknown").replace("_"," ")}),e.jsx(y,{variant:"outline",children:(s.type||"support")==="support"?"IT Support":"Feature Suggestion"})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(W,{children:[e.jsx(X,{asChild:!0,children:e.jsx(o,{variant:"outline",size:"sm",children:e.jsx(de,{className:"w-4 h-4"})})}),e.jsxs(Z,{className:"max-w-2xl",children:[e.jsx(k,{children:e.jsxs(ee,{children:["Ticket Details - ",s.ticket_id||"No ID"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Type"}),e.jsx("p",{className:"text-sm",children:(s.type||"support")==="support"?"IT Support":"Feature Suggestion"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Priority"}),e.jsx("p",{className:"text-sm",children:s.priority})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Status"}),e.jsx("p",{className:"text-sm",children:s.status})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Created"}),e.jsx("p",{className:"text-sm",children:s.created_at?new Date(s.created_at).toLocaleString():"Unknown Date"})]})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Subject"}),e.jsx("p",{className:"text-sm font-medium",children:s.subject||"No Subject"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Description"}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.description||"No description provided"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"User Name"}),e.jsx("p",{className:"text-sm",children:s.user_name||"Unknown User"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"User Email"}),e.jsx("p",{className:"text-sm",children:s.user_email||"No Email"})]}),s.user_phone&&e.jsxs("div",{children:[e.jsx(r,{children:"Phone"}),e.jsx("p",{className:"text-sm",children:s.user_phone})]}),s.app_version&&e.jsxs("div",{children:[e.jsx(r,{children:"App Version"}),e.jsx("p",{className:"text-sm",children:s.app_version})]})]}),s.device_info&&e.jsxs("div",{children:[e.jsx(r,{children:"Device Info"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.device_info})]}),e.jsxs("div",{className:"flex space-x-2",children:[s.status==="open"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{size:"sm",onClick:()=>N(s.id,"in_progress"),children:"Mark In Progress"}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>N(s.id,"resolved"),children:"Mark Resolved"})]}),s.status==="in_progress"&&e.jsx(o,{size:"sm",onClick:()=>N(s.id,"resolved"),children:"Mark Resolved"}),s.status==="resolved"&&e.jsx(o,{size:"sm",variant:"outline",onClick:()=>N(s.id,"closed"),children:"Close Ticket"})]})]})]})]})})]})},s.id))})})]})]})}export{ye as default};
