var z=(a,m,o)=>new Promise((d,p)=>{var i=t=>{try{j(o.next(t))}catch(T){p(T)}},y=t=>{try{j(o.throw(t))}catch(T){p(T)}},j=t=>t.done?d(t.value):Promise.resolve(t.value).then(i,y);j((o=o.apply(a,m)).next())});import{j as e}from"./ui-vendor-DMUr7mTx.js";import{r as k}from"./react-vendor-BvqlMsL5.js";import{u as K,s as M,S as G,q as H,r as Q,t as W,v as P,B as R,C as u,d as h,h as X,i as Y,j as _,k as D,a as N,b as w,P as Z,e as ee}from"./index-ZwIgorfy.js";import{u as F}from"./query-vendor-B2F_wWlc.js";import{N as ae}from"./router-vendor-CEyBJ8vK.js";import{D as E,M as te,bf as $,l as se,A as V,J as ne,t as L,ab as O,m as B,aN as ie,bg as J,bh as re,f as ce,a as le,j as oe,bi as de,bj as me}from"./icons-vendor-b0I7fGSL.js";import"./supabase-vendor-B984m0TI.js";import"./utils-vendor-B2FlkASS.js";import"./ui-components-7w1-MJre.js";const ue=()=>{const{profile:a}=K(),{data:m=[]}=F({queryKey:["analytics-vehicles",a==null?void 0:a.organization_id],queryFn:()=>z(void 0,null,function*(){if(!(a!=null&&a.organization_id))return[];const{data:r,error:n}=yield M.from("vehicles").select("*").eq("organization_id",a.organization_id);return n?(console.error("Error fetching vehicles for analytics:",n),[]):r||[]}),enabled:!!(a!=null&&a.organization_id)}),{data:o=[]}=F({queryKey:["analytics-drivers",a==null?void 0:a.organization_id],queryFn:()=>z(void 0,null,function*(){if(!(a!=null&&a.organization_id))return[];const{data:r,error:n}=yield M.from("profiles").select("*").eq("role","driver").eq("organization_id",a.organization_id);return n?(console.error("Error fetching drivers for analytics:",n),[]):r||[]}),enabled:!!(a!=null&&a.organization_id)}),{data:d=[]}=F({queryKey:["analytics-jobs",a==null?void 0:a.organization_id],queryFn:()=>z(void 0,null,function*(){if(!(a!=null&&a.organization_id))return[];const{data:r,error:n}=yield M.from("jobs").select("*").eq("organization_id",a.organization_id).order("created_at",{ascending:!1}).limit(1e3);return n?(console.error("Error fetching jobs for analytics:",n),[]):r||[]}),enabled:!!(a!=null&&a.organization_id)}),{data:p=[]}=F({queryKey:["analytics-routes",a==null?void 0:a.organization_id],queryFn:()=>z(void 0,null,function*(){if(!(a!=null&&a.organization_id))return[];const{data:r,error:n}=yield M.from("routes").select("*").eq("organization_id",a.organization_id);return n?(console.error("Error fetching routes for analytics:",n),[]):r||[]}),enabled:!!(a!=null&&a.organization_id)}),y=(()=>{const n=d.filter(x=>x.status==="completed").reduce((x,q)=>x+(q.total_amount||0),0),S=d.length;d.filter(x=>{const q=new Date(x.created_at),U=new Date;return U.setMonth(U.getMonth()-1),q>=U}).length;const f=m.filter(x=>x.status==="active"||x.is_active).length,v=m.length,C=v>0?f/v*100:0,b=o.filter(x=>x.is_active).length,s=0,l=0,c=o.length>0?b/o.length*100:0,g=v>0?f/v*100:0,I=(c+g)/2;return{revenue:{value:`£${n.toLocaleString()}`,change:0,changeType:"neutral"},trips:{value:S.toString(),change:0,changeType:"neutral"},efficiency:{value:`${C.toFixed(1)}%`,change:0,changeType:"neutral"},drivers:{value:b.toString(),change:0,changeType:"neutral"},routes:{value:p.length.toString(),change:0,changeType:"neutral"},vehicles:{value:v.toString(),change:0,changeType:"neutral"},fuel:{value:`£${s.toLocaleString()}`,change:0,changeType:"neutral"},maintenance:{value:`£${l.toLocaleString()}`,change:0,changeType:"neutral"},compliance:{value:`${I.toFixed(1)}%`,change:0,changeType:"neutral"}}})(),j=[{name:"This Month",value:parseInt(y.revenue.value.replace(/[£,]/g,"")),trend:"neutral"},{name:"Last Month",value:0,trend:"neutral"},{name:"2 Months Ago",value:0,trend:"neutral"},{name:"3 Months Ago",value:0,trend:"neutral"}],t=[{name:"School Runs",value:d.filter(r=>r.job_type==="school_run").length,color:"bg-blue-500"},{name:"Regular Routes",value:p.filter(r=>r.status==="active").length,color:"bg-green-500"},{name:"Special Events",value:d.filter(r=>r.job_type==="special_event").length,color:"bg-purple-500"},{name:"Maintenance",value:m.filter(r=>r.status==="maintenance").length,color:"bg-orange-500"}],A=(()=>{const r=o.filter(g=>g.is_active).length,n=m.length,S=m.filter(g=>g.status==="active"||g.is_active).length,f=m.filter(g=>g.status==="maintenance").length,v=d.filter(g=>g.status==="completed").length,C=n>0?S/n*100:0,b=n>0?f/n*100:0,s=n>0?(n-f)/n*100:100,l="0.0/5",c="0.0%";return{driverPerformance:{averageRating:l,punctuality:c,safetyScore:c,fuelEfficiency:c},vehicleUtilization:{averageUtilization:`${C.toFixed(1)}%`,downtime:`${b.toFixed(1)}%`,maintenanceSchedule:c,availability:`${s.toFixed(1)}%`},customerSatisfaction:{overallRating:l,onTimePerformance:c,complaintResolution:c,repeatCustomers:c},quickStats:{activeDrivers:r,fleetVehicles:n,onTimeRate:c,targetAchievement:`${Math.min(v/Math.max(d.length,1)*100,100).toFixed(1)}%`}}})();return{metrics:y,revenueData:j,serviceData:t,performanceMetrics:A,rawData:{vehicles:m,drivers:o,jobs:d,routes:p},isLoading:!1}},we=()=>{const{user:a,profile:m,loading:o}=K(),[d,p]=k.useState("30d");k.useState("revenue");const{metrics:i,revenueData:y,serviceData:j,performanceMetrics:t,rawData:T,isLoading:A}=ue();if(o)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading analytics dashboard..."})]})});if(!a||!m)return e.jsx(ae,{to:"/auth",replace:!0});if(o||A||!t)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading analytics data..."})]})});const r=[{id:"revenue",title:"Total Revenue",value:i.revenue.value,change:i.revenue.change,changeType:i.revenue.changeType,icon:E,color:"text-green-600",description:"Estimated revenue from completed jobs"},{id:"trips",title:"Total Trips",value:i.trips.value,change:i.trips.change,changeType:i.trips.changeType,icon:te,color:"text-blue-600",description:"Jobs completed this period"},{id:"efficiency",title:"Fleet Efficiency",value:i.efficiency.value,change:i.efficiency.change,changeType:i.efficiency.changeType,icon:$,color:"text-orange-600",description:"Active vehicles / total vehicles"},{id:"fuel",title:"Fuel Costs",value:i.fuel.value,change:i.fuel.change,changeType:i.fuel.changeType,icon:se,color:"text-purple-600",description:"Estimated monthly fuel expenditure"},{id:"maintenance",title:"Maintenance Costs",value:i.maintenance.value,change:i.maintenance.change,changeType:i.maintenance.changeType,icon:V,color:"text-red-600",description:"Vehicle maintenance expenses"},{id:"compliance",title:"Compliance Score",value:i.compliance.value,change:i.compliance.change,changeType:i.compliance.changeType,icon:ne,color:"text-emerald-600",description:"Driver and vehicle compliance rating"}],n=(s,l)=>{const c=parseFloat(s.replace(/[%/]/g,""));switch(l){case"rating":return c>=4.5?"excellent":c>=4?"good":"warning";case"percentage":return c>=95?"excellent":c>=85?"good":"warning";case"downtime":return c<=5?"excellent":c<=15?"good":"warning";default:return"good"}},S=[{category:"Driver Performance",metrics:[{name:"Average Rating",value:t.driverPerformance.averageRating,status:n(t.driverPerformance.averageRating,"rating")},{name:"Punctuality",value:t.driverPerformance.punctuality,status:n(t.driverPerformance.punctuality,"percentage")},{name:"Safety Score",value:t.driverPerformance.safetyScore,status:n(t.driverPerformance.safetyScore,"percentage")},{name:"Fuel Efficiency",value:t.driverPerformance.fuelEfficiency,status:n(t.driverPerformance.fuelEfficiency,"percentage")}]},{category:"Vehicle Utilization",metrics:[{name:"Average Utilization",value:t.vehicleUtilization.averageUtilization,status:n(t.vehicleUtilization.averageUtilization,"percentage")},{name:"Downtime",value:t.vehicleUtilization.downtime,status:n(t.vehicleUtilization.downtime,"downtime")},{name:"Maintenance Schedule",value:t.vehicleUtilization.maintenanceSchedule,status:n(t.vehicleUtilization.maintenanceSchedule,"percentage")},{name:"Availability",value:t.vehicleUtilization.availability,status:n(t.vehicleUtilization.availability,"percentage")}]},{category:"Customer Satisfaction",metrics:[{name:"Overall Rating",value:t.customerSatisfaction.overallRating,status:n(t.customerSatisfaction.overallRating,"rating")},{name:"On-Time Performance",value:t.customerSatisfaction.onTimePerformance,status:n(t.customerSatisfaction.onTimePerformance,"percentage")},{name:"Complaint Resolution",value:t.customerSatisfaction.complaintResolution,status:n(t.customerSatisfaction.complaintResolution,"percentage")},{name:"Repeat Customers",value:t.customerSatisfaction.repeatCustomers,status:n(t.customerSatisfaction.repeatCustomers,"percentage")}]}],f=s=>{switch(s){case"increase":return e.jsx(me,{className:"w-4 h-4 text-green-600"});case"decrease":return e.jsx(de,{className:"w-4 h-4 text-red-600"});default:return e.jsx(J,{className:"w-4 h-4 text-gray-600"})}},v=s=>{switch(s){case"increase":return"text-green-600";case"decrease":return"text-red-600";default:return"text-gray-600"}},C=s=>{switch(s){case"excellent":return"text-emerald-600";case"good":return"text-green-600";case"warning":return"text-yellow-600";case"critical":return"text-red-600";default:return"text-gray-600"}},b=s=>{const l={excellent:"bg-emerald-100 text-emerald-800",good:"bg-green-100 text-green-800",warning:"bg-yellow-100 text-yellow-800",critical:"bg-red-100 text-red-800"};return e.jsx(ee,{className:l[s]||"bg-gray-100 text-gray-800",children:s})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(L,{className:"w-8 h-8 text-blue-600"}),"Analytics Dashboard"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Comprehensive business intelligence and performance metrics"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(G,{value:d,onValueChange:p,children:[e.jsx(H,{className:"w-32",children:e.jsx(Q,{})}),e.jsxs(W,{children:[e.jsx(P,{value:"7d",children:"Last 7 days"}),e.jsx(P,{value:"30d",children:"Last 30 days"}),e.jsx(P,{value:"90d",children:"Last 90 days"}),e.jsx(P,{value:"1y",children:"Last year"})]})]}),e.jsxs(R,{className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Export Report"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(s=>e.jsx(u,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gray-100",children:e.jsx(s.icon,{className:`w-6 h-6 ${s.color}`})}),e.jsxs("div",{className:"flex items-center gap-2",children:[f(s.changeType),e.jsxs("span",{className:`text-sm font-medium ${v(s.changeType)}`,children:[Math.abs(s.change),"%"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.title}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mb-1",children:s.value}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]})]})},s.id))}),e.jsxs(X,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(Y,{className:"grid w-full grid-cols-5",children:[e.jsx(_,{value:"overview",children:"Overview"}),e.jsx(_,{value:"financial",children:"Financial"}),e.jsx(_,{value:"operational",children:"Operational"}),e.jsx(_,{value:"performance",children:"Performance"}),e.jsx(_,{value:"reports",children:"Reports"})]}),e.jsxs(D,{value:"overview",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(u,{children:[e.jsx(N,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),"Revenue Trend"]})}),e.jsx(h,{children:e.jsx("div",{className:"space-y-4",children:y.map((s,l)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:s.name}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm",children:["£",s.value.toLocaleString()]}),s.trend==="up"?e.jsx(B,{className:"w-4 h-4 text-green-600"}):s.trend==="down"?e.jsx(ie,{className:"w-4 h-4 text-red-600"}):e.jsx(J,{className:"w-4 h-4 text-gray-600"})]})]},s.name))})})]}),e.jsxs(u,{children:[e.jsx(N,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5"}),"Service Distribution"]})}),e.jsx(h,{children:e.jsx("div",{className:"space-y-4",children:j.map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:s.name}),e.jsxs("span",{className:"text-sm",children:[s.value,"%"]})]}),e.jsx(Z,{value:s.value,className:"h-2"})]},s.name))})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(u,{children:e.jsxs(h,{className:"p-6 text-center",children:[e.jsx(ce,{className:"w-8 h-8 text-blue-600 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Active Drivers"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:t.quickStats.activeDrivers}),e.jsx("p",{className:"text-sm text-gray-600",children:"Currently available"})]})}),e.jsx(u,{children:e.jsxs(h,{className:"p-6 text-center",children:[e.jsx(le,{className:"w-8 h-8 text-green-600 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Fleet Vehicles"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:t.quickStats.fleetVehicles}),e.jsx("p",{className:"text-sm text-gray-600",children:"Operational vehicles"})]})}),e.jsx(u,{children:e.jsxs(h,{className:"p-6 text-center",children:[e.jsx(oe,{className:"w-8 h-8 text-purple-600 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"On-Time Rate"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:t.quickStats.onTimeRate}),e.jsx("p",{className:"text-sm text-gray-600",children:"This month"})]})}),e.jsx(u,{children:e.jsxs(h,{className:"p-6 text-center",children:[e.jsx($,{className:"w-8 h-8 text-orange-600 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Target Achievement"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:t.quickStats.targetAchievement}),e.jsx("p",{className:"text-sm text-gray-600",children:"Monthly target"})]})})]})]}),e.jsx(D,{value:"financial",className:"space-y-4",children:e.jsxs(u,{children:[e.jsx(N,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"Financial Analytics"]})}),e.jsx(h,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Financial Performance Analysis"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Detailed revenue analysis, cost breakdown, and profitability metrics."}),e.jsx(R,{className:"bg-blue-600 hover:bg-blue-700",children:"View Financial Dashboard"})]})})]})}),e.jsx(D,{value:"operational",className:"space-y-4",children:e.jsxs(u,{children:[e.jsx(N,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Operational Metrics"]})}),e.jsx(h,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(V,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Operational Performance"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Fleet utilization, route optimization, and operational efficiency metrics."}),e.jsx(R,{className:"bg-blue-600 hover:bg-blue-700",children:"View Operational Dashboard"})]})})]})}),e.jsx(D,{value:"performance",className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:S.map(s=>e.jsxs(u,{children:[e.jsx(N,{children:e.jsx(w,{children:s.category})}),e.jsx(h,{children:e.jsx("div",{className:"space-y-4",children:s.metrics.map(l=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:l.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm font-medium ${C(l.status)}`,children:l.value}),b(l.status)]})]},l.name))})})]},s.category))})}),e.jsx(D,{value:"reports",className:"space-y-4",children:e.jsxs(u,{children:[e.jsx(N,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5"}),"Custom Reports"]})}),e.jsx(h,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(L,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Generate Custom Reports"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Create detailed analytical reports with custom date ranges and metrics."}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(R,{className:"bg-blue-600 hover:bg-blue-700",children:"Create Report"}),e.jsxs(R,{variant:"outline",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Export Data"]})]})]})})]})})]})]})};export{we as default};
