var be=Object.defineProperty,we=Object.defineProperties;var ke=Object.getOwnPropertyDescriptors;var me=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable;var he=(g,x,h)=>x in g?be(g,x,{enumerable:!0,configurable:!0,writable:!0,value:h}):g[x]=h,d=(g,x)=>{for(var h in x||(x={}))Se.call(x,h)&&he(g,h,x[h]);if(me)for(var h of me(x))Fe.call(x,h)&&he(g,h,x[h]);return g},m=(g,x)=>we(g,ke(x));var ee=(g,x,h)=>new Promise((E,w)=>{var I=n=>{try{P(h.next(n))}catch(j){w(j)}},u=n=>{try{P(h.throw(n))}catch(j){w(j)}},P=n=>n.done?E(n.value):Promise.resolve(n.value).then(I,u);P((h=h.apply(g,x)).next())});import{j as e}from"./ui-vendor-DMUr7mTx.js";import{r as b}from"./react-vendor-BvqlMsL5.js";import{u as ve,l as Te,s as se,D as ne,m as te,n as re,o as ie,p as le,P as Ae,B as v,C as F,a as T,b as A,d as D,e as B,w as N,L as t,I as o,T as C,S as G,q as V,r as H,t as U,v as _,ag as De,ah as Ee,ai as Pe,aj as Me,h as qe,i as Re,j as J,k as Y,G as Ie}from"./index-ZwIgorfy.js";import{E as Le}from"./EmergencyContacts-CGH7bCEy.js";import{a as Be,u as Oe,b as $e}from"./query-vendor-B2F_wWlc.js";import{J as S,bm as ze,b as Ge,V as Ve,U as _e,_ as He,aA as Ue,$ as O,k as Je,E as ye,T as Ye,f as xe,ak as Qe,bs as We,M as ae,j as Q,a1 as je,Y as pe,g as ge}from"./icons-vendor-b0I7fGSL.js";import{N as ue}from"./router-vendor-CEyBJ8vK.js";import{f as fe}from"./utils-vendor-B2FlkASS.js";import"./supabase-vendor-B984m0TI.js";import"./ui-components-7w1-MJre.js";const Ke=({open:g,onOpenChange:x,onChildAdded:h})=>{const{user:E}=ve(),{toast:w}=Te(),I=Be(),[u,P]=b.useState(1),[n,j]=b.useState({first_name:"",last_name:"",date_of_birth:"",gender:"",nationality:"British",student_id:"",school_name:"",school_address:"",grade_level:"",class_name:"",school_start_date:"",pickup_location:"",dropoff_location:"",alternative_pickup_locations:[],transport_days:["monday","tuesday","wednesday","thursday","friday"],transport_type:"both",morning_pickup_time:"",afternoon_dropoff_time:"",special_schedule_notes:"",holiday_transport_needed:!1,allergies:[],medical_conditions:[],medications:[],emergency_procedures:"",medical_alert_info:"",mobility_requirements:"",communication_needs:"",behavioral_considerations:"",required_equipment:[],transport_consent:!1,medical_consent:!1,photo_consent:!1,data_protection_consent:!1,emergency_contacts:[],payment_method:"",billing_address:"",discount_eligible:!1,payment_schedule:"",notification_preferences:{sms:!0,email:!0,app:!0,emergency_alerts:!0},language_preference:"english"}),{data:L=[]}=Oe({queryKey:["schools"],queryFn:()=>ee(void 0,null,function*(){const{data:s,error:r}=yield se.from("schools").select("*").eq("is_active",!0).order("name");if(r)throw r;return s||[]})}),l=6,p=u/l*100,W=[{id:1,name:"Basic Information",icon:_e},{id:2,name:"Transport Details",icon:He},{id:3,name:"Medical Information",icon:Ue},{id:4,name:"Emergency Contacts",icon:O},{id:5,name:"Legal & Consent",icon:Je},{id:6,name:"Review & Submit",icon:S}],M=$e({mutationFn:s=>ee(void 0,null,function*(){if(!(E!=null&&E.id))throw new Error("User not authenticated");const{data:r,error:c}=yield se.from("child_profiles").insert(m(d({parent_id:E.id},s),{emergency_contacts:void 0})).select().single();if(c)throw c;if(s.emergency_contacts.length>0){const y=s.emergency_contacts.map(z=>d({child_id:r.id},z)),{error:f}=yield se.from("emergency_contacts").insert(y);if(f)throw f}return r}),onSuccess:()=>{I.invalidateQueries({queryKey:["parent-children"]}),w({title:"Child Registration Successful",description:"Your child has been registered for transport services."}),x(!1),h==null||h(),q()},onError:s=>{console.error("Error creating child:",s),w({title:"Registration Failed",description:"There was an error registering your child. Please try again.",variant:"destructive"})}}),q=()=>{j({first_name:"",last_name:"",date_of_birth:"",gender:"",nationality:"British",student_id:"",school_name:"",school_address:"",grade_level:"",class_name:"",school_start_date:"",pickup_location:"",dropoff_location:"",alternative_pickup_locations:[],transport_days:["monday","tuesday","wednesday","thursday","friday"],transport_type:"both",morning_pickup_time:"",afternoon_dropoff_time:"",special_schedule_notes:"",holiday_transport_needed:!1,allergies:[],medical_conditions:[],medications:[],emergency_procedures:"",medical_alert_info:"",mobility_requirements:"",communication_needs:"",behavioral_considerations:"",required_equipment:[],transport_consent:!1,medical_consent:!1,photo_consent:!1,data_protection_consent:!1,emergency_contacts:[],payment_method:"",billing_address:"",discount_eligible:!1,payment_schedule:"",notification_preferences:{sms:!0,email:!0,app:!0,emergency_alerts:!0},language_preference:"english"}),P(1)},ce=()=>{u<l&&P(u+1)},$=()=>{u>1&&P(u-1)},de=()=>{M.mutate(n)},i=(s,r)=>{j(c=>m(d({},c),{[s]:r}))},k=(s,r,c)=>{j(y=>m(d({},y),{emergency_contacts:y.emergency_contacts.map((f,z)=>z===s?m(d({},f),{[r]:c}):f)}))},K=()=>{j(s=>m(d({},s),{emergency_contacts:[...s.emergency_contacts,{contact_name:"",relationship:"",phone:"",email:"",address:"",contact_type:"general",is_primary:!1,can_authorize_treatment:!1}]}))},X=s=>{j(r=>m(d({},r),{emergency_contacts:r.emergency_contacts.filter((c,y)=>y!==s)}))},Z=()=>{switch(u){case 1:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"first_name",children:"First Name *"}),e.jsx(o,{id:"first_name",value:n.first_name,onChange:s=>i("first_name",s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"last_name",children:"Last Name *"}),e.jsx(o,{id:"last_name",value:n.last_name,onChange:s=>i("last_name",s.target.value),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"date_of_birth",children:"Date of Birth *"}),e.jsx(o,{id:"date_of_birth",type:"date",value:n.date_of_birth,onChange:s=>i("date_of_birth",s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"gender",children:"Gender"}),e.jsxs(G,{value:n.gender,onValueChange:s=>i("gender",s),children:[e.jsx(V,{children:e.jsx(H,{placeholder:"Select gender"})}),e.jsxs(U,{children:[e.jsx(_,{value:"male",children:"Male"}),e.jsx(_,{value:"female",children:"Female"}),e.jsx(_,{value:"other",children:"Other"}),e.jsx(_,{value:"prefer_not_to_say",children:"Prefer not to say"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"nationality",children:"Nationality"}),e.jsx(o,{id:"nationality",value:n.nationality,onChange:s=>i("nationality",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"student_id",children:"Student ID"}),e.jsx(o,{id:"student_id",value:n.student_id,onChange:s=>i("student_id",s.target.value),placeholder:"School student ID"})]})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"school_name",children:"School *"}),e.jsxs(G,{value:n.school_name,onValueChange:s=>i("school_name",s),children:[e.jsx(V,{children:e.jsx(H,{placeholder:"Select school"})}),e.jsx(U,{children:L.map(s=>e.jsx(_,{value:s.name,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"grade_level",children:"Grade/Year Level *"}),e.jsx(o,{id:"grade_level",value:n.grade_level,onChange:s=>i("grade_level",s.target.value),placeholder:"e.g., Year 3, Grade 5",required:!0})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"class_name",children:"Class"}),e.jsx(o,{id:"class_name",value:n.class_name,onChange:s=>i("class_name",s.target.value),placeholder:"e.g., Class 3A"})]})]})]});case 2:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"pickup_location",children:"Pickup Location *"}),e.jsx(o,{id:"pickup_location",value:n.pickup_location,onChange:s=>i("pickup_location",s.target.value),placeholder:"Full address",required:!0})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"dropoff_location",children:"Dropoff Location *"}),e.jsx(o,{id:"dropoff_location",value:n.dropoff_location,onChange:s=>i("dropoff_location",s.target.value),placeholder:"School address",required:!0})]})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"transport_type",children:"Transport Type *"}),e.jsxs(G,{value:n.transport_type,onValueChange:s=>i("transport_type",s),children:[e.jsx(V,{children:e.jsx(H,{placeholder:"Select transport type"})}),e.jsxs(U,{children:[e.jsx(_,{value:"morning_only",children:"Morning Only"}),e.jsx(_,{value:"afternoon_only",children:"Afternoon Only"}),e.jsx(_,{value:"both",children:"Both Morning & Afternoon"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"morning_pickup_time",children:"Morning Pickup Time"}),e.jsx(o,{id:"morning_pickup_time",type:"time",value:n.morning_pickup_time,onChange:s=>i("morning_pickup_time",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"afternoon_dropoff_time",children:"Afternoon Dropoff Time"}),e.jsx(o,{id:"afternoon_dropoff_time",type:"time",value:n.afternoon_dropoff_time,onChange:s=>i("afternoon_dropoff_time",s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"special_schedule_notes",children:"Special Schedule Notes"}),e.jsx(C,{id:"special_schedule_notes",value:n.special_schedule_notes,onChange:s=>i("special_schedule_notes",s.target.value),placeholder:"Any special scheduling requirements"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{id:"holiday_transport",checked:n.holiday_transport_needed,onCheckedChange:s=>i("holiday_transport_needed",s)}),e.jsx(t,{htmlFor:"holiday_transport",children:"Holiday transport needed"})]})]});case 3:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"allergies",children:"Allergies"}),e.jsx(C,{id:"allergies",value:n.allergies.join(", "),onChange:s=>i("allergies",s.target.value.split(",").map(r=>r.trim()).filter(Boolean)),placeholder:"List any allergies (separate with commas)"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"medical_conditions",children:"Medical Conditions"}),e.jsx(C,{id:"medical_conditions",value:n.medical_conditions.join(", "),onChange:s=>i("medical_conditions",s.target.value.split(",").map(r=>r.trim()).filter(Boolean)),placeholder:"List any medical conditions (separate with commas)"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"medications",children:"Medications"}),e.jsx(C,{id:"medications",value:n.medications.join(", "),onChange:s=>i("medications",s.target.value.split(",").map(r=>r.trim()).filter(Boolean)),placeholder:"List any medications (separate with commas)"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"emergency_procedures",children:"Emergency Procedures"}),e.jsx(C,{id:"emergency_procedures",value:n.emergency_procedures,onChange:s=>i("emergency_procedures",s.target.value),placeholder:"Emergency procedures for medical conditions"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"medical_alert_info",children:"Medical Alert Information"}),e.jsx(C,{id:"medical_alert_info",value:n.medical_alert_info,onChange:s=>i("medical_alert_info",s.target.value),placeholder:"Any medical alert information"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"mobility_requirements",children:"Mobility Requirements"}),e.jsx(C,{id:"mobility_requirements",value:n.mobility_requirements,onChange:s=>i("mobility_requirements",s.target.value),placeholder:"Any mobility requirements or assistance needed"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"communication_needs",children:"Communication Needs"}),e.jsx(C,{id:"communication_needs",value:n.communication_needs,onChange:s=>i("communication_needs",s.target.value),placeholder:"Any communication needs or preferences"})]})]});case 4:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Emergency Contacts"}),e.jsxs(v,{type:"button",variant:"outline",size:"sm",onClick:K,children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Add Contact"]})]}),n.emergency_contacts.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(O,{className:"w-12 h-12 mx-auto mb-4"}),e.jsx("p",{children:"No emergency contacts added yet."}),e.jsx("p",{className:"text-sm",children:'Click "Add Contact" to add emergency contacts.'})]}):e.jsx("div",{className:"space-y-4",children:n.emergency_contacts.map((s,r)=>e.jsxs(F,{children:[e.jsx(T,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(A,{className:"text-base",children:["Contact ",r+1]}),e.jsx(v,{type:"button",variant:"ghost",size:"sm",onClick:()=>X(r),children:"Remove"})]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{children:"Contact Name *"}),e.jsx(o,{value:s.contact_name,onChange:c=>k(r,"contact_name",c.target.value),placeholder:"Full name"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Relationship *"}),e.jsx(o,{value:s.relationship,onChange:c=>k(r,"relationship",c.target.value),placeholder:"e.g., Mother, Father, Grandparent"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{children:"Phone Number *"}),e.jsx(o,{value:s.phone,onChange:c=>k(r,"phone",c.target.value),placeholder:"Phone number"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Email"}),e.jsx(o,{type:"email",value:s.email,onChange:c=>k(r,"email",c.target.value),placeholder:"Email address"})]})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Address"}),e.jsx(C,{value:s.address,onChange:c=>k(r,"address",c.target.value),placeholder:"Full address",rows:2})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{checked:s.is_primary,onCheckedChange:c=>k(r,"is_primary",c)}),e.jsx(t,{children:"Primary Contact"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{checked:s.can_authorize_treatment,onCheckedChange:c=>k(r,"can_authorize_treatment",c)}),e.jsx(t,{children:"Can Authorize Medical Treatment"})]})]})]})]},r))})]});case 5:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Consent Forms"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{id:"transport_consent",checked:n.transport_consent,onCheckedChange:s=>i("transport_consent",s)}),e.jsx(t,{htmlFor:"transport_consent",children:"I consent to my child using the transport service"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{id:"medical_consent",checked:n.medical_consent,onCheckedChange:s=>i("medical_consent",s)}),e.jsx(t,{htmlFor:"medical_consent",children:"I consent to emergency medical treatment if required"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{id:"photo_consent",checked:n.photo_consent,onCheckedChange:s=>i("photo_consent",s)}),e.jsx(t,{htmlFor:"photo_consent",children:"I consent to photos/videos being taken for safety purposes"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{id:"data_protection_consent",checked:n.data_protection_consent,onCheckedChange:s=>i("data_protection_consent",s)}),e.jsx(t,{htmlFor:"data_protection_consent",children:"I consent to my data being processed in accordance with GDPR"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Communication Preferences"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{id:"sms_notifications",checked:n.notification_preferences.sms,onCheckedChange:s=>i("notification_preferences",m(d({},n.notification_preferences),{sms:s}))}),e.jsx(t,{htmlFor:"sms_notifications",children:"SMS Notifications"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{id:"email_notifications",checked:n.notification_preferences.email,onCheckedChange:s=>i("notification_preferences",m(d({},n.notification_preferences),{email:s}))}),e.jsx(t,{htmlFor:"email_notifications",children:"Email Notifications"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{id:"app_notifications",checked:n.notification_preferences.app,onCheckedChange:s=>i("notification_preferences",m(d({},n.notification_preferences),{app:s}))}),e.jsx(t,{htmlFor:"app_notifications",children:"App Notifications"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{id:"emergency_alerts",checked:n.notification_preferences.emergency_alerts,onCheckedChange:s=>i("notification_preferences",m(d({},n.notification_preferences),{emergency_alerts:s}))}),e.jsx(t,{htmlFor:"emergency_alerts",children:"Emergency Alerts"})]})]})]})]});case 6:return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Review Registration Details"}),e.jsxs(F,{children:[e.jsx(T,{children:e.jsx(A,{className:"text-base",children:"Basic Information"})}),e.jsx(D,{className:"space-y-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Name:"})," ",n.first_name," ",n.last_name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date of Birth:"})," ",n.date_of_birth]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Gender:"})," ",n.gender]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Nationality:"})," ",n.nationality]}),e.jsxs("div",{children:[e.jsx("strong",{children:"School:"})," ",n.school_name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Grade:"})," ",n.grade_level]})]})})]}),e.jsxs(F,{children:[e.jsx(T,{children:e.jsx(A,{className:"text-base",children:"Transport Details"})}),e.jsx(D,{className:"space-y-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Pickup:"})," ",n.pickup_location]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Dropoff:"})," ",n.dropoff_location]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Type:"})," ",n.transport_type]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Morning Time:"})," ",n.morning_pickup_time]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Afternoon Time:"})," ",n.afternoon_dropoff_time]})]})})]}),e.jsxs(F,{children:[e.jsx(T,{children:e.jsx(A,{className:"text-base",children:"Emergency Contacts"})}),e.jsx(D,{children:n.emergency_contacts.length===0?e.jsx("p",{className:"text-gray-500",children:"No emergency contacts added"}):e.jsx("div",{className:"space-y-2",children:n.emergency_contacts.map((s,r)=>e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:s.contact_name})," (",s.relationship,") - ",s.phone,s.is_primary&&e.jsx(B,{className:"ml-2",children:"Primary"})]},r))})})]}),e.jsxs(F,{children:[e.jsx(T,{children:e.jsx(A,{className:"text-base",children:"Consent Status"})}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{className:`w-4 h-4 ${n.transport_consent?"text-green-500":"text-gray-300"}`}),e.jsx("span",{children:"Transport Consent"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{className:`w-4 h-4 ${n.medical_consent?"text-green-500":"text-gray-300"}`}),e.jsx("span",{children:"Medical Consent"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{className:`w-4 h-4 ${n.photo_consent?"text-green-500":"text-gray-300"}`}),e.jsx("span",{children:"Photo Consent"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{className:`w-4 h-4 ${n.data_protection_consent?"text-green-500":"text-gray-300"}`}),e.jsx("span",{children:"Data Protection Consent"})]})]})})]})]})});default:return null}};return e.jsx(ne,{open:g,onOpenChange:x,children:e.jsxs(te,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Register Child for Transport"}),e.jsx(le,{children:"Complete the registration process for your child's transport service."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{children:["Step ",u," of ",l]}),e.jsxs("span",{children:[Math.round(p),"% Complete"]})]}),e.jsx(Ae,{value:p,className:"w-full"}),e.jsx("div",{className:"flex items-center justify-between",children:W.map((s,r)=>{const c=s.icon,y=u===s.id,f=u>s.id;return e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${f?"bg-green-500 text-white":y?"bg-blue-500 text-white":"bg-gray-200 text-gray-500"}`,children:f?e.jsx(S,{className:"w-4 h-4"}):e.jsx(c,{className:"w-4 h-4"})}),e.jsx("span",{className:`text-xs text-center ${y?"text-blue-600 font-medium":"text-gray-500"}`,children:s.name})]},s.id)})})]}),e.jsx("div",{className:"py-6",children:Z()}),e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t",children:[e.jsxs(v,{type:"button",variant:"outline",onClick:$,disabled:u===1,children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),"Previous"]}),e.jsx("div",{className:"flex items-center space-x-2",children:u<l?e.jsxs(v,{onClick:ce,children:["Next",e.jsx(Ge,{className:"w-4 h-4 ml-2"})]}):e.jsx(v,{onClick:de,disabled:M.isPending,children:M.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Ve,{className:"w-4 h-4 mr-2 animate-spin"}),"Registering..."]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Complete Registration"]})})})]})]})})},ds=()=>{var oe;const{user:g,profile:x,loading:h}=ve();b.useState(!1);const[E,w]=b.useState(!1),[I,u]=b.useState(null),[P,n]=b.useState(null),[j,L]=b.useState(null),[l,p]=b.useState(null),[W,M]=b.useState(!1),[q,ce]=b.useState(null),{data:$=[],isLoading:de,error:i}=De();if(Ee(),Pe(q==null?void 0:q.id,fe(new Date().setDate(new Date().getDate()-7),"yyyy-MM-dd"),fe(new Date,"yyyy-MM-dd")),Me(q==null?void 0:q.id),h)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading child management..."})]})});if(!g||!x)return e.jsx(ue,{to:"/auth",replace:!0});if(x.role!=="parent")return e.jsx(ue,{to:"/dashboard",replace:!0});if(i)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ye,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Error Loading Children"}),e.jsx("p",{className:"text-muted-foreground",children:"Failed to load child information. Please try again."})]})});const k=[{id:"1",childId:"1",childName:"Emma",type:"pickup",time:"15:35",date:"2024-01-15",location:"Elmwood Primary School",status:"completed",driver:"John Smith",vehicle:"LSR-001"},{id:"2",childId:"2",childName:"James",type:"dropoff",time:"08:02",date:"2024-01-15",location:"Elmwood Primary School",status:"completed",driver:"John Smith",vehicle:"LSR-001"},{id:"3",childId:"1",childName:"Emma",type:"absence",date:"2024-01-12",reason:"Medical appointment",status:"approved"}],K=a=>{switch(a){case"at_home":return e.jsx(B,{className:"bg-blue-100 text-blue-800 hover:bg-blue-100",children:"At Home"});case"on_transport":return e.jsx(B,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"On Transport"});case"at_school":return e.jsx(B,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"At School"});case"absent":return e.jsx(B,{className:"bg-gray-100 text-gray-800 hover:bg-gray-100",children:"Absent"});default:return e.jsx(B,{variant:"secondary",children:a})}},X=a=>{switch(a){case"pickup":return e.jsx(ae,{className:"w-4 h-4 text-green-600"});case"dropoff":return e.jsx(ae,{className:"w-4 h-4 text-blue-600"});case"absence":return e.jsx(pe,{className:"w-4 h-4 text-red-600"});default:return e.jsx(Q,{className:"w-4 h-4"})}},Z=(a,R)=>{u(a),console.log(`Starting live tracking for ${R}`),window.open(`/tracking/${a}`,"_blank")},s=(a,R)=>{n(a),console.log(`Opening schedule for ${R}`),window.open(`/schedule/${a}`,"_blank")},r=(a,R)=>{L(a),console.log(`Opening call options for ${R}`)},c=a=>{window.location.href=`tel:${a}`,L(null)},y=a=>{window.location.href=`tel:${a}`,L(null)},f=a=>$.find(R=>R.id===a),z=a=>{p(d({},a)),M(!0)},Ne=()=>{l&&(console.log("Saving child updates:",l),M(!1),p(null))},Ce=()=>{M(!1),p(null)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(xe,{className:"w-8 h-8 text-blue-600"}),"My Children"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your children's transport and school information"})]}),e.jsxs(v,{className:"bg-blue-600 hover:bg-blue-700",onClick:()=>w(!0),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Add Child (Comprehensive)"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:$.map(a=>e.jsxs(F,{className:"relative",children:[e.jsx(T,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(xe,{className:"w-8 h-8 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs(A,{className:"text-xl",children:[a.firstName," ",a.lastName]}),e.jsxs("p",{className:"text-gray-600",children:[a.grade," • Age ",a.age]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[K(a.currentStatus),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>z(a),children:e.jsx(Qe,{className:"w-4 h-4"})})]})]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{children:a.school})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{children:a.route})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{children:["Pickup: ",a.pickupTime]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{children:["Dropoff: ",a.dropoffTime]})]}),a.currentStatus==="on_transport"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 col-span-2",children:[e.jsx(je,{className:"w-4 h-4 text-orange-600"}),e.jsxs("span",{className:"text-orange-600 font-medium",children:["Last seen: ",a.lastSeen," • ETA: ",a.estimatedArrival]})]}),e.jsxs("div",{className:"flex items-center gap-2 col-span-2",children:[e.jsx(_e,{className:"w-4 h-4 text-gray-600"}),e.jsxs("span",{className:"text-gray-600",children:["Driver: ",a.driver]})]})]})]}),a.medicalNotes&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-yellow-800 mb-1",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Medical Notes"})]}),e.jsx("p",{className:"text-yellow-700 text-sm",children:a.medicalNotes})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{size:"sm",className:"flex-1 bg-blue-600 hover:bg-blue-700",onClick:()=>Z(a.id,a.firstName),disabled:I===a.id,children:[e.jsx(je,{className:"w-4 h-4 mr-1"}),I===a.id?"Tracking...":"Track Live"]}),e.jsxs(v,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>s(a.id,a.firstName),children:[e.jsx(ge,{className:"w-4 h-4 mr-1"}),"Schedule"]}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>r(a.id,a.firstName),children:e.jsx(O,{className:"w-4 h-4"})})]})]})]},a.id))}),e.jsxs(qe,{defaultValue:"activity",className:"space-y-6",children:[e.jsxs(Re,{className:"grid w-full grid-cols-4",children:[e.jsx(J,{value:"activity",children:"Recent Activity"}),e.jsx(J,{value:"schedule",children:"Weekly Schedule"}),e.jsx(J,{value:"attendance",children:"Attendance"}),e.jsx(J,{value:"contacts",children:"Emergency Contacts"})]}),e.jsx(Y,{value:"activity",className:"space-y-4",children:e.jsxs(F,{children:[e.jsx(T,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Recent Transport Activity"]})}),e.jsx(D,{children:e.jsx("div",{className:"space-y-4",children:k.map(a=>e.jsxs("div",{className:"flex items-center gap-4 p-3 border rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0",children:X(a.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-medium",children:[a.childName," - ",a.type==="pickup"?"Picked up":a.type==="dropoff"?"Dropped off":"Absence reported"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[a.time&&e.jsxs("span",{children:[a.time," • "]}),a.date,a.location&&e.jsxs("span",{children:[" • ",a.location]}),a.driver&&e.jsxs("span",{children:[" • Driver: ",a.driver]})]}),a.reason&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Reason: ",a.reason]})]}),e.jsx("div",{children:e.jsx(S,{className:"w-5 h-5 text-green-600"})})]},a.id))})})]})}),e.jsx(Y,{value:"schedule",className:"space-y-4",children:e.jsxs(F,{children:[e.jsx(T,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5"}),"Weekly Transport Schedule"]})}),e.jsx(D,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-7 gap-4",children:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(a=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsx("h3",{className:"font-medium text-center mb-3",children:a}),e.jsx("div",{className:"space-y-2",children:a!=="Saturday"&&a!=="Sunday"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs",children:[e.jsx("div",{className:"font-medium",children:"Morning Pickup"}),e.jsx("div",{className:"text-gray-600",children:"08:00 - Route 1"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("div",{className:"font-medium",children:"Afternoon Return"}),e.jsx("div",{className:"text-gray-600",children:"15:30 - Route 1"})]})]}):e.jsx("div",{className:"text-center text-gray-400 text-xs py-4",children:"No transport"})})]},a))})})]})}),e.jsx(Y,{value:"attendance",className:"space-y-4",children:e.jsxs(F,{children:[e.jsx(T,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5"}),"Attendance Summary"]})}),e.jsx(D,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:$.map(a=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold mb-3",children:[a.firstName," ",a.lastName]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"This Month"}),e.jsx("span",{className:"font-medium",children:"18/20 days"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"This Term"}),e.jsx("span",{className:"font-medium",children:"85/90 days"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Attendance Rate"}),e.jsx("span",{className:"font-medium text-green-600",children:"94%"})]}),e.jsx("div",{className:"bg-green-100 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 rounded-full h-2 w-[94%]"})})]})]},a.id))})})]})}),e.jsx(Y,{value:"contacts",className:"space-y-4",children:e.jsx(Le,{})})]}),e.jsx(Ke,{open:E,onOpenChange:w,onChildAdded:()=>{w(!1)}}),e.jsx(ne,{open:!!j,onOpenChange:()=>L(null),children:e.jsxs(te,{className:"max-w-md",children:[e.jsxs(re,{children:[e.jsxs(ie,{children:["Contact Options - ",j&&((oe=f(j))==null?void 0:oe.firstName)]}),e.jsx(le,{children:"Choose who you'd like to contact regarding your child's transport."})]}),e.jsx("div",{className:"space-y-4",children:j&&f(j)&&e.jsxs(e.Fragment,{children:[e.jsxs(v,{className:"w-full bg-red-600 hover:bg-red-700",onClick:()=>c(f(j).emergencyContact),children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Emergency Contact"]}),e.jsxs(v,{variant:"outline",className:"w-full",onClick:()=>y(f(j).driverPhone),children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Call Driver (",f(j).driver,")"]}),e.jsxs(v,{variant:"outline",className:"w-full",onClick:()=>y(f(j).transportOffice),children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Call Transport Office"]})]})})]})}),e.jsx(ne,{open:W,onOpenChange:M,children:e.jsxs(te,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Edit Child Information"}),e.jsx(le,{children:"Update your child's transport and school information."})]}),l&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-firstName",children:"First Name"}),e.jsx(o,{id:"edit-firstName",value:l.firstName,onChange:a=>p(m(d({},l),{firstName:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-lastName",children:"Last Name"}),e.jsx(o,{id:"edit-lastName",value:l.lastName,onChange:a=>p(m(d({},l),{lastName:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-age",children:"Age"}),e.jsx(o,{id:"edit-age",type:"number",value:l.age,onChange:a=>p(m(d({},l),{age:parseInt(a.target.value)}))})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-grade",children:"Grade"}),e.jsx(o,{id:"edit-grade",value:l.grade,onChange:a=>p(m(d({},l),{grade:a.target.value}))})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"School Information"}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-school",children:"School"}),e.jsx(o,{id:"edit-school",value:l.school,onChange:a=>p(m(d({},l),{school:a.target.value}))})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Transport Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-pickupTime",children:"Pickup Time"}),e.jsx(o,{id:"edit-pickupTime",type:"time",value:l.pickupTime,onChange:a=>p(m(d({},l),{pickupTime:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-dropoffTime",children:"Dropoff Time"}),e.jsx(o,{id:"edit-dropoffTime",type:"time",value:l.dropoffTime,onChange:a=>p(m(d({},l),{dropoffTime:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-route",children:"Route"}),e.jsx(o,{id:"edit-route",value:l.route,onChange:a=>p(m(d({},l),{route:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-emergencyContact",children:"Emergency Contact"}),e.jsx(o,{id:"edit-emergencyContact",value:l.emergencyContact,onChange:a=>p(m(d({},l),{emergencyContact:a.target.value}))})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Medical Information"}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-medicalNotes",children:"Medical Notes"}),e.jsx(C,{id:"edit-medicalNotes",value:l.medicalNotes,onChange:a=>p(m(d({},l),{medicalNotes:a.target.value})),rows:3,placeholder:"Any medical conditions, allergies, or special requirements..."})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Status Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-currentStatus",children:"Current Status"}),e.jsxs(G,{value:l.currentStatus,onValueChange:a=>p(m(d({},l),{currentStatus:a})),children:[e.jsx(V,{children:e.jsx(H,{})}),e.jsxs(U,{children:[e.jsx(_,{value:"at_home",children:"At Home"}),e.jsx(_,{value:"on_transport",children:"On Transport"}),e.jsx(_,{value:"at_school",children:"At School"}),e.jsx(_,{value:"absent",children:"Absent"})]})]})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-transportStatus",children:"Transport Status"}),e.jsxs(G,{value:l.transportStatus,onValueChange:a=>p(m(d({},l),{transportStatus:a})),children:[e.jsx(V,{children:e.jsx(H,{})}),e.jsxs(U,{children:[e.jsx(_,{value:"active",children:"Active"}),e.jsx(_,{value:"suspended",children:"Suspended"}),e.jsx(_,{value:"cancelled",children:"Cancelled"})]})]})]})]})]})]}),e.jsxs(Ie,{className:"flex gap-2",children:[e.jsx(v,{variant:"outline",onClick:Ce,children:"Cancel"}),e.jsx(v,{onClick:Ne,className:"bg-blue-600 hover:bg-blue-700",children:"Save Changes"})]})]})})]})};export{ds as default};
