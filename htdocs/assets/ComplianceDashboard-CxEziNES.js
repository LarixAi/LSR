import{j as e}from"./ui-vendor-DMUr7mTx.js";import{r as j}from"./react-vendor-BvqlMsL5.js";import{u as K,S as w,q as C,r as D,t as V,v as r,B as t,C as i,d as n,P as L,h as Q,i as W,j as d,k as o,a as x,b as h,I as X,e as T}from"./index-ZwIgorfy.js";import{u as Y,a as Z}from"./useComplianceData-CmhSjdal.js";import{N as A}from"./router-vendor-CEyBJ8vK.js";import{k as _,ab as M,m as S,J as ee,T as u,a2 as se,j as ae,f as v,a as N,aa as le,t as R}from"./icons-vendor-b0I7fGSL.js";import"./supabase-vendor-B984m0TI.js";import"./utils-vendor-B2FlkASS.js";import"./query-vendor-B2F_wWlc.js";import"./ui-components-7w1-MJre.js";const je=()=>{const{user:k,profile:p,loading:$}=K(),[c,B]=j.useState(""),[m,O]=j.useState("all"),[E,I]=j.useState("7d"),{data:s,isLoading:z}=Y(),{data:U=[],isLoading:re}=Z();if($||z)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading compliance dashboard..."})]})});if(!k||!p)return e.jsx(A,{to:"/auth",replace:!0});if(!["admin","council"].includes(p.role))return e.jsx(A,{to:"/unauthorized",replace:!0});const g=[{id:"driver-compliance",title:"Driver Compliance",value:(s==null?void 0:s.driversCompliant)||0,total:(s==null?void 0:s.totalDrivers)||0,percentage:(s==null?void 0:s.totalDrivers)>0?Math.round(s.driversCompliant/s.totalDrivers*100):100,status:((s==null?void 0:s.totalDrivers)>0?s.driversCompliant/s.totalDrivers*100:100)>=90?"good":((s==null?void 0:s.totalDrivers)>0?s.driversCompliant/s.totalDrivers*100:100)>=70?"warning":"critical",trend:"stable"},{id:"vehicle-compliance",title:"Vehicle Compliance",value:(s==null?void 0:s.vehiclesCompliant)||0,total:(s==null?void 0:s.totalVehicles)||0,percentage:(s==null?void 0:s.totalVehicles)>0?Math.round(s.vehiclesCompliant/s.totalVehicles*100):100,status:((s==null?void 0:s.totalVehicles)>0?s.vehiclesCompliant/s.totalVehicles*100:100)>=90?"good":((s==null?void 0:s.totalVehicles)>0?s.vehiclesCompliant/s.totalVehicles*100:100)>=70?"warning":"critical",trend:"stable"},{id:"violations",title:"Active Violations",value:(s==null?void 0:s.activeViolations)||0,total:((s==null?void 0:s.totalDrivers)||0)+((s==null?void 0:s.totalVehicles)||0),percentage:((s==null?void 0:s.totalDrivers)||0)+((s==null?void 0:s.totalVehicles)||0)>0?Math.max(0,100-Math.round(((s==null?void 0:s.activeViolations)||0)/(((s==null?void 0:s.totalDrivers)||0)+((s==null?void 0:s.totalVehicles)||0))*100)):100,status:((s==null?void 0:s.activeViolations)||0)===0?"good":((s==null?void 0:s.activeViolations)||0)<=2?"warning":"critical",trend:"stable"},{id:"overall-score",title:"Overall Score",value:(s==null?void 0:s.overallScore)||0,total:100,percentage:(s==null?void 0:s.overallScore)||0,status:((s==null?void 0:s.overallScore)||0)>=90?"good":((s==null?void 0:s.overallScore)||0)>=70?"warning":"critical",trend:"stable"}],q=U.map((a,l)=>({id:`alert-${l+1}`,type:a.type,severity:a.severity,title:`${a.type} - ${a.entity}`,description:`${a.type} expires in ${a.days} day${a.days!==1?"s":""}`,createdAt:new Date().toISOString(),status:"open"})),F=a=>{switch(a){case"good":return"text-green-600";case"warning":return"text-yellow-600";case"critical":return"text-red-600";default:return"text-gray-600"}},G=a=>{const l={open:"bg-red-100 text-red-800",investigating:"bg-yellow-100 text-yellow-800",resolved:"bg-green-100 text-green-800"};return e.jsx(T,{className:l[a]||"bg-gray-100 text-gray-800",children:a})},H=a=>{const l={critical:"bg-red-100 text-red-800",high:"bg-orange-100 text-orange-800",medium:"bg-yellow-100 text-yellow-800",low:"bg-blue-100 text-blue-800"};return e.jsx(T,{className:l[a]||"bg-gray-100 text-gray-800",children:a})},P=q.filter(a=>{var y,f;const l=a.title.toLowerCase().includes(c.toLowerCase())||a.description.toLowerCase().includes(c.toLowerCase())||((y=a.driverName)==null?void 0:y.toLowerCase().includes(c.toLowerCase()))||((f=a.vehicleNumber)==null?void 0:f.toLowerCase().includes(c.toLowerCase())),J=m==="all"||a.severity===m;return l&&J}),b=Math.round(g.reduce((a,l)=>a+l.percentage,0)/g.length);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(_,{className:"w-8 h-8 text-blue-600"}),"Compliance Dashboard"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Real-time compliance monitoring and management"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(w,{value:E,onValueChange:I,children:[e.jsx(C,{className:"w-32",children:e.jsx(D,{})}),e.jsxs(V,{children:[e.jsx(r,{value:"24h",children:"Last 24h"}),e.jsx(r,{value:"7d",children:"Last 7 days"}),e.jsx(r,{value:"30d",children:"Last 30 days"}),e.jsx(r,{value:"90d",children:"Last 90 days"})]})]}),e.jsxs(t,{className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Export Report"]})]})]}),e.jsx(i,{children:e.jsxs(n,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Overall Compliance Score"}),e.jsx("p",{className:"text-gray-600",children:"Across all categories and requirements"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-3xl font-bold text-blue-600",children:[b,"%"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{children:"+2.3% from last month"})]})]})]}),e.jsx(L,{value:b,className:"h-3"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:g.map(a=>e.jsx(i,{children:e.jsxs(n,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:a.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[a.value," / ",a.total]}),e.jsxs("span",{className:`text-sm font-medium ${F(a.status)}`,children:[a.percentage,"%"]})]})]}),e.jsx("div",{className:`p-2 rounded-lg ${a.status==="good"?"bg-green-100":a.status==="warning"?"bg-yellow-100":"bg-red-100"}`,children:a.status==="good"?e.jsx(ee,{className:"w-6 h-6 text-green-600"}):a.status==="warning"?e.jsx(u,{className:"w-6 h-6 text-yellow-600"}):e.jsx(u,{className:"w-6 h-6 text-red-600"})})]}),e.jsx(L,{value:a.percentage,className:"h-2"})]})},a.id))}),e.jsxs(Q,{defaultValue:"alerts",className:"space-y-6",children:[e.jsxs(W,{className:"grid w-full grid-cols-4",children:[e.jsx(d,{value:"alerts",children:"Active Alerts"}),e.jsx(d,{value:"drivers",children:"Driver Compliance"}),e.jsx(d,{value:"vehicles",children:"Vehicle Compliance"}),e.jsx(d,{value:"reports",children:"Compliance Reports"})]}),e.jsx(o,{value:"alerts",className:"space-y-4",children:e.jsxs(i,{children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-5 h-5"}),"Compliance Alerts"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(X,{placeholder:"Search alerts...",value:c,onChange:a=>B(a.target.value),className:"pl-10"})]}),e.jsxs(w,{value:m,onValueChange:O,children:[e.jsx(C,{className:"w-48",children:e.jsx(D,{})}),e.jsxs(V,{children:[e.jsx(r,{value:"all",children:"All Severity"}),e.jsx(r,{value:"critical",children:"Critical"}),e.jsx(r,{value:"high",children:"High"}),e.jsx(r,{value:"medium",children:"Medium"}),e.jsx(r,{value:"low",children:"Low"})]})]})]})]}),e.jsx(n,{children:e.jsx("div",{className:"space-y-4",children:P.map(a=>e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:a.title}),H(a.severity),G(a.status)]}),e.jsx("p",{className:"text-gray-600 mb-2",children:a.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4"}),new Date(a.createdAt).toLocaleDateString()]}),a.driverName&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(v,{className:"w-4 h-4"}),a.driverName]}),a.vehicleNumber&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"w-4 h-4"}),a.vehicleNumber]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{variant:"outline",size:"sm",children:e.jsx(le,{className:"w-4 h-4"})}),e.jsx(t,{size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:"Investigate"})]})]})},a.id))})})]})}),e.jsx(o,{value:"drivers",className:"space-y-4",children:e.jsxs(i,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5"}),"Driver Compliance Overview"]})}),e.jsx(n,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(v,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Driver Compliance Tracking"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Monitor individual driver compliance scores, certifications, and training status."}),e.jsx(t,{className:"bg-blue-600 hover:bg-blue-700",children:"View Driver Details"})]})})]})}),e.jsx(o,{value:"vehicles",className:"space-y-4",children:e.jsxs(i,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(N,{className:"w-5 h-5"}),"Vehicle Compliance Overview"]})}),e.jsx(n,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Vehicle Compliance Tracking"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Monitor vehicle inspections, insurance, MOT status, and maintenance compliance."}),e.jsx(t,{className:"bg-blue-600 hover:bg-blue-700",children:"View Vehicle Details"})]})})]})}),e.jsx(o,{value:"reports",className:"space-y-4",children:e.jsxs(i,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),"Compliance Reports"]})}),e.jsx(n,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(R,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Generate Compliance Reports"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Create detailed compliance reports for regulatory submissions and internal reviews."}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(t,{className:"bg-blue-600 hover:bg-blue-700",children:"Generate Report"}),e.jsxs(t,{variant:"outline",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Export Data"]})]})]})})]})})]})]})};export{je as default};
