var C=(p,a,o)=>new Promise((t,j)=>{var m=i=>{try{x(o.next(i))}catch(u){j(u)}},f=i=>{try{x(o.throw(i))}catch(u){j(u)}},x=i=>i.done?t(i.value):Promise.resolve(i.value).then(m,f);x((o=o.apply(p,a)).next())});import{j as e}from"./ui-vendor-DMUr7mTx.js";import{u as A,s as _,B as h,C as n,a as l,b as c,d,e as k}from"./index-ZwIgorfy.js";import{u as U}from"./useComplianceData-CmhSjdal.js";import{u as q}from"./query-vendor-B2F_wWlc.js";import{N as R}from"./router-vendor-CEyBJ8vK.js";import{k as D,Z as E,ab as M,f as B,T as L,m as V,J as T,F as z,j as F}from"./icons-vendor-b0I7fGSL.js";import"./react-vendor-BvqlMsL5.js";import"./supabase-vendor-B984m0TI.js";import"./utils-vendor-B2FlkASS.js";import"./ui-components-7w1-MJre.js";const W=()=>{const{user:p,profile:a,loading:o}=A();if(o)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading..."})]})});if(!p||!a)return e.jsx(R,{to:"/auth",replace:!0});if(a.role!=="admin"&&a.role!=="council")return e.jsx(R,{to:"/",replace:!0});const{data:t,isLoading:j}=U(),{data:m,isLoading:f}=q({queryKey:["recent-violations"],queryFn:()=>C(void 0,null,function*(){try{const{data:s,error:N}=yield _.from("compliance_violations").select("*").eq("organization_id",a.organization_id).order("violation_date",{ascending:!1}).limit(10);if(N)return console.warn("Error fetching compliance violations:",N),[];const v=[...new Set((s==null?void 0:s.filter(r=>r.driver_id).map(r=>r.driver_id))||[])];let w=[];if(v.length>0){const{data:r}=yield _.from("profiles").select("id, first_name, last_name").in("id",v);w=r||[]}const g=new Map(w.map(r=>[r.id,r]));return(s==null?void 0:s.map(r=>{var y,b;return{id:r.id,driver:r.driver_id&&g.has(r.driver_id)&&`${((y=g.get(r.driver_id))==null?void 0:y.first_name)||""} ${((b=g.get(r.driver_id))==null?void 0:b.last_name)||""}`.trim()||"Unknown Driver",type:r.violation_type||"Unknown Violation",severity:r.severity||"Unknown",date:new Date(r.violation_date).toLocaleDateString(),status:r.status||"Unknown"}}))||[]}catch(s){return console.warn("Error fetching compliance violations:",s),[]}}),enabled:!!(a!=null&&a.organization_id)}),x=j||f,i=s=>{switch(s){case"high":return"destructive";case"medium":return"secondary";case"low":return"outline";default:return"outline"}},u=s=>{switch(s){case"resolved":return"default";case"pending":return"secondary";default:return"outline"}};return x?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading compliance reports..."})]})}):e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(D,{className:"w-8 h-8 text-green-600"}),"Compliance Reports"]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Monitor compliance analytics and generate comprehensive reports"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(h,{variant:"outline",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Refresh"]}),e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),"Export Report"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(n,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Total Drivers"}),e.jsx(B,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(t==null?void 0:t.totalDrivers)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Active drivers"})]})]}),e.jsxs(n,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Active Violations"}),e.jsx(L,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:(t==null?void 0:t.activeViolations)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Requires attention"})]})]}),e.jsxs(n,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Critical Issues"}),e.jsx(D,{className:"h-4 w-4 text-red-500"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:(t==null?void 0:t.criticalAlerts)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Requires immediate attention"})]})]}),e.jsxs(n,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Compliance Score"}),e.jsx(V,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[(t==null?void 0:t.overallScore)||0,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Overall compliance"})]})]})]}),e.jsxs(n,{children:[e.jsx(l,{children:e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5"}),"Recent Compliance Issues"]})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-3",children:!m||m.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(T,{className:"h-12 w-12 mx-auto mb-4 text-green-600"}),e.jsx("p",{className:"text-lg font-medium",children:"No recent violations"}),e.jsx("p",{children:"All compliance requirements are being met"})]}):m.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.driver}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.type})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{variant:i(s.severity),children:s.severity}),e.jsx(k,{variant:u(s.status),children:s.status}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.date})]})]},s.id))})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs(n,{children:[e.jsx(l,{children:e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"Driver Compliance"]})}),e.jsxs(d,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Comprehensive report on driver licenses, certifications, and violations."}),e.jsx(h,{variant:"outline",className:"w-full",children:"Generate Report"})]})]}),e.jsxs(n,{children:[e.jsx(l,{children:e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),"Expiry Tracking"]})}),e.jsxs(d,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Track upcoming expirations for licenses, MOTs, and insurance."}),e.jsx(h,{variant:"outline",className:"w-full",children:"Generate Report"})]})]}),e.jsxs(n,{children:[e.jsx(l,{children:e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"Audit Summary"]})}),e.jsxs(d,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monthly audit summary with compliance scores and recommendations."}),e.jsx(h,{variant:"outline",className:"w-full",children:"Generate Report"})]})]})]}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["Last updated: ",new Date().toLocaleDateString()]})]})};export{W as default};
