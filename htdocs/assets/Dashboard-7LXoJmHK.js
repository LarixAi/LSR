var v=(a,s,n)=>new Promise((d,i)=>{var o=c=>{try{x(n.next(c))}catch(u){i(u)}},l=c=>{try{x(n.throw(c))}catch(u){i(u)}},x=c=>c.done?d(c.value):Promise.resolve(c.value).then(o,l);x((n=n.apply(a,s)).next())});import{j as e}from"./ui-vendor-DMUr7mTx.js";import{A as z,e as f,B as m,g as _,u as I,f as F,s as y,C as h,d as j,a as N,b as p,h as B,i as Y,j as A,k as q}from"./index-ZwIgorfy.js";import{a as K,u as w}from"./query-vendor-B2F_wWlc.js";import{a as C}from"./react-vendor-BvqlMsL5.js";import{u as T}from"./useTrialManagement-Diw1iLp0.js";import{a as k,N as S}from"./router-vendor-CEyBJ8vK.js";import{X as D,T as b,j as P,aq as Q,az as M,aE as R,a as V,f as U,W as L,A as W,J as E,m as H,g as J,p as G,F as X}from"./icons-vendor-b0I7fGSL.js";import"./supabase-vendor-B984m0TI.js";import"./utils-vendor-B2FlkASS.js";import"./ui-components-7w1-MJre.js";const O=({className:a=""})=>{const{data:s,isLoading:n,error:d}=T(),i=k(),[o,l]=C.useState(!0);if(n||!o||d||!s||!s.isActive)return null;const x=t=>t<=3?"destructive":(t<=7,"default"),c=t=>t<=3?e.jsx(b,{className:"h-4 w-4"}):t<=7?e.jsx(P,{className:"h-4 w-4"}):e.jsx(Q,{className:"h-4 w-4"}),u=t=>t<=3?"Trial Expiring Soon":t<=7?"Trial Ending Soon":"Free Trial Active",$=t=>t<=3?`Your trial expires in ${t} day${t===1?"":"s"}. Upgrade now to continue using all features.`:t<=7?`Your trial ends in ${t} days. Upgrade to keep your data and continue using the platform.`:`You have ${t} days left in your free trial. Upgrade anytime to unlock all features.`;return e.jsxs(z,{className:`mb-6 ${a}`,variant:x(s.daysLeft),children:[c(s.daysLeft),e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:u(s.daysLeft)}),e.jsxs(f,{variant:"outline",children:[s.currentDrivers,"/",s.maxDrivers," Drivers"]}),e.jsxs(f,{variant:"secondary",children:[s.daysLeft," days left"]})]}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>l(!1),className:"h-6 w-6 p-0 hover:bg-background/20",children:e.jsx(D,{className:"h-4 w-4"})})]}),e.jsxs(_,{className:"flex items-center justify-between",children:[e.jsx("span",{children:$(s.daysLeft)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{size:"sm",onClick:()=>i("/subscriptions"),variant:s.daysLeft<=3?"default":"outline",children:s.daysLeft<=3?"Upgrade Now":"View Plans"}),s.daysLeft>3&&e.jsx(m,{size:"sm",variant:"ghost",onClick:()=>i("/subscriptions"),children:"Learn More"})]})]})]})},Z=({className:a=""})=>{const{data:s,isLoading:n}=T(),d=k(),[i,o]=C.useState(!0);return n||!s||!i||s.isActive||s.daysLeft>0?null:e.jsxs(z,{className:`mb-6 ${a}`,variant:"destructive",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:"font-medium",children:"Trial Expired"}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>o(!1),className:"h-6 w-6 p-0 hover:bg-destructive/20",children:e.jsx(D,{className:"h-4 w-4"})})]}),e.jsxs(_,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Your free trial has expired. Upgrade to a paid plan to continue using the platform and access your data."}),e.jsx(m,{size:"sm",onClick:()=>d("/subscriptions"),variant:"destructive",children:"Upgrade Now"})]})]})},ee=({className:a=""})=>{const{data:s,isLoading:n}=T(),d=k(),[i,o]=C.useState(!0);if(n||!s||!i)return null;const l=s.currentDrivers/s.maxDrivers*100;return l<80?null:e.jsxs(z,{className:`mb-6 ${a}`,variant:l>=100?"destructive":"default",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:"font-medium",children:l>=100?"Driver Limit Reached":"Approaching Driver Limit"}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>o(!1),className:"h-6 w-6 p-0 hover:bg-background/20",children:e.jsx(D,{className:"h-4 w-4"})})]}),e.jsxs(_,{className:"flex items-center justify-between",children:[e.jsx("span",{children:l>=100?`You've reached your limit of ${s.maxDrivers} drivers. Upgrade to add more drivers.`:`You're using ${s.currentDrivers} of ${s.maxDrivers} drivers. Consider upgrading soon.`}),e.jsx(m,{size:"sm",onClick:()=>d("/subscriptions"),variant:l>=100?"destructive":"outline",children:l>=100?"Upgrade Now":"View Plans"})]})]})};function xe(){const{profile:a}=I(),s=F();if(K(),(a==null?void 0:a.role)==="driver")return e.jsx(S,{to:"/driver-dashboard",replace:!0});if((a==null?void 0:a.role)==="mechanic")return e.jsx(S,{to:"/mechanic-dashboard",replace:!0});const{data:n=[]}=w({queryKey:["vehicles",a==null?void 0:a.organization_id],queryFn:()=>v(this,null,function*(){if(!(a!=null&&a.organization_id))return[];const{data:t,error:r}=yield y.from("vehicles").select("*").eq("organization_id",a.organization_id).limit(100);return r?(console.error("Error fetching vehicles:",r),[]):t||[]}),enabled:!!(a!=null&&a.organization_id)}),{data:d=[]}=w({queryKey:["drivers",a==null?void 0:a.organization_id],queryFn:()=>v(this,null,function*(){if(!(a!=null&&a.organization_id))return[];const{data:t,error:r}=yield y.from("profiles").select("*").eq("role","driver").eq("organization_id",a.organization_id).limit(100);return r?(console.error("Error fetching drivers:",r),[]):t||[]}),enabled:!!(a!=null&&a.organization_id)}),{data:i=[]}=w({queryKey:["recent-incidents",a==null?void 0:a.organization_id],queryFn:()=>v(this,null,function*(){if(!(a!=null&&a.organization_id))return[];const{data:t,error:r}=yield y.from("incidents").select("*").eq("organization_id",a.organization_id).order("created_at",{ascending:!1}).limit(5);return r?(console.error("Error fetching incidents:",r),[]):t||[]}),enabled:!!(a!=null&&a.organization_id)}),{data:o=[]}=w({queryKey:["maintenance-requests",a==null?void 0:a.organization_id],queryFn:()=>v(this,null,function*(){if(!(a!=null&&a.organization_id))return[];const{data:t,error:r}=yield y.from("maintenance_requests").select("*").eq("organization_id",a.organization_id).order("created_at",{ascending:!1}).limit(10);return r?(console.error("Error fetching maintenance requests:",r),[]):t||[]}),enabled:!!(a!=null&&a.organization_id)}),l=n.filter(t=>t.status==="active").length,x=d.filter(t=>t.is_active).length,c=o.filter(t=>t.status==="pending").length,u=i.length,$=[{label:"Add Vehicle",icon:V,href:"/vehicles"},{label:"Add Driver",icon:U,href:"/drivers"},{label:"Create Route",icon:G,href:"/routes"},{label:"View Reports",icon:X,href:"/analytics"}];return e.jsxs("div",{className:`${s?"space-y-4":"space-y-6"}`,children:[e.jsx(O,{}),e.jsx(Z,{}),e.jsx(ee,{}),e.jsxs("div",{className:`${s?"space-y-3":"flex items-center justify-between"}`,children:[e.jsxs("div",{children:[e.jsx("h1",{className:`${s?"text-2xl":"text-3xl"} font-bold`,children:"Dashboard"}),e.jsxs("p",{className:`text-muted-foreground ${s?"text-sm":""}`,children:["Welcome back, ",(a==null?void 0:a.first_name)||"User","! Here's your fleet overview."]})]}),e.jsx("div",{className:`flex ${s?"flex-col space-y-2":"gap-2"}`})]}),(a==null?void 0:a.role)==="admin"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(h,{className:"border-purple-200 bg-purple-50 action-card",children:e.jsx(j,{className:`${s?"p-3":"p-4"}`,children:e.jsxs("div",{className:`${s?"space-y-3":"flex items-center justify-between"}`,children:[e.jsxs("div",{className:`flex items-center ${s?"space-x-2":"space-x-3"}`,children:[e.jsx(M,{className:`${s?"h-4 w-4":"h-5 w-5"} text-purple-600`}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-medium text-purple-900 ${s?"text-sm":""}`,children:"Driver Training Management"}),e.jsx("p",{className:`${s?"text-xs":"text-sm"} text-purple-700`,children:"Assign training modules to drivers and track their completion progress."})]})]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>window.location.href="/admin/training-management",className:`border-purple-300 text-purple-700 hover:bg-purple-100 admin-button-secondary ${s?"w-full":""}`,children:[e.jsx(M,{className:`${s?"mr-1":"mr-2"} h-4 w-4`}),s?"Manage":"Manage Training"]})]})})}),e.jsx(h,{className:"border-blue-200 bg-blue-50 action-card",children:e.jsx(j,{className:`${s?"p-3":"p-4"}`,children:e.jsxs("div",{className:`${s?"space-y-3":"flex items-center justify-between"}`,children:[e.jsxs("div",{className:`flex items-center ${s?"space-x-2":"space-x-3"}`,children:[e.jsx(R,{className:`${s?"h-4 w-4":"h-5 w-5"} text-blue-600`}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-medium text-blue-900 ${s?"text-sm":""}`,children:"Mechanic Request Management"}),e.jsx("p",{className:`${s?"text-xs":"text-sm"} text-blue-700`,children:"Manage mechanic requests and working relationships for your organization."})]})]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>window.location.href="/admin/mechanic-requests",className:`border-blue-300 text-blue-700 hover:bg-blue-100 admin-button-secondary ${s?"w-full":""}`,children:[e.jsx(R,{className:`${s?"mr-1":"mr-2"} h-4 w-4`}),s?"Manage":"Manage Requests"]})]})})})]}),e.jsxs("div",{className:`grid ${s?"grid-cols-2 gap-3":"gap-4 md:grid-cols-2 lg:grid-cols-4"}`,children:[e.jsxs(h,{className:"stats-card",children:[e.jsxs(N,{className:`flex flex-row items-center justify-between space-y-0 ${s?"pb-1":"pb-2"}`,children:[e.jsx(p,{className:`${s?"text-xs":"text-sm"} font-medium stats-label`,children:"Total Vehicles"}),e.jsx(V,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{className:s?"pt-1":"",children:[e.jsx("div",{className:`${s?"text-lg":"text-2xl"} font-bold stats-number`,children:n.length}),e.jsxs("p",{className:"text-xs text-muted-foreground stats-label",children:[l," active"]})]})]}),e.jsxs(h,{className:"stats-card",children:[e.jsxs(N,{className:`flex flex-row items-center justify-between space-y-0 ${s?"pb-1":"pb-2"}`,children:[e.jsx(p,{className:`${s?"text-xs":"text-sm"} font-medium stats-label`,children:"Active Drivers"}),e.jsx(U,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{className:s?"pt-1":"",children:[e.jsx("div",{className:`${s?"text-lg":"text-2xl"} font-bold stats-number`,children:x}),e.jsxs("p",{className:"text-xs text-muted-foreground stats-label",children:["of ",d.length," total drivers"]})]})]}),e.jsxs(h,{className:"stats-card",children:[e.jsxs(N,{className:`flex flex-row items-center justify-between space-y-0 ${s?"pb-1":"pb-2"}`,children:[e.jsx(p,{className:`${s?"text-xs":"text-sm"} font-medium stats-label`,children:"Pending Maintenance"}),e.jsx(L,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{className:s?"pt-1":"",children:[e.jsx("div",{className:`${s?"text-lg":"text-2xl"} font-bold stats-number`,children:c}),e.jsx("p",{className:"text-xs text-muted-foreground stats-label",children:"requests awaiting attention"})]})]}),e.jsxs(h,{className:"stats-card",children:[e.jsxs(N,{className:`flex flex-row items-center justify-between space-y-0 ${s?"pb-1":"pb-2"}`,children:[e.jsx(p,{className:`${s?"text-xs":"text-sm"} font-medium stats-label`,children:"Recent Incidents"}),e.jsx(b,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{className:s?"pt-1":"",children:[e.jsx("div",{className:`${s?"text-lg":"text-2xl"} font-bold stats-number`,children:u}),e.jsx("p",{className:"text-xs text-muted-foreground stats-label",children:"in the last 7 days"})]})]})]}),e.jsxs("div",{className:`grid ${s?"gap-4":"gap-6 md:grid-cols-2 lg:grid-cols-7"}`,children:[e.jsxs(h,{className:`${s?"":"col-span-4"} dashboard-card`,children:[e.jsx(N,{className:s?"pb-3":"",children:e.jsxs(p,{className:`flex items-center space-x-2 ${s?"text-lg":""}`,children:[e.jsx(W,{className:`${s?"w-4 h-4":"w-5 h-5"}`}),e.jsx("span",{children:"Recent Activity"})]})}),e.jsx(j,{children:e.jsxs(B,{defaultValue:"incidents",className:"w-full",children:[e.jsxs(Y,{className:"grid w-full grid-cols-2 tabs-list",children:[e.jsx(A,{value:"incidents",className:"tabs-trigger",children:"Recent Incidents"}),e.jsx(A,{value:"maintenance",className:"tabs-trigger",children:"Maintenance"})]}),e.jsx(q,{value:"incidents",className:"space-y-4",children:i.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(E,{className:"w-12 h-12 mx-auto mb-2 text-green-500"}),e.jsx("p",{children:"No recent incidents - Great job!"})]}):i.slice(0,5).map((t,r)=>{var g;return e.jsxs("div",{className:"flex items-center space-x-4 rounded-lg border p-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(b,{className:"w-5 h-5 text-orange-500"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:t.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[(g=t.description)==null?void 0:g.substring(0,100),"..."]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(t.created_at).toLocaleDateString()})]}),e.jsx(f,{variant:t.severity==="high"?"destructive":t.severity==="medium"?"default":"secondary",children:t.severity})]},t.id||r)})}),e.jsx(q,{value:"maintenance",className:"space-y-4",children:o.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(E,{className:"w-12 h-12 mx-auto mb-2 text-green-500"}),e.jsx("p",{children:"No pending maintenance requests"})]}):o.slice(0,5).map((t,r)=>{var g;return e.jsxs("div",{className:"flex items-center space-x-4 rounded-lg border p-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(L,{className:"w-5 h-5 text-blue-500"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:"Maintenance Request"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[(g=t.description)==null?void 0:g.substring(0,100),"..."]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(t.created_at).toLocaleDateString()})]}),e.jsx(f,{variant:t.status==="pending"?"default":t.status==="in_progress"?"secondary":"outline",children:t.status})]},t.id||r)})})]})})]}),e.jsxs(h,{className:"col-span-3",children:[e.jsx(N,{children:e.jsxs(p,{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"w-5 h-5"}),e.jsx("span",{children:"Quick Actions"})]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsx("div",{className:"grid gap-3",children:$.map((t,r)=>{const g=t.icon;return e.jsxs(m,{variant:"outline",className:"w-full justify-start",onClick:()=>window.location.href=t.href,children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),t.label]},r)})}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Fleet Status"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Vehicles Active"}),e.jsxs(f,{variant:"secondary",children:[l,"/",n.length]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Drivers Available"}),e.jsxs(f,{variant:"secondary",children:[x,"/",d.length]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Maintenance Due"}),e.jsx(f,{variant:c>0?"destructive":"secondary",children:c})]})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center space-x-2",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{children:"Today's Summary"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Active Routes"}),e.jsx("span",{className:"font-medium",children:"0"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Completed Jobs"}),e.jsx("span",{className:"font-medium",children:"0"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"New Incidents"}),e.jsx("span",{className:"font-medium",children:u})]})]})]})]})]})]})]})}export{xe as default};
