var We=Object.defineProperty,Le=Object.defineProperties;var qe=Object.getOwnPropertyDescriptors;var ve=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable;var ye=(a,r,l)=>r in a?We(a,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[r]=l,D=(a,r)=>{for(var l in r||(r={}))ze.call(r,l)&&ye(a,l,r[l]);if(ve)for(var l of ve(r))Ee.call(r,l)&&ye(a,l,r[l]);return a},T=(a,r)=>Le(a,qe(r));var F=(a,r,l)=>new Promise((j,n)=>{var O=h=>{try{p(l.next(h))}catch(f){n(f)}},N=h=>{try{p(l.throw(h))}catch(f){n(f)}},p=h=>h.done?j(h.value):Promise.resolve(h.value).then(O,N);p((l=l.apply(a,r)).next())});import{j as e}from"./ui-vendor-DMUr7mTx.js";import{r as u}from"./react-vendor-BvqlMsL5.js";import{u as Te,s as q,y as $,B as o,C as v,a as _,b as C,d as y,c as te,e as b,P as Pe,z as Ae,I as X,S as B,q as Q,r as H,t as U,v as c,h as Ie,i as Ve,j as Y,k as Me,D as re,m as ae,n as le,o as ie,p as ce,L as x,T as Ke,G as Ne}from"./index-ZwIgorfy.js";import{a as Fe,u as ee,b as ne}from"./query-vendor-B2F_wWlc.js";import{O as Be}from"./OrganizationSelector-D_TUpvVh.js";import{T as z,X as Qe,W as I,au as we,J as de,Z as be,E as _e,k as Ce,F as Se,a2 as ke,aa as He,ak as Ue,j as Ye,_ as Ze,a4 as Ge}from"./icons-vendor-b0I7fGSL.js";import{N as De}from"./router-vendor-CEyBJ8vK.js";import"./supabase-vendor-B984m0TI.js";import"./utils-vendor-B2FlkASS.js";import"./ui-components-7w1-MJre.js";const Je=({defectId:a,onClose:r})=>{const{profile:l}=Te(),j=Fe(),{data:n,isLoading:O}=ee({queryKey:["defect",a],queryFn:()=>F(void 0,null,function*(){console.log("ðŸ” Fetching defect:",a);const{data:t,error:d}=yield q.from("combined_defects").select(`
          id,
          defect_number,
          title,
          description,
          defect_type,
          severity,
          status,
          organization_id,
          source_type
        `).eq("id",a).single();if(d)throw console.error("âŒ Error fetching defect:",d),d;return console.log("âœ… Defect fetched:",t),t})}),{data:N=[],isLoading:p}=ee({queryKey:["work-order-stages",a],queryFn:()=>F(void 0,null,function*(){console.log("ðŸ” Fetching work order stages for defect:",a);const{data:t,error:d}=yield q.from("work_order_stages").select("*").eq("defect_id",a).order("stage_order");if(d)throw console.error("âŒ Error fetching stages:",d),d;return console.log("âœ… Stages fetched:",t),t||[]}),enabled:!!a}),h=ne({mutationFn:()=>F(void 0,null,function*(){console.log("ðŸ”§ Starting work order for defect:",a),console.log("ðŸ”§ Using mechanic ID:",l==null?void 0:l.id),console.log("ðŸ”§ Defect type:",n==null?void 0:n.defect_type);const{data:t,error:d}=yield q.rpc("start_work_order",{p_defect_id:a,p_mechanic_id:l==null?void 0:l.id});if(d)throw console.error("âŒ Error starting work order:",d),d;return console.log("âœ… Work order started:",t),t}),onSuccess:()=>{j.invalidateQueries({queryKey:["work-order-stages",a]}),j.invalidateQueries({queryKey:["defect",a]}),$({title:"Work Order Started",description:"Work order has been initiated successfully."})},onError:t=>{console.error("âŒ Start work order failed:",t),$({title:"Error",description:"Failed to start work order. Please try again.",variant:"destructive"})}}),f=ne({mutationFn:oe=>F(void 0,[oe],function*({stageId:t,status:d}){const{data:se,error:R}=yield q.from("work_order_stages").update({status:d,started_at:d==="in_progress"?new Date().toISOString():void 0,completed_at:d==="completed"?new Date().toISOString():void 0,mechanic_id:l==null?void 0:l.id,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(R)throw R;return se}),onSuccess:()=>{j.invalidateQueries({queryKey:["work-order-stages",a]})}}),Z=ne({mutationFn:()=>F(void 0,null,function*(){const{data:t,error:d}=yield q.rpc("complete_work_order",{p_defect_id:a,p_mechanic_id:l==null?void 0:l.id});if(d)throw d;return t}),onSuccess:()=>{j.invalidateQueries({queryKey:["work-order-stages",a]}),j.invalidateQueries({queryKey:["defect",a]}),$({title:"Work Order Completed",description:"Work order has been completed successfully."})}});if(O)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading workflow..."})]})});if(!n)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx(z,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("p",{className:"text-red-500 mb-4",children:"Defect not found"}),e.jsx(o,{onClick:r,variant:"outline",children:"Close"})]});const S=N.filter(t=>t.status==="completed").length,k=N.length,V=k>0?S/k*100:0,E=n.status==="repairing",P=n.status==="reported"||n.status==="investigating";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Defect Workflow"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[n.defect_number," - ",n.title]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Type: ",n.defect_type," | Source: ",n.source_type]})]}),e.jsx(o,{onClick:r,variant:"outline",children:e.jsx(Qe,{className:"w-4 h-4"})})]}),e.jsxs(v,{className:"border-yellow-200 bg-yellow-50",children:[e.jsx(_,{children:e.jsx(C,{className:"text-yellow-800",children:"Debug Information"})}),e.jsx(y,{children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Defect ID:"})," ",a]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Defect Type:"})," ",n.defect_type]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",n.status]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Work Order Number:"})," Not Available"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Stages:"})," ",k]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Completed Stages:"})," ",S]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Can Start Work Order:"})," ",P?"Yes":"No"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Is Work Order Started:"})," ",E?"Yes":"No"]})]})})]}),e.jsxs(v,{children:[e.jsxs(_,{children:[e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5"}),"Work Order Status"]}),e.jsx(te,{children:"Work Order Status"})]}),e.jsx(y,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Progress"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[S," of ",k," stages completed"]})]}),e.jsx(b,{variant:n.status==="resolved"?"default":"secondary",children:n.status})]}),e.jsx(Pe,{value:V,className:"w-full"}),P&&e.jsxs(o,{onClick:()=>h.mutate(),disabled:h.isPending,className:"w-full",children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),h.isPending?"Starting...":"Start Work Order"]})]})})]}),E&&N.length>0&&e.jsxs(v,{children:[e.jsxs(_,{children:[e.jsx(C,{children:"Workflow Stages"}),e.jsx(te,{children:"Follow the workflow to complete the repair"})]}),e.jsx(y,{children:e.jsx("div",{className:"space-y-4",children:N.map(t=>e.jsxs("div",{className:`p-4 border rounded-lg ${t.status==="completed"?"border-green-500 bg-green-50":t.status==="in_progress"?"border-yellow-500 bg-yellow-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:t.stage_name}),e.jsx(b,{variant:t.status==="completed"?"default":t.status==="in_progress"?"secondary":"outline",children:t.status})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.status==="pending"&&e.jsx(o,{onClick:()=>f.mutate({stageId:t.id,status:"in_progress"}),size:"sm",children:"Start"}),t.status==="in_progress"&&e.jsx(o,{onClick:()=>f.mutate({stageId:t.id,status:"completed"}),size:"sm",variant:"outline",children:"Complete"})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:t.notes})]},t.id))})})]}),E&&N.length===0&&e.jsxs(v,{className:"border-red-200 bg-red-50",children:[e.jsx(_,{children:e.jsxs(C,{className:"text-red-800 flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"No Workflow Stages Found"]})}),e.jsxs(y,{children:[e.jsx("p",{className:"text-red-700 mb-4",children:"The work order was started but no workflow stages were created. This might be due to:"}),e.jsxs("ul",{className:"text-red-700 text-sm space-y-1 mb-4",children:[e.jsxs("li",{children:["â€¢ No workflow template found for defect type: ",e.jsx("strong",{children:n.defect_type})]}),e.jsx("li",{children:"â€¢ The start_work_order function failed to create stages"}),e.jsx("li",{children:"â€¢ Database permissions issue"})]}),e.jsxs(o,{onClick:()=>h.mutate(),disabled:h.isPending,variant:"outline",className:"border-red-300 text-red-700 hover:bg-red-100",children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Retry Starting Work Order"]})]})]}),E&&S===k&&k>0&&e.jsxs(v,{className:"border-green-500 bg-green-50",children:[e.jsxs(_,{children:[e.jsxs(C,{className:"flex items-center gap-2 text-green-800",children:[e.jsx(de,{className:"w-5 h-5"}),"Ready to Complete"]}),e.jsx(te,{className:"text-green-700",children:"All stages are completed. Ready to finalize the work order."})]}),e.jsx(y,{children:e.jsxs(o,{onClick:()=>Z.mutate(),disabled:Z.isPending,className:"w-full bg-green-600 hover:bg-green-700",children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Complete Work Order"]})})]})]})},xs=()=>{var ge,pe;const{user:a,profile:r,loading:l}=Te(),{selectedOrganizationId:j,setSelectedOrganizationId:n}=Ae();Fe();const[O,N]=u.useState("all"),[p,h]=u.useState(""),[f,Z]=u.useState("all"),[S,k]=u.useState("all"),[V,E]=u.useState("all"),[P,t]=u.useState(!1),[d,oe]=u.useState(!1),[se,R]=u.useState(!1),[Oe,G]=u.useState(!1),[i,J]=u.useState(null),[m,W]=u.useState({title:"",description:"",defect_type:"mechanical",severity:"medium",location:"",estimated_cost:0,vehicle_id:"",additional_notes:""}),w=(r==null?void 0:r.role)==="mechanic"?j:r==null?void 0:r.organization_id,{data:A=[],isLoading:Re,error:Xe}=ee({queryKey:["combined-defects",w,r==null?void 0:r.role],queryFn:()=>F(void 0,null,function*(){if(!w)return[];try{let s=q.from("combined_defects").select(`
            id,
            defect_number,
            vehicle_id,
            reported_by,
            title,
            description,
            defect_type,
            severity,
            status,
            location,
            defect_date,
            estimated_cost,
            actual_cost,
            created_at,
            updated_at,
            organization_id,
            source_type
          `).order("created_at",{ascending:!1});s=s.eq("organization_id",w);const{data:g,error:L}=yield s;return L?(console.error("Error fetching defect reports:",L),[]):(g||[]).map(K=>T(D({},K),{defect_date:K.defect_date,source_type:K.source_type||"defect_report"}))}catch(s){return console.error("Error in defect fetching:",s),[]}}),enabled:!!w,staleTime:0,gcTime:0,refetchOnWindowFocus:!0,refetchOnMount:!0,refetchInterval:5e3,refetchIntervalInBackground:!0});if(ee({queryKey:["vehicles",w],queryFn:()=>F(void 0,null,function*(){if(!w)return[];const{data:s,error:g}=yield q.from("vehicles").select("id, make, model").eq("organization_id",w).order("make");return g?(console.error("Error fetching vehicles:",g),[]):s||[]}),enabled:!!w,staleTime:0,gcTime:0}),u.useEffect(()=>{P&&W({title:"",description:"",defect_type:"mechanical",severity:"medium",location:"",estimated_cost:0,vehicle_id:"",additional_notes:""})},[P]),l)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading defect reports..."})]})});if(!a)return e.jsx(De,{to:"/auth",replace:!0});if((r==null?void 0:r.role)==="mechanic"&&!j)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Select Organization"}),e.jsx(Be,{onOrganizationSelect:n,selectedOrganizationId:j||void 0})]})});if(!r)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(z,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-red-900 mb-2",children:"Profile Loading Issue"}),e.jsx("p",{className:"text-red-500 mb-4",children:"Unable to load user profile. Please refresh the page."}),e.jsxs(o,{onClick:()=>window.location.reload(),variant:"outline",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Refresh Page"]})]})});if(r.role!=="mechanic"&&r.role!=="admin"&&r.role!=="council")return e.jsx(De,{to:"/dashboard",replace:!0});const M=A.filter(s=>{const g=p===""||s.title.toLowerCase().includes(p.toLowerCase())||s.description.toLowerCase().includes(p.toLowerCase())||s.defect_number.toLowerCase().includes(p.toLowerCase()),L=f==="all"||s.severity===f,fe=S==="all"||s.status===S,K=V==="all"||s.defect_type===V;return g&&L&&fe&&K}),xe=(()=>{switch(O){case"reported":return M.filter(s=>s.status==="reported");case"investigating":return M.filter(s=>s.status==="investigating");case"repairing":return M.filter(s=>s.status==="repairing");case"resolved":return M.filter(s=>s.status==="resolved");default:return M}})(),he=s=>{switch(s){case"critical":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},me=s=>{switch(s){case"reported":return"bg-blue-100 text-blue-800";case"investigating":return"bg-yellow-100 text-yellow-800";case"repairing":return"bg-orange-100 text-orange-800";case"resolved":return"bg-green-100 text-green-800";case"closed":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},ue=s=>{switch(s){case"reported":return e.jsx(z,{className:"w-4 h-4"});case"investigating":return e.jsx(ke,{className:"w-4 h-4"});case"repairing":return e.jsx(I,{className:"w-4 h-4"});case"resolved":return e.jsx(de,{className:"w-4 h-4"});case"closed":return e.jsx(Se,{className:"w-4 h-4"});default:return e.jsx(Ye,{className:"w-4 h-4"})}},je=s=>{switch(s){case"safety":return e.jsx(Ce,{className:"w-4 h-4"});case"mechanical":return e.jsx(I,{className:"w-4 h-4"});case"electrical":return e.jsx(Ge,{className:"w-4 h-4"});case"cosmetic":return e.jsx(Ze,{className:"w-4 h-4"});default:return e.jsx(z,{className:"w-4 h-4"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Defect Reports"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage and track vehicle defects and issues"})]}),e.jsxs(o,{onClick:()=>t(!0),children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Create Defect Report"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(v,{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"Total Defects"}),e.jsx(z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold",children:A.length}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[A.filter(s=>s.status==="resolved").length," resolved"]})]})]}),e.jsxs(v,{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"Critical Issues"}),e.jsx(Ce,{className:"h-4 w-4 text-red-500"})]}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:A.filter(s=>s.severity==="critical").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Require immediate attention"})]})]}),e.jsxs(v,{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"In Progress"}),e.jsx(I,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:A.filter(s=>s.status==="investigating"||s.status==="repairing").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Being investigated or repaired"})]})]}),e.jsxs(v,{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"Total Cost"}),e.jsx(Se,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(y,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["Â£",A.reduce((s,g)=>s+(g.actual_cost||0),0).toLocaleString()]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total repair costs"})]})]})]}),e.jsx(v,{children:e.jsx(y,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(X,{placeholder:"Search defect...",value:p,onChange:s=>h(s.target.value),className:"pl-10"})]})}),e.jsxs(B,{value:f,onValueChange:Z,children:[e.jsx(Q,{className:"w-[180px]",children:e.jsx(H,{placeholder:"All Severity"})}),e.jsxs(U,{children:[e.jsx(c,{value:"all",children:"All Severity"}),e.jsx(c,{value:"critical",children:"Critical"}),e.jsx(c,{value:"high",children:"High"}),e.jsx(c,{value:"medium",children:"Medium"}),e.jsx(c,{value:"low",children:"Low"})]})]}),e.jsxs(B,{value:S,onValueChange:k,children:[e.jsx(Q,{className:"w-[180px]",children:e.jsx(H,{placeholder:"All Status"})}),e.jsxs(U,{children:[e.jsx(c,{value:"all",children:"All Status"}),e.jsx(c,{value:"reported",children:"Reported"}),e.jsx(c,{value:"investigating",children:"Investigating"}),e.jsx(c,{value:"repairing",children:"Repairing"}),e.jsx(c,{value:"resolved",children:"Resolved"}),e.jsx(c,{value:"closed",children:"Closed"})]})]}),e.jsxs(B,{value:V,onValueChange:E,children:[e.jsx(Q,{className:"w-[180px]",children:e.jsx(H,{placeholder:"All Types"})}),e.jsxs(U,{children:[e.jsx(c,{value:"all",children:"All Types"}),e.jsx(c,{value:"safety",children:"Safety"}),e.jsx(c,{value:"mechanical",children:"Mechanical"}),e.jsx(c,{value:"electrical",children:"Electrical"}),e.jsx(c,{value:"cosmetic",children:"Cosmetic"}),e.jsx(c,{value:"other",children:"Other"})]})]})]})})}),e.jsxs(Ie,{value:O,onValueChange:N,className:"space-y-4",children:[e.jsxs(Ve,{children:[e.jsx(Y,{value:"all",children:"All Reports"}),e.jsx(Y,{value:"reported",children:"Reported"}),e.jsx(Y,{value:"investigating",children:"Investigating"}),e.jsx(Y,{value:"repairing",children:"Repairing"}),e.jsx(Y,{value:"resolved",children:"Resolved"})]}),e.jsx(Me,{value:O,className:"space-y-4",children:Re?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})}):xe.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No defect reports found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"No defect reports found for the selected organization."}),w?e.jsxs(o,{onClick:()=>t(!0),children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Create Defect Report"]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-red-500 text-sm",children:"Organization ID is not set. This may prevent data from loading."}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(o,{onClick:()=>window.location.reload(),variant:"outline",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Refresh Page"]})})]})]}):e.jsx("div",{className:"space-y-4",children:xe.map(s=>{var g,L;return e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-semibold",children:s.defect_number}),e.jsx(b,{className:he(s.severity),children:s.severity}),e.jsxs(b,{className:me(s.status),children:[ue(s.status),s.status]}),e.jsxs(b,{variant:"outline",className:"flex items-center gap-1",children:[je(s.defect_type),s.defect_type]}),e.jsx(b,{variant:"secondary",className:"text-xs",children:s.source_type==="vehicle_check"?"Vehicle Check":"Manual Report"})]}),e.jsx("h5",{className:"font-medium text-lg mb-1",children:s.title}),e.jsx("p",{className:"text-gray-600 text-sm mb-2",children:s.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Vehicle:"}),e.jsxs("p",{className:"font-medium",children:[(g=s.vehicle)==null?void 0:g.make," ",(L=s.vehicle)==null?void 0:L.model]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Location:"}),e.jsx("p",{className:"font-medium",children:s.location})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Reported:"}),e.jsx("p",{className:"font-medium",children:new Date(s.defect_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Cost:"}),e.jsxs("p",{className:"font-medium",children:["Â£",s.actual_cost||s.estimated_cost]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{J(s),R(!0)},children:e.jsx(He,{className:"w-4 h-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{J(s),oe(!0)},children:e.jsx(Ue,{className:"w-4 h-4"})}),s.status==="reported"||s.status==="investigating"?e.jsxs(o,{variant:"default",size:"sm",onClick:()=>{J(s),G(!0)},children:[e.jsx(I,{className:"w-4 h-4"}),"Start Work"]}):s.status==="repairing"?e.jsxs(o,{variant:"secondary",size:"sm",onClick:()=>{J(s),G(!0)},children:[e.jsx(I,{className:"w-4 h-4"}),"Continue Work"]}):null]})]})},s.id)})})})]}),e.jsx(re,{open:P,onOpenChange:t,children:e.jsxs(ae,{className:"max-w-2xl",children:[e.jsxs(le,{children:[e.jsx(ie,{children:"Create Defect Report"}),e.jsx(ce,{children:"Report a new vehicle defect or issue"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"title",children:"Title"}),e.jsx(X,{id:"title",value:m.title,onChange:s=>W(T(D({},m),{title:s.target.value})),placeholder:"Brief description of the defect"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"description",children:"Description"}),e.jsx(Ke,{id:"description",value:m.description,onChange:s=>W(T(D({},m),{description:s.target.value})),placeholder:"Detailed description of the defect",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"defect_type",children:"Type"}),e.jsxs(B,{value:m.defect_type,onValueChange:s=>W(T(D({},m),{defect_type:s})),children:[e.jsx(Q,{children:e.jsx(H,{})}),e.jsxs(U,{children:[e.jsx(c,{value:"safety",children:"Safety"}),e.jsx(c,{value:"mechanical",children:"Mechanical"}),e.jsx(c,{value:"electrical",children:"Electrical"}),e.jsx(c,{value:"cosmetic",children:"Cosmetic"}),e.jsx(c,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"severity",children:"Severity"}),e.jsxs(B,{value:m.severity,onValueChange:s=>W(T(D({},m),{severity:s})),children:[e.jsx(Q,{children:e.jsx(H,{})}),e.jsxs(U,{children:[e.jsx(c,{value:"low",children:"Low"}),e.jsx(c,{value:"medium",children:"Medium"}),e.jsx(c,{value:"high",children:"High"}),e.jsx(c,{value:"critical",children:"Critical"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"location",children:"Location"}),e.jsx(X,{id:"location",value:m.location,onChange:s=>W(T(D({},m),{location:s.target.value})),placeholder:"Where the defect is located"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"estimated_cost",children:"Estimated Cost"}),e.jsx(X,{id:"estimated_cost",type:"number",value:m.estimated_cost,onChange:s=>W(T(D({},m),{estimated_cost:parseFloat(s.target.value)||0})),placeholder:"0.00"})]})]}),e.jsxs(Ne,{children:[e.jsx(o,{variant:"outline",onClick:()=>t(!1),children:"Cancel"}),e.jsx(o,{onClick:()=>{t(!1),$({title:"Defect Report Created",description:"The defect report has been created successfully."})},children:"Create Report"})]})]})}),e.jsx(re,{open:se,onOpenChange:R,children:e.jsxs(ae,{className:"max-w-2xl",children:[e.jsxs(le,{children:[e.jsx(ie,{children:"Defect Report Details"}),e.jsx(ce,{children:i==null?void 0:i.defect_number})]}),i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{className:"text-sm font-medium text-gray-500",children:"Title"}),e.jsx("p",{className:"text-lg font-medium",children:i.title})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-sm font-medium text-gray-500",children:"Status"}),e.jsxs(b,{className:me(i.status),children:[ue(i.status),i.status]})]})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-sm font-medium text-gray-500",children:"Description"}),e.jsx("p",{className:"text-gray-700",children:i.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{className:"text-sm font-medium text-gray-500",children:"Vehicle"}),e.jsxs("p",{className:"font-medium",children:[(ge=i.vehicle)==null?void 0:ge.make," ",(pe=i.vehicle)==null?void 0:pe.model]})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-sm font-medium text-gray-500",children:"Location"}),e.jsx("p",{className:"font-medium",children:i.location})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{className:"text-sm font-medium text-gray-500",children:"Severity"}),e.jsx(b,{className:he(i.severity),children:i.severity})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-sm font-medium text-gray-500",children:"Type"}),e.jsxs(b,{variant:"outline",className:"flex items-center gap-1",children:[je(i.defect_type),i.defect_type]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{className:"text-sm font-medium text-gray-500",children:"Estimated Cost"}),e.jsxs("p",{className:"font-medium",children:["Â£",i.estimated_cost]})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-sm font-medium text-gray-500",children:"Actual Cost"}),e.jsxs("p",{className:"font-medium",children:["Â£",i.actual_cost||0]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{className:"text-sm font-medium text-gray-500",children:"Reported"}),e.jsx("p",{className:"font-medium",children:new Date(i.defect_date).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-sm font-medium text-gray-500",children:"Last Updated"}),e.jsx("p",{className:"font-medium",children:new Date(i.updated_at).toLocaleString()})]})]})]}),e.jsxs(Ne,{children:[e.jsx(o,{variant:"outline",onClick:()=>R(!1),children:"Close"}),i&&e.jsx(o,{onClick:()=>{R(!1),oe(!0)},children:"Edit Defect Report"})]})]})}),e.jsx(re,{open:Oe,onOpenChange:G,children:e.jsxs(ae,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(le,{children:[e.jsx(ie,{children:"Defect Workflow"}),e.jsxs(ce,{children:[i==null?void 0:i.defect_number," - ",i==null?void 0:i.title]})]}),i&&e.jsx(Je,{defectId:i.id,onClose:()=>G(!1)})]})})]})};export{xs as default};
