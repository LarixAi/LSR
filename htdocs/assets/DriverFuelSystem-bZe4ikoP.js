var Ge=Object.defineProperty,Ke=Object.defineProperties;var Xe=Object.getOwnPropertyDescriptors;var Pe=Object.getOwnPropertySymbols;var Ye=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable;var Te=(N,x,t)=>x in N?Ge(N,x,{enumerable:!0,configurable:!0,writable:!0,value:t}):N[x]=t,ge=(N,x)=>{for(var t in x||(x={}))Ye.call(x,t)&&Te(N,t,x[t]);if(Pe)for(var t of Pe(x))Je.call(x,t)&&Te(N,t,x[t]);return N},ve=(N,x)=>Ke(N,Xe(x));var Y=(N,x,t)=>new Promise((B,P)=>{var Q=u=>{try{y(t.next(u))}catch(k){P(k)}},_=u=>{try{y(t.throw(u))}catch(k){P(k)}},y=u=>u.done?B(u.value):Promise.resolve(u.value).then(Q,_);y((t=t.apply(N,x)).next())});import{j as e}from"./ui-vendor-DMUr7mTx.js";import{r as v}from"./react-vendor-BvqlMsL5.js";import{l as ke,M as fe,B as n,C as j,d as p,h as qe,i as Ee,j as ee,k as se,I as m,S as q,q as E,r as V,t as M,v as d,e as C,a as D,b as A,D as xe,m as he,n as me,o as ue,L as a,T as ye,f as es,u as ss,c as Se,p as Le}from"./index-ZwIgorfy.js";import{T as ls,a as as,b as De,c as R,d as ts,e as O}from"./table-6WL4qh3Z.js";import{u as Ve,a as Me,b as Re,c as Oe,d as Ue}from"./useFuelPurchases-C7mcgkEN.js";import{u as Ie}from"./useVehicles-uD3YILF5.js";import{T as J,Z as be,E as we,a2 as ze,l as U,g as He,a3 as is,M as cs,aa as Be,ak as Qe,aF as $e,t as ns,ab as We,a4 as Ze,aI as je,X as oe,D as rs,m as ds,_ as os,aN as xs}from"./icons-vendor-b0I7fGSL.js";import{f as H,p as Ae}from"./utils-vendor-B2FlkASS.js";import"./supabase-vendor-B984m0TI.js";import"./query-vendor-B2F_wWlc.js";import"./router-vendor-CEyBJ8vK.js";import"./ui-components-7w1-MJre.js";function hs(){var ne,re,X,o,de,s,S,L;ke();const[N,x]=v.useState("purchases"),[t,B]=v.useState(""),[P,Q]=v.useState("all"),[_,y]=v.useState(!1),[u,k]=v.useState(null),[g,T]=v.useState(null),{data:b=[],isLoading:le,error:h,refetch:$}=Ve(),{data:ae=[]}=Ie(),W=Me(),te=Re(),ie=Oe(),{statistics:i}=Ue(),[f,Z]=v.useState({vehicle_id:"",fuel_type:"diesel",quantity:0,unit_price:0,total_cost:0,location:"",odometer_reading:0,purchase_date:new Date().toISOString().split("T")[0],notes:""}),ce=b.filter(l=>{var F,_e,Fe,Ce;const c=((F=l.vehicle_number)==null?void 0:F.toLowerCase().includes(t.toLowerCase()))||((_e=l.license_plate)==null?void 0:_e.toLowerCase().includes(t.toLowerCase()))||((Fe=l.location)==null?void 0:Fe.toLowerCase().includes(t.toLowerCase()))||((Ce=l.notes)==null?void 0:Ce.toLowerCase().includes(t.toLowerCase())),z=P==="all"||l.fuel_type===P;return c&&z}),I=l=>{switch(l){case"diesel":return e.jsx(C,{variant:"outline",className:"text-blue-600",children:"Diesel"});case"petrol":return e.jsx(C,{variant:"outline",className:"text-green-600",children:"Petrol"});case"electric":return e.jsx(C,{variant:"outline",className:"text-purple-600",children:"Electric"});default:return e.jsx(C,{variant:"outline",children:l})}},r=()=>{Z({vehicle_id:"",fuel_type:"diesel",quantity:0,unit_price:0,total_cost:0,location:"",odometer_reading:0,purchase_date:new Date().toISOString().split("T")[0],notes:""}),y(!0)},G=l=>{k(l),Z({vehicle_id:l.vehicle_id,fuel_type:l.fuel_type,quantity:Number(l.quantity),unit_price:Number(l.unit_price),total_cost:Number(l.total_cost),location:l.location||"",odometer_reading:l.odometer_reading||0,purchase_date:l.purchase_date,notes:l.notes||""}),y(!0)},K=l=>{T(l)},pe=l=>Y(this,null,function*(){if(confirm("Are you sure you want to delete this fuel purchase?"))try{yield ie.mutateAsync(l)}catch(c){}}),Ne=()=>Y(this,null,function*(){try{u?yield te.mutateAsync({id:u.id,updates:f}):yield W.mutateAsync(f),y(!1),k(null)}catch(l){}}),w=(l,c)=>{Z(z=>{const F=ve(ge({},z),{[l]:c});return(l==="quantity"||l==="unit_price")&&(F.total_cost=Number(F.quantity)*Number(F.unit_price)),F})};return le?e.jsx(fe,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading fuel system..."})]})})}):h?e.jsx(fe,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(J,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-red-900 mb-2",children:"Error Loading Fuel Data"}),e.jsx("p",{className:"text-red-700 mb-4",children:h.message}),e.jsxs(n,{onClick:()=>$(),variant:"outline",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Try Again"]})]})})}):e.jsx(fe,{children:e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Fuel System"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage fuel purchases and track consumption"})]}),e.jsxs(n,{size:"sm",className:"ml-4 flex-shrink-0",onClick:r,children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Add Fuel"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsx(j,{children:e.jsx(p,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:b.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Purchases"})]})})}),e.jsx(j,{children:e.jsx(p,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["£",((ne=i==null?void 0:i.totalSpent)==null?void 0:ne.toFixed(2))||"0.00"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Spent"})]})})}),e.jsx(j,{children:e.jsx(p,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[((re=i==null?void 0:i.totalQuantity)==null?void 0:re.toFixed(1))||"0.0","L"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Fuel"})]})})}),e.jsx(j,{children:e.jsx(p,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["£",((X=i==null?void 0:i.averagePrice)==null?void 0:X.toFixed(2))||"0.00"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Price/L"})]})})})]}),e.jsxs(qe,{value:N,onValueChange:x,className:"w-full",children:[e.jsxs(Ee,{className:"grid w-full grid-cols-3 mb-6",children:[e.jsx(ee,{value:"purchases",className:"text-xs",children:"Purchases"}),e.jsx(ee,{value:"analytics",className:"text-xs",children:"Analytics"}),e.jsx(ee,{value:"settings",className:"text-xs",children:"Settings"})]}),e.jsxs(se,{value:"purchases",className:"space-y-4",children:[e.jsx(j,{className:"mb-6",children:e.jsx(p,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(m,{placeholder:"Search purchases",value:t,onChange:l=>B(l.target.value),className:"pl-10"})]}),e.jsxs(q,{value:P,onValueChange:Q,children:[e.jsxs(E,{children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),e.jsx(V,{placeholder:"Filter by fuel type"})]}),e.jsxs(M,{children:[e.jsx(d,{value:"all",children:"All Types"}),e.jsx(d,{value:"diesel",children:"Diesel"}),e.jsx(d,{value:"petrol",children:"Petrol"}),e.jsx(d,{value:"electric",children:"Electric"})]})]})]})})}),ce.length===0?e.jsx(j,{children:e.jsx(p,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(U,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No fuel purchases found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:t||P!=="all"?"No purchases match your search criteria":"You haven't recorded any fuel purchases yet"}),e.jsxs(n,{onClick:r,children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Add First Purchase"]})]})})}):e.jsx("div",{className:"space-y-4",children:ce.map(l=>{var c;return e.jsx(j,{className:"overflow-hidden",children:e.jsxs(p,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 leading-tight",children:l.vehicle_number||"Unknown Vehicle"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:l.license_plate||"No license plate"})]}),e.jsxs("div",{className:"flex flex-col gap-1 flex-shrink-0",children:[I(l.fuel_type),e.jsxs(C,{variant:"outline",className:"text-green-600",children:["£",Number(l.total_cost).toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4 text-gray-400"}),H(Ae(l.purchase_date),"MMM dd, yyyy")]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(is,{className:"w-4 h-4 text-gray-400"}),((c=l.odometer_reading)==null?void 0:c.toLocaleString())||"N/A"," km"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"w-4 h-4 text-gray-400"}),l.location||"Location not specified"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4 text-gray-400"}),Number(l.quantity).toFixed(1),"L"]})]})]}),l.notes&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-gray-600",children:l.notes})}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>K(l),children:[e.jsx(Be,{className:"w-3 h-3 mr-1"}),"View"]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>G(l),children:[e.jsx(Qe,{className:"w-3 h-3 mr-1"}),"Edit"]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>pe(l.id),children:[e.jsx($e,{className:"w-3 h-3 mr-1"}),"Delete"]})]})]})},l.id)})})]}),e.jsx(se,{value:"analytics",className:"space-y-4",children:e.jsxs(j,{children:[e.jsx(D,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"w-5 h-5 text-blue-600"}),"Fuel Analytics"]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-1",children:"Monthly Average"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["£",((o=i==null?void 0:i.monthlyAverage)==null?void 0:o.toFixed(2))||"0.00"]}),e.jsx("p",{className:"text-sm text-blue-600",children:"per month"})]}),e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-800 mb-1",children:"Efficiency"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:((de=i==null?void 0:i.averageEfficiency)==null?void 0:de.toFixed(1))||"0.0"}),e.jsx("p",{className:"text-sm text-green-600",children:"km/L"})]}),e.jsxs("div",{className:"p-3 bg-orange-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-orange-800 mb-1",children:"Best Price"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:["£",((s=i==null?void 0:i.bestPricePerLiter)==null?void 0:s.toFixed(2))||"0.00"]}),e.jsx("p",{className:"text-sm text-orange-600",children:"per liter"})]}),e.jsxs("div",{className:"p-3 bg-purple-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-purple-800 mb-1",children:"Total Distance"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:((S=i==null?void 0:i.totalDistance)==null?void 0:S.toFixed(0))||"0"}),e.jsx("p",{className:"text-sm text-purple-600",children:"km"})]})]}),e.jsxs(n,{className:"w-full mt-4",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Export Analytics Report"]})]})]})}),e.jsx(se,{value:"settings",className:"space-y-4",children:e.jsxs(j,{children:[e.jsx(D,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"w-5 h-5 text-yellow-600"}),"Fuel System Settings"]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-yellow-50 rounded-lg border-l-4 border-yellow-400",children:[e.jsx("h4",{className:"font-medium text-yellow-800 mb-2",children:"Fuel Alerts"}),e.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsx("li",{children:"• Low fuel level notifications"}),e.jsx("li",{children:"• Price change alerts"}),e.jsx("li",{children:"• Maintenance reminders"})]})]}),e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border-l-4 border-blue-400",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Data Management"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• Auto-sync with vehicle systems"}),e.jsx("li",{children:"• Backup fuel purchase history"}),e.jsx("li",{children:"• Export data for reporting"})]})]}),e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border-l-4 border-green-400",children:[e.jsx("h4",{className:"font-medium text-green-800 mb-2",children:"Preferences"}),e.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[e.jsx("li",{children:"• Default fuel type"}),e.jsx("li",{children:"• Preferred fuel stations"}),e.jsx("li",{children:"• Currency settings"})]})]})]}),e.jsxs(n,{className:"w-full mt-4",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Save Settings"]})]})]})})]}),e.jsx(xe,{open:_,onOpenChange:y,children:e.jsxs(he,{className:"max-w-md",children:[e.jsx(me,{children:e.jsx(ue,{children:u?"Edit Fuel Purchase":"Add New Fuel Purchase"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"vehicle",children:"Vehicle"}),e.jsxs(q,{value:f.vehicle_id,onValueChange:l=>w("vehicle_id",l),children:[e.jsx(E,{children:e.jsx(V,{placeholder:"Select vehicle"})}),e.jsx(M,{children:ae.map(l=>e.jsxs(d,{value:l.id,children:[l.vehicle_number," - ",l.license_plate]},l.id))})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"fuel_type",children:"Fuel Type"}),e.jsxs(q,{value:f.fuel_type,onValueChange:l=>w("fuel_type",l),children:[e.jsx(E,{children:e.jsx(V,{})}),e.jsxs(M,{children:[e.jsx(d,{value:"diesel",children:"Diesel"}),e.jsx(d,{value:"petrol",children:"Petrol"}),e.jsx(d,{value:"electric",children:"Electric"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"quantity",children:"Quantity (L)"}),e.jsx(m,{id:"quantity",type:"number",step:"0.1",value:f.quantity,onChange:l=>w("quantity",parseFloat(l.target.value)||0)})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"unit_price",children:"Unit Price (£)"}),e.jsx(m,{id:"unit_price",type:"number",step:"0.01",value:f.unit_price,onChange:l=>w("unit_price",parseFloat(l.target.value)||0)})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"total_cost",children:"Total Cost (£)"}),e.jsx(m,{id:"total_cost",type:"number",step:"0.01",value:f.total_cost,onChange:l=>w("total_cost",parseFloat(l.target.value)||0)})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"location",children:"Location"}),e.jsx(m,{id:"location",value:f.location,onChange:l=>w("location",l.target.value),placeholder:"Fuel station name"})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"odometer",children:"Odometer Reading (km)"}),e.jsx(m,{id:"odometer",type:"number",value:f.odometer_reading,onChange:l=>w("odometer_reading",parseInt(l.target.value)||0)})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"purchase_date",children:"Purchase Date"}),e.jsx(m,{id:"purchase_date",type:"date",value:f.purchase_date,onChange:l=>w("purchase_date",l.target.value)})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"notes",children:"Notes"}),e.jsx(ye,{id:"notes",value:f.notes,onChange:l=>w("notes",l.target.value),placeholder:"Additional notes..."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{onClick:Ne,className:"flex-1",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),u?"Update":"Save"]}),e.jsxs(n,{variant:"outline",onClick:()=>y(!1),children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]})]})}),e.jsx(xe,{open:!!g,onOpenChange:()=>T(null),children:e.jsxs(he,{className:"max-w-md",children:[e.jsx(me,{children:e.jsx(ue,{children:"Fuel Purchase Details"})}),g&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Vehicle:"}),e.jsx("p",{children:g.vehicle_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"License Plate:"}),e.jsx("p",{children:g.license_plate})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Fuel Type:"}),e.jsx("p",{children:I(g.fuel_type)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Quantity:"}),e.jsxs("p",{children:[Number(g.quantity).toFixed(1),"L"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Unit Price:"}),e.jsxs("p",{children:["£",Number(g.unit_price).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Cost:"}),e.jsxs("p",{children:["£",Number(g.total_cost).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Location:"}),e.jsx("p",{children:g.location||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Odometer:"}),e.jsxs("p",{children:[((L=g.odometer_reading)==null?void 0:L.toLocaleString())||"N/A"," km"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Date:"}),e.jsx("p",{children:H(Ae(g.purchase_date),"MMM dd, yyyy")})]})]}),g.notes&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Notes:"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:g.notes})]})]})]})})]})})}const Cs=()=>{const N=es(),{profile:x,loading:t}=ss(),{toast:B}=ke(),[P,Q]=v.useState("new-purchase"),[_,y]=v.useState(""),[u,k]=v.useState("all"),[g,T]=v.useState(!1),[b,le]=v.useState(null),[h,$]=v.useState(null),{data:ae=[],isLoading:W,error:te,refetch:ie}=Ve(),{data:i=[]}=Ie(),f=Me(),Z=Re(),ce=Oe(),{statistics:I}=Ue(),[r,G]=v.useState({vehicle_id:"",fuel_type:"diesel",quantity:0,unit_price:0,total_cost:0,location:"",odometer_reading:0,purchase_date:new Date().toISOString().split("T")[0],notes:""});if(N)return e.jsx(hs,{});if(t||W)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading fuel system..."})]})});if(!x)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(J,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-red-900 mb-2",children:"Authentication Required"}),e.jsx("p",{className:"text-red-700",children:"Please log in to access the fuel system."})]})});if(te)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(J,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-red-900 mb-2",children:"Error Loading Fuel Data"}),e.jsx("p",{className:"text-red-700 mb-4",children:te.message}),e.jsxs(n,{onClick:()=>ie(),variant:"outline",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Try Again"]})]})});const K=ae.filter(s=>{var l,c,z,F;const S=((l=s.vehicle_number)==null?void 0:l.toLowerCase().includes(_.toLowerCase()))||((c=s.license_plate)==null?void 0:c.toLowerCase().includes(_.toLowerCase()))||((z=s.location)==null?void 0:z.toLowerCase().includes(_.toLowerCase()))||((F=s.notes)==null?void 0:F.toLowerCase().includes(_.toLowerCase())),L=u==="all"||s.fuel_type===u;return S&&L}),pe=s=>{switch(s){case"diesel":return e.jsx(C,{variant:"outline",className:"text-blue-600",children:"Diesel"});case"petrol":return e.jsx(C,{variant:"outline",className:"text-green-600",children:"Petrol"});case"electric":return e.jsx(C,{variant:"outline",className:"text-purple-600",children:"Electric"});default:return e.jsx(C,{variant:"outline",children:s})}},Ne=()=>{G({vehicle_id:"",fuel_type:"diesel",quantity:0,unit_price:0,total_cost:0,location:"",odometer_reading:0,purchase_date:new Date().toISOString().split("T")[0],notes:""}),T(!0)},w=s=>{le(s),G({vehicle_id:s.vehicle_id,fuel_type:s.fuel_type,quantity:Number(s.quantity),unit_price:Number(s.unit_price),total_cost:Number(s.total_cost),location:s.location||"",odometer_reading:s.odometer_reading||0,purchase_date:s.purchase_date,notes:s.notes||""}),T(!0)},ne=s=>{$(s)},re=s=>Y(void 0,null,function*(){if(confirm("Are you sure you want to delete this fuel purchase?"))try{yield ce.mutateAsync(s)}catch(S){}}),X=()=>Y(void 0,null,function*(){try{b?yield Z.mutateAsync({id:b.id,updates:r}):yield f.mutateAsync(r),T(!1),le(null)}catch(s){}}),o=(s,S)=>{G(L=>{const l=ve(ge({},L),{[s]:S});return(s==="quantity"||s==="unit_price")&&(l.total_cost=Number(l.quantity)*Number(l.unit_price)),l})},de=()=>{const s=[["Date","Vehicle","License Plate","Fuel Type","Quantity (L)","Unit Price (£)","Total Cost (£)","Location","Odometer","Notes"],...K.map(c=>[c.purchase_date,c.vehicle_number||"",c.license_plate||"",c.fuel_type,c.quantity,c.unit_price,c.total_cost,c.location||"",c.odometer_reading||"",c.notes||""])].map(c=>c.join(",")).join(`
`),S=new Blob([s],{type:"text/csv"}),L=window.URL.createObjectURL(S),l=document.createElement("a");l.href=L,l.download=`fuel-purchases-${new Date().toISOString().split("T")[0]}.csv`,l.click(),window.URL.revokeObjectURL(L),B({title:"Export Successful",description:"Fuel purchase data exported to CSV"})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Fuel System"}),e.jsx("p",{className:"text-muted-foreground",children:"Record fuel purchases and track consumption"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(n,{onClick:()=>ie(),variant:"outline",size:"sm",disabled:W,children:[e.jsx(be,{className:`w-4 h-4 mr-2 ${W?"animate-spin":""}`}),"Refresh"]}),e.jsxs(n,{onClick:de,variant:"outline",size:"sm",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Export"]}),e.jsxs(n,{onClick:Ne,children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Add Purchase"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(j,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(A,{className:"text-sm font-medium",children:"Total Spent"}),e.jsx(rs,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(p,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["£",I.totalSpent.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This month"})]})]}),e.jsxs(j,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(A,{className:"text-sm font-medium",children:"Total Fuel"}),e.jsx(U,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(p,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[I.totalQuantity.toFixed(1),"L"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Liters purchased"})]})]}),e.jsxs(j,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(A,{className:"text-sm font-medium",children:"Avg Price"}),e.jsx(ds,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(p,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["£",I.averagePrice.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Per liter"})]})]}),e.jsxs(j,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(A,{className:"text-sm font-medium",children:"Purchases"}),e.jsx(He,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:ae.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This month"})]})]})]}),e.jsxs(qe,{value:P,onValueChange:Q,className:"space-y-4",children:[e.jsxs(Ee,{className:"grid w-full grid-cols-2",children:[e.jsx(ee,{value:"new-purchase",children:"New Purchase"}),e.jsx(ee,{value:"history",children:"Purchase History"})]}),e.jsxs(se,{value:"new-purchase",className:"space-y-4",children:[e.jsxs(j,{children:[e.jsxs(D,{children:[e.jsxs(A,{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"w-5 h-5"}),e.jsx("span",{children:"Record Fuel Purchase"})]}),e.jsx(Se,{children:"Add a new fuel purchase for your assigned vehicle"})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"vehicle",children:"Select Vehicle"}),e.jsxs(q,{onValueChange:s=>o("vehicle_id",s),value:r.vehicle_id,children:[e.jsx(E,{children:e.jsx(V,{placeholder:"Choose your vehicle"})}),e.jsx(M,{children:i.map(s=>e.jsxs(d,{value:s.id,children:[s.vehicle_number," - ",s.license_plate]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"fuel-type",children:"Fuel Type"}),e.jsxs(q,{onValueChange:s=>o("fuel_type",s),value:r.fuel_type,children:[e.jsx(E,{children:e.jsx(V,{placeholder:"Select fuel type"})}),e.jsxs(M,{children:[e.jsx(d,{value:"diesel",children:"Diesel"}),e.jsx(d,{value:"petrol",children:"Petrol"}),e.jsx(d,{value:"electric",children:"Electric"})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"quantity",children:"Quantity (Liters/kWh)"}),e.jsx(m,{id:"quantity",type:"number",placeholder:"0.00",step:"0.1",value:r.quantity,onChange:s=>o("quantity",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"unit-price",children:"Unit Price (£)"}),e.jsx(m,{id:"unit-price",type:"number",placeholder:"0.00",step:"0.01",value:r.unit_price,onChange:s=>o("unit_price",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"total-cost",children:"Total Cost (£)"}),e.jsx(m,{id:"total-cost",type:"number",placeholder:"0.00",step:"0.01",value:r.total_cost,onChange:s=>o("total_cost",s.target.value)})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"location",children:"Location"}),e.jsx(m,{id:"location",placeholder:"Fuel station name and location",value:r.location,onChange:s=>o("location",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"odometer",children:"Odometer Reading"}),e.jsx(m,{id:"odometer",type:"number",placeholder:"Current mileage",value:r.odometer_reading,onChange:s=>o("odometer_reading",s.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"notes",children:"Notes"}),e.jsx(ye,{id:"notes",placeholder:"Any additional notes about this purchase...",rows:3,value:r.notes,onChange:s=>o("notes",s.target.value)})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsxs(n,{variant:"outline",onClick:()=>T(!1),children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(n,{onClick:X,children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),b?"Update Purchase":"Record Purchase"]})]})]})]}),e.jsxs(j,{children:[e.jsx(D,{children:e.jsxs(A,{className:"flex items-center space-x-2",children:[e.jsx(Ze,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{children:"Fuel Efficiency Tips"})]})}),e.jsx(p,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(os,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Smooth Driving"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avoid rapid acceleration and braking to improve fuel efficiency"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(J,{className:"w-5 h-5 text-orange-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Regular Maintenance"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Keep tires properly inflated and engine well-maintained"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(xs,{className:"w-5 h-5 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Reduce Idling"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Turn off engine when parked for more than 30 seconds"})]})]})]})})]})]}),e.jsxs(se,{value:"history",className:"space-y-4",children:[e.jsxs(j,{children:[e.jsxs(D,{children:[e.jsx(A,{children:"Purchase History"}),e.jsx(Se,{children:"View and manage your fuel purchase history"})]}),e.jsx(p,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(a,{htmlFor:"search",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(ze,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(m,{id:"search",placeholder:"Search by vehicle, location, or notes...",value:_,onChange:s=>y(s.target.value),className:"pl-8"})]})]}),e.jsxs("div",{className:"sm:w-48",children:[e.jsx(a,{htmlFor:"fuel-type-filter",children:"Fuel Type"}),e.jsxs(q,{value:u,onValueChange:k,children:[e.jsx(E,{children:e.jsx(V,{})}),e.jsxs(M,{children:[e.jsx(d,{value:"all",children:"All Types"}),e.jsx(d,{value:"diesel",children:"Diesel"}),e.jsx(d,{value:"petrol",children:"Petrol"}),e.jsx(d,{value:"electric",children:"Electric"})]})]})]})]})})]}),e.jsx(j,{children:e.jsxs(p,{className:"p-0",children:[e.jsxs(ls,{children:[e.jsx(as,{children:e.jsxs(De,{children:[e.jsx(R,{children:"Vehicle"}),e.jsx(R,{children:"Date"}),e.jsx(R,{children:"Fuel Type"}),e.jsx(R,{children:"Quantity"}),e.jsx(R,{children:"Total Cost"}),e.jsx(R,{children:"Location"}),e.jsx(R,{className:"text-right",children:"Actions"})]})}),e.jsx(ts,{children:K.map(s=>e.jsxs(De,{children:[e.jsx(O,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.vehicle_number}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.license_plate})]})}),e.jsx(O,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:H(new Date(s.purchase_date),"MMM dd, yyyy")}),e.jsx("div",{className:"text-sm text-muted-foreground",children:H(new Date(s.created_at),"HH:mm")})]})}),e.jsx(O,{children:pe(s.fuel_type)}),e.jsx(O,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.fuel_type==="electric"?`${s.quantity}kWh`:`${s.quantity}L`}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["£",s.unit_price.toFixed(2),"/unit"]})]})}),e.jsx(O,{children:e.jsxs("div",{className:"font-medium",children:["£",s.total_cost.toFixed(2)]})}),e.jsx(O,{children:e.jsx("div",{className:"max-w-xs truncate",children:s.location})}),e.jsx(O,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>ne(s),children:e.jsx(Be,{className:"w-4 h-4"})}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>w(s),children:e.jsx(Qe,{className:"w-4 h-4"})}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>re(s.id),children:e.jsx($e,{className:"w-4 h-4 text-red-500"})})]})})]},s.id))})]}),K.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(U,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"No fuel purchases found"}),e.jsx("p",{className:"text-muted-foreground",children:_||u!=="all"?"Try adjusting your search or filter criteria":"Record your first fuel purchase to see it here"})]})]})})]})]}),e.jsx(xe,{open:g,onOpenChange:T,children:e.jsxs(he,{className:"max-w-2xl",children:[e.jsxs(me,{children:[e.jsx(ue,{children:b?"Edit Fuel Purchase":"Add Fuel Purchase"}),e.jsx(Le,{children:"Record a new fuel purchase for your vehicle"})]}),e.jsxs("div",{className:"space-y-4",children:[b&&e.jsxs("div",{className:"flex items-center space-x-2 text-red-500",children:[e.jsx(J,{className:"w-5 h-5"}),e.jsxs("p",{children:["Editing existing purchase: ",b.vehicle_number," - ",b.license_plate]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"vehicle",children:"Select Vehicle"}),e.jsxs(q,{onValueChange:s=>o("vehicle_id",s),value:r.vehicle_id,children:[e.jsx(E,{children:e.jsx(V,{placeholder:"Choose your vehicle"})}),e.jsx(M,{children:i.map(s=>e.jsxs(d,{value:s.id,children:[s.vehicle_number," - ",s.license_plate]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"fuel-type",children:"Fuel Type"}),e.jsxs(q,{onValueChange:s=>o("fuel_type",s),value:r.fuel_type,children:[e.jsx(E,{children:e.jsx(V,{placeholder:"Select fuel type"})}),e.jsxs(M,{children:[e.jsx(d,{value:"diesel",children:"Diesel"}),e.jsx(d,{value:"petrol",children:"Petrol"}),e.jsx(d,{value:"electric",children:"Electric"})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"quantity",children:"Quantity (Liters/kWh)"}),e.jsx(m,{id:"quantity",type:"number",placeholder:"0.00",step:"0.1",value:r.quantity,onChange:s=>o("quantity",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"unit-price",children:"Unit Price (£)"}),e.jsx(m,{id:"unit-price",type:"number",placeholder:"0.00",step:"0.01",value:r.unit_price,onChange:s=>o("unit_price",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"total-cost",children:"Total Cost (£)"}),e.jsx(m,{id:"total-cost",type:"number",placeholder:"0.00",step:"0.01",value:r.total_cost,onChange:s=>o("total_cost",s.target.value)})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"location",children:"Location"}),e.jsx(m,{id:"location",placeholder:"Fuel station name and location",value:r.location,onChange:s=>o("location",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"odometer",children:"Odometer Reading"}),e.jsx(m,{id:"odometer",type:"number",placeholder:"Current mileage",value:r.odometer_reading,onChange:s=>o("odometer_reading",s.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"notes",children:"Notes"}),e.jsx(ye,{id:"notes",placeholder:"Any additional notes about this purchase...",rows:3,value:r.notes,onChange:s=>o("notes",s.target.value)})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsxs(n,{variant:"outline",onClick:()=>T(!1),children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(n,{onClick:X,children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),b?"Update Purchase":"Record Purchase"]})]})]})]})}),e.jsx(xe,{open:!!h,onOpenChange:s=>!s&&$(null),children:e.jsxs(he,{className:"max-w-2xl",children:[e.jsxs(me,{children:[e.jsx(ue,{children:"View Fuel Purchase"}),e.jsx(Le,{children:"Details of a specific fuel purchase"})]}),h?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Vehicle"}),e.jsx("div",{className:"font-medium",children:h.vehicle_number}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["License Plate: ",h.license_plate]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Date"}),e.jsx("div",{className:"font-medium",children:H(new Date(h.purchase_date),"MMM dd, yyyy")}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Created: ",H(new Date(h.created_at),"MMM dd, yyyy HH:mm")]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Fuel Type"}),e.jsx(C,{variant:"outline",children:h.fuel_type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Quantity"}),e.jsx("div",{className:"font-medium",children:h.fuel_type==="electric"?`${h.quantity}kWh`:`${h.quantity}L`}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["£",h.unit_price.toFixed(2),"/unit"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Total Cost"}),e.jsxs("div",{className:"font-medium",children:["£",h.total_cost.toFixed(2)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Location"}),e.jsx("div",{className:"font-medium",children:h.location})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Odometer Reading"}),e.jsx("div",{className:"font-medium",children:h.odometer_reading||"N/A"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Notes"}),e.jsx("div",{className:"font-medium",children:h.notes||"No notes"})]})]}),e.jsx("div",{className:"flex justify-end space-x-2",children:e.jsxs(n,{variant:"outline",onClick:()=>$(null),children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Close"]})})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(U,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No purchase selected for viewing."})]})]})})]})};export{Cs as default};
