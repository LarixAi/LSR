import{j as e}from"./ui-vendor-DMUr7mTx.js";import{r as u}from"./react-vendor-BvqlMsL5.js";import{u as ee,D as A,F as U,B as n,m as Y,n as z,o as G,L as l,S as v,q as N,r as y,t as f,v as a,I as h,T as se,C as i,d as c,h as ae,i as le,j as S,k as I,a as _,b as C,e as r}from"./index-ZwIgorfy.js";import{c as re,u as te,a as ie}from"./useIncidents-BcFhYSaB.js";import{N as q}from"./router-vendor-CEyBJ8vK.js";import{T as o,E as ce,ba as ne,af as de,F,j as W,a2 as xe,M as he,aa as oe}from"./icons-vendor-b0I7fGSL.js";import{f as b,p as w}from"./utils-vendor-B2FlkASS.js";import"./supabase-vendor-B984m0TI.js";import"./query-vendor-B2F_wWlc.js";import"./ui-components-7w1-MJre.js";const Ce=()=>{const{user:J,profile:D,loading:K}=ee();re();const[Q,X]=u.useState(!1),[m,Z]=u.useState(""),[L,me]=u.useState("all"),[R,je]=u.useState("all"),{data:d=[],isLoading:ge,error:pe}=te();ie();const $=d.filter(s=>{var x;const t=s.title.toLowerCase().includes(m.toLowerCase())||s.description.toLowerCase().includes(m.toLowerCase())||((x=s.location_address)==null?void 0:x.toLowerCase().includes(m.toLowerCase())),g=L==="all"||s.status===L,p=R==="all"||s.severity===R;return t&&g&&p}),T=s=>{switch(s){case"resolved":return e.jsx(r,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"Resolved"});case"investigating":return e.jsx(r,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"Under Investigation"});case"open":return e.jsx(r,{className:"bg-blue-100 text-blue-800 hover:bg-blue-100",children:"Open"});case"closed":return e.jsx(r,{className:"bg-gray-100 text-gray-800 hover:bg-gray-100",children:"Closed"});default:return e.jsx(r,{variant:"secondary",children:s})}},M=s=>{switch(s){case"low":return e.jsx(r,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"Low"});case"medium":return e.jsx(r,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"Medium"});case"high":return e.jsx(r,{className:"bg-red-100 text-red-800 hover:bg-red-100",children:"High"});case"critical":return e.jsx(r,{className:"bg-red-200 text-red-900 hover:bg-red-200",children:"Critical"});default:return e.jsx(r,{variant:"secondary",children:s})}},j={totalIncidents:d.length,resolvedIncidents:d.filter(s=>s.status==="resolved").length,pendingIncidents:d.filter(s=>s.status==="open"||s.status==="investigating").length,thisMonthIncidents:d.filter(s=>{const t=new Date(s.incident_date||s.created_at);return t.getMonth()===new Date().getMonth()&&t.getFullYear()===new Date().getFullYear()}).length};return K?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading incidents..."})]})}):!J||!D?e.jsx(q,{to:"/auth",replace:!0}):D.role!=="driver"?e.jsx(q,{to:"/dashboard",replace:!0}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(o,{className:"w-8 h-8 text-red-600"}),"Incident Reports"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Report and track safety incidents"})]}),e.jsxs(A,{open:Q,onOpenChange:X,children:[e.jsx(U,{asChild:!0,children:e.jsxs(n,{className:"bg-red-600 hover:bg-red-700",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Report Incident"]})}),e.jsxs(Y,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(z,{children:e.jsx(G,{children:"Report New Incident"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"incident-type",children:"Incident Type"}),e.jsxs(v,{children:[e.jsx(N,{children:e.jsx(y,{placeholder:"Select type"})}),e.jsxs(f,{children:[e.jsx(a,{value:"breakdown",children:"Vehicle Breakdown"}),e.jsx(a,{value:"accident",children:"Traffic Accident"}),e.jsx(a,{value:"passenger",children:"Passenger Incident"}),e.jsx(a,{value:"medical",children:"Medical Emergency"}),e.jsx(a,{value:"security",children:"Security Issue"}),e.jsx(a,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"severity",children:"Severity Level"}),e.jsxs(v,{children:[e.jsx(N,{children:e.jsx(y,{placeholder:"Select severity"})}),e.jsxs(f,{children:[e.jsx(a,{value:"low",children:"Low - Minor issue"}),e.jsx(a,{value:"medium",children:"Medium - Significant issue"}),e.jsx(a,{value:"high",children:"High - Serious issue"}),e.jsx(a,{value:"critical",children:"Critical - Emergency"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"date",children:"Date"}),e.jsx(h,{id:"date",type:"date",defaultValue:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"time",children:"Time"}),e.jsx(h,{id:"time",type:"time",defaultValue:new Date().toTimeString().split(" ")[0].substring(0,5)})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"location",children:"Location"}),e.jsx(h,{id:"location",placeholder:"Where did the incident occur?"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"vehicle",children:"Vehicle Number"}),e.jsxs(v,{children:[e.jsx(N,{children:e.jsx(y,{placeholder:"Select vehicle"})}),e.jsxs(f,{children:[e.jsx(a,{value:"LSR-001",children:"LSR-001"}),e.jsx(a,{value:"LSR-002",children:"LSR-002"}),e.jsx(a,{value:"LSR-003",children:"LSR-003"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"passenger-count",children:"Number of Passengers on Board"}),e.jsx(h,{id:"passenger-count",type:"number",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"description",children:"Incident Description"}),e.jsx(se,{id:"description",placeholder:"Provide a detailed description of what happened...",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"injury",className:"rounded"}),e.jsx(l,{htmlFor:"injury",children:"Injury Reported"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"damage",className:"rounded"}),e.jsx(l,{htmlFor:"damage",children:"Property Damage"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"police",className:"rounded"}),e.jsx(l,{htmlFor:"police",children:"Police Involved"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"emergency",className:"rounded"}),e.jsx(l,{htmlFor:"emergency",children:"Emergency Services Called"})]})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Attach Photos/Documents"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(ne,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"Upload photos or documents"}),e.jsxs(n,{variant:"outline",size:"sm",children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Choose Files"]})]})]}),e.jsx(n,{className:"w-full bg-red-600 hover:bg-red-700",children:"Submit Incident Report"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(i,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(F,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Incidents"}),e.jsx("p",{className:"text-2xl font-bold",children:j.totalIncidents})]})]})})}),e.jsx(i,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{className:"w-8 h-8 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:j.pendingIncidents})]})]})})}),e.jsx(i,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Resolved"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:j.resolvedIncidents})]})]})})}),e.jsx(i,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"This Month"}),e.jsx("p",{className:"text-2xl font-bold",children:j.thisMonthIncidents})]})]})})})]}),e.jsxs(ae,{defaultValue:"my-incidents",className:"space-y-6",children:[e.jsxs(le,{className:"grid w-full grid-cols-3",children:[e.jsx(S,{value:"my-incidents",children:"My Incidents"}),e.jsx(S,{value:"emergency-contacts",children:"Emergency Contacts"}),e.jsx(S,{value:"safety-guidelines",children:"Safety Guidelines"})]}),e.jsx(I,{value:"my-incidents",className:"space-y-4",children:e.jsxs(i,{children:[e.jsxs(_,{children:[e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),"My Incident Reports"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(h,{placeholder:"Search incidents...",value:m,onChange:s=>Z(s.target.value),className:"pl-10"})]}),e.jsxs(v,{children:[e.jsx(N,{className:"w-48",children:e.jsx(y,{placeholder:"Filter by status"})}),e.jsxs(f,{children:[e.jsx(a,{value:"all",children:"All Status"}),e.jsx(a,{value:"resolved",children:"Resolved"}),e.jsx(a,{value:"investigating",children:"Under Investigation"}),e.jsx(a,{value:"open",children:"Open"})]})]})]})]}),e.jsx(c,{children:e.jsx("div",{className:"space-y-4",children:$.map(s=>{var t,g,p,x,P,H,E,k,V,B,O;return e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(W,{className:"w-4 h-4"}),s.incident_date?b(w(s.incident_date),"MM/dd/yyyy HH:mm"):b(w(s.created_at),"MM/dd/yyyy HH:mm")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"w-4 h-4"}),s.location_address]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[M(s.severity),T(s.status)]})]}),e.jsx("p",{className:"text-gray-600 mb-3 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex gap-4 text-sm text-gray-500",children:[e.jsxs("span",{children:["Vehicle: ",((t=s.vehicles)==null?void 0:t.vehicle_number)||"Not specified"]}),e.jsxs("span",{children:["Passengers: ",((g=s.people_involved)==null?void 0:g.length)||0]}),((p=s.additional_data)==null?void 0:p.injury_reported)&&e.jsx("span",{className:"text-red-600 font-medium",children:"Injury Reported"}),((x=s.additional_data)==null?void 0:x.damage_reported)&&e.jsx("span",{className:"text-orange-600 font-medium",children:"Damage Reported"})]}),e.jsxs(A,{children:[e.jsx(U,{asChild:!0,children:e.jsxs(n,{variant:"outline",size:"sm",children:[e.jsx(oe,{className:"w-4 h-4 mr-1"}),"View Details"]})}),e.jsxs(Y,{className:"max-w-2xl",children:[e.jsx(z,{children:e.jsxs(G,{children:["Incident Details - ",s.title]})}),s&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Basic Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Date & Time:"}),e.jsx("span",{children:s.incident_date?b(w(s.incident_date),"MM/dd/yyyy HH:mm"):b(w(s.created_at),"MM/dd/yyyy HH:mm")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Location:"}),e.jsx("span",{children:s.location_address})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Vehicle:"}),e.jsx("span",{children:((P=s.vehicles)==null?void 0:P.vehicle_number)||"Not specified"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Passengers:"}),e.jsx("span",{children:((H=s.people_involved)==null?void 0:H.length)||0})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Status & Severity"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Severity:"}),e.jsx("span",{children:M(s.severity)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{children:T(s.status)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Injury:"}),e.jsx("span",{children:(E=s.additional_data)!=null&&E.injury_reported?"Yes":"No"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Damage:"}),e.jsx("span",{children:(k=s.additional_data)!=null&&k.damage_reported?"Yes":"No"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Description"}),e.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded",children:s.description})]}),((V=s.additional_data)==null?void 0:V.resolution)&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Resolution"}),e.jsx("p",{className:"text-sm text-gray-600 bg-green-50 p-3 rounded",children:s.additional_data.resolution})]}),(((B=s.additional_data)==null?void 0:B.police_reference)||((O=s.additional_data)==null?void 0:O.insurance_claim))&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"References"}),e.jsxs("div",{className:"text-sm space-y-1",children:[s.additional_data.police_reference&&e.jsxs("div",{children:["Police Ref: ",s.additional_data.police_reference]}),s.additional_data.insurance_claim&&e.jsxs("div",{children:["Insurance Claim: ",s.additional_data.insurance_claim]})]})]})]})]})]})]})]},s.id)})})})]})}),e.jsx(I,{value:"emergency-contacts",className:"space-y-4",children:e.jsxs(i,{children:[e.jsx(_,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(o,{className:"w-5 h-5"}),"Emergency Contacts"]})}),e.jsx(c,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Emergency Services"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-red-50 rounded-lg",children:[e.jsx("span",{className:"font-medium",children:"Emergency (Police/Fire/Ambulance)"}),e.jsx("span",{className:"font-bold text-red-600",children:"999"})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("span",{className:"font-medium",children:"NHS 111"}),e.jsx("span",{className:"font-bold text-blue-600",children:"111"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"LSR Logistics"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 rounded-lg",children:[e.jsx("span",{className:"font-medium",children:"Control Room (24/7)"}),e.jsx("span",{className:"font-bold text-green-600",children:"+44 20 1234 5678"})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium",children:"Fleet Manager"}),e.jsx("span",{className:"font-bold",children:"+44 20 1234 5679"})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium",children:"Safety Officer"}),e.jsx("span",{className:"font-bold",children:"+44 20 1234 5680"})]})]})]})]})})]})}),e.jsx(I,{value:"safety-guidelines",className:"space-y-4",children:e.jsxs(i,{children:[e.jsx(_,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(o,{className:"w-5 h-5"}),"Safety Guidelines"]})}),e.jsx(c,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(F,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Safety Documentation"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Access safety procedures, emergency protocols, and incident reporting guidelines."}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(n,{className:"bg-red-600 hover:bg-red-700",children:"Download Safety Manual"}),e.jsx(n,{variant:"outline",children:"Emergency Procedures"})]})]})})]})})]})]})};export{Ce as default};
