var I=(k,g,d)=>new Promise((i,o)=>{var R=n=>{try{x(d.next(n))}catch(m){o(m)}},y=n=>{try{x(d.throw(n))}catch(m){o(m)}},x=n=>n.done?i(n.value):Promise.resolve(n.value).then(R,y);x((d=d.apply(k,g)).next())});import{j as e}from"./ui-vendor-DMUr7mTx.js";import{r as S}from"./react-vendor-BvqlMsL5.js";import{u as q,f as G,B as p,C as b,a as v,b as L,d as M,A as P,g as z,a2 as Q,a3 as X,a4 as ee,H as w,e as se}from"./index-ZwIgorfy.js";import{C as te}from"./calendar-C0tEixyh.js";import{u as ae}from"./useSchedules-P7CgD3AR.js";import{k as re,a as le,d as ne,l as ie,j as ce}from"./useDailyRest-QJ0s7v-K.js";import{N as F}from"./router-vendor-CEyBJ8vK.js";import{Z as de,k as oe,T as xe,bm as me,b as he,aJ as ue,K as W,O as D,j as B,I as je,H as ge}from"./icons-vendor-b0I7fGSL.js";import{s as ye,e as fe,g as Ne,j as pe,f as l,a as be,L as ve,N as we}from"./utils-vendor-B2FlkASS.js";import"./supabase-vendor-B984m0TI.js";import"./query-vendor-B2F_wWlc.js";import"./ui-components-7w1-MJre.js";const Ie=()=>{const{user:k,profile:g,loading:d}=q();G();const[i,o]=S.useState(new Date);S.useState("week");const[R,y]=S.useState(!1),{data:x=[],isLoading:n}=ae(),{data:m=[],isLoading:V}=re(),{data:Y=[]}=le(),{analysis:T}=ne(i),{data:h}=ie(),f=ce(),E=Y||[],A=m||[],O=x||[];if(d||n||V)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading schedule..."})]})});if(!k||!g)return e.jsx(F,{to:"/auth",replace:!0});if(g.role!=="driver")return e.jsx(F,{to:"/dashboard",replace:!0});const N=ye(i,{weekStartsOn:1}),C=fe(i,{weekStartsOn:1}),J=Ne({start:N,end:C}),K=s=>{const a=l(s,"yyyy-MM-dd"),r=E.some(t=>t.entry_date===a),c=A.some(t=>t.rest_date===a),u=O.some(t=>l(new Date(t.start_time),"yyyy-MM-dd")===a);return r?"worked":c?"rest":u?"scheduled":"off"},U=s=>{const a=l(s,"yyyy-MM-dd"),r=O.filter(t=>l(new Date(t.start_time),"yyyy-MM-dd")===a),c=A.find(t=>t.rest_date===a),u=E.find(t=>t.entry_date===a);return{schedules:r,rest:c,timeEntry:u}},Z=()=>I(void 0,null,function*(){try{yield f.mutateAsync({startDate:N,endDate:C})}catch(s){console.error("Error auto-recording rest days:",s)}}),$=s=>{switch(s){case"worked":return{icon:W,color:"text-green-600",bgColor:"bg-green-100",label:"Worked"};case"rest":return{icon:D,color:"text-blue-600",bgColor:"bg-blue-100",label:"Rest"};case"scheduled":return{icon:B,color:"text-orange-600",bgColor:"bg-orange-100",label:"Scheduled"};default:return{icon:ge,color:"text-gray-600",bgColor:"bg-gray-100",label:"Off"}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"My Schedule"}),e.jsx("p",{className:"text-muted-foreground",children:"View your work schedule and rest periods"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(p,{onClick:Z,disabled:f.isPending,variant:"outline",size:"sm",children:[e.jsx(de,{className:`w-4 h-4 mr-2 ${f.isPending?"animate-spin":""}`}),f.isPending?"Recording Rest...":"Record Rest Days"]})})]}),h&&e.jsxs(b,{children:[e.jsx(v,{children:e.jsxs(L,{className:"flex items-center space-x-2",children:[e.jsx(oe,{className:"w-5 h-5"}),e.jsx("span",{children:"Weekly Rest Summary"})]})}),e.jsx(M,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:h.workedDays}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Work Days"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:h.restDays}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Rest Days"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[h.totalWorkHours.toFixed(1),"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Work Hours"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[h.totalRestHours.toFixed(1),"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Rest Hours"})]})]})})]}),T.criticalViolations.length>0&&e.jsxs(P,{className:"border-red-200 bg-red-50",children:[e.jsx(xe,{className:"h-4 w-4 text-red-600"}),e.jsxs(z,{className:"text-red-800",children:[e.jsx("strong",{children:"WTD Compliance Issues:"})," ",T.criticalViolations[0]]})]}),e.jsx(b,{children:e.jsx(v,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(p,{variant:"outline",size:"sm",onClick:()=>o(pe(i,7)),children:e.jsx(me,{className:"w-4 h-4"})}),e.jsxs("div",{className:"text-center",children:[e.jsxs("h2",{className:"text-lg font-semibold",children:[l(N,"MMM dd")," - ",l(C,"MMM dd, yyyy")]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Week of ",l(N,"MMMM yyyy")]})]}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>o(be(i,7)),children:e.jsx(he,{className:"w-4 h-4"})})]}),e.jsxs(Q,{open:R,onOpenChange:y,children:[e.jsx(X,{asChild:!0,children:e.jsxs(p,{variant:"outline",size:"sm",children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Select Week"]})}),e.jsx(ee,{className:"w-auto p-0",align:"end",children:e.jsx(te,{mode:"single",selected:i,onSelect:s=>{s&&(o(s),y(!1))},initialFocus:!0})})]})]})})}),e.jsx("div",{className:"grid gap-4 md:grid-cols-7",children:J.map(s=>{var _;const a=K(s),r=U(s),c=$(a),u=c.icon,t=ve(s),H=we(s);return e.jsxs(b,{className:w("min-h-[200px]",t&&"ring-2 ring-blue-500",H&&"ring-1 ring-gray-300"),children:[e.jsxs(v,{className:"pb-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:l(s,"EEE")}),e.jsx("p",{className:w("text-lg font-bold",t&&"text-blue-600",H&&"text-gray-600"),children:l(s,"dd")})]}),e.jsx("div",{className:w("p-2 rounded-full",c.bgColor),children:e.jsx(u,{className:w("w-4 h-4",c.color)})})]}),e.jsx(se,{variant:"outline",className:"text-xs",children:c.label})]}),e.jsx(M,{className:"pt-0",children:e.jsxs("div",{className:"space-y-2",children:[r.timeEntry&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(W,{className:"w-3 h-3 text-green-600"}),e.jsxs("span",{className:"text-green-700",children:["Worked: ",((_=r.timeEntry.total_hours)==null?void 0:_.toFixed(1))||"0.0","h"]})]}),r.rest&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(D,{className:"w-3 h-3 text-blue-600"}),e.jsxs("span",{className:"text-blue-700",children:["Rest: ",r.rest.duration_hours,"h"]})]}),r.schedules.map(j=>e.jsxs("div",{className:"text-xs p-2 bg-orange-50 rounded border-l-2 border-orange-300",children:[e.jsxs("div",{className:"font-medium text-orange-800",children:[l(new Date(j.start_time),"HH:mm")," - ",j.job_type]}),j.notes&&e.jsx("div",{className:"text-orange-600 mt-1",children:j.notes})]},j.id)),a==="off"&&!r.schedules.length&&e.jsx("div",{className:"text-xs text-gray-500 italic",children:"No scheduled activities"})]})})]},s.toISOString())})}),e.jsxs(b,{children:[e.jsx(v,{children:e.jsxs(L,{className:"flex items-center space-x-2",children:[e.jsx(D,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{children:"Daily Rest Tracking"})]})}),e.jsx(M,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-full",children:e.jsx(W,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Work Days"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Days when you clocked in and worked"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:e.jsx(D,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Rest Days"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Days automatically recorded as rest when no work activity"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-full",children:e.jsx(B,{className:"w-4 h-4 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Scheduled"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Days with scheduled activities but no work recorded"})]})]})]}),e.jsxs(P,{className:"border-blue-200 bg-blue-50",children:[e.jsx(je,{className:"h-4 w-4 text-blue-600"}),e.jsxs(z,{className:"text-blue-800",children:[e.jsx("strong",{children:"Automatic Rest Recording:"}),' Days without work activity are automatically recorded as rest days for WTD compliance. Use the "Record Rest Days" button to manually process rest days for the current week.']})]})]})})]})]})};export{Ie as default};
