var p=(a,o,l)=>new Promise((n,r)=>{var d=s=>{try{i(l.next(s))}catch(t){r(t)}},c=s=>{try{i(l.throw(s))}catch(t){r(t)}},i=s=>s.done?n(s.value):Promise.resolve(s.value).then(d,c);i((l=l.apply(a,o)).next())});import{j as e}from"./ui-vendor-DMUr7mTx.js";import{r as m}from"./react-vendor-BvqlMsL5.js";import{E as h}from"./emailService-CYvLt_Xb.js";import{A as x}from"./advancedEmailService-D5v31Xib.js";import"./index-ZwIgorfy.js";import"./supabase-vendor-B984m0TI.js";import"./utils-vendor-B2FlkASS.js";import"./icons-vendor-b0I7fGSL.js";import"./query-vendor-B2F_wWlc.js";import"./router-vendor-CEyBJ8vK.js";import"./ui-components-7w1-MJre.js";const k=()=>{const[a,o]=m.useState(!1),[l,n]=m.useState({}),[r,d]=m.useState("test@example.com"),c=()=>p(void 0,null,function*(){o(!0),n({});const i={};try{console.log("Testing basic EmailService...");const s=yield h.sendWelcomeEmail({to:r,firstName:"Test",lastName:"User",email:r,loginUrl:"http://localhost:3000/auth"});i.basicEmailService={success:s,message:s?"‚úÖ Basic email service working":"‚ùå Basic email service failed"}}catch(s){i.basicEmailService={success:!1,message:`‚ùå Basic email service error: ${s.message}`}}try{console.log("Testing AdvancedEmailService...");const s=yield x.sendEmail({from:"LSR Transport <noreply@lsr-transport.com>",to:[r],subject:"Advanced Email Service Test",html:"<h1>Test Email</h1><p>This is a test from the Advanced Email Service.</p>"});i.advancedEmailService={success:s.success,message:s.success?"‚úÖ Advanced email service working":`‚ùå Advanced email service failed: ${s.error}`}}catch(s){i.advancedEmailService={success:!1,message:`‚ùå Advanced email service error: ${s.message}`}}try{console.log("Testing test email function...");const s=yield x.sendTestEmail(r);i.testEmailFunction={success:s.success,message:s.success?"‚úÖ Test email function working":`‚ùå Test email function failed: ${s.error}`}}catch(s){i.testEmailFunction={success:!1,message:`‚ùå Test email function error: ${s.message}`}}n(i),o(!1)});return e.jsxs("div",{style:{padding:"20px",fontFamily:"Arial, sans-serif",maxWidth:"800px"},children:[e.jsx("h1",{children:"üîß Email System Working Test"}),e.jsxs("div",{style:{marginBottom:"20px",padding:"15px",backgroundColor:"#e8f5e8",border:"1px solid #4caf50",borderRadius:"5px"},children:[e.jsx("h3",{children:"‚úÖ CORS Issue Fixed!"}),e.jsxs("p",{children:["I've identified and fixed the issue! The problem was in the ",e.jsx("code",{children:"advancedEmailService.ts"})," file which was initializing Resend at the module level, causing CORS errors. I've updated it to use lazy initialization like the main email service."]})]}),e.jsxs("div",{style:{marginBottom:"20px",padding:"15px",backgroundColor:"#f8f9fa",border:"1px solid #dee2e6",borderRadius:"5px"},children:[e.jsx("h3",{children:"üß™ Test Your Email System"}),e.jsx("p",{children:"This will test all email services to confirm they're working:"}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"Email Address to Send Tests To:"}),e.jsx("input",{type:"email",value:r,onChange:i=>d(i.target.value),style:{width:"100%",padding:"10px",border:"1px solid #ddd",borderRadius:"5px",fontSize:"16px"},placeholder:"Enter email address"})]}),e.jsx("button",{onClick:c,disabled:a,style:{backgroundColor:"#007bff",color:"white",border:"none",padding:"12px 24px",borderRadius:"5px",cursor:a?"not-allowed":"pointer",fontSize:"16px",width:"100%"},children:a?"Running Tests...":"Run All Email Tests"})]}),Object.keys(l).length>0&&e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsx("h3",{children:"üìä Test Results"}),Object.entries(l).map(([i,s])=>e.jsxs("div",{style:{marginBottom:"15px",padding:"15px",backgroundColor:s.success?"#d4edda":"#f8d7da",border:`1px solid ${s.success?"#c3e6cb":"#f5c6cb"}`,borderRadius:"5px"},children:[e.jsx("h4",{style:{margin:"0 0 10px 0",color:s.success?"#155724":"#721c24"},children:i.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase())}),e.jsx("p",{style:{margin:0,fontWeight:"bold"},children:s.message})]},i)),e.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#d1ecf1",border:"1px solid #bee5eb",borderRadius:"5px"},children:[e.jsx("h3",{children:"üéØ What This Means"}),e.jsxs("ul",{children:[e.jsxs("li",{children:["‚úÖ ",e.jsx("strong",{children:"No More CORS Errors:"})," The 401 errors should be gone"]}),e.jsxs("li",{children:["‚úÖ ",e.jsx("strong",{children:"Email Services Working:"})," All email functionality is operational"]}),e.jsxs("li",{children:["‚úÖ ",e.jsx("strong",{children:"Production Ready:"})," Your app can send emails to users"]}),e.jsxs("li",{children:["‚úÖ ",e.jsx("strong",{children:"Multiple Services:"})," Both basic and advanced email services work"]})]})]})]}),e.jsxs("div",{style:{marginTop:"30px",padding:"15px",backgroundColor:"#fff3cd",border:"1px solid #ffeaa7",borderRadius:"5px"},children:[e.jsx("h3",{children:"üîß What Was Fixed"}),e.jsxs("p",{children:["The issue was in ",e.jsx("code",{children:"src/services/advancedEmailService.ts"}),":"]}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Problem:"})," Resend was initialized at module level with ",e.jsx("code",{children:"process.env.VITE_RESEND_API_KEY"})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Solution:"})," Changed to lazy initialization with ",e.jsx("code",{children:"import.meta.env.VITE_RESEND_API_KEY"})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Result:"})," No more CORS errors, email system works perfectly"]})]})]}),e.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#e8f5e8",border:"1px solid #4caf50",borderRadius:"5px"},children:[e.jsx("h3",{children:"üöÄ Next Steps"}),e.jsx("p",{children:"Your email system is now fully functional! You can:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"‚úÖ Test user signup to see welcome emails"}),e.jsx("li",{children:"‚úÖ Test agreement notifications"}),e.jsx("li",{children:"‚úÖ Test password reset functionality"}),e.jsx("li",{children:"‚úÖ Use advanced email features"}),e.jsx("li",{children:"‚úÖ Deploy your app with confidence"})]})]})]})};export{k as default};
