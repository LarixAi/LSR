var te=Object.defineProperty,ne=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var U=(n,t,a)=>t in n?te(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a,l=(n,t)=>{for(var a in t||(t={}))L.call(t,a)&&U(n,a,t[a]);if(N)for(var a of N(t))Q.call(t,a)&&U(n,a,t[a]);return n},d=(n,t)=>ne(n,re(t));var K=(n,t)=>{var a={};for(var r in n)L.call(n,r)&&t.indexOf(r)<0&&(a[r]=n[r]);if(n!=null&&N)for(var r of N(n))t.indexOf(r)<0&&Q.call(n,r)&&(a[r]=n[r]);return a};var g=(n,t,a)=>new Promise((r,m)=>{var v=h=>{try{u(a.next(h))}catch(f){m(f)}},p=h=>{try{u(a.throw(h))}catch(f){m(f)}},u=h=>h.done?r(h.value):Promise.resolve(h.value).then(v,p);u((a=a.apply(n,t)).next())});import{j as e}from"./ui-vendor-DMUr7mTx.js";import{r as C}from"./react-vendor-BvqlMsL5.js";import{u as ie,s as _,l as E,ak as ce,C as P,a as le,b as oe,B as y,d as R,e as $,D as B,m as z,n as G,o as H,p as I,L as x,I as j,T as V}from"./index-ZwIgorfy.js";import{u as de,a as k,b as q}from"./query-vendor-B2F_wWlc.js";import{$ as A,E as J,V as D,aq as me,ak as he,aF as xe,h as pe,M as ue}from"./icons-vendor-b0I7fGSL.js";const ge=n=>{const{user:t}=ie();return de({queryKey:["emergency-contacts",t==null?void 0:t.id,n],queryFn:()=>g(void 0,null,function*(){if(!(t!=null&&t.id))return[];console.log("Fetching emergency contacts for child:",n);try{let a=_.from("emergency_contacts").select(`
            *,
            child_profiles:child_profiles(
              id,
              first_name,
              last_name
            )
          `).eq("is_active",!0).order("is_primary",{ascending:!1}).order("contact_name");n?a=a.eq("child_id",n):a=a.in("child_id",_.from("child_profiles").select("id").eq("parent_id",t.id).eq("is_active",!0));const{data:r,error:m}=yield a;if(m)throw console.error("Error fetching emergency contacts:",m),m;return console.log("Fetched emergency contacts:",r),r||[]}catch(a){return console.error("Error in useEmergencyContacts:",a),[]}}),enabled:!!(t!=null&&t.id)})},ye=()=>{const{toast:n}=E(),t=k();return q({mutationFn:a=>g(void 0,null,function*(){const{data:r,error:m}=yield _.from("emergency_contacts").insert(a).select().single();if(m)throw m;return r}),onSuccess:a=>{t.invalidateQueries({queryKey:["emergency-contacts"]}),n({title:"Emergency Contact Added",description:"The emergency contact has been added successfully."})},onError:a=>{console.error("Error creating emergency contact:",a),n({title:"Error",description:"Failed to add emergency contact. Please try again.",variant:"destructive"})}})},je=()=>{const{toast:n}=E(),t=k();return q({mutationFn:m=>g(void 0,null,function*(){var v=m,{id:a}=v,r=K(v,["id"]);const{data:p,error:u}=yield _.from("emergency_contacts").update(r).eq("id",a).select().single();if(u)throw u;return p}),onSuccess:a=>{t.invalidateQueries({queryKey:["emergency-contacts"]}),n({title:"Emergency Contact Updated",description:"The emergency contact has been updated successfully."})},onError:a=>{console.error("Error updating emergency contact:",a),n({title:"Error",description:"Failed to update emergency contact. Please try again.",variant:"destructive"})}})},ve=()=>{const{toast:n}=E(),t=k();return q({mutationFn:a=>g(void 0,null,function*(){const{error:r}=yield _.from("emergency_contacts").delete().eq("id",a);if(r)throw r;return a}),onSuccess:a=>{t.invalidateQueries({queryKey:["emergency-contacts"]}),n({title:"Emergency Contact Removed",description:"The emergency contact has been removed successfully."})},onError:a=>{console.error("Error deleting emergency contact:",a),n({title:"Error",description:"Failed to remove emergency contact. Please try again.",variant:"destructive"})}})},we=({className:n})=>{const{toast:t}=E(),{children:a}=ce(),[r,m]=C.useState(null),[v,p]=C.useState(!1),[u,h]=C.useState(!1),[f,S]=C.useState(null),[c,o]=C.useState({contact_name:"",relationship:"",phone:"",email:"",address:"",is_primary:!1}),{data:O=[],isLoading:W}=ge(r),F=ye(),w=je(),X=ve(),Y=()=>g(void 0,null,function*(){if(!r){t({title:"Error",description:"Please select a child first.",variant:"destructive"});return}try{yield F.mutateAsync(l({child_id:r},c)),p(!1),b()}catch(s){console.error("Failed to add emergency contact:",s)}}),Z=()=>g(void 0,null,function*(){if(f)try{yield w.mutateAsync(l({id:f.id},c)),h(!1),S(null),b()}catch(s){console.error("Failed to update emergency contact:",s)}}),ee=s=>g(void 0,null,function*(){if(confirm("Are you sure you want to delete this emergency contact?"))try{yield X.mutateAsync(s)}catch(i){console.error("Failed to delete emergency contact:",i)}}),b=()=>{o({contact_name:"",relationship:"",phone:"",email:"",address:"",is_primary:!1})},se=s=>{S(s),o({contact_name:s.contact_name,relationship:s.relationship,phone:s.phone,email:s.email||"",address:s.address||"",is_primary:s.is_primary}),h(!0)},M=()=>{b(),p(!0)},T=s=>{const i=a.find(ae=>ae.id===s);return i?`${i.first_name} ${i.last_name}`:"Unknown Child"};return e.jsxs("div",{className:`space-y-6 ${n}`,children:[e.jsx(P,{children:e.jsx(le,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(oe,{className:"flex items-center space-x-2",children:[e.jsx(A,{className:"w-5 h-5"}),e.jsx("span",{children:"Emergency Contacts"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("select",{value:r||"",onChange:s=>m(s.target.value?Number(s.target.value):null),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Children"}),a.map(s=>e.jsxs("option",{value:s.id,children:[s.first_name," ",s.last_name]},s.id))]}),e.jsxs(y,{onClick:M,disabled:!r,children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Add Contact"]})]})]})})}),e.jsx(P,{children:e.jsx(R,{className:"p-6",children:W?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(D,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-2",children:"Loading emergency contacts..."})]}):O.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Emergency Contacts"}),e.jsx("p",{className:"text-gray-600 mb-4",children:r?"No emergency contacts found for this child.":"No emergency contacts found. Select a child to add contacts."}),r&&e.jsxs(y,{onClick:M,children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Add First Contact"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:O.map(s=>e.jsx(P,{className:"relative",children:e.jsxs(R,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.contact_name}),s.is_primary&&e.jsx(me,{className:"w-4 h-4 text-yellow-500 fill-current"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>se(s),children:e.jsx(he,{className:"w-4 h-4"})}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>ee(s.id),className:"text-red-600 hover:text-red-700",children:e.jsx(xe,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{variant:"outline",className:"text-xs",children:s.relationship}),!r&&e.jsx($,{variant:"secondary",className:"text-xs",children:T(s.child_id)})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:s.phone})]}),s.email&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:s.email})]}),s.address&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ue,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-xs",children:s.address})]})]})]})]})},s.id))})})}),e.jsx(B,{open:v,onOpenChange:p,children:e.jsxs(z,{children:[e.jsxs(G,{children:[e.jsx(H,{children:"Add Emergency Contact"}),e.jsxs(I,{children:["Add a new emergency contact for ",r?T(r):"your child","."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"contact_name",children:"Contact Name"}),e.jsx(j,{id:"contact_name",value:c.contact_name,onChange:s=>o(i=>d(l({},i),{contact_name:s.target.value})),placeholder:"Full name"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"relationship",children:"Relationship"}),e.jsx(j,{id:"relationship",value:c.relationship,onChange:s=>o(i=>d(l({},i),{relationship:s.target.value})),placeholder:"e.g., Mother, Father, Grandparent"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"phone",children:"Phone Number"}),e.jsx(j,{id:"phone",value:c.phone,onChange:s=>o(i=>d(l({},i),{phone:s.target.value})),placeholder:"Phone number"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"email",children:"Email (Optional)"}),e.jsx(j,{id:"email",type:"email",value:c.email,onChange:s=>o(i=>d(l({},i),{email:s.target.value})),placeholder:"Email address"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"address",children:"Address (Optional)"}),e.jsx(V,{id:"address",value:c.address,onChange:s=>o(i=>d(l({},i),{address:s.target.value})),placeholder:"Full address",rows:2})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"is_primary",checked:c.is_primary,onChange:s=>o(i=>d(l({},i),{is_primary:s.target.checked})),className:"rounded"}),e.jsx(x,{htmlFor:"is_primary",children:"Primary contact"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(y,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsxs(y,{onClick:Y,disabled:!c.contact_name||!c.relationship||!c.phone||F.isPending,children:[F.isPending&&e.jsx(D,{className:"w-4 h-4 mr-2 animate-spin"}),"Add Contact"]})]})]})]})}),e.jsx(B,{open:u,onOpenChange:h,children:e.jsxs(z,{children:[e.jsxs(G,{children:[e.jsx(H,{children:"Edit Emergency Contact"}),e.jsx(I,{children:"Update the emergency contact information."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"edit_contact_name",children:"Contact Name"}),e.jsx(j,{id:"edit_contact_name",value:c.contact_name,onChange:s=>o(i=>d(l({},i),{contact_name:s.target.value})),placeholder:"Full name"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"edit_relationship",children:"Relationship"}),e.jsx(j,{id:"edit_relationship",value:c.relationship,onChange:s=>o(i=>d(l({},i),{relationship:s.target.value})),placeholder:"e.g., Mother, Father, Grandparent"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"edit_phone",children:"Phone Number"}),e.jsx(j,{id:"edit_phone",value:c.phone,onChange:s=>o(i=>d(l({},i),{phone:s.target.value})),placeholder:"Phone number"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"edit_email",children:"Email (Optional)"}),e.jsx(j,{id:"edit_email",type:"email",value:c.email,onChange:s=>o(i=>d(l({},i),{email:s.target.value})),placeholder:"Email address"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"edit_address",children:"Address (Optional)"}),e.jsx(V,{id:"edit_address",value:c.address,onChange:s=>o(i=>d(l({},i),{address:s.target.value})),placeholder:"Full address",rows:2})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"edit_is_primary",checked:c.is_primary,onChange:s=>o(i=>d(l({},i),{is_primary:s.target.checked})),className:"rounded"}),e.jsx(x,{htmlFor:"edit_is_primary",children:"Primary contact"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(y,{variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsxs(y,{onClick:Z,disabled:!c.contact_name||!c.relationship||!c.phone||w.isPending,children:[w.isPending&&e.jsx(D,{className:"w-4 h-4 mr-2 animate-spin"}),"Update Contact"]})]})]})]})})]})};export{we as E};
