var ve=Object.defineProperty,fe=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable;var Y=(n,t,a)=>t in n?ve(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a,x=(n,t)=>{for(var a in t||(t={}))ye.call(t,a)&&Y(n,a,t[a]);if(X)for(var a of X(t))Ne.call(t,a)&&Y(n,a,t[a]);return n},h=(n,t)=>fe(n,ge(t));var V=(n,t,a)=>new Promise((D,T)=>{var N=o=>{try{g(a.next(o))}catch(F){T(F)}},L=o=>{try{g(a.throw(o))}catch(F){T(F)}},g=o=>o.done?D(o.value):Promise.resolve(o.value).then(N,L);g((a=a.apply(n,t)).next())});import{j as e}from"./ui-vendor-DMUr7mTx.js";import{r as y}from"./react-vendor-BvqlMsL5.js";import{u as be,l as _e,B as m,C as u,d as j,h as we,i as Fe,j as H,k as O,a as P,b as S,I as w,S as B,q as R,r as I,t as U,v as p,D as $,m as ee,n as se,o as te,p as Ce,L as i,T as Te,e as Pe}from"./index-ZwIgorfy.js";import{T as Se,a as De,b as le,c as v,d as Le,e as f}from"./table-6WL4qh3Z.js";import{u as Ae,a as qe,b as ke,c as Me,d as Ee}from"./useFuelPurchases-C7mcgkEN.js";import{u as Ve}from"./useVehicles-uD3YILF5.js";import{N as ae}from"./router-vendor-CEyBJ8vK.js";import{Z as He,E as ie,D as Oe,l as z,m as Be,t as Re,a2 as Ie,aa as Ue,ak as ze,aF as Qe}from"./icons-vendor-b0I7fGSL.js";import{f as C}from"./utils-vendor-B2FlkASS.js";import"./supabase-vendor-B984m0TI.js";import"./query-vendor-B2F_wWlc.js";import"./ui-components-7w1-MJre.js";const ns=()=>{const{user:n,profile:t,loading:a}=be();_e();const[D,T]=y.useState("overview"),[N,L]=y.useState(""),[g,o]=y.useState("all"),[F,b]=y.useState(!1),[A,Q]=y.useState(null),[c,Z]=y.useState(null),{data:G=[],isLoading:ne,error:Ze,refetch:ce}=Ae(),{data:re=[]}=Ve(),q=qe(),k=ke(),de=Me(),{statistics:_}=Ee(),oe=G,[l,d]=y.useState({vehicle_id:"",fuel_type:"diesel",quantity:0,unit_price:0,total_cost:0,location:"",odometer_reading:0,purchase_date:new Date().toISOString().split("T")[0],notes:""});if(a)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading..."})]})});if(!n||!t)return e.jsx(ae,{to:"/auth",replace:!0});if(!["admin","council","driver"].includes(t.role))return e.jsx(ae,{to:"/",replace:!0});const xe=["admin","council"].includes(t.role)?oe:G,he=ne,M=xe.filter(s=>{var J,K,W;const r=((J=s.vehicle_number)==null?void 0:J.toLowerCase().includes(N.toLowerCase()))||((K=s.location)==null?void 0:K.toLowerCase().includes(N.toLowerCase()))||((W=s.driver_name)==null?void 0:W.toLowerCase().includes(N.toLowerCase())),pe=g==="all"||s.fuel_type===g;return r&&pe}),E=s=>{const r={diesel:"bg-blue-100 text-blue-800",petrol:"bg-green-100 text-green-800",electric:"bg-purple-100 text-purple-800"};return e.jsx(Pe,{className:r[s]||"bg-gray-100 text-gray-800",children:s.charAt(0).toUpperCase()+s.slice(1)})},me=s=>V(void 0,null,function*(){s.preventDefault();try{A?(yield k.mutateAsync({id:A.id,updates:l}),Q(null)):yield q.mutateAsync(l),b(!1),d({vehicle_id:"",fuel_type:"diesel",quantity:0,unit_price:0,total_cost:0,location:"",odometer_reading:0,purchase_date:new Date().toISOString().split("T")[0],notes:""})}catch(r){console.error("Error saving fuel purchase:",r)}}),ue=s=>{Q(s),d({vehicle_id:s.vehicle_id,fuel_type:s.fuel_type,quantity:s.quantity,unit_price:s.unit_price,total_cost:s.total_cost,location:s.location||"",odometer_reading:s.odometer_reading||0,purchase_date:s.purchase_date,notes:s.notes||""}),b(!0)},je=s=>V(void 0,null,function*(){confirm("Are you sure you want to delete this fuel purchase?")&&(yield de.mutateAsync(s))});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Fuel Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Track and manage fuel consumption, costs, and efficiency"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{onClick:()=>ce(),variant:"outline",size:"sm",children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),"Refresh"]}),e.jsxs(m,{onClick:()=>b(!0),children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Add Purchase"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(u,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Spent"}),e.jsxs("p",{className:"text-2xl font-bold",children:["£",_.totalSpent.toFixed(2)]})]}),e.jsx(Oe,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(u,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Fuel"}),e.jsxs("p",{className:"text-2xl font-bold",children:[_.totalQuantity.toFixed(1),"L"]})]}),e.jsx(z,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(u,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Avg Price/L"}),e.jsxs("p",{className:"text-2xl font-bold",children:["£",_.averagePrice.toFixed(2)]})]}),e.jsx(Be,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(u,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Purchases"}),e.jsx("p",{className:"text-2xl font-bold",children:_.purchaseCount})]}),e.jsx(Re,{className:"h-8 w-8 text-muted-foreground"})]})})})]}),e.jsxs(we,{value:D,onValueChange:T,className:"space-y-4",children:[e.jsxs(Fe,{children:[e.jsx(H,{value:"overview",children:"Overview"}),e.jsx(H,{value:"purchases",children:"Purchase History"}),e.jsx(H,{value:"analytics",children:"Analytics"})]}),e.jsx(O,{value:"overview",className:"space-y-4",children:e.jsxs(u,{children:[e.jsx(P,{children:e.jsx(S,{children:"Recent Fuel Purchases"})}),e.jsx(j,{children:he?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{children:"Loading fuel purchases..."})]}):M.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(z,{className:"h-16 w-16 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No fuel purchases found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Start tracking your fuel consumption by adding your first purchase."}),e.jsxs(m,{onClick:()=>b(!0),children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Add First Purchase"]})]}):e.jsx("div",{className:"space-y-4",children:M.slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(z,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.vehicle_number}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[C(new Date(s.purchase_date),"MMM dd, yyyy")," • ",s.location]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium",children:["£",s.total_cost.toFixed(2)]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.quantity,"L ",s.fuel_type]})]})]},s.id))})})]})}),e.jsx(O,{value:"purchases",className:"space-y-4",children:e.jsxs(u,{children:[e.jsx(P,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(S,{children:"Purchase History"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(w,{placeholder:"Search purchases...",value:N,onChange:s=>L(s.target.value),className:"pl-10 w-64"})]}),e.jsxs(B,{value:g,onValueChange:o,children:[e.jsx(R,{className:"w-32",children:e.jsx(I,{})}),e.jsxs(U,{children:[e.jsx(p,{value:"all",children:"All Types"}),e.jsx(p,{value:"diesel",children:"Diesel"}),e.jsx(p,{value:"petrol",children:"Petrol"}),e.jsx(p,{value:"electric",children:"Electric"})]})]})]})]})}),e.jsx(j,{children:e.jsxs(Se,{children:[e.jsx(De,{children:e.jsxs(le,{children:[e.jsx(v,{children:"Vehicle"}),["admin","council"].includes(t.role)&&e.jsx(v,{children:"Driver"}),e.jsx(v,{children:"Date"}),e.jsx(v,{children:"Fuel Type"}),e.jsx(v,{children:"Quantity"}),e.jsx(v,{children:"Total Cost"}),e.jsx(v,{children:"Location"}),e.jsx(v,{className:"text-right",children:"Actions"})]})}),e.jsx(Le,{children:M.map(s=>e.jsxs(le,{children:[e.jsx(f,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.vehicle_number}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.license_plate})]})}),["admin","council"].includes(t.role)&&e.jsx(f,{children:s.driver_name}),e.jsx(f,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:C(new Date(s.purchase_date),"MMM dd, yyyy")}),e.jsx("div",{className:"text-sm text-muted-foreground",children:C(new Date(s.created_at),"HH:mm")})]})}),e.jsx(f,{children:E(s.fuel_type)}),e.jsx(f,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.quantity,"L"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["£",s.unit_price,"/L"]})]})}),e.jsxs(f,{children:["£",s.total_cost.toFixed(2)]}),e.jsx(f,{children:s.location}),e.jsx(f,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>Z(s),children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>ue(s),children:e.jsx(ze,{className:"w-4 h-4"})}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>je(s.id),children:e.jsx(Qe,{className:"w-4 h-4"})})]})})]},s.id))})]})})]})}),e.jsx(O,{value:"analytics",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(u,{children:[e.jsx(P,{children:e.jsx(S,{children:"Fuel Type Breakdown"})}),e.jsx(j,{children:Object.entries(_.byFuelType).map(([s,r])=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[E(s),e.jsx("span",{className:"font-medium",children:s.charAt(0).toUpperCase()+s.slice(1)})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:[r.quantity.toFixed(1),"L"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["£",r.cost.toFixed(2)]})]})]},s))})]}),e.jsxs(u,{children:[e.jsx(P,{children:e.jsx(S,{children:"Monthly Trends"})}),e.jsx(j,{children:Object.entries(_.monthlyData).slice(0,6).map(([s,r])=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"font-medium",children:C(new Date(s+"-01"),"MMM yyyy")}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:[r.quantity.toFixed(1),"L"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["£",r.cost.toFixed(2)]})]})]},s))})]})]})})]}),e.jsx($,{open:F,onOpenChange:b,children:e.jsxs(ee,{className:"max-w-md",children:[e.jsxs(se,{children:[e.jsx(te,{children:A?"Edit Fuel Purchase":"Add Fuel Purchase"}),e.jsx(Ce,{children:"Record a new fuel purchase for your vehicle."})]}),e.jsxs("form",{onSubmit:me,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"vehicle",children:"Vehicle"}),e.jsxs(B,{value:l.vehicle_id,onValueChange:s=>d(h(x({},l),{vehicle_id:s})),children:[e.jsx(R,{children:e.jsx(I,{placeholder:"Select vehicle"})}),e.jsx(U,{children:re.map(s=>e.jsxs(p,{value:s.id,children:[s.vehicle_number," - ",s.license_plate]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"fuel_type",children:"Fuel Type"}),e.jsxs(B,{value:l.fuel_type,onValueChange:s=>d(h(x({},l),{fuel_type:s})),children:[e.jsx(R,{children:e.jsx(I,{})}),e.jsxs(U,{children:[e.jsx(p,{value:"diesel",children:"Diesel"}),e.jsx(p,{value:"petrol",children:"Petrol"}),e.jsx(p,{value:"electric",children:"Electric"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"quantity",children:"Quantity (L)"}),e.jsx(w,{id:"quantity",type:"number",step:"0.01",value:l.quantity,onChange:s=>d(h(x({},l),{quantity:parseFloat(s.target.value)||0})),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"unit_price",children:"Price per L"}),e.jsx(w,{id:"unit_price",type:"number",step:"0.01",value:l.unit_price,onChange:s=>d(h(x({},l),{unit_price:parseFloat(s.target.value)||0})),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"total_cost",children:"Total Cost"}),e.jsx(w,{id:"total_cost",type:"number",step:"0.01",value:l.total_cost,onChange:s=>d(h(x({},l),{total_cost:parseFloat(s.target.value)||0})),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"location",children:"Location"}),e.jsx(w,{id:"location",value:l.location,onChange:s=>d(h(x({},l),{location:s.target.value})),placeholder:"Fuel station name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"purchase_date",children:"Purchase Date"}),e.jsx(w,{id:"purchase_date",type:"date",value:l.purchase_date,onChange:s=>d(h(x({},l),{purchase_date:s.target.value})),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"notes",children:"Notes"}),e.jsx(Te,{id:"notes",value:l.notes,onChange:s=>d(h(x({},l),{notes:s.target.value})),placeholder:"Any additional notes..."})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(m,{type:"submit",disabled:q.isPending||k.isPending,children:q.isPending||k.isPending?"Saving...":"Save Purchase"})]})]})]})}),e.jsx($,{open:!!c,onOpenChange:()=>Z(null),children:e.jsxs(ee,{children:[e.jsx(se,{children:e.jsx(te,{children:"Fuel Purchase Details"})}),c&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Vehicle"}),e.jsxs("p",{children:[c.vehicle_number," - ",c.license_plate]})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Fuel Type"}),e.jsx("p",{children:E(c.fuel_type)})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Quantity"}),e.jsxs("p",{children:[c.quantity,"L"]})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Unit Price"}),e.jsxs("p",{children:["£",c.unit_price,"/L"]})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Total Cost"}),e.jsxs("p",{children:["£",c.total_cost.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Purchase Date"}),e.jsx("p",{children:C(new Date(c.purchase_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Location"}),e.jsx("p",{children:c.location||"N/A"})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Odometer"}),e.jsx("p",{children:c.odometer_reading||"N/A"})]})]}),c.notes&&e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Notes"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c.notes})]})]})]})})]})};export{ns as default};
