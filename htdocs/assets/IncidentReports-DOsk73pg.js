var ts=Object.defineProperty,as=Object.defineProperties;var rs=Object.getOwnPropertyDescriptors;var ie=Object.getOwnPropertySymbols;var ke=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable;var Ce=(t,a,r)=>a in t?ts(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,y=(t,a)=>{for(var r in a||(a={}))ke.call(a,r)&&Ce(t,r,a[r]);if(ie)for(var r of ie(a))_e.call(a,r)&&Ce(t,r,a[r]);return t},R=(t,a)=>as(t,rs(a));var De=(t,a)=>{var r={};for(var s in t)ke.call(t,s)&&a.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&ie)for(var s of ie(t))a.indexOf(s)<0&&_e.call(t,s)&&(r[s]=t[s]);return r};var te=(t,a,r)=>new Promise((s,i)=>{var n=h=>{try{d(r.next(h))}catch(b){i(b)}},o=h=>{try{d(r.throw(h))}catch(b){i(b)}},d=h=>h.done?s(h.value):Promise.resolve(h.value).then(n,o);d((r=r.apply(t,a)).next())});import{j as e}from"./ui-vendor-DMUr7mTx.js";import{g as ns,r as S,c as ls}from"./react-vendor-BvqlMsL5.js";import{D as ve,m as Ne,n as ye,o as be,B as k,I,S as O,q as U,r as V,t as G,v as x,T as J,L as M,C as L,a as z,b as q,d as A,s as is,G as cs,x as ne,l as Fe,c as os,M as he,h as ds,i as hs,j as xe,k as me,e as W,u as xs,f as ms,A as us,g as js,p as ps}from"./index-ZwIgorfy.js";import{v as gs,aj as fs,a_ as vs,aA as Ns,a$ as ys,W as bs,M as Z,f as ws,X as je,E as ee,aa as Me,af as Ss,a1 as Te,g as X,j as Q,T as ae,a2 as Is,a5 as Cs,F as re,Y as ks,$ as ce,k as _s,av as Ds,ao as Oe,J as Ue,Z as Ts,U as Ee,_ as Le,ak as Es,h as Ls,aI as As}from"./icons-vendor-b0I7fGSL.js";import{F as p,a as g,b as f,c as v,d as N,e as Ps,f as Rs}from"./zod-G3EUSSZ0.js";import{o as Fs,s as _,e as Ae,a as Ms,b as ue,u as Os}from"./form-vendor-C09QGZOn.js";import{u as Ve,a as Us,b as Vs}from"./useIncidents-BcFhYSaB.js";import{f as pe,p as Pe}from"./utils-vendor-B2FlkASS.js";import{N as Re}from"./router-vendor-CEyBJ8vK.js";import"./supabase-vendor-B984m0TI.js";import"./query-vendor-B2F_wWlc.js";import"./ui-components-7w1-MJre.js";var F=(t=>(t.transportation="transportation",t.school="school",t.wedding="wedding",t.airport="airport",t.privateJob="privateJob",t))(F||{});function Ge(t){switch(t){case F.transportation:return"Transportation";case F.school:return"School";case F.wedding:return"Wedding";case F.airport:return"Airport Run";case F.privateJob:return"Private Job";default:return"Unknown"}}function Gs(t){switch(t){case F.transportation:return"directions_bus";case F.school:return"school";case F.wedding:return"favorite";case F.airport:return"flight_takeoff";case F.privateJob:return"build";default:return"help"}}const Bs=({open:t,onOpenChange:a,onSelect:r})=>{const s=Object.values(F),i=n=>{const d={directions_bus:fs,school:vs,favorite:Ns,flight_takeoff:ys,build:bs}[n]||gs;return e.jsx(d,{className:"w-8 h-8"})};return e.jsx(ve,{open:t,onOpenChange:a,children:e.jsxs(Ne,{className:"max-w-md",children:[e.jsx(ye,{children:e.jsx(be,{children:"Select Incident Type"})}),e.jsx("div",{className:"grid grid-cols-2 gap-4 p-4",children:s.map(n=>e.jsxs(k,{variant:"outline",className:"h-24 flex flex-col items-center justify-center space-y-2",onClick:()=>{r(n),a(!1)},children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center text-blue-600",children:i(Gs(n))}),e.jsx("span",{className:"text-sm font-medium text-center",children:Ge(n)})]},n))})]})})},Ks=({form:t})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{control:t.control,name:"title",render:({field:a})=>e.jsxs(g,{children:[e.jsx(f,{children:"Incident Title"}),e.jsx(v,{children:e.jsx(I,y({placeholder:"Brief description of the incident"},a))}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"severity",render:({field:a})=>e.jsxs(g,{children:[e.jsx(f,{children:"Severity"}),e.jsxs(O,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(v,{children:e.jsx(U,{children:e.jsx(V,{placeholder:"Select severity"})})}),e.jsxs(G,{children:[e.jsx(x,{value:"low",children:"Low"}),e.jsx(x,{value:"medium",children:"Medium"}),e.jsx(x,{value:"high",children:"High"}),e.jsx(x,{value:"critical",children:"Critical"})]})]}),e.jsx(N,{})]})})]}),e.jsx(p,{control:t.control,name:"description",render:({field:a})=>e.jsxs(g,{children:[e.jsx(f,{children:"Detailed Description"}),e.jsx(v,{children:e.jsx(J,y({placeholder:"Provide a detailed description of what happened...",className:"min-h-[100px]"},a))}),e.jsx(N,{})]})})]}),$s=({selectedLocation:t,onLocationPickerOpen:a})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs(M,{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"Location"})]}),t?e.jsxs("div",{className:"p-4 border rounded-lg bg-gray-50",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Latitude: ",t.lat.toFixed(6),", Longitude: ",t.lng.toFixed(6)]}),e.jsx(k,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:a,children:"Change Location"})]}):e.jsxs(k,{type:"button",variant:"outline",onClick:a,children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Pick Location"]})]}),zs=({peopleInvolved:t,setPeopleInvolved:a,witnesses:r,setWitnesses:s})=>{const i=()=>{a([...t,""])},n=m=>{a(t.filter((u,j)=>j!==m))},o=(m,u)=>{const j=[...t];j[m]=u,a(j)},d=()=>{s([...r,""])},h=m=>{s(r.filter((u,j)=>j!==m))},b=(m,u)=>{const j=[...r];j[m]=u,s(j)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs(M,{className:"flex items-center space-x-2",children:[e.jsx(ws,{className:"w-4 h-4"}),e.jsx("span",{children:"People Involved"})]}),t.map((m,u)=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(I,{placeholder:"Name of person involved",value:m,onChange:j=>o(u,j.target.value)}),t.length>1&&e.jsx(k,{type:"button",variant:"outline",size:"icon",onClick:()=>n(u),children:e.jsx(je,{className:"w-4 h-4"})})]},u)),e.jsxs(k,{type:"button",variant:"outline",onClick:i,children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Add Person"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(M,{className:"flex items-center space-x-2",children:[e.jsx(Me,{className:"w-4 h-4"}),e.jsx("span",{children:"Witnesses"})]}),r.map((m,u)=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(I,{placeholder:"Name of witness",value:m,onChange:j=>b(u,j.target.value)}),r.length>1&&e.jsx(k,{type:"button",variant:"outline",size:"icon",onClick:()=>h(u),children:e.jsx(je,{className:"w-4 h-4"})})]},u)),e.jsxs(k,{type:"button",variant:"outline",onClick:d,children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Add Witness"]})]})]})},qs=({attachments:t,setAttachments:a})=>{const r=i=>{const n=Array.from(i.target.files||[]);a([...t,...n])},s=i=>{a(t.filter((n,o)=>o!==i))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(M,{className:"flex items-center space-x-2",children:[e.jsx(Ss,{className:"w-4 h-4"}),e.jsx("span",{children:"Attachments"})]}),e.jsx(I,{type:"file",multiple:!0,accept:"image/*,application/pdf,.doc,.docx",onChange:r}),t.length>0&&e.jsx("div",{className:"space-y-2",children:t.map((i,n)=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsx("span",{className:"text-sm",children:i.name}),e.jsx(k,{type:"button",variant:"outline",size:"sm",onClick:()=>s(n),children:e.jsx(je,{className:"w-4 h-4"})})]},n))})]})};var ge={exports:{}};function Js(t,a,r,s){function i(n){return n instanceof r?n:new r(function(o){o(n)})}return new(r||(r=Promise))(function(n,o){function d(m){try{b(s.next(m))}catch(u){o(u)}}function h(m){try{b(s.throw(m))}catch(u){o(u)}}function b(m){m.done?n(m.value):i(m.value).then(d,h)}b((s=s.apply(t,[])).next())})}function Ws(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Hs=function t(a,r){if(a===r)return!0;if(a&&r&&typeof a=="object"&&typeof r=="object"){if(a.constructor!==r.constructor)return!1;var s,i,n;if(Array.isArray(a)){if(s=a.length,s!=r.length)return!1;for(i=s;i--!==0;)if(!t(a[i],r[i]))return!1;return!0}if(a.constructor===RegExp)return a.source===r.source&&a.flags===r.flags;if(a.valueOf!==Object.prototype.valueOf)return a.valueOf()===r.valueOf();if(a.toString!==Object.prototype.toString)return a.toString()===r.toString();if(n=Object.keys(a),s=n.length,s!==Object.keys(r).length)return!1;for(i=s;i--!==0;)if(!Object.prototype.hasOwnProperty.call(r,n[i]))return!1;for(i=s;i--!==0;){var o=n[i];if(!t(a[o],r[o]))return!1}return!0}return a!==a&&r!==r},Ys=Ws(Hs);const fe="__googleMapsScriptId";var Y;(function(t){t[t.INITIALIZED=0]="INITIALIZED",t[t.LOADING=1]="LOADING",t[t.SUCCESS=2]="SUCCESS",t[t.FAILURE=3]="FAILURE"})(Y||(Y={}));class H{constructor({apiKey:a,authReferrerPolicy:r,channel:s,client:i,id:n=fe,language:o,libraries:d=[],mapIds:h,nonce:b,region:m,retries:u=3,url:j="https://maps.googleapis.com/maps/api/js",version:C}){if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=a,this.authReferrerPolicy=r,this.channel=s,this.client=i,this.id=n||fe,this.language=o,this.libraries=d,this.mapIds=h,this.nonce=b,this.region=m,this.retries=u,this.url=j,this.version=C,H.instance){if(!Ys(this.options,H.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(H.instance.options)}`);return H.instance}H.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?Y.FAILURE:this.done?Y.SUCCESS:this.loading?Y.LOADING:Y.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let a=this.url;return a+="?callback=__googleMapsCallback&loading=async",this.apiKey&&(a+=`&key=${this.apiKey}`),this.channel&&(a+=`&channel=${this.channel}`),this.client&&(a+=`&client=${this.client}`),this.libraries.length>0&&(a+=`&libraries=${this.libraries.join(",")}`),this.language&&(a+=`&language=${this.language}`),this.region&&(a+=`&region=${this.region}`),this.version&&(a+=`&v=${this.version}`),this.mapIds&&(a+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(a+=`&auth_referrer_policy=${this.authReferrerPolicy}`),a}deleteScript(){const a=document.getElementById(this.id);a&&a.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((a,r)=>{this.loadCallback(s=>{s?r(s.error):a(window.google)})})}importLibrary(a){return this.execute(),google.maps.importLibrary(a)}loadCallback(a){this.callbacks.push(a),this.execute()}setScript(){var a,r;if(document.getElementById(this.id)){this.callback();return}const s={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(s).forEach(n=>!s[n]&&delete s[n]),!((r=(a=window==null?void 0:window.google)===null||a===void 0?void 0:a.maps)===null||r===void 0)&&r.importLibrary||(n=>{let o,d,h,b="The Google Maps JavaScript API",m="google",u="importLibrary",j="__ib__",C=document,c=window;c=c[m]||(c[m]={});const T=c.maps||(c.maps={}),D=new Set,E=new URLSearchParams,P=()=>o||(o=new Promise((K,$)=>Js(this,void 0,void 0,function*(){var w;yield d=C.createElement("script"),d.id=this.id,E.set("libraries",[...D]+"");for(h in n)E.set(h.replace(/[A-Z]/g,B=>"_"+B[0].toLowerCase()),n[h]);E.set("callback",m+".maps."+j),d.src=this.url+"?"+E,T[j]=K,d.onerror=()=>o=$(Error(b+" could not load.")),d.nonce=this.nonce||((w=C.querySelector("script[nonce]"))===null||w===void 0?void 0:w.nonce)||"",C.head.append(d)})));T[u]?console.warn(b+" only loads once. Ignoring:",n):T[u]=(K,...$)=>D.add(K)&&P().then(()=>T[u](K,...$))})(s);const i=this.libraries.map(n=>this.importLibrary(n));i.length||i.push(this.importLibrary("core")),Promise.all(i).then(()=>this.callback(),n=>{const o=new ErrorEvent("error",{error:n});this.loadErrorCallback(o)})}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(a){if(this.errors.push(a),this.errors.length<=this.retries){const r=this.errors.length*Math.pow(2,this.errors.length);console.error(`Failed to load Google Maps script, retrying in ${r} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},r)}else this.onerrorEvent=a,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(a=>{a(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),!this.loading)if(this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version){console.warn("Google Maps already loaded outside @googlemaps/js-api-loader. This may result in undesirable behavior as options and script parameters may not match."),this.callback();return}this.loading=!0,this.setScript()}}}const Zs=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_ID:fe,Loader:H,get LoaderStatus(){return Y}},Symbol.toStringTag,{value:"Module"})),Xs=ns(Zs);(function(t,a){(function(r,s){s(a,Xs,S)})(ls,function(r,s,i){function n(h){return h&&typeof h=="object"&&"default"in h?h:{default:h}}var o=n(i);r.Status=void 0,function(h){h.LOADING="LOADING",h.FAILURE="FAILURE",h.SUCCESS="SUCCESS"}(r.Status||(r.Status={}));const d=j=>{var C=j,{children:h,render:b,callback:m}=C,u=De(C,["children","render","callback"]);const[c,T]=i.useState(r.Status.LOADING);return i.useEffect(()=>{const D=new s.Loader(u),E=P=>{m&&m(P,D),T(P)};E(r.Status.LOADING),D.load().then(()=>E(r.Status.SUCCESS),()=>E(r.Status.FAILURE))},[]),c===r.Status.SUCCESS&&h?o.default.createElement(o.default.Fragment,null,h):b?b(c):o.default.createElement(o.default.Fragment,null)};r.Wrapper=d,Object.defineProperty(r,"__esModule",{value:!0})})})(ge,ge.exports);var oe=ge.exports;const Qs=({center:t,zoom:a,markers:r=[],routes:s=[]})=>{const i=S.useRef(null),[n,o]=S.useState();return S.useEffect(()=>{if(i.current&&!n){const d=new window.google.maps.Map(i.current,{center:t,zoom:a,mapTypeControl:!0,streetViewControl:!0,fullscreenControl:!0});o(d)}},[i,n,t,a]),S.useEffect(()=>{n&&(r.forEach(d=>{new google.maps.Marker({position:d.position,map:n,title:d.title,icon:d.type==="driver"?{url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(`
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="8" fill="#22c55e" stroke="white" stroke-width="2"/>
                <circle cx="12" cy="12" r="3" fill="white"/>
              </svg>
            `),scaledSize:new google.maps.Size(24,24)}:void 0})}),s.forEach(d=>{new google.maps.Polyline({path:d.path,geodesic:!0,strokeColor:d.color||"#3b82f6",strokeOpacity:1,strokeWeight:3,map:n})}))},[n,r,s]),e.jsx("div",{ref:i,className:"w-full h-full min-h-[400px] rounded-lg"})},et=({status:t,center:a,zoom:r,markers:s,routes:i})=>{switch(t){case oe.Status.LOADING:return e.jsxs("div",{className:"flex items-center justify-center h-[400px]",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2",children:"Loading map..."})]});case oe.Status.FAILURE:return e.jsx("div",{className:"flex items-center justify-center h-[400px] bg-gray-100 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Failed to load map"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Please check your Google Maps API key"})]})});case oe.Status.SUCCESS:return e.jsx(Qs,{center:a,zoom:r,markers:s,routes:i});default:return null}},st=({apiKey:t="",center:a={lat:-25.7479,lng:28.2293},zoom:r=10,markers:s=[],routes:i=[],title:n="Map View",showApiKeyInput:o=!1})=>{const[d,h]=S.useState(t),[b,m]=S.useState(!0);S.useEffect(()=>{d?m(!1):te(void 0,null,function*(){try{const{data:C,error:c}=yield is.functions.invoke("get-google-maps-key");if(C!=null&&C.apiKey)h(C.apiKey);else{console.log("No API key found in Supabase secrets, falling back to local storage");const T=localStorage.getItem("google_maps_api_key");T&&h(T)}}catch(C){console.log("Error fetching API key from Supabase, using local storage fallback");const c=localStorage.getItem("google_maps_api_key");c&&h(c)}finally{m(!1)}})},[d]);const u=j=>{h(j),localStorage.setItem("google_maps_api_key",j)};return b?e.jsxs(L,{children:[e.jsx(z,{children:e.jsxs(q,{className:"flex items-center space-x-2",children:[e.jsx(Te,{className:"w-5 h-5"}),e.jsx("span",{children:n})]})}),e.jsx(A,{children:e.jsxs("div",{className:"flex items-center justify-center h-[400px]",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2",children:"Loading map configuration..."})]})})]}):o&&!d?e.jsxs(L,{children:[e.jsx(z,{children:e.jsxs(q,{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"w-5 h-5"}),e.jsx("span",{children:n})]})}),e.jsx(A,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(M,{htmlFor:"apiKey",children:"Google Maps API Key"}),e.jsx(I,{id:"apiKey",type:"password",placeholder:"Enter your Google Maps API key",value:d,onChange:j=>u(j.target.value)}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Get your API key from"," ",e.jsx("a",{href:"https://console.cloud.google.com/google/maps-apis",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Google Cloud Console"})]})]})})})]}):d?e.jsxs(L,{children:[e.jsx(z,{children:e.jsxs(q,{className:"flex items-center space-x-2",children:[e.jsx(Te,{className:"w-5 h-5"}),e.jsx("span",{children:n})]})}),e.jsx(A,{children:e.jsx(oe.Wrapper,{apiKey:d,render:j=>e.jsx(et,{status:j,center:a,zoom:r,markers:s,routes:i})})})]}):e.jsxs(L,{children:[e.jsx(z,{children:e.jsxs(q,{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"w-5 h-5"}),e.jsx("span",{children:n})]})}),e.jsx(A,{children:e.jsx("div",{className:"flex items-center justify-center h-[400px] bg-gray-100 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Google Maps API key required"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Configure your API key to view the map"})]})})})]})},tt=({open:t,onOpenChange:a,onLocationSelect:r,initialLocation:s={lat:-25.7479,lng:28.2293}})=>{const[i,n]=S.useState(s),o=()=>{r(i),a(!1)};return e.jsx(ve,{open:t,onOpenChange:a,children:e.jsxs(Ne,{className:"max-w-2xl",children:[e.jsx(ye,{children:e.jsx(be,{children:"Pick Location"})}),e.jsx("div",{className:"h-96",children:e.jsx(st,{center:i,zoom:13,markers:[{position:i,title:"Selected Location",type:"stop"}],showApiKeyInput:!0})}),e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:["Selected: ",i.lat.toFixed(6),", ",i.lng.toFixed(6)]}),e.jsxs(cs,{children:[e.jsx(k,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsx(k,{onClick:o,children:"Confirm Location"})]})]})})},at=({form:t,selectedDate:a,selectedTime:r})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Incident Details"}),e.jsx(ne,{className:"mb-4"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{control:t.control,name:"incidentType",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Incident Type"}),e.jsxs(O,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(v,{children:e.jsx(U,{children:e.jsx(V,{placeholder:"Select incident type"})})}),e.jsxs(G,{children:[e.jsx(x,{value:"Collision",children:"Collision"}),e.jsx(x,{value:"Breakdown",children:"Breakdown"}),e.jsx(x,{value:"Passenger Injury",children:"Passenger Injury"}),e.jsx(x,{value:"Other",children:"Other"})]})]}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"vehicleRoute",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Vehicle/Route"}),e.jsx(v,{children:e.jsx(I,y({placeholder:"Enter vehicle or route details"},s))}),e.jsx(N,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(p,{control:t.control,name:"date",render:({field:s})=>e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{children:"Date"})]}),e.jsx(v,{children:e.jsx(I,R(y({type:"date"},s),{value:a}))}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"time",render:({field:s})=>e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{children:"Time"})]}),e.jsx(v,{children:e.jsx(I,R(y({type:"time"},s),{value:r}))}),e.jsx(N,{})]})})]}),e.jsx(p,{control:t.control,name:"injuriesDamage",render:({field:s})=>e.jsxs(g,{className:"mt-4",children:[e.jsx(f,{children:"Injuries/Damage Details"}),e.jsx(v,{children:e.jsx(J,y({placeholder:"Describe any injuries or damage...",className:"min-h-[80px]"},s))}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"actionsTaken",render:({field:s})=>e.jsxs(g,{className:"mt-4",children:[e.jsx(f,{children:"Actions Taken"}),e.jsx(v,{children:e.jsx(J,y({placeholder:"Describe actions taken...",className:"min-h-[80px]"},s))}),e.jsx(N,{})]})})]})}),rt=({form:t,selectedDate:a,selectedTime:r})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Incident Details"}),e.jsx(ne,{className:"mb-4"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{control:t.control,name:"incidentType",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Incident Type"}),e.jsxs(O,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(v,{children:e.jsx(U,{children:e.jsx(V,{placeholder:"Select incident type"})})}),e.jsxs(G,{children:[e.jsx(x,{value:"Student Injury",children:"Student Injury"}),e.jsx(x,{value:"Bullying",children:"Bullying"}),e.jsx(x,{value:"Property Damage",children:"Property Damage"}),e.jsx(x,{value:"Other",children:"Other"})]})]}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"personName",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Student/Staff Name"}),e.jsx(v,{children:e.jsx(I,y({placeholder:"Enter name"},s))}),e.jsx(N,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(p,{control:t.control,name:"classRole",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Class/Role"}),e.jsx(v,{children:e.jsx(I,y({placeholder:"Enter class or role"},s))}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"schoolLocation",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"School Location"}),e.jsx(v,{children:e.jsx(I,y({placeholder:"Enter location within school"},s))}),e.jsx(N,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(p,{control:t.control,name:"date",render:({field:s})=>e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{children:"Date"})]}),e.jsx(v,{children:e.jsx(I,R(y({type:"date"},s),{value:a}))}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"time",render:({field:s})=>e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{children:"Time"})]}),e.jsx(v,{children:e.jsx(I,R(y({type:"time"},s),{value:r}))}),e.jsx(N,{})]})})]}),e.jsx(p,{control:t.control,name:"actionsTaken",render:({field:s})=>e.jsxs(g,{className:"mt-4",children:[e.jsx(f,{children:"Actions Taken"}),e.jsx(v,{children:e.jsx(J,y({placeholder:"Describe actions taken...",className:"min-h-[80px]"},s))}),e.jsx(N,{})]})})]})}),nt=({form:t,selectedDate:a,selectedTime:r})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Incident Details"}),e.jsx(ne,{className:"mb-4"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{control:t.control,name:"incidentType",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Incident Type"}),e.jsxs(O,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(v,{children:e.jsx(U,{children:e.jsx(V,{placeholder:"Select incident type"})})}),e.jsxs(G,{children:[e.jsx(x,{value:"Injury",children:"Injury"}),e.jsx(x,{value:"Property Damage",children:"Property Damage"}),e.jsx(x,{value:"Vendor Issue",children:"Vendor Issue"}),e.jsx(x,{value:"Guest Behavior",children:"Guest Behavior"}),e.jsx(x,{value:"Other",children:"Other"})]})]}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"personInvolved",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Person(s) Involved"}),e.jsx(v,{children:e.jsx(I,y({placeholder:"Enter names of people involved"},s))}),e.jsx(N,{})]})})]}),e.jsx(p,{control:t.control,name:"venueLocation",render:({field:s})=>e.jsxs(g,{className:"mt-4",children:[e.jsx(f,{children:"Location (venue/area)"}),e.jsx(v,{children:e.jsx(I,y({placeholder:"Enter venue or area details"},s))}),e.jsx(N,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(p,{control:t.control,name:"date",render:({field:s})=>e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{children:"Date"})]}),e.jsx(v,{children:e.jsx(I,R(y({type:"date"},s),{value:a}))}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"time",render:({field:s})=>e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{children:"Time"})]}),e.jsx(v,{children:e.jsx(I,R(y({type:"time"},s),{value:r}))}),e.jsx(N,{})]})})]}),e.jsx(p,{control:t.control,name:"actionsTaken",render:({field:s})=>e.jsxs(g,{className:"mt-4",children:[e.jsx(f,{children:"Actions Taken"}),e.jsx(v,{children:e.jsx(J,y({placeholder:"Describe actions taken...",className:"min-h-[80px]"},s))}),e.jsx(N,{})]})})]})}),lt=({form:t,selectedDate:a,selectedTime:r})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Incident Details"}),e.jsx(ne,{className:"mb-4"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{control:t.control,name:"incidentType",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Incident Type"}),e.jsxs(O,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(v,{children:e.jsx(U,{children:e.jsx(V,{placeholder:"Select incident type"})})}),e.jsxs(G,{children:[e.jsx(x,{value:"Baggage",children:"Baggage"}),e.jsx(x,{value:"Security",children:"Security"}),e.jsx(x,{value:"Injury",children:"Injury"}),e.jsx(x,{value:"Equipment",children:"Equipment"}),e.jsx(x,{value:"Delay",children:"Delay"}),e.jsx(x,{value:"Other",children:"Other"})]})]}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"flightVehicle",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Flight/Vehicle Details"}),e.jsx(v,{children:e.jsx(I,y({placeholder:"Enter flight or vehicle details"},s))}),e.jsx(N,{})]})})]}),e.jsx(p,{control:t.control,name:"airportLocation",render:({field:s})=>e.jsxs(g,{className:"mt-4",children:[e.jsx(f,{children:"Location (terminal/gate/runway)"}),e.jsx(v,{children:e.jsx(I,y({placeholder:"Enter airport location details"},s))}),e.jsx(N,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(p,{control:t.control,name:"date",render:({field:s})=>e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{children:"Date"})]}),e.jsx(v,{children:e.jsx(I,R(y({type:"date"},s),{value:a}))}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"time",render:({field:s})=>e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{children:"Time"})]}),e.jsx(v,{children:e.jsx(I,R(y({type:"time"},s),{value:r}))}),e.jsx(N,{})]})})]}),e.jsx(p,{control:t.control,name:"actionsTaken",render:({field:s})=>e.jsxs(g,{className:"mt-4",children:[e.jsx(f,{children:"Actions Taken"}),e.jsx(v,{children:e.jsx(J,y({placeholder:"Describe actions taken...",className:"min-h-[80px]"},s))}),e.jsx(N,{})]})})]})}),it=({form:t,selectedDate:a,selectedTime:r})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Incident Details"}),e.jsx(ne,{className:"mb-4"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{control:t.control,name:"incidentType",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Incident Type"}),e.jsxs(O,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(v,{children:e.jsx(U,{children:e.jsx(V,{placeholder:"Select incident type"})})}),e.jsxs(G,{children:[e.jsx(x,{value:"Injury",children:"Injury"}),e.jsx(x,{value:"Property",children:"Property"}),e.jsx(x,{value:"Theft",children:"Theft"}),e.jsx(x,{value:"Other",children:"Other"})]})]}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"clientStaffThirdParty",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"People Involved (client/staff/third party)"}),e.jsx(v,{children:e.jsx(I,y({placeholder:"Enter details of people involved"},s))}),e.jsx(N,{})]})})]}),e.jsx(p,{control:t.control,name:"jobLocation",render:({field:s})=>e.jsxs(g,{className:"mt-4",children:[e.jsx(f,{children:"Location"}),e.jsx(v,{children:e.jsx(I,y({placeholder:"Enter job location"},s))}),e.jsx(N,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(p,{control:t.control,name:"date",render:({field:s})=>e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{children:"Date"})]}),e.jsx(v,{children:e.jsx(I,R(y({type:"date"},s),{value:a}))}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"time",render:({field:s})=>e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{children:"Time"})]}),e.jsx(v,{children:e.jsx(I,R(y({type:"time"},s),{value:r}))}),e.jsx(N,{})]})})]}),e.jsx(p,{control:t.control,name:"actionsTaken",render:({field:s})=>e.jsxs(g,{className:"mt-4",children:[e.jsx(f,{children:"Actions Taken"}),e.jsx(v,{children:e.jsx(J,y({placeholder:"Describe actions taken...",className:"min-h-[80px]"},s))}),e.jsx(N,{})]})})]})}),ct=Fs({title:_().min(2,{message:"Title must be at least 2 characters."}),description:_().min(10,{message:"Description must be at least 10 characters."}),severity:Ae(["low","medium","high"]),status:Ae(["open","closed"]).optional(),date:_().optional(),time:_().optional(),locationAddress:_().optional(),peopleInvolved:Ms(_()).optional(),vehicleInfo:_().optional(),weatherConditions:_().optional(),reportedBy:_().optional(),contactInfo:_().optional(),emergencyServices:ue().optional(),policeReportNumber:_().optional(),insuranceClaim:ue().optional(),estimatedDamages:_().optional(),followUpRequired:ue().optional(),incidentType:_().optional(),vehicleRoute:_().optional(),injuriesDamage:_().optional(),actionsTaken:_().optional(),personName:_().optional(),classRole:_().optional(),schoolLocation:_().optional(),personInvolved:_().optional(),venueLocation:_().optional(),flightVehicle:_().optional(),airportLocation:_().optional(),clientStaffThirdParty:_().optional(),jobLocation:_().optional()}),ot=({incidentType:t,onSubmit:a,onCancel:r})=>{const{toast:s}=Fe(),[i,n]=S.useState(!1),[o,d]=S.useState(null),[h,b]=S.useState(!1),[m,u]=S.useState([]),[j,C]=S.useState([""]),[c,T]=S.useState([""]),D=Os({resolver:Ps(ct),defaultValues:{title:"",description:"",severity:"low",status:"open",date:new Date().toISOString().split("T")[0],time:new Date().toTimeString().slice(0,5),locationAddress:"",peopleInvolved:[],vehicleInfo:"",weatherConditions:"",reportedBy:"",contactInfo:"",emergencyServices:!1,policeReportNumber:"",insuranceClaim:!1,estimatedDamages:"",followUpRequired:!1}}),E=D.watch("date")||"",P=D.watch("time")||"",K=w=>te(void 0,null,function*(){n(!0);try{const B=y({type:t,title:w.title,description:w.description,severity:w.severity,status:w.status||"open",date:w.date?new Date(w.date):void 0,time:w.time,location:o?{lat:o.lat,lng:o.lng,address:w.locationAddress||""}:void 0,peopleInvolved:j.filter(se=>se.trim()!==""),witnesses:c.filter(se=>se.trim()!==""),vehicleInfo:w.vehicleInfo,weatherConditions:w.weatherConditions,reportedBy:w.reportedBy,contactInfo:w.contactInfo,emergencyServices:w.emergencyServices||!1,policeReportNumber:w.policeReportNumber,insuranceClaim:w.insuranceClaim||!1,estimatedDamages:w.estimatedDamages,followUpRequired:w.followUpRequired||!1,attachments:m},w);yield a(B),s({title:"Incident Reported",description:"Your incident report has been submitted successfully."})}catch(B){console.error("Error submitting incident:",B),s({title:"Error",description:"Failed to submit incident report. Please try again.",variant:"destructive"})}finally{n(!1)}}),$=()=>{switch(t){case"transportation":return e.jsx(at,{form:D,selectedDate:E,selectedTime:P});case"school":return e.jsx(rt,{form:D,selectedDate:E,selectedTime:P});case"wedding":return e.jsx(nt,{form:D,selectedDate:E,selectedTime:P});case"airport":return e.jsx(lt,{form:D,selectedDate:E,selectedTime:P});case"privateJob":return e.jsx(it,{form:D,selectedDate:E,selectedTime:P});default:return null}};return e.jsxs(L,{className:"w-full max-w-4xl mx-auto",children:[e.jsxs(z,{children:[e.jsxs(q,{children:["Report ",t.charAt(0).toUpperCase()+t.slice(1)," Incident"]}),e.jsx(os,{children:"Please provide detailed information about the incident"})]}),e.jsxs(A,{children:[e.jsx(Rs,R(y({},D),{children:e.jsxs("form",{onSubmit:D.handleSubmit(K),className:"space-y-6",children:[e.jsx(Ks,{form:D}),$(),e.jsx($s,{selectedLocation:o,onLocationPickerOpen:()=>b(!0)}),e.jsx(zs,{peopleInvolved:j,setPeopleInvolved:C,witnesses:c,setWitnesses:T}),e.jsx(qs,{attachments:m,setAttachments:u}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-6",children:[e.jsx(k,{type:"button",variant:"outline",onClick:r,disabled:i,children:"Cancel"}),e.jsx(k,{type:"submit",disabled:i,children:i?"Submitting...":"Submit Report"})]})]})})),h&&e.jsx(tt,{open:h,onOpenChange:b,onLocationSelect:w=>{d(w),b(!1)}})]})]})};function dt(){const{data:t=[],isLoading:a,error:r}=Ve(),[s,i]=S.useState(""),[n,o]=S.useState("all"),[d,h]=S.useState("incidents"),b=t.filter(c=>{var E;const T=c.title.toLowerCase().includes(s.toLowerCase())||c.description.toLowerCase().includes(s.toLowerCase())||((E=c.location_address)==null?void 0:E.toLowerCase().includes(s.toLowerCase())),D=n==="all"||c.status===n;return T&&D}),m=c=>{switch(c){case"open":return e.jsx(ae,{className:"w-3 h-3"});case"investigating":return e.jsx(Q,{className:"w-3 h-3"});case"resolved":return e.jsx(Ue,{className:"w-3 h-3"});case"closed":return e.jsx(Oe,{className:"w-3 h-3"});default:return e.jsx(re,{className:"w-3 h-3"})}},u=c=>{switch(c){case"open":return"destructive";case"investigating":return"default";case"resolved":return"default";case"closed":return"secondary";default:return"secondary"}},j=c=>{switch(c){case"critical":return"destructive";case"high":return"destructive";case"medium":return"default";case"low":return"secondary";default:return"secondary"}},C={totalIncidents:t.length,pendingIncidents:t.filter(c=>c.status==="open"||c.status==="investigating").length,resolvedIncidents:t.filter(c=>c.status==="resolved").length,thisMonthIncidents:t.filter(c=>{const T=new Date(c.incident_date||c.created_at);return T.getMonth()===new Date().getMonth()&&T.getFullYear()===new Date().getFullYear()}).length};return a?e.jsx(he,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading incident reports..."})]})})}):r?e.jsx(he,{children:e.jsx("div",{className:"space-y-4 p-4",children:e.jsx(L,{className:"border-red-200 bg-red-50",children:e.jsx(A,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ae,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-red-900 mb-2",children:"Error Loading Reports"}),e.jsx("p",{className:"text-red-700",children:r.message})]})})})})}):e.jsx(he,{children:e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"My Incident Reports"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Track and manage your incident reports"})]}),e.jsxs(k,{size:"sm",className:"ml-4 flex-shrink-0",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"New Report"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsx(L,{children:e.jsx(A,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:C.totalIncidents}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Incidents"})]})})}),e.jsx(L,{children:e.jsx(A,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:C.pendingIncidents}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending"})]})})}),e.jsx(L,{children:e.jsx(A,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:C.resolvedIncidents}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Resolved"})]})})}),e.jsx(L,{children:e.jsx(A,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:C.thisMonthIncidents}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This Month"})]})})})]}),e.jsxs(ds,{value:d,onValueChange:h,className:"w-full mobile-tabs",children:[e.jsxs(hs,{className:"grid w-full grid-cols-3 mb-6 gap-1",children:[e.jsx(xe,{value:"incidents",className:"text-xs sm:text-sm px-1 sm:px-3 py-2",children:"My Incidents"}),e.jsx(xe,{value:"emergency",className:"text-xs sm:text-sm px-1 sm:px-3 py-2",children:"Emergency Contact"}),e.jsx(xe,{value:"guidelines",className:"text-xs sm:text-sm px-1 sm:px-3 py-2",children:"Safety Guidelines"})]}),e.jsxs(me,{value:"incidents",className:"space-y-4",children:[e.jsx(L,{className:"mb-6",children:e.jsx(A,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(I,{placeholder:"Search incidents",value:s,onChange:c=>i(c.target.value),className:"pl-10"})]}),e.jsxs(O,{value:n,onValueChange:o,children:[e.jsxs(U,{children:[e.jsx(Cs,{className:"w-4 h-4 mr-2"}),e.jsx(V,{placeholder:"Filter by status"})]}),e.jsxs(G,{children:[e.jsx(x,{value:"all",children:"All Status"}),e.jsx(x,{value:"open",children:"Open"}),e.jsx(x,{value:"investigating",children:"Investigating"}),e.jsx(x,{value:"resolved",children:"Resolved"}),e.jsx(x,{value:"closed",children:"Closed"})]})]})]})})}),b.length===0?e.jsx(L,{children:e.jsx(A,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(re,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"No incidents found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:s||n!=="all"?"No incidents match your search criteria":"You haven't reported any incidents yet"}),e.jsxs(k,{children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Report New Incident"]})]})})}):e.jsxs("div",{className:"space-y-4",children:[b.map(c=>e.jsx(L,{className:"hover:shadow-md transition-shadow",children:e.jsx(A,{className:"pt-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"flex-1 pr-6 min-w-0",children:e.jsx("h3",{className:"text-lg font-semibold text-foreground leading-tight break-words",children:c.title})}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs(W,{variant:u(c.status),children:[m(c.status),e.jsx("span",{className:"ml-1 capitalize",children:c.status})]}),c.severity&&e.jsx(W,{variant:j(c.severity),children:c.severity})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-3 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:[c.incident_date?pe(Pe(c.incident_date),"yyyy-MM-dd"):"Not specified"," at ",c.incident_time||"00:00"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"max-w-[120px] truncate",children:c.location_address||"Location not specified"})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed break-words max-h-[80px] overflow-hidden",children:c.description})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:"Vehicle:"}),e.jsx("span",{children:c.vehicle_id||"Not specified"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:"Damage:"}),e.jsx("span",{children:"Reported"}),e.jsx(Me,{className:"w-3 h-3 text-muted-foreground"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["ID: ",c.id]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Updated: ",pe(Pe(c.updated_at),"MMM dd, yyyy")]})]}),e.jsx(k,{size:"sm",variant:"outline",children:"View Details"})]})]})]})})},c.id)),e.jsx(L,{children:e.jsx(A,{className:"pt-6",children:e.jsx("div",{className:"text-center",children:e.jsxs(k,{variant:"outline",className:"w-full",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"View All Reports"]})})})})]})]}),e.jsx(me,{value:"emergency",className:"space-y-4",children:e.jsxs(L,{children:[e.jsx(z,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(ks,{className:"w-5 h-5 text-red-600"}),"Emergency Contacts"]})}),e.jsx(A,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Emergency Services"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Police, Fire, Ambulance"})]}),e.jsxs(k,{size:"sm",variant:"destructive",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"999"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Control Room"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"24/7 Support"})]}),e.jsxs(k,{size:"sm",variant:"outline",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Call"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Manager"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Direct Line"})]}),e.jsxs(k,{size:"sm",variant:"outline",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Call"]})]})]})})]})}),e.jsx(me,{value:"guidelines",className:"space-y-4",children:e.jsxs(L,{children:[e.jsx(z,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(_s,{className:"w-5 h-5 text-blue-600"}),"Safety Guidelines"]})}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-yellow-50 rounded-lg border-l-4 border-yellow-400",children:[e.jsx("h4",{className:"font-medium text-yellow-800 mb-2",children:"Pre-Trip Safety"}),e.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsx("li",{children:"• Complete vehicle inspection before departure"}),e.jsx("li",{children:"• Check all safety equipment"}),e.jsx("li",{children:"• Verify passenger count and seating"})]})]}),e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border-l-4 border-blue-400",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"During Journey"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• Maintain safe driving speed"}),e.jsx("li",{children:"• Regular breaks every 4.5 hours"}),e.jsx("li",{children:"• Monitor passenger safety"})]})]}),e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border-l-4 border-green-400",children:[e.jsx("h4",{className:"font-medium text-green-800 mb-2",children:"Emergency Procedures"}),e.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[e.jsx("li",{children:"• Stop safely if incident occurs"}),e.jsx("li",{children:"• Contact emergency services if needed"}),e.jsx("li",{children:"• Report incident within 24 hours"})]})]})]}),e.jsxs(k,{className:"w-full mt-4",children:[e.jsx(Ds,{className:"w-4 h-4 mr-2"}),"View Full Safety Manual"]})]})]})})]})]})})}const St=()=>{const{user:t,profile:a,loading:r}=xs(),s=ms(),{toast:i}=Fe(),[n,o]=S.useState(!1),[d,h]=S.useState(null),[b,m]=S.useState(""),[u,j]=S.useState("all"),[C,c]=S.useState("all"),[T,D]=S.useState(null),[E,P]=S.useState(!1),[K,$]=S.useState(""),[w,B]=S.useState(""),{data:se=[],isLoading:Be,error:we,refetch:Se}=Ve(),Ke=Us(),$e=Vs(),ze=[{id:"parent-1",source:"parent",title:"Child pickup delay",description:"My child was not picked up at the scheduled time",severity:"medium",status:"open",reported_by:"parent-1",reported_by_name:"Sarah Johnson",child_name:"Emma Johnson",incident_date:new Date().toISOString(),contact_info:{phone:"+1234567890",email:"sarah.johnson@email.com"},created_at:new Date().toISOString()},{id:"parent-2",source:"parent",title:"Safety concern on route",description:"Concerned about the route safety near the construction zone",severity:"high",status:"investigating",reported_by:"parent-2",reported_by_name:"Michael Chen",child_name:"Alex Chen",incident_date:new Date().toISOString(),contact_info:{phone:"+1234567891",email:"michael.chen@email.com"},created_at:new Date().toISOString()}],qe=[...se.map(l=>R(y({},l),{source:"driver"})),...ze];if(r||Be)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading incident reports..."})]})});if(!t||!a)return e.jsx(Re,{to:"/auth",replace:!0});if(!["driver","admin","council","mechanic"].includes(a.role))return e.jsx(Re,{to:"/dashboard",replace:!0});if(s&&a.role==="driver")return e.jsx(dt,{});const Je=l=>{h(l)},We=l=>te(void 0,null,function*(){try{yield Ke.mutateAsync(R(y({},l),{incident_type:d,reported_by:t.id})),h(null)}catch(de){console.error("Error creating incident:",de)}}),He=()=>{h(null)},Ye=()=>te(void 0,null,function*(){if(!(!T||!w))try{T.source==="driver"?yield $e.mutateAsync({id:T.id,status:w}):i({title:"Parent incident updated",description:"Parent incident status has been updated."}),P(!1),D(null),$(""),B(""),Se()}catch(l){console.error("Error resolving incident:",l),i({title:"Error",description:"Failed to resolve incident. Please try again.",variant:"destructive"})}}),Ze=l=>{switch(l){case"open":return e.jsx(ae,{className:"w-4 h-4"});case"investigating":return e.jsx(Q,{className:"w-4 h-4"});case"resolved":return e.jsx(Ue,{className:"w-4 h-4"});case"closed":return e.jsx(Oe,{className:"w-4 h-4"});default:return e.jsx(re,{className:"w-4 h-4"})}},Xe=l=>{switch(l){case"open":return"destructive";case"investigating":return"default";case"resolved":return"default";case"closed":return"secondary";default:return"secondary"}},Qe=l=>{switch(l){case"driver":return e.jsx(Le,{className:"w-4 h-4"});case"parent":return e.jsx(Ee,{className:"w-4 h-4"});default:return e.jsx(re,{className:"w-4 h-4"})}},Ie=l=>{switch(l){case"driver":return"blue";case"parent":return"green";default:return"gray"}},le=qe.filter(l=>{const de=l.title.toLowerCase().includes(b.toLowerCase())||l.description.toLowerCase().includes(b.toLowerCase()),es=u==="all"||l.status===u,ss=C==="all"||l.source===C;return de&&es&&ss});return d?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsx(ot,{incidentType:d,onSubmit:We,onCancel:He})})}):we?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsxs(us,{variant:"destructive",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsxs(js,{children:["Error loading incidents: ",we.message]})]})})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"container mx-auto px-6 py-8 space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Incident Reports"}),e.jsx("p",{className:"text-gray-600",children:a.role==="admin"||a.role==="council"?"Manage and resolve all incident reports from drivers and parents":"Manage and track incident reports"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(k,{onClick:()=>Se(),variant:"outline",size:"sm",children:[e.jsx(Ts,{className:"w-4 h-4 mr-2"}),"Refresh"]}),e.jsxs(k,{onClick:()=>o(!0),children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"New Incident Report"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"search",className:"text-sm font-medium",children:"Search"}),e.jsx(I,{id:"search",placeholder:"Search incidents...",value:b,onChange:l=>m(l.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"status-filter",className:"text-sm font-medium",children:"Status"}),e.jsxs(O,{value:u,onValueChange:j,children:[e.jsx(U,{className:"mt-1",children:e.jsx(V,{placeholder:"All statuses"})}),e.jsxs(G,{children:[e.jsx(x,{value:"all",children:"All Statuses"}),e.jsx(x,{value:"open",children:"Open"}),e.jsx(x,{value:"investigating",children:"Investigating"}),e.jsx(x,{value:"resolved",children:"Resolved"}),e.jsx(x,{value:"closed",children:"Closed"})]})]})]}),(a.role==="admin"||a.role==="council")&&e.jsxs("div",{children:[e.jsx(M,{htmlFor:"source-filter",className:"text-sm font-medium",children:"Source"}),e.jsxs(O,{value:C,onValueChange:c,children:[e.jsx(U,{className:"mt-1",children:e.jsx(V,{placeholder:"All sources"})}),e.jsxs(G,{children:[e.jsx(x,{value:"all",children:"All Sources"}),e.jsx(x,{value:"driver",children:"Driver Reports"}),e.jsx(x,{value:"parent",children:"Parent Reports"})]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(W,{variant:"outline",className:"text-sm",children:[le.length," incident",le.length!==1?"s":""]})})]}),le.length===0?e.jsx(L,{children:e.jsxs(A,{className:"text-center py-12",children:[e.jsx(ae,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"No incidents found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:b||u!=="all"||C!=="all"?"Try adjusting your filters to see more results.":"Get started by creating your first incident report."}),e.jsxs(k,{onClick:()=>o(!0),children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Create Incident Report"]})]})}):e.jsx("div",{className:"space-y-4",children:le.map(l=>e.jsxs(L,{className:"hover:shadow-md transition-shadow",children:[e.jsx(z,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(q,{className:"text-lg",children:l.title}),e.jsxs(W,{variant:"outline",className:`text-${Ie(l.source)}-600 border-${Ie(l.source)}-200`,children:[Qe(l.source),e.jsx("span",{className:"ml-1 capitalize",children:l.source})]}),"incident_type"in l&&l.incident_type&&e.jsx(W,{variant:"outline",children:Ge(l.incident_type)})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:l.description}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(X,{className:"w-3 h-3 mr-1"}),pe(new Date(l.created_at),"MMM dd, yyyy")]}),l.source==="parent"&&"child_name"in l&&l.child_name&&e.jsxs("span",{className:"flex items-center",children:[e.jsx(Ee,{className:"w-3 h-3 mr-1"}),l.child_name]}),l.source==="driver"&&"vehicles"in l&&l.vehicles&&e.jsxs("span",{className:"flex items-center",children:[e.jsx(Le,{className:"w-3 h-3 mr-1"}),l.vehicles.vehicle_number]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(W,{variant:Xe(l.status),className:"flex items-center space-x-1",children:[Ze(l.status),e.jsx("span",{className:"capitalize",children:l.status.replace("_"," ")})]}),(a.role==="admin"||a.role==="council")&&l.status!=="resolved"&&l.status!=="closed"&&e.jsx(k,{size:"sm",variant:"outline",onClick:()=>{D(l),B(l.status),P(!0)},children:e.jsx(Es,{className:"w-4 h-4"})})]})]})}),e.jsx(A,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-600",children:"Severity"}),e.jsx(W,{variant:l.severity==="high"||l.severity==="critical"?"destructive":"secondary",children:l.severity})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-600",children:"Reported By"}),e.jsx("p",{children:l.source==="driver"?l.profiles?`${l.profiles.first_name} ${l.profiles.last_name}`:"Unknown":l.reported_by_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-600",children:"Contact"}),l.source==="parent"&&l.contact_info?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"flex items-center text-xs",children:[e.jsx(ce,{className:"w-3 h-3 mr-1"}),l.contact_info.phone]}),e.jsxs("p",{className:"flex items-center text-xs",children:[e.jsx(Ls,{className:"w-3 h-3 mr-1"}),l.contact_info.email]})]}):e.jsx("p",{className:"text-xs text-gray-500",children:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-600",children:"Location"}),e.jsx("p",{className:"text-xs",children:l.location_address||l.location||"Not specified"})]})]})})]},l.id))})]}),e.jsx(Bs,{open:n,onOpenChange:o,onSelect:Je}),e.jsx(ve,{open:E,onOpenChange:P,children:e.jsxs(Ne,{className:"max-w-md",children:[e.jsxs(ye,{children:[e.jsx(be,{children:"Resolve Incident"}),e.jsx(ps,{children:"Update the status and add resolution notes for this incident."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"status",children:"Status"}),e.jsxs(O,{value:w,onValueChange:B,children:[e.jsx(U,{children:e.jsx(V,{placeholder:"Select status"})}),e.jsxs(G,{children:[e.jsx(x,{value:"open",children:"Open"}),e.jsx(x,{value:"investigating",children:"Investigating"}),e.jsx(x,{value:"resolved",children:"Resolved"}),e.jsx(x,{value:"closed",children:"Closed"})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"resolution-notes",children:"Resolution Notes"}),e.jsx(J,{id:"resolution-notes",placeholder:"Add notes about how this incident was resolved...",value:K,onChange:l=>$(l.target.value),rows:4})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(k,{variant:"outline",onClick:()=>P(!1),className:"flex-1",children:"Cancel"}),e.jsxs(k,{onClick:Ye,className:"flex-1",disabled:!w,children:[e.jsx(As,{className:"w-4 h-4 mr-2"}),"Update Status"]})]})]})]})})]})};export{St as default};
