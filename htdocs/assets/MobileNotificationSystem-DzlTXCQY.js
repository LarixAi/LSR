var te=Object.defineProperty,le=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var H=(i,a,t)=>a in i?te(i,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[a]=t,x=(i,a)=>{for(var t in a||(a={}))ne.call(a,t)&&H(i,t,a[t]);if(V)for(var t of V(a))ce.call(a,t)&&H(i,t,a[t]);return i},u=(i,a)=>le(i,ie(a));var q=(i,a,t)=>new Promise((C,m)=>{var S=d=>{try{c(t.next(d))}catch(o){m(o)}},T=d=>{try{c(t.throw(d))}catch(o){m(o)}},c=d=>d.done?C(d.value):Promise.resolve(d.value).then(S,T);c((t=t.apply(i,a)).next())});import{j as e}from"./ui-vendor-DMUr7mTx.js";import{r as p}from"./react-vendor-BvqlMsL5.js";import{u as de,l as oe,a5 as me,a6 as he,a7 as xe,a8 as ue,a9 as pe,aa as ge,e as j,B as N,I as B,S as v,q as f,r as b,t as w,v as l,h as ye,i as je,j as $,k as z,C as Y,d as O,D as Ne,m as ve,n as fe,o as be,p as we,L as y,T as Ce}from"./index-ZwIgorfy.js";import{d as U,E as Se,G,j as Te,I as Ae,T as J,J as _e}from"./icons-vendor-b0I7fGSL.js";import{f as Q}from"./utils-vendor-B2FlkASS.js";import"./supabase-vendor-B984m0TI.js";import"./query-vendor-B2F_wWlc.js";import"./router-vendor-CEyBJ8vK.js";import"./ui-components-7w1-MJre.js";const Be=()=>{const{user:i,profile:a}=de(),{toast:t}=oe(),[C,m]=p.useState(!1),[S,T]=p.useState("received"),[c,d]=p.useState(""),[o,W]=p.useState("all"),[g,K]=p.useState("all"),[r,h]=p.useState({recipientType:"specific",recipientId:"",recipientRole:"",title:"",body:"",type:"info",priority:"normal",category:"general",channels:["in_app"],scheduledFor:"",isScheduled:!1}),{data:L=[],isLoading:Re}=me(),{data:M=[],isLoading:Le}=he(),A=xe(),X=ue(),{data:P=0}=pe();ge();const Z=()=>{if(!(a!=null&&a.organization_id))return[];switch(a.role){case"admin":case"council":return[{id:"all_drivers",name:"All Drivers",role:"driver"},{id:"all_mechanics",name:"All Mechanics",role:"mechanic"},{id:"all_parents",name:"All Parents",role:"parent"},{id:"all_admins",name:"All Administrators",role:"admin"}];case"driver":return[{id:"all_admins",name:"All Administrators",role:"admin"},{id:"all_mechanics",name:"All Mechanics",role:"mechanic"},{id:"all_parents",name:"All Parents",role:"parent"}];case"parent":return[{id:"all_drivers",name:"All Drivers",role:"driver"},{id:"all_admins",name:"All Administrators",role:"admin"}];case"mechanic":return[{id:"all_admins",name:"All Administrators",role:"admin"},{id:"all_drivers",name:"All Drivers",role:"driver"}];default:return[]}},ee=[{id:"safety_alert",name:"Safety Alert",title:"Safety Alert - Immediate Action Required",body:"Please review and acknowledge this safety alert. Your immediate attention is required.",type:"warning",priority:"high",category:"safety"},{id:"schedule_change",name:"Schedule Change",title:"Schedule Update",body:"There has been a change to your schedule. Please review the updated details.",type:"info",priority:"normal",category:"schedule"},{id:"maintenance_reminder",name:"Maintenance Reminder",title:"Vehicle Maintenance Due",body:"Your vehicle is due for maintenance. Please schedule an appointment.",type:"warning",priority:"normal",category:"maintenance"},{id:"emergency_notice",name:"Emergency Notice",title:"EMERGENCY - Immediate Response Required",body:"This is an emergency notification requiring immediate attention.",type:"error",priority:"emergency",category:"emergency"}],se=()=>{h({recipientType:"specific",recipientId:"",recipientRole:"",title:"",body:"",type:"info",priority:"normal",category:"general",channels:["in_app"],scheduledFor:"",isScheduled:!1})},ae=s=>{h(n=>u(x({},n),{title:s.title,body:s.body,type:s.type,priority:s.priority,category:s.category}))},re=()=>q(void 0,null,function*(){if(!r.title.trim()||!r.body.trim()){t({title:"Validation Error",description:"Please fill in all required fields.",variant:"destructive"});return}const s={recipientType:r.recipientType,recipientId:r.recipientId,recipientRole:r.recipientRole,title:r.title,body:r.body,type:r.type,priority:r.priority,category:r.category,channels:r.channels,scheduledFor:r.scheduledFor,isScheduled:r.isScheduled};yield A.mutateAsync(s),m(!1),se()}),k=s=>{switch(s){case"success":return e.jsx(_e,{className:"w-4 h-4 text-green-600"});case"warning":return e.jsx(J,{className:"w-4 h-4 text-yellow-600"});case"error":return e.jsx(J,{className:"w-4 h-4 text-red-600"});default:return e.jsx(Ae,{className:"w-4 h-4 text-blue-600"})}},D=s=>{switch(s){case"emergency":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"normal":return"bg-blue-100 text-blue-800";case"low":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},I=s=>{switch(s){case"emergency":return"bg-red-50 border-red-200";case"safety":return"bg-yellow-50 border-yellow-200";case"maintenance":return"bg-orange-50 border-orange-200";case"schedule":return"bg-blue-50 border-blue-200";default:return"bg-gray-50 border-gray-200"}},E=L.filter(s=>{const n=s.title.toLowerCase().includes(c.toLowerCase())||s.body.toLowerCase().includes(c.toLowerCase()),_=o==="all"||s.type===o,R=g==="all"||s.priority===g;return n&&_&&R}),F=M.filter(s=>{const n=s.title.toLowerCase().includes(c.toLowerCase())||s.body.toLowerCase().includes(c.toLowerCase()),_=o==="all"||s.type===o,R=g==="all"||s.priority===g;return n&&_&&R});return!i||!a?null:e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-background border-b",children:e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(U,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-xl font-semibold",children:"Notifications"}),P>0&&e.jsxs(j,{variant:"destructive",className:"text-xs",children:[P," new"]})]}),e.jsxs(N,{size:"sm",onClick:()=>m(!0),className:"h-9 px-3",children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"New"]})]})}),e.jsxs("div",{className:"p-4 space-y-3 border-b bg-muted/30",children:[e.jsx(B,{placeholder:"Search notifications...",value:c,onChange:s=>d(s.target.value),className:"h-10"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(v,{value:o,onValueChange:W,children:[e.jsx(f,{className:"h-9 text-sm",children:e.jsx(b,{placeholder:"Type"})}),e.jsxs(w,{children:[e.jsx(l,{value:"all",children:"All Types"}),e.jsx(l,{value:"info",children:"Info"}),e.jsx(l,{value:"warning",children:"Warning"}),e.jsx(l,{value:"success",children:"Success"}),e.jsx(l,{value:"error",children:"Error"})]})]}),e.jsxs(v,{value:g,onValueChange:K,children:[e.jsx(f,{className:"h-9 text-sm",children:e.jsx(b,{placeholder:"Priority"})}),e.jsxs(w,{children:[e.jsx(l,{value:"all",children:"All Priority"}),e.jsx(l,{value:"low",children:"Low"}),e.jsx(l,{value:"normal",children:"Normal"}),e.jsx(l,{value:"high",children:"High"}),e.jsx(l,{value:"emergency",children:"Emergency"})]})]})]})]}),e.jsxs(ye,{value:S,onValueChange:T,className:"flex-1",children:[e.jsxs(je,{className:"grid w-full grid-cols-2 rounded-none",children:[e.jsxs($,{value:"received",className:"rounded-none",children:["Received (",M.length,")"]}),e.jsxs($,{value:"sent",className:"rounded-none",children:["Sent (",L.length,")"]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx(z,{value:"received",className:"m-0 space-y-3",children:F.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(U,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No notifications"}),e.jsx("p",{className:"text-sm",children:"You're all caught up!"})]}):F.map(s=>e.jsx(Y,{className:`${I(s.category)} ${s.read_at?"":"ring-2 ring-blue-200"} cursor-pointer`,onClick:()=>{s.read_at||X.mutate(s.id)},children:e.jsx(O,{className:"p-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[k(s.type),e.jsx("h4",{className:"font-medium text-base",children:s.title}),e.jsx(j,{className:`${D(s.priority)} text-xs`,children:s.priority}),!s.read_at&&e.jsx(j,{variant:"secondary",className:"bg-blue-100 text-blue-800 text-xs",children:"New"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.body}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:["From: ",s.sender_name]}),e.jsx("span",{children:Q(new Date(s.created_at),"MMM dd, HH:mm")})]})]})})})},s.id))}),e.jsx(z,{value:"sent",className:"m-0 space-y-3",children:E.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(G,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No sent notifications"}),e.jsx("p",{className:"text-sm",children:"Start sending messages to your team!"})]}):E.map(s=>e.jsx(Y,{className:`${I(s.category)}`,children:e.jsx(O,{className:"p-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[k(s.type),e.jsx("h4",{className:"font-medium text-base",children:s.title}),e.jsx(j,{className:`${D(s.priority)} text-xs`,children:s.priority})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.body}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:["To: ",s.recipient_role||"Specific User"]}),e.jsx("span",{children:Q(new Date(s.created_at),"MMM dd, HH:mm")})]})]})})})},s.id))})]})]}),e.jsx(Ne,{open:C,onOpenChange:m,children:e.jsxs(ve,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(fe,{children:[e.jsx(be,{children:"Send Message"}),e.jsx(we,{children:"Send a notification to your team."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Quick Templates"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:ee.map(s=>e.jsxs(N,{variant:"outline",size:"sm",className:"h-auto p-3 text-left",onClick:()=>ae(s),children:[e.jsx("div",{className:"text-sm font-medium",children:s.name}),e.jsx("div",{className:"text-xs text-muted-foreground truncate",children:s.title})]},s.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Send to"}),e.jsxs(v,{value:r.recipientRole,onValueChange:s=>h(n=>u(x({},n),{recipientRole:s,recipientType:"role"})),children:[e.jsx(f,{children:e.jsx(b,{placeholder:"Select recipients"})}),e.jsx(w,{children:Z().map(s=>e.jsx(l,{value:s.role,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Title"}),e.jsx(B,{value:r.title,onChange:s=>h(n=>u(x({},n),{title:s.target.value})),placeholder:"Enter message title..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Message"}),e.jsx(Ce,{value:r.body,onChange:s=>h(n=>u(x({},n),{body:s.target.value})),placeholder:"Enter your message...",rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Priority"}),e.jsxs(v,{value:r.priority,onValueChange:s=>h(n=>u(x({},n),{priority:s})),children:[e.jsx(f,{children:e.jsx(b,{})}),e.jsxs(w,{children:[e.jsx(l,{value:"low",children:"Low"}),e.jsx(l,{value:"normal",children:"Normal"}),e.jsx(l,{value:"high",children:"High"}),e.jsx(l,{value:"emergency",children:"Emergency"})]})]})]}),e.jsxs("div",{className:"flex space-x-2 pt-4",children:[e.jsx(N,{variant:"outline",onClick:()=>m(!1),className:"flex-1",children:"Cancel"}),e.jsx(N,{onClick:re,disabled:A.isPending||!r.body.trim()||!r.recipientRole,className:"flex-1",children:A.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Send"]})})]})]})]})})]})};export{Be as default};
