var j=(m,n,r)=>new Promise((o,i)=>{var h=t=>{try{a(r.next(t))}catch(d){i(d)}},c=t=>{try{a(r.throw(t))}catch(d){i(d)}},a=t=>t.done?o(t.value):Promise.resolve(t.value).then(h,c);a((r=r.apply(m,n)).next())});import{j as e}from"./ui-vendor-DMUr7mTx.js";import{r as g}from"./react-vendor-BvqlMsL5.js";import{u as S,l as D,f as T,ah as _,ar as F,C as k,a as I,b as P,c as A,D as E,F as L,B as x,m as z,n as B,o as G,p as H,L as p,S as $,q as O,r as R,t as V,v as l,T as q,G as J,d as X,e as Y}from"./index-ZwIgorfy.js";import{a0 as f,G as y,ao as K,J as N}from"./icons-vendor-b0I7fGSL.js";import{f as Q}from"./utils-vendor-B2FlkASS.js";import"./supabase-vendor-B984m0TI.js";import"./query-vendor-B2F_wWlc.js";import"./router-vendor-CEyBJ8vK.js";import"./ui-components-7w1-MJre.js";const ie=()=>{S();const{toast:m}=D(),[n,r]=g.useState(""),[o,i]=g.useState("general"),[h,c]=g.useState(!1),a=T(),{data:t=[],isLoading:d,refetch:b}=_(),u=F(),v=()=>j(void 0,null,function*(){if(n.trim())try{yield u.mutateAsync({message_type:o,message:n,priority:"normal"}),m({title:"Message sent successfully",description:"Your message has been sent to the driver."}),r(""),i("general"),c(!1),b()}catch(s){m({title:"Failed to send message",description:"There was an error sending your message. Please try again.",variant:"destructive"})}}),w=s=>{switch(s){case"delay":return"bg-orange-100 text-orange-800";case"incident":return"bg-red-100 text-red-800";case"absence":return"bg-yellow-100 text-yellow-800";case"emergency":return"bg-red-100 text-red-800";default:return"bg-blue-100 text-blue-800"}},C=s=>{switch(s){case"delay":return"Delay";case"incident":return"Incident";case"absence":return"Absence";case"emergency":return"Emergency";case"pickup":return"Pickup Change";default:return"General"}},M=s=>{switch(s){case"read":return e.jsx(N,{className:"w-4 h-4 text-green-500"});case"delivered":return e.jsx(N,{className:"w-4 h-4 text-blue-500"});case"sent":return e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"});case"failed":return e.jsx(K,{className:"w-4 h-4 text-red-500"});default:return e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"})}};return e.jsxs(k,{children:[e.jsx(I,{className:a?"pb-3":"",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(P,{className:`flex items-center space-x-2 ${a?"text-lg":""}`,children:[e.jsx(f,{className:`${a?"w-4 h-4":"w-5 h-5"}`}),e.jsx("span",{children:"Communication Center"})]}),e.jsx(A,{className:a?"text-sm":"",children:"Messages with your child's driver"})]}),e.jsxs(E,{open:h,onOpenChange:c,children:[e.jsx(L,{asChild:!0,children:e.jsxs(x,{size:a?"sm":"default",className:a?"text-xs":"",children:[e.jsx(y,{className:`${a?"w-3 h-3 mr-1":"w-4 h-4 mr-2"}`}),a?"New":"New Message"]})}),e.jsxs(z,{className:a?"w-[95vw] max-w-none mx-2":"",children:[e.jsxs(B,{children:[e.jsx(G,{className:a?"text-lg":"",children:"Send Message to Driver"}),e.jsx(H,{className:a?"text-sm":"",children:"Communicate with your child's driver about transport matters"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"messageType",className:a?"text-sm":"",children:"Message Type"}),e.jsxs($,{value:o,onValueChange:i,children:[e.jsx(O,{className:a?"h-12":"",children:e.jsx(R,{})}),e.jsxs(V,{className:"bg-white",children:[e.jsx(l,{value:"general",children:"General Information"}),e.jsx(l,{value:"absence",children:"Student Absence"}),e.jsx(l,{value:"pickup",children:"Pickup Change"}),e.jsx(l,{value:"delay",children:"Delay Notification"}),e.jsx(l,{value:"incident",children:"Incident Report"}),e.jsx(l,{value:"emergency",children:"Emergency"})]})]})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"message",className:a?"text-sm":"",children:"Message"}),e.jsx(q,{id:"message",placeholder:"Enter your message here...",value:n,onChange:s=>r(s.target.value),className:a?"min-h-[100px]":"min-h-[120px]"})]})]}),e.jsxs(J,{children:[e.jsx(x,{variant:"outline",onClick:()=>c(!1),size:a?"sm":"default",children:"Cancel"}),e.jsx(x,{onClick:v,disabled:!n.trim()||u.isPending,size:a?"sm":"default",children:u.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:`${a?"w-3 h-3 mr-1":"w-4 h-4 mr-2"}`}),"Send Message"]})})]})]})]})]})}),e.jsx(X,{children:d?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})}):t.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(f,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No communications yet"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Start a conversation with your child's driver"})]}):e.jsxs("div",{className:"space-y-4",children:[t.slice(0,10).map(s=>e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Y,{className:w(s.message_type),children:C(s.message_type)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:Q(new Date(s.sent_at),"MMM dd, yyyy HH:mm")})]}),s.subject&&e.jsx("h4",{className:"font-medium mb-1",children:s.subject}),e.jsx("p",{className:"text-sm text-gray-600",children:s.message}),s.child_profiles&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Re: ",s.child_profiles.first_name," ",s.child_profiles.last_name]}),s.profiles&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["From: ",s.profiles.first_name," ",s.profiles.last_name]})]}),e.jsx("div",{className:"flex items-center space-x-1 ml-4",children:M(s.status)})]})},s.id)),t.length>10&&e.jsx("div",{className:"text-center pt-4",children:e.jsxs(x,{variant:"outline",size:"sm",children:["View All Messages (",t.length,")"]})})]})})]})};export{ie as default};
