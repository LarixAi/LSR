var N=(a,c,n)=>new Promise((h,s)=>{var l=t=>{try{i(n.next(t))}catch(r){s(r)}},d=t=>{try{i(n.throw(t))}catch(r){s(r)}},i=t=>t.done?h(t.value):Promise.resolve(t.value).then(l,d);i((n=n.apply(a,c)).next())});import{j as e}from"./ui-vendor-DMUr7mTx.js";import{u as _,s as x,C as j,a as u,b as g,c as v,d as f,e as y}from"./index-ZwIgorfy.js";import{u as b}from"./query-vendor-B2F_wWlc.js";import{M as m,j as w,U as C,$ as R}from"./icons-vendor-b0I7fGSL.js";import"./react-vendor-BvqlMsL5.js";import"./supabase-vendor-B984m0TI.js";import"./utils-vendor-B2FlkASS.js";import"./router-vendor-CEyBJ8vK.js";import"./ui-components-7w1-MJre.js";const F=()=>{const{user:a}=_(),{data:c,isLoading:n,error:h}=b({queryKey:["active-routes-tracking",a==null?void 0:a.id],queryFn:()=>N(void 0,null,function*(){if(!(a!=null&&a.id))return[];console.log("Fetching active routes for tracking");const s=new Date().toISOString().split("T")[0],{data:l,error:d}=yield x.from("route_assignments").select("*").eq("assignment_date",s).eq("status","active").eq("is_active",!0);if(d)throw console.error("Error fetching route assignments:",d),d;const i=[];if(l&&l.length>0)for(const t of l){const{data:r}=yield x.from("routes").select("name, start_location, end_location").eq("id",t.route_id).single(),{data:o}=yield x.from("profiles").select("first_name, last_name, phone").eq("id",t.driver_id).single(),{data:p}=yield x.from("vehicles").select("vehicle_number, license_plate").eq("id",t.vehicle_id).single();r&&o&&p&&i.push({id:t.id,status:t.status||"active",assignment_date:t.assignment_date,start_time:t.start_time||"N/A",end_time:t.end_time||"N/A",route_name:r.name,start_location:r.start_location,end_location:r.end_location,driver_name:`${o.first_name||"Unknown"} ${o.last_name||"Driver"}`,driver_phone:o.phone,vehicle_number:p.vehicle_number,license_plate:p.license_plate})}return console.log("Active routes found:",i.length),i}),enabled:!!(a!=null&&a.id)});return n?e.jsxs(j,{children:[e.jsxs(u,{children:[e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(m,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{children:"Live Route Tracking"})]}),e.jsx(v,{children:"Currently active transport routes"})]}),e.jsx(f,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading active routes..."})]})})]}):h?e.jsxs(j,{children:[e.jsxs(u,{children:[e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(m,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{children:"Live Route Tracking"})]}),e.jsx(v,{children:"Currently active transport routes"})]}),e.jsx(f,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-red-600 mb-2",children:"Error loading routes"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Please try again later"})]})})]}):e.jsxs(j,{children:[e.jsxs(u,{children:[e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(m,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{children:"Live Route Tracking"})]}),e.jsx(v,{children:"Currently active transport routes"})]}),e.jsx(f,{children:c&&c.length>0?e.jsx("div",{className:"space-y-4",children:c.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 bg-gradient-to-r from-green-50 to-blue-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold text-lg",children:s.route_name}),e.jsx(y,{className:"bg-green-500 text-white",children:e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),e.jsx("span",{children:"Live"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(m,{className:"w-5 h-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Route"}),e.jsxs("p",{className:"text-gray-600 text-sm",children:[s.start_location," â†’ ",s.end_location]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(w,{className:"w-5 h-5 text-purple-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Time"}),e.jsxs("p",{className:"text-gray-600 text-sm",children:[s.start_time," - ",s.end_time]})]})]})]}),e.jsxs("div",{className:"border-t pt-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Driver:"}),e.jsx("span",{className:"text-sm text-gray-600",children:s.driver_name})]}),s.driver_phone&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(R,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:s.driver_phone})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Vehicle:"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[s.vehicle_number," (",s.license_plate,")"]})]})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(m,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Active Routes"}),e.jsx("p",{className:"text-gray-600",children:"There are currently no active transport routes."})]})})]})};export{F as default};
