var he=Object.defineProperty,xe=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var U=(a,n,r)=>n in a?he(a,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[n]=r,i=(a,n)=>{for(var r in n||(n={}))V.call(n,r)&&U(a,r,n[r]);if(T)for(var r of T(n))K.call(n,r)&&U(a,r,n[r]);return a},l=(a,n)=>xe(a,ue(n));var R=(a,n)=>{var r={};for(var o in a)V.call(a,o)&&n.indexOf(o)<0&&(r[o]=a[o]);if(a!=null&&T)for(var o of T(a))n.indexOf(o)<0&&K.call(a,o)&&(r[o]=a[o]);return r};var v=(a,n,r)=>new Promise((o,j)=>{var g=u=>{try{N(r.next(u))}catch(A){j(A)}},y=u=>{try{N(r.throw(u))}catch(A){j(A)}},N=u=>u.done?o(u.value):Promise.resolve(u.value).then(g,y);N((r=r.apply(a,n)).next())});import{j as e}from"./ui-vendor-DMUr7mTx.js";import{r as C}from"./react-vendor-BvqlMsL5.js";import{u as B,s as D,l as me,D as Y,F as je,B as f,m as J,n as $,o as G,p as W,L as d,I as x,S as w,q as F,r as S,t as q,v as h,T as X,C as _,d as p,a as ge,b as ve,c as _e,e as Z}from"./index-ZwIgorfy.js";import{u as pe,a as M,b as H}from"./query-vendor-B2F_wWlc.js";import{T as ye,a as fe,b as ee,c as b,d as Ne,e as k}from"./table-6WL4qh3Z.js";import{N as Ce}from"./router-vendor-CEyBJ8vK.js";import{E as be,f as ke,J as Ae,j as Pe,k as we,T as Fe,az as Se,$ as qe,M as ze,ak as Te,aF as De}from"./icons-vendor-b0I7fGSL.js";import"./supabase-vendor-B984m0TI.js";import"./utils-vendor-B2FlkASS.js";import"./ui-components-7w1-MJre.js";const Ee=()=>{const{profile:a}=B();return pe({queryKey:["personal-assistants",a==null?void 0:a.organization_id],queryFn:()=>v(void 0,null,function*(){if(!(a!=null&&a.organization_id))throw new Error("Organization ID is required");const{data:n,error:r}=yield D.from("personal_assistants").select("*").eq("organization_id",a.organization_id).order("last_name",{ascending:!0});if(r)throw r;return n||[]}),enabled:!!(a!=null&&a.organization_id)})},Le=()=>{const a=M(),{profile:n}=B();return H({mutationFn:r=>v(void 0,null,function*(){if(!(n!=null&&n.organization_id))throw new Error("Organization ID is required");const{data:o,error:j}=yield D.from("personal_assistants").insert(l(i({},r),{organization_id:n.organization_id})).select().single();if(j)throw j;return o}),onSuccess:()=>{a.invalidateQueries({queryKey:["personal-assistants"]})}})},Ie=()=>{const a=M();return H({mutationFn:o=>v(void 0,null,function*(){var j=o,{id:n}=j,r=R(j,["id"]);const{data:g,error:y}=yield D.from("personal_assistants").update(r).eq("id",n).select().single();if(y)throw y;return g}),onSuccess:n=>{a.invalidateQueries({queryKey:["personal-assistants"]}),a.invalidateQueries({queryKey:["personal-assistant",n.id]})}})},Oe=()=>{const a=M();return H({mutationFn:n=>v(void 0,null,function*(){const{error:r}=yield D.from("personal_assistants").delete().eq("id",n);if(r)throw r}),onSuccess:()=>{a.invalidateQueries({queryKey:["personal-assistants"]})}})},Ge=()=>{const{profile:a}=B(),{toast:n}=me(),[r,o]=C.useState(!1),[j,g]=C.useState(!1),[y,N]=C.useState(null),[u,A]=C.useState(""),[E,se]=C.useState("all"),[t,c]=C.useState({first_name:"",last_name:"",email:"",phone:"",date_of_birth:"",address:"",emergency_contact_name:"",emergency_contact_phone:"",emergency_contact_relationship:"",qualifications:[],certifications:[],experience_years:0,specializations:[],hourly_rate:0,status:"active",background_check_status:"pending",notes:""}),{data:m=[],isLoading:ae}=Ee(),L=Le(),I=Ie(),te=Oe();if(!["admin","council"].includes((a==null?void 0:a.role)||""))return e.jsx(Ce,{to:"/dashboard",replace:!0});const Q=m.filter(s=>{const z=s.first_name.toLowerCase().includes(u.toLowerCase())||s.last_name.toLowerCase().includes(u.toLowerCase())||s.email.toLowerCase().includes(u.toLowerCase()),oe=E==="all"||s.status===E;return z&&oe}),P={total:m.length,active:m.filter(s=>s.status==="active").length,inactive:m.filter(s=>s.status==="inactive").length,onLeave:m.filter(s=>s.status==="on_leave").length,backgroundCheckPassed:m.filter(s=>s.background_check_status==="passed").length,backgroundCheckPending:m.filter(s=>s.background_check_status==="pending").length},ne=()=>v(void 0,null,function*(){try{yield L.mutateAsync(l(i({},t),{organization_id:a==null?void 0:a.organization_id})),n({title:"Success",description:"Personal Assistant created successfully"}),o(!1),O()}catch(s){n({title:"Error",description:"Failed to create Personal Assistant",variant:"destructive"})}}),re=()=>v(void 0,null,function*(){if(y)try{yield I.mutateAsync(i({id:y.id},t)),n({title:"Success",description:"Personal Assistant updated successfully"}),g(!1),N(null),O()}catch(s){n({title:"Error",description:"Failed to update Personal Assistant",variant:"destructive"})}}),ie=s=>v(void 0,null,function*(){if(confirm("Are you sure you want to delete this Personal Assistant?"))try{yield te.mutateAsync(s),n({title:"Success",description:"Personal Assistant deleted successfully"})}catch(z){n({title:"Error",description:"Failed to delete Personal Assistant",variant:"destructive"})}}),le=s=>{N(s),c({first_name:s.first_name,last_name:s.last_name,email:s.email,phone:s.phone||"",date_of_birth:s.date_of_birth||"",address:s.address||"",emergency_contact_name:s.emergency_contact_name||"",emergency_contact_phone:s.emergency_contact_phone||"",emergency_contact_relationship:s.emergency_contact_relationship||"",qualifications:s.qualifications||[],certifications:s.certifications||[],experience_years:s.experience_years,specializations:s.specializations||[],hourly_rate:s.hourly_rate||0,status:s.status,background_check_status:s.background_check_status,notes:s.notes||""}),g(!0)},O=()=>{c({first_name:"",last_name:"",email:"",phone:"",date_of_birth:"",address:"",emergency_contact_name:"",emergency_contact_phone:"",emergency_contact_relationship:"",qualifications:[],certifications:[],experience_years:0,specializations:[],hourly_rate:0,status:"active",background_check_status:"pending",notes:""})},ce=s=>{switch(s){case"active":return"bg-green-100 text-green-800";case"inactive":return"bg-gray-100 text-gray-800";case"on_leave":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},de=s=>{switch(s){case"passed":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return ae?e.jsx("div",{className:"container mx-auto p-6",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-lg",children:"Loading Personal Assistants..."})})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Personal Assistants"}),e.jsx("p",{className:"text-gray-600",children:"Manage Personal Assistants for school routes"})]}),e.jsxs(Y,{open:r,onOpenChange:o,children:[e.jsx(je,{asChild:!0,children:e.jsxs(f,{onClick:()=>O(),children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Add Personal Assistant"]})}),e.jsxs(J,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs($,{children:[e.jsx(G,{children:"Add Personal Assistant"}),e.jsx(W,{children:"Add a new Personal Assistant to your organization"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"first_name",children:"First Name *"}),e.jsx(x,{id:"first_name",value:t.first_name,onChange:s=>c(l(i({},t),{first_name:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"last_name",children:"Last Name *"}),e.jsx(x,{id:"last_name",value:t.last_name,onChange:s=>c(l(i({},t),{last_name:s.target.value}))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"email",children:"Email *"}),e.jsx(x,{id:"email",type:"email",value:t.email,onChange:s=>c(l(i({},t),{email:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"phone",children:"Phone"}),e.jsx(x,{id:"phone",value:t.phone,onChange:s=>c(l(i({},t),{phone:s.target.value}))})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"address",children:"Address"}),e.jsx(x,{id:"address",value:t.address,onChange:s=>c(l(i({},t),{address:s.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"experience_years",children:"Years of Experience"}),e.jsx(x,{id:"experience_years",type:"number",value:t.experience_years,onChange:s=>c(l(i({},t),{experience_years:parseInt(s.target.value)||0}))})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"hourly_rate",children:"Hourly Rate (£)"}),e.jsx(x,{id:"hourly_rate",type:"number",step:"0.01",value:t.hourly_rate,onChange:s=>c(l(i({},t),{hourly_rate:parseFloat(s.target.value)||0}))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"status",children:"Status"}),e.jsxs(w,{value:t.status,onValueChange:s=>c(l(i({},t),{status:s})),children:[e.jsx(F,{children:e.jsx(S,{})}),e.jsxs(q,{children:[e.jsx(h,{value:"active",children:"Active"}),e.jsx(h,{value:"inactive",children:"Inactive"}),e.jsx(h,{value:"on_leave",children:"On Leave"})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"background_check_status",children:"Background Check"}),e.jsxs(w,{value:t.background_check_status,onValueChange:s=>c(l(i({},t),{background_check_status:s})),children:[e.jsx(F,{children:e.jsx(S,{})}),e.jsxs(q,{children:[e.jsx(h,{value:"pending",children:"Pending"}),e.jsx(h,{value:"passed",children:"Passed"}),e.jsx(h,{value:"failed",children:"Failed"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"notes",children:"Notes"}),e.jsx(X,{id:"notes",value:t.notes,onChange:s=>c(l(i({},t),{notes:s.target.value}))})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(f,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(f,{onClick:ne,disabled:L.isPending,children:L.isPending?"Creating...":"Create"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsx(_,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ke,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold",children:P.total})]})]})})}),e.jsx(_,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ae,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Active"}),e.jsx("p",{className:"text-2xl font-bold",children:P.active})]})]})})}),e.jsx(_,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"On Leave"}),e.jsx("p",{className:"text-2xl font-bold",children:P.onLeave})]})]})})}),e.jsx(_,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(we,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Background Check Passed"}),e.jsx("p",{className:"text-2xl font-bold",children:P.backgroundCheckPassed})]})]})})}),e.jsx(_,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Fe,{className:"w-4 h-4 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Background Check Pending"}),e.jsx("p",{className:"text-2xl font-bold",children:P.backgroundCheckPending})]})]})})}),e.jsx(_,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Se,{className:"w-4 h-4 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Average Experience"}),e.jsxs("p",{className:"text-2xl font-bold",children:[m.length>0?Math.round(m.reduce((s,z)=>s+z.experience_years,0)/m.length):0,"y"]})]})]})})})]}),e.jsx(_,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(d,{htmlFor:"search",children:"Search"}),e.jsx(x,{id:"search",placeholder:"Search by name or email...",value:u,onChange:s=>A(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"status-filter",children:"Status"}),e.jsxs(w,{value:E,onValueChange:se,children:[e.jsx(F,{className:"w-32",children:e.jsx(S,{})}),e.jsxs(q,{children:[e.jsx(h,{value:"all",children:"All"}),e.jsx(h,{value:"active",children:"Active"}),e.jsx(h,{value:"inactive",children:"Inactive"}),e.jsx(h,{value:"on_leave",children:"On Leave"})]})]})]})]})})}),e.jsxs(_,{children:[e.jsxs(ge,{children:[e.jsx(ve,{children:"Personal Assistants"}),e.jsxs(_e,{children:[Q.length," of ",m.length," Personal Assistants"]})]}),e.jsx(p,{children:e.jsxs(ye,{children:[e.jsx(fe,{children:e.jsxs(ee,{children:[e.jsx(b,{children:"Name"}),e.jsx(b,{children:"Contact"}),e.jsx(b,{children:"Experience"}),e.jsx(b,{children:"Status"}),e.jsx(b,{children:"Background Check"}),e.jsx(b,{children:"Actions"})]})}),e.jsx(Ne,{children:Q.map(s=>e.jsxs(ee,{children:[e.jsx(k,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.first_name," ",s.last_name]}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-1",children:[s.phone&&e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(qe,{className:"w-3 h-3 mr-1"}),s.phone]}),s.address&&e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(ze,{className:"w-3 h-3 mr-1"}),s.address]})]})}),e.jsx(k,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.experience_years," years"]}),s.hourly_rate>0&&e.jsxs("div",{className:"text-sm text-gray-500",children:["£",s.hourly_rate,"/hr"]})]})}),e.jsx(k,{children:e.jsx(Z,{className:ce(s.status),children:s.status.replace("_"," ")})}),e.jsx(k,{children:e.jsx(Z,{className:de(s.background_check_status),children:s.background_check_status})}),e.jsx(k,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(f,{variant:"outline",size:"sm",onClick:()=>le(s),children:e.jsx(Te,{className:"w-4 h-4"})}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>ie(s.id),children:e.jsx(De,{className:"w-4 h-4"})})]})})]},s.id))})]})})]}),e.jsx(Y,{open:j,onOpenChange:g,children:e.jsxs(J,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs($,{children:[e.jsx(G,{children:"Edit Personal Assistant"}),e.jsx(W,{children:"Update Personal Assistant information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit_first_name",children:"First Name *"}),e.jsx(x,{id:"edit_first_name",value:t.first_name,onChange:s=>c(l(i({},t),{first_name:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit_last_name",children:"Last Name *"}),e.jsx(x,{id:"edit_last_name",value:t.last_name,onChange:s=>c(l(i({},t),{last_name:s.target.value}))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit_email",children:"Email *"}),e.jsx(x,{id:"edit_email",type:"email",value:t.email,onChange:s=>c(l(i({},t),{email:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit_phone",children:"Phone"}),e.jsx(x,{id:"edit_phone",value:t.phone,onChange:s=>c(l(i({},t),{phone:s.target.value}))})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit_address",children:"Address"}),e.jsx(x,{id:"edit_address",value:t.address,onChange:s=>c(l(i({},t),{address:s.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit_experience_years",children:"Years of Experience"}),e.jsx(x,{id:"edit_experience_years",type:"number",value:t.experience_years,onChange:s=>c(l(i({},t),{experience_years:parseInt(s.target.value)||0}))})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit_hourly_rate",children:"Hourly Rate (£)"}),e.jsx(x,{id:"edit_hourly_rate",type:"number",step:"0.01",value:t.hourly_rate,onChange:s=>c(l(i({},t),{hourly_rate:parseFloat(s.target.value)||0}))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit_status",children:"Status"}),e.jsxs(w,{value:t.status,onValueChange:s=>c(l(i({},t),{status:s})),children:[e.jsx(F,{children:e.jsx(S,{})}),e.jsxs(q,{children:[e.jsx(h,{value:"active",children:"Active"}),e.jsx(h,{value:"inactive",children:"Inactive"}),e.jsx(h,{value:"on_leave",children:"On Leave"})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit_background_check_status",children:"Background Check"}),e.jsxs(w,{value:t.background_check_status,onValueChange:s=>c(l(i({},t),{background_check_status:s})),children:[e.jsx(F,{children:e.jsx(S,{})}),e.jsxs(q,{children:[e.jsx(h,{value:"pending",children:"Pending"}),e.jsx(h,{value:"passed",children:"Passed"}),e.jsx(h,{value:"failed",children:"Failed"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit_notes",children:"Notes"}),e.jsx(X,{id:"edit_notes",value:t.notes,onChange:s=>c(l(i({},t),{notes:s.target.value}))})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(f,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(f,{onClick:re,disabled:I.isPending,children:I.isPending?"Updating...":"Update"})]})]})]})})]})};export{Ge as default};
