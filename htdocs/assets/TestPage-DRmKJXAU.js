var E=(n,i,t)=>new Promise((c,o)=>{var r=l=>{try{x(t.next(l))}catch(a){o(a)}},m=l=>{try{x(t.throw(l))}catch(a){o(a)}},x=l=>l.done?c(l.value):Promise.resolve(l.value).then(r,m);x((t=t.apply(n,i)).next())});import{j as s}from"./ui-vendor-DMUr7mTx.js";import{r as T}from"./react-vendor-BvqlMsL5.js";import{u as S,C as j,a as g,b as f,c as N,d as w,B as A,A as C,g as F,s as p,l as P}from"./index-ZwIgorfy.js";import{J as h,V as R,ao as u}from"./icons-vendor-b0I7fGSL.js";import"./supabase-vendor-B984m0TI.js";import"./utils-vendor-B2FlkASS.js";import"./query-vendor-B2F_wWlc.js";import"./router-vendor-CEyBJ8vK.js";import"./ui-components-7w1-MJre.js";const _=()=>{const[n,i]=T.useState(!1),[t,c]=T.useState(null),[o,r]=T.useState(""),{user:m,profile:x}=S(),l=()=>E(void 0,null,function*(){i(!0),r(""),c(null);const a={supabase:!1,edgeFunctions:!1,database:!1,auth:!1};try{console.log("Testing Supabase connection...");const{data:b,error:v}=yield p.from("profiles").select("count").limit(1);if(v)throw console.error("Supabase connection failed:",v),new Error(`Supabase connection failed: ${v.message}`);a.supabase=!0,console.log("‚úÖ Supabase connection successful"),console.log("Testing database access...");const{data:U,error:y}=yield p.from("profiles").select("id, email").limit(1);if(y)throw console.error("Database access failed:",y),new Error(`Database access failed: ${y.message}`);if(a.database=!0,console.log("‚úÖ Database access successful"),m){console.log("Testing authentication...");const{data:{user:d},error:e}=yield p.auth.getUser();if(e)throw console.error("Authentication test failed:",e),new Error(`Authentication failed: ${e.message}`);d&&(a.auth=!0,console.log("‚úÖ Authentication successful"))}else console.log("‚ö†Ô∏è No user logged in, skipping auth test");console.log("Testing Edge Functions...");try{const{data:{session:d}}=yield p.auth.getSession();if(d){const e=yield fetch("https://dznbihypzmvcmradijqn.supabase.co/functions/v1/change-user-password",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d.access_token}`},body:JSON.stringify({test:"connection"})});if(e.status===401)a.edgeFunctions=!0,console.log("‚úÖ Edge Functions accessible (401 expected without proper auth)");else if(e.ok)a.edgeFunctions=!0,console.log("‚úÖ Edge Functions working");else throw console.error("Edge Functions test failed:",e.status,e.statusText),new Error(`Edge Functions failed: ${e.status} ${e.statusText}`)}else{console.log("‚ö†Ô∏è No session, testing Edge Functions without auth...");const e=yield fetch("https://dznbihypzmvcmradijqn.supabase.co/functions/v1/change-user-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:"connection"})});if(e.status===401)a.edgeFunctions=!0,console.log("‚úÖ Edge Functions accessible (401 expected without auth)");else throw new Error(`Edge Functions failed: ${e.status} ${e.statusText}`)}}catch(d){throw console.error("Edge Functions test error:",d),new Error(`Edge Functions test failed: ${d.message}`)}c(a),console.log("üéâ All tests completed successfully!")}catch(b){console.error("Test failed:",b),r(b.message||"Unknown error occurred"),c(a)}finally{i(!1)}});return s.jsxs(j,{className:"w-full max-w-md mx-auto",children:[s.jsxs(g,{children:[s.jsxs(f,{className:"flex items-center gap-2",children:[s.jsx(h,{className:"h-5 w-5 text-green-600"}),"Connection Test"]}),s.jsx(N,{children:"Test the connection to Supabase and Edge Functions"})]}),s.jsxs(w,{className:"space-y-4",children:[s.jsx(A,{onClick:l,disabled:n,className:"w-full",children:n?s.jsxs(s.Fragment,{children:[s.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}),"Testing..."]}):"Run Connection Test"}),o&&s.jsxs(C,{variant:"destructive",children:[s.jsx(u,{className:"h-4 w-4"}),s.jsx(F,{children:o})]}),t&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"font-medium",children:"Test Results:"}),s.jsxs("div",{className:"space-y-1 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[t.supabase?s.jsx(h,{className:"h-4 w-4 text-green-600"}):s.jsx(u,{className:"h-4 w-4 text-red-600"}),s.jsx("span",{children:"Supabase Connection"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[t.database?s.jsx(h,{className:"h-4 w-4 text-green-600"}):s.jsx(u,{className:"h-4 w-4 text-red-600"}),s.jsx("span",{children:"Database Access"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[t.auth?s.jsx(h,{className:"h-4 w-4 text-green-600"}):s.jsx(u,{className:"h-4 w-4 text-red-600"}),s.jsx("span",{children:"Authentication"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[t.edgeFunctions?s.jsx(h,{className:"h-4 w-4 text-green-600"}):s.jsx(u,{className:"h-4 w-4 text-red-600"}),s.jsx("span",{children:"Edge Functions"})]})]})]}),m&&s.jsxs("div",{className:"text-xs text-gray-600",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Current User:"})," ",m.email]}),x&&s.jsxs("p",{children:[s.jsx("strong",{children:"Role:"})," ",x.role]})]})]})]})},q=()=>{const{user:n,profile:i,session:t}=S(),{toast:c}=P(),o=()=>E(void 0,null,function*(){if(!n){c({title:"No user logged in",description:"Please log in to test password change",variant:"destructive"});return}try{const{error:r}=yield p.auth.updateUser({password:"TestPassword123!"});c(r?{title:"Password change failed",description:r.message,variant:"destructive"}:{title:"Password change successful",description:"Password was updated successfully"})}catch(r){c({title:"Error",description:r.message,variant:"destructive"})}});return s.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Frontend Test Page"}),s.jsx("p",{className:"text-gray-600",children:"Testing all frontend updates and connections"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsx(_,{}),s.jsxs(j,{children:[s.jsxs(g,{children:[s.jsx(f,{children:"Current Status"}),s.jsx(N,{children:"Authentication and user information"})]}),s.jsxs(w,{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Logged In:"}),s.jsx("span",{className:n?"text-green-600":"text-red-600",children:n?"Yes":"No"})]}),n&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Email:"}),s.jsx("span",{className:"text-sm",children:n.email})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"User ID:"}),s.jsx("span",{className:"text-xs font-mono",children:n.id})]})]}),i&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Role:"}),s.jsx("span",{className:"text-sm",children:i.role})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Name:"}),s.jsxs("span",{className:"text-sm",children:[i.first_name," ",i.last_name]})]}),i.organization_id&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Organization:"}),s.jsx("span",{className:"text-xs font-mono",children:i.organization_id})]})]}),t&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Session Active:"}),s.jsx("span",{className:"text-green-600",children:"Yes"})]})]}),s.jsx(A,{onClick:o,variant:"outline",className:"w-full",children:"Test Password Change"})]})]})]}),s.jsxs(j,{children:[s.jsxs(g,{children:[s.jsx(f,{children:"Environment Information"}),s.jsx(N,{children:"Current configuration and settings"})]}),s.jsx(w,{children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Supabase URL:"}),s.jsx("p",{className:"text-xs font-mono break-all",children:"https://dznbihypzmvcmradijqn.supabase.co"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Current Port:"}),s.jsx("p",{className:"text-xs",children:"3001"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"VITE_SUPABASE_URL:"}),s.jsx("p",{className:"text-xs font-mono text-green-600",children:"‚úÖ Available"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"VITE_SUPABASE_ANON_KEY:"}),s.jsx("p",{className:"text-xs font-mono text-green-600",children:"‚úÖ Available"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"SUPABASE_URL:"}),s.jsx("p",{className:"text-xs font-mono text-green-600",children:"‚úÖ Available"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"SUPABASE_ANON_KEY:"}),s.jsx("p",{className:"text-xs font-mono text-green-600",children:"‚úÖ Available"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"VITE_APP_TYPE:"}),s.jsx("p",{className:"text-xs font-mono text-blue-600",children:"Not set"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"VITE_PLATFORM:"}),s.jsx("p",{className:"text-xs font-mono text-blue-600",children:"Not set"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Edge Functions:"}),s.jsx("p",{className:"text-xs text-green-600",children:"‚úÖ Redeployed and Active"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"CORS Status:"}),s.jsx("p",{className:"text-xs text-yellow-600",children:"‚ö†Ô∏è Needs update in dashboard"})]})]})})]}),s.jsxs(j,{children:[s.jsxs(g,{children:[s.jsx(f,{children:"Next Steps"}),s.jsx(N,{children:"What you need to do to complete the setup"})]}),s.jsx(w,{children:s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-blue-600",children:"1."}),s.jsxs("span",{children:["Update CORS settings in Supabase dashboard to include ",s.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"http://localhost:3001"})]})]}),s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-blue-600",children:"2."}),s.jsx("span",{children:"Run the connection test above to verify everything is working"})]}),s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-blue-600",children:"3."}),s.jsx("span",{children:"Test the password change functionality in your app"})]}),s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-blue-600",children:"4."}),s.jsx("span",{children:"Clear browser cache if you still see CORS errors"})]})]})})]})]})};export{q as default};
