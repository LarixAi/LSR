var Is=Object.defineProperty,As=Object.defineProperties;var Fs=Object.getOwnPropertyDescriptors;var ts=Object.getOwnPropertySymbols;var Ps=Object.prototype.hasOwnProperty,Ls=Object.prototype.propertyIsEnumerable;var as=(n,a,d)=>a in n?Is(n,a,{enumerable:!0,configurable:!0,writable:!0,value:d}):n[a]=d,M=(n,a)=>{for(var d in a||(a={}))Ps.call(a,d)&&as(n,d,a[d]);if(ts)for(var d of ts(a))Ls.call(a,d)&&as(n,d,a[d]);return n},D=(n,a)=>As(n,Fs(a));var O=(n,a,d)=>new Promise((m,y)=>{var w=i=>{try{T(d.next(i))}catch(h){y(h)}},Y=i=>{try{T(d.throw(i))}catch(h){y(h)}},T=i=>i.done?m(i.value):Promise.resolve(i.value).then(w,Y);T((d=d.apply(n,a)).next())});import{j as e}from"./ui-vendor-DMUr7mTx.js";import{r as V}from"./react-vendor-BvqlMsL5.js";import{u as We,s as Ne,J as Ce,M as Ke,C as o,d as x,a as j,b as f,B as g,D as Me,m as De,n as Se,o as Re,p as Pe,L as S,I as ge,S as Ve,q as Ue,r as Xe,t as ze,v as L,T as ie,G as Le,H as Oe,P as re,e as E,f as qs,h as ns,i as rs,j as X,k as z,A as _e,g as Te}from"./index-ZwIgorfy.js";import{T as Ie,a as Ae,b as ne,c as k,d as Fe,e as b}from"./table-6WL4qh3Z.js";import{u as os,a as xs,b as ms,c as hs,d as us,e as js,f as fs,g as gs,h as ps,i as ys,j as Ns,W as ce}from"./useDailyRest-QJ0s7v-K.js";import{u as vs,a as ks,b as bs}from"./query-vendor-B2F_wWlc.js";import{f as p,s as Ye,e as ke,p as W,d as qe}from"./utils-vendor-B2FlkASS.js";import{j as $,Z as me,au as pe,aJ as ye,I as Ys,aK as le,k as Ee,L as xe,aL as ws,J as je,T as fe,E as $e,K as Bs,H as is,g as Ks,Y as He,_ as Hs,ao as Gs,m as Vs,t as Us,O as Ge,aM as ls,F as cs}from"./icons-vendor-b0I7fGSL.js";import{N as ds}from"./router-vendor-CEyBJ8vK.js";import"./supabase-vendor-B984m0TI.js";import"./ui-components-7w1-MJre.js";const ve={FULL_WEEKLY_REST:45,REDUCED_WEEKLY_REST:24,COMPENSATION_REQUIRED:!0,COMPENSATION_PERIOD:3},_s=n=>{const{profile:a}=We(),d=n?p(n,"yyyy-MM-dd"):p(Ye(new Date,{weekStartsOn:1}),"yyyy-MM-dd"),m=n?p(ke(n,{weekStartsOn:1}),"yyyy-MM-dd"):p(ke(new Date,{weekStartsOn:1}),"yyyy-MM-dd");return vs({queryKey:["weekly-rest",a==null?void 0:a.id,d,m],queryFn:()=>O(void 0,null,function*(){if(!(a!=null&&a.id))throw new Error("User profile is required");const{data:y,error:w}=yield Ne.from("weekly_rest").select("*").eq("driver_id",a.id).gte("week_start_date",d).lte("week_end_date",m).order("week_start_date",{ascending:!1});if(w){if(console.error("Error fetching weekly rest:",w),w.code==="PGRST205"||w.code==="42P01")return console.warn("weekly_rest table not found, returning empty data"),[];throw w}return y||[]}),enabled:!!(a!=null&&a.id)})},Xs=()=>{const{profile:n}=We(),a=ks();return bs({mutationFn:d=>O(void 0,null,function*(){if(!(n!=null&&n.id)||!(n!=null&&n.organization_id))throw new Error("User profile and organization information required");const{data:m,error:y}=yield Ne.from("weekly_rest").insert(D(M({},d),{driver_id:n.id,organization_id:n.organization_id})).select().single();if(y)throw y.code==="PGRST205"||y.code==="42P01"?(console.warn("weekly_rest table not found, cannot create weekly rest record"),new Error("Weekly rest table not found. Please ensure the database is properly set up.")):y;return m}),onSuccess:()=>{a.invalidateQueries({queryKey:["weekly-rest"]}),a.invalidateQueries({queryKey:["daily-rest"]}),Ce.success("Weekly rest recorded successfully")},onError:d=>{console.error("Error creating weekly rest:",d),Ce.error("Failed to record weekly rest: "+d.message)}})},Ts=(n,a)=>O(void 0,null,function*(){const d=ke(a,{weekStartsOn:1}),m=p(a,"yyyy-MM-dd"),y=p(d,"yyyy-MM-dd"),{data:w,error:Y}=yield Ne.from("time_entries").select("entry_date, total_hours").eq("driver_id",n).gte("entry_date",m).lte("entry_date",y);Y&&console.warn("Error fetching time entries for weekly rest analysis:",Y);const{data:T,error:i}=yield Ne.from("daily_rest").select("rest_date, duration_hours").eq("driver_id",n).gte("rest_date",m).lte("rest_date",y);i&&(i.code==="PGRST205"||i.code==="42P01")&&console.warn("daily_rest table not found for weekly rest analysis");const{data:h,error:N}=yield Ne.from("weekly_rest").select("*").eq("driver_id",n).gte("week_start_date",m).lte("week_end_date",y).order("week_start_date",{ascending:!1}).limit(1),B=(h==null?void 0:h[0])||null;N&&(N.code==="PGRST205"||N.code==="42P01")&&console.warn("weekly_rest table not found for weekly rest analysis");const v=(w==null?void 0:w.reduce((_,J)=>_+(J.total_hours||0),0))||0,K=(T==null?void 0:T.reduce((_,J)=>_+(J.duration_hours||0),0))||0,l=(B==null?void 0:B.total_rest_hours)||0;let C="missing",Q=!1,I=!1,A;l>=ve.FULL_WEEKLY_REST?(C="full",Q=!0):l>=ve.REDUCED_WEEKLY_REST&&(C="reduced",Q=!0,I=!0,B!=null&&B.compensation_date&&(A=new Date(B.compensation_date)));const q=[],r=[];return v>60?r.push(`Weekly working time (${v}h) exceeds WTD limit (60h)`):v>55&&q.push(`Weekly working time (${v}h) approaching WTD limit (60h)`),C==="missing"?r.push("No weekly rest period recorded"):C==="reduced"&&!I&&q.push("Reduced weekly rest requires compensation"),I&&!A&&q.push("Compensation for reduced weekly rest not scheduled"),{weekStart:a,weekEnd:d,totalWorkHours:v,totalRestHours:K,requiredWeeklyRest:ve.FULL_WEEKLY_REST,actualRestHours:l,restCompliance:Q,restType:C,compensationRequired:I,compensationDate:A,warnings:q,violations:r}}),zs=n=>{const{profile:a}=We();return vs({queryKey:["weekly-rest-analysis",a==null?void 0:a.id,n.toISOString()],queryFn:()=>O(void 0,null,function*(){if(!(a!=null&&a.id))throw new Error("User profile is required");return Ts(a.id,n)}),enabled:!!(a!=null&&a.id)})},Cs=()=>{const{profile:n}=We(),a=ks(),d=Xs();return bs({mutationFn:m=>O(void 0,null,function*(){if(!(n!=null&&n.id))throw new Error("User profile is required");const y=yield Ts(n.id,m),w=ke(m,{weekStartsOn:1}),{data:Y}=yield Ne.from("weekly_rest").select("id").eq("driver_id",n.id).gte("week_start_date",p(m,"yyyy-MM-dd")).lte("week_end_date",p(w,"yyyy-MM-dd")).limit(1);if(Y==null?void 0:Y[0])return{message:"Weekly rest already recorded for this week",analysis:y};let i="full_weekly_rest",h=!1;return y.totalWorkHours>60&&(i="reduced_weekly_rest",h=!0),yield d.mutateAsync({week_start_date:p(m,"yyyy-MM-dd"),week_end_date:p(w,"yyyy-MM-dd"),total_rest_hours:y.actualRestHours||ve.FULL_WEEKLY_REST,rest_type:i,compensation_required:h,notes:"Automatically recorded weekly rest period"}),{message:"Weekly rest recorded successfully",analysis:y}}),onSuccess:m=>{a.invalidateQueries({queryKey:["weekly-rest"]}),a.invalidateQueries({queryKey:["weekly-rest-analysis"]}),a.invalidateQueries({queryKey:["daily-rest"]}),m.message.includes("already recorded")?Ce.info(m.message):Ce.success(m.message)},onError:m=>{console.error("Error auto-recording weekly rest:",m),Ce.error("Failed to auto-record weekly rest: "+m.message)}})},Ms=()=>{const n=Ye(new Date,{weekStartsOn:1});return zs(n)};function $s(){const[n,a]=V.useState(new Date),[d,m]=V.useState(!1),[y,w]=V.useState(!1),[Y,T]=V.useState(""),[i,h]=V.useState({start_date:"",end_date:"",request_type:"annual_leave",reason:"",notes:""}),{data:N,isLoading:B}=os(),{data:v=[],isLoading:K}=xs(),{data:l=[]}=ms();hs();const{analysis:C,limits:Q}=us(n||new Date);_s(n),Ms(),Cs();const I=js(),A=fs(),q=gs(),r=ps(),_=ys(),J=Ns(),R=()=>{if(!(N!=null&&N.clock_in_time)||N.status==="completed")return 0;const t=new Date,[P,ee,se]=N.clock_in_time.split(":").map(Number),Je=new Date(t.getFullYear(),t.getMonth(),t.getDate(),P,ee,se),ue=new Date,Be=qe(ue,Je);if(N.break_start_time&&!N.break_end_time){const[c,Ze,te]=N.break_start_time.split(":").map(Number),s=new Date(t.getFullYear(),t.getMonth(),t.getDate(),c,Ze,te),u=qe(ue,s);return Math.max(0,Be-u)}return Be},be=t=>{const P=Math.floor(t/60),ee=t%60;return`${P.toString().padStart(2,"0")}:${ee.toString().padStart(2,"0")}`},H=()=>O(this,null,function*(){try{let t="Unknown";navigator.geolocation&&navigator.geolocation.getCurrentPosition(P=>{t=`${P.coords.latitude.toFixed(4)}, ${P.coords.longitude.toFixed(4)}`},()=>{}),yield I.mutateAsync(t)}catch(t){console.error("Clock in error:",t)}}),U=()=>O(this,null,function*(){try{let t="Unknown";navigator.geolocation&&navigator.geolocation.getCurrentPosition(se=>{t=`${se.coords.latitude.toFixed(4)}, ${se.coords.longitude.toFixed(4)}`},()=>{}),yield A.mutateAsync(t);const P=Ye(new Date,{weekStartsOn:1}),ee=ke(new Date,{weekStartsOn:1});try{yield J.mutateAsync({startDate:P,endDate:ee})}catch(se){console.error("Error auto-recording rest days:",se)}w(!1),T("")}catch(t){console.error("Clock out error:",t)}}),de=()=>O(this,null,function*(){try{yield q.mutateAsync()}catch(t){console.error("Start break error:",t)}}),oe=()=>O(this,null,function*(){try{yield r.mutateAsync()}catch(t){console.error("End break error:",t)}}),he=()=>O(this,null,function*(){try{yield _.mutateAsync(i),h({start_date:"",end_date:"",request_type:"annual_leave",reason:"",notes:""}),m(!1)}catch(t){console.error("Create time off error:",t)}});if(B||K)return e.jsx(Ke,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading time management..."})]})})});if(!(v.length>0||l.length>0))return e.jsx(Ke,{children:e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Time Management"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Track your work hours and breaks"})]})}),e.jsx(o,{className:"mb-4",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx($,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Time Data"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Your time management is currently empty. This could be because:"}),e.jsxs("div",{className:"text-left space-y-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{children:"You haven't clocked in yet today"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{children:"No time entries have been recorded"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsx("span",{children:"No time off requests submitted"})]})]})]})})}),e.jsxs(o,{className:"mb-4",children:[e.jsx(j,{className:"pb-3",children:e.jsx(f,{className:"text-lg",children:"Get Started"})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs(g,{onClick:H,disabled:I.isPending,className:"w-full h-12",children:[I.isPending?e.jsx(me,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(pe,{className:"w-4 h-4 mr-2"}),I.isPending?"Clocking In...":"Clock In to Start"]}),e.jsxs(g,{onClick:()=>m(!0),variant:"outline",className:"w-full h-12",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Request Time Off"]})]})})]}),e.jsxs(o,{children:[e.jsx(j,{className:"pb-3",children:e.jsxs(f,{className:"flex items-center space-x-2 text-lg",children:[e.jsx(Ys,{className:"w-5 h-5"}),e.jsx("span",{children:"About Time Management"})]})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx($,{className:"w-4 h-4 mt-0.5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Clock In/Out"}),e.jsx("p",{children:"Track your work hours with GPS location"})]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(le,{className:"w-4 h-4 mt-0.5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Break Management"}),e.jsx("p",{children:"Record breaks to comply with WTD regulations"})]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Ee,{className:"w-4 h-4 mt-0.5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"WTD Compliance"}),e.jsx("p",{children:"Monitor your working time directive compliance"})]})]})]})})]}),e.jsx(Me,{open:d,onOpenChange:m,children:e.jsxs(De,{children:[e.jsxs(Se,{children:[e.jsx(Re,{children:"Request Time Off"}),e.jsx(Pe,{children:"Submit a request for time off."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"startDate",children:"Start Date"}),e.jsx(ge,{id:"startDate",type:"date",value:i.start_date,onChange:t=>h(D(M({},i),{start_date:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"endDate",children:"End Date"}),e.jsx(ge,{id:"endDate",type:"date",value:i.end_date,onChange:t=>h(D(M({},i),{end_date:t.target.value}))})]})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"requestType",children:"Request Type"}),e.jsxs(Ve,{value:i.request_type,onValueChange:t=>h(D(M({},i),{request_type:t})),children:[e.jsx(Ue,{children:e.jsx(Xe,{})}),e.jsxs(ze,{children:[e.jsx(L,{value:"annual_leave",children:"Annual Leave"}),e.jsx(L,{value:"sick_leave",children:"Sick Leave"}),e.jsx(L,{value:"personal_leave",children:"Personal Leave"}),e.jsx(L,{value:"bereavement",children:"Bereavement"}),e.jsx(L,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"reason",children:"Reason"}),e.jsx(ie,{id:"reason",value:i.reason,onChange:t=>h(D(M({},i),{reason:t.target.value})),placeholder:"Enter reason for time off request..."})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"notes",children:"Notes"}),e.jsx(ie,{id:"notes",value:i.notes,onChange:t=>h(D(M({},i),{notes:t.target.value})),placeholder:"Additional notes..."})]})]}),e.jsxs(Le,{children:[e.jsx(g,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(g,{onClick:he,disabled:_.isPending,children:_.isPending?"Submitting...":"Submit Request"})]})]})})]})});const we=R(),F=(N==null?void 0:N.clock_in_time)&&N.status!=="completed",Z=(N==null?void 0:N.break_start_time)&&!(N!=null&&N.break_end_time);return e.jsx(Ke,{children:e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Time Management"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Track your work hours and breaks"})]})}),e.jsxs(o,{className:"mb-4",children:[e.jsx(j,{className:"pb-3",children:e.jsxs(f,{className:"flex items-center space-x-2 text-lg",children:[e.jsx($,{className:"w-5 h-5"}),e.jsx("span",{children:"Current Status"})]})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:Oe("w-4 h-4 rounded-full",F?"bg-green-500":"bg-gray-400")}),e.jsx("span",{className:"font-medium",children:F?"Clocked In":"Not Clocked In"})]}),F&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:be(we)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Current Session"})]}),Z&&e.jsxs("div",{className:"flex items-center space-x-2 p-3 bg-blue-50 rounded-lg",children:[e.jsx(le,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-blue-800 font-medium",children:"On Break"})]})]})})]}),e.jsxs(o,{className:"mb-4",children:[e.jsx(j,{className:"pb-3",children:e.jsx(f,{className:"text-lg",children:"Quick Actions"})}),e.jsx(x,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(g,{onClick:F?()=>w(!0):H,disabled:I.isPending||A.isPending,variant:F?"destructive":"default",className:"h-12",children:[I.isPending||A.isPending?e.jsx(me,{className:"w-4 h-4 animate-spin"}):F?e.jsx(xe,{className:"w-4 h-4"}):e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:F?"Clock Out":"Clock In"})]}),e.jsxs(g,{onClick:Z?oe:de,disabled:!F||q.isPending||r.isPending,variant:"outline",className:"h-12",children:[q.isPending||r.isPending?e.jsx(me,{className:"w-4 h-4 animate-spin"}):Z?e.jsx(ws,{className:"w-4 h-4"}):e.jsx(le,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:Z?"End Break":"Start Break"})]})]})})]}),C&&e.jsxs(o,{className:"mb-4",children:[e.jsx(j,{className:"pb-3",children:e.jsxs(f,{className:"flex items-center space-x-2 text-lg",children:[e.jsx(Ee,{className:"w-5 h-5"}),e.jsx("span",{children:"WTD Compliance"})]})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Daily Working Time"}),e.jsxs("span",{children:[C.dailyWorkingTime.toFixed(1),"h / ",ce.MAX_DAILY_WORKING_TIME,"h"]})]}),e.jsx(re,{value:C.dailyWorkingTime/ce.MAX_DAILY_WORKING_TIME*100,className:"h-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Weekly Working Time"}),e.jsxs("span",{children:[C.weeklyWorkingTime.toFixed(1),"h / ",ce.MAX_WEEKLY_WORKING_TIME,"h"]})]}),e.jsx(re,{value:C.weeklyWorkingTime/ce.MAX_WEEKLY_WORKING_TIME*100,className:"h-2"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[C.overallCompliance?e.jsx(je,{className:"w-4 h-4 text-green-600"}):e.jsx(fe,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:Oe("text-sm font-medium",C.overallCompliance?"text-green-600":"text-red-600"),children:C.overallCompliance?"Compliant":"Non-Compliant"})]})]})})]}),e.jsxs(o,{className:"mb-4",children:[e.jsx(j,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(f,{className:"text-lg",children:"Time Off Requests"}),e.jsxs(g,{onClick:()=>m(!0),size:"sm",variant:"outline",children:[e.jsx($e,{className:"w-4 h-4 mr-1"}),"Request"]})]})}),e.jsx(x,{children:l.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(ye,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"No time off requests"})]}):e.jsx("div",{className:"space-y-2",children:l.slice(0,3).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:t.request_type.replace("_"," ")}),e.jsxs("p",{className:"text-xs text-gray-600",children:[p(W(t.start_date),"MMM dd")," - ",p(W(t.end_date),"MMM dd")]})]}),e.jsx(E,{variant:t.status==="approved"?"default":t.status==="pending"?"secondary":"destructive",children:t.status})]},t.id))})})]}),e.jsxs(o,{children:[e.jsx(j,{className:"pb-3",children:e.jsx(f,{className:"text-lg",children:"Recent Entries"})}),e.jsx(x,{children:v.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx($,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"No time entries"})]}):e.jsx("div",{className:"space-y-2",children:v.slice(0,5).map(t=>{var P;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:p(W(t.entry_date),"MMM dd, yyyy")}),e.jsxs("p",{className:"text-xs text-gray-600",children:[t.clock_in_time," - ",t.clock_out_time||"Active"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium text-sm",children:[((P=t.total_hours)==null?void 0:P.toFixed(1))||"0.0","h"]}),e.jsx(E,{variant:"outline",className:"text-xs",children:t.status})]})]},t.id)})})})]}),e.jsx(Me,{open:y,onOpenChange:w,children:e.jsxs(De,{children:[e.jsxs(Se,{children:[e.jsx(Re,{children:"Sign Off"}),e.jsx(Pe,{children:"Please provide a reason for signing off early."})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(S,{htmlFor:"signOffReason",children:"Reason"}),e.jsx(ie,{id:"signOffReason",value:Y,onChange:t=>T(t.target.value),placeholder:"Enter reason for early sign off..."})]})}),e.jsxs(Le,{children:[e.jsx(g,{variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsx(g,{onClick:U,disabled:A.isPending,children:A.isPending?"Signing Off...":"Sign Off"})]})]})}),e.jsx(Me,{open:d,onOpenChange:m,children:e.jsxs(De,{children:[e.jsxs(Se,{children:[e.jsx(Re,{children:"Request Time Off"}),e.jsx(Pe,{children:"Submit a request for time off."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"startDate",children:"Start Date"}),e.jsx(ge,{id:"startDate",type:"date",value:i.start_date,onChange:t=>h(D(M({},i),{start_date:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"endDate",children:"End Date"}),e.jsx(ge,{id:"endDate",type:"date",value:i.end_date,onChange:t=>h(D(M({},i),{end_date:t.target.value}))})]})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"requestType",children:"Request Type"}),e.jsxs(Ve,{value:i.request_type,onValueChange:t=>h(D(M({},i),{request_type:t})),children:[e.jsx(Ue,{children:e.jsx(Xe,{})}),e.jsxs(ze,{children:[e.jsx(L,{value:"annual_leave",children:"Annual Leave"}),e.jsx(L,{value:"sick_leave",children:"Sick Leave"}),e.jsx(L,{value:"personal_leave",children:"Personal Leave"}),e.jsx(L,{value:"bereavement",children:"Bereavement"}),e.jsx(L,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"reason",children:"Reason"}),e.jsx(ie,{id:"reason",value:i.reason,onChange:t=>h(D(M({},i),{reason:t.target.value})),placeholder:"Enter reason for time off request..."})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"notes",children:"Notes"}),e.jsx(ie,{id:"notes",value:i.notes,onChange:t=>h(D(M({},i),{notes:t.target.value})),placeholder:"Additional notes..."})]})]}),e.jsxs(Le,{children:[e.jsx(g,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(g,{onClick:he,disabled:_.isPending,children:_.isPending?"Submitting...":"Submit Request"})]})]})})]})})}function dt(){const{user:n,profile:a,loading:d}=We(),m=qs(),[y,w]=V.useState(new Date),[Y,T]=V.useState(!1),[i,h]=V.useState(!1),[N,B]=V.useState(""),[v,K]=V.useState({start_date:"",end_date:"",request_type:"annual_leave",reason:"",notes:""}),{data:l,isLoading:C}=os(),{data:Q=[],isLoading:I}=xs(),{data:A=[]}=ms(),q=hs(),{analysis:r,limits:_}=us(y||new Date),{data:J=[]}=_s(y),{data:R}=Ms(),be=Cs(),H=js(),U=fs(),de=gs(),oe=ps(),he=ys(),Qe=Ns();if(d||C||I)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading time management..."})]})});if(!n||!a)return e.jsx(ds,{to:"/auth",replace:!0});if(a.role!=="driver")return e.jsx(ds,{to:"/dashboard",replace:!0});if(m)return e.jsx($s,{});const we=()=>{if(!(l!=null&&l.clock_in_time)||l.status==="completed")return 0;const s=new Date,[u,G,ae]=l.clock_in_time.split(":").map(Number),Ds=new Date(s.getFullYear(),s.getMonth(),s.getDate(),u,G,ae),es=new Date,ss=qe(es,Ds);if(l.break_start_time&&!l.break_end_time){const[Ss,Rs,Os]=l.break_start_time.split(":").map(Number),Es=new Date(s.getFullYear(),s.getMonth(),s.getDate(),Ss,Rs,Os),Ws=qe(es,Es);return Math.max(0,ss-Ws)}return ss},F=s=>{const u=Math.floor(s/60),G=s%60;return`${u.toString().padStart(2,"0")}:${G.toString().padStart(2,"0")}`},Z=()=>O(this,null,function*(){try{let s="Unknown";navigator.geolocation&&navigator.geolocation.getCurrentPosition(u=>{s=`${u.coords.latitude.toFixed(4)}, ${u.coords.longitude.toFixed(4)}`},()=>{}),yield H.mutateAsync(s)}catch(s){console.error("Clock in error:",s)}}),t=()=>O(this,null,function*(){try{let s="Unknown";navigator.geolocation&&navigator.geolocation.getCurrentPosition(ae=>{s=`${ae.coords.latitude.toFixed(4)}, ${ae.coords.longitude.toFixed(4)}`},()=>{}),yield U.mutateAsync(s);const u=Ye(new Date,{weekStartsOn:1}),G=ke(new Date,{weekStartsOn:1});try{yield Qe.mutateAsync({startDate:u,endDate:G})}catch(ae){console.error("Error auto-recording rest days:",ae)}h(!1),B("")}catch(s){console.error("Clock out error:",s)}}),P=()=>O(this,null,function*(){try{yield de.mutateAsync()}catch(s){console.error("Start break error:",s)}}),ee=()=>O(this,null,function*(){try{yield oe.mutateAsync()}catch(s){console.error("End break error:",s)}}),se=()=>O(this,null,function*(){try{yield he.mutateAsync(v),T(!1),K({start_date:"",end_date:"",request_type:"annual_leave",reason:"",notes:""})}catch(s){console.error("Time off request error:",s)}}),ue=r.criticalViolations.length>0?{status:"critical",color:"text-red-600",bgColor:"bg-red-100"}:r.warnings.length>0?{status:"warning",color:"text-yellow-600",bgColor:"bg-yellow-100"}:{status:"compliant",color:"text-green-600",bgColor:"bg-green-100"},c=l?l.status==="completed"?"signed_off":l.break_start_time&&!l.break_end_time?"on_break":"on_duty":"off_duty",te=(()=>{const s=new Date;return A.filter(u=>{const G=W(u.start_date),ae=W(u.end_date);return G<=s&&ae>=s})})();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Time Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Track your working hours, manage breaks, and submit time off requests"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>window.location.reload(),children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Refresh"]})})]}),e.jsxs(ns,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(rs,{className:"grid w-full grid-cols-4",children:[e.jsx(X,{value:"overview",children:"Overview"}),e.jsx(X,{value:"time-tracking",children:"Time Tracking"}),e.jsx(X,{value:"compliance",children:"WTD Compliance"}),e.jsx(X,{value:"time-off",children:"Time Off"})]}),e.jsxs(z,{value:"overview",className:"space-y-6",children:[e.jsx(o,{className:Oe("border-2",c==="on_duty"&&"border-green-200 bg-green-50",c==="on_break"&&"border-yellow-200 bg-yellow-50",c==="signed_off"&&"border-blue-200 bg-blue-50",c==="off_duty"&&"border-gray-200 bg-gray-50"),children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:Oe("p-3 rounded-full",c==="on_duty"&&"bg-green-100",c==="on_break"&&"bg-yellow-100",c==="signed_off"&&"bg-blue-100",c==="off_duty"&&"bg-gray-100"),children:[c==="on_duty"&&e.jsx(Bs,{className:"w-6 h-6 text-green-600"}),c==="on_break"&&e.jsx(le,{className:"w-6 h-6 text-yellow-600"}),c==="signed_off"&&e.jsx(xe,{className:"w-6 h-6 text-blue-600"}),c==="off_duty"&&e.jsx(is,{className:"w-6 h-6 text-gray-600"})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold",children:[c==="on_duty"&&"Currently On Duty",c==="on_break"&&"Currently On Break",c==="signed_off"&&"Signed Off for the Day",c==="off_duty"&&"Off Duty"]}),e.jsxs("p",{className:"text-muted-foreground",children:[c==="on_duty"&&"You are currently working. Remember to take breaks and monitor your WTD compliance.",c==="on_break"&&"You are currently on break. Take your time to rest properly.",c==="signed_off"&&"You have successfully signed off for the day. Have a good rest!",c==="off_duty"&&'You are not currently on duty. Click "Clock In" to start your work day.']})]})]}),e.jsxs("div",{className:"text-right",children:[c==="on_duty"&&e.jsxs(g,{onClick:()=>h(!0),className:"bg-red-600 hover:bg-red-700",size:"lg",children:[e.jsx(xe,{className:"w-5 h-5 mr-2"}),"Sign Off Work"]}),c==="off_duty"&&e.jsxs(g,{onClick:Z,disabled:H.isPending,className:"bg-green-600 hover:bg-green-700",size:"lg",children:[e.jsx(pe,{className:"w-5 h-5 mr-2"}),H.isPending?"Clocking In...":"Clock In"]})]})]})})}),te.length>0&&e.jsxs(_e,{className:"border-blue-200 bg-blue-50",children:[e.jsx(Ks,{className:"h-4 w-4 text-blue-600"}),e.jsxs(Te,{className:"text-blue-800",children:[e.jsx("strong",{children:"You are currently on approved time off:"})," ",te[0].request_type.replace("_"," "),"from ",p(W(te[0].start_date),"MMM dd")," to ",p(W(te[0].end_date),"MMM dd")]})]}),r.criticalViolations.length>0&&e.jsx(o,{className:"border-red-200 bg-red-50",children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(fe,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-red-900",children:"Working Time Directive Violations"}),e.jsx("ul",{className:"mt-1 text-sm text-red-700",children:r.criticalViolations.map((s,u)=>e.jsxs("li",{children:["• ",s]},u))})]})]})})}),r.warnings.length>0&&r.criticalViolations.length===0&&e.jsx(o,{className:"border-yellow-200 bg-yellow-50",children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(He,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-yellow-900",children:"Working Time Directive Warnings"}),e.jsx("ul",{className:"mt-1 text-sm text-yellow-700",children:r.warnings.map((s,u)=>e.jsxs("li",{children:["• ",s]},u))})]})]})})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(o,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Daily Working Time"}),e.jsx(Ee,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[r.dailyWorkingTime.toFixed(1),"h"]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(re,{value:r.dailyWorkingTime/_.MAX_DAILY_WORKING_TIME*100,className:"flex-1"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[_.MAX_DAILY_WORKING_TIME,"h limit"]})]}),r.dailyWorkingTime>_.MAX_DAILY_WORKING_TIME&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Exceeds limit"})]})]}),e.jsxs(o,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Daily Driving Time"}),e.jsx(Hs,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[r.dailyDrivingTime.toFixed(1),"h"]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(re,{value:r.dailyDrivingTime/_.MAX_DAILY_DRIVING_TIME*100,className:"flex-1"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[_.MAX_DAILY_DRIVING_TIME,"h limit"]})]}),r.dailyDrivingTime>_.MAX_DAILY_DRIVING_TIME&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Exceeds limit"})]})]}),e.jsxs(o,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Weekly Working Time"}),e.jsx(ye,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[r.weeklyWorkingTime.toFixed(1),"h"]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(re,{value:r.weeklyWorkingTime/_.MAX_WEEKLY_WORKING_TIME*100,className:"flex-1"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[_.MAX_WEEKLY_WORKING_TIME,"h limit"]})]}),r.weeklyWorkingTime>_.MAX_WEEKLY_WORKING_TIME&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Exceeds limit"})]})]}),e.jsxs(o,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Compliance Score"}),e.jsx(je,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[r.complianceScore,"%"]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(re,{value:r.complianceScore,className:"flex-1"}),e.jsx(E,{variant:r.overallCompliance?"default":"destructive",children:r.overallCompliance?"Compliant":"Non-Compliant"})]})]})]})]}),e.jsxs(o,{children:[e.jsx(j,{children:e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(le,{className:"w-5 h-5"}),e.jsx("span",{children:"Break Compliance"})]})}),e.jsxs(x,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[r.takenBreaks.toFixed(1),"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Breaks Taken"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[r.requiredBreaks.toFixed(1),"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Breaks Required"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:r.breakCompliance?e.jsx(je,{className:"w-8 h-8 text-green-600 mx-auto"}):e.jsx(Gs,{className:"w-8 h-8 text-red-600 mx-auto"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Compliance Status"})]})]}),r.breakWarnings.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"Break Warnings:"}),e.jsx("ul",{className:"text-sm text-yellow-700",children:r.breakWarnings.map((s,u)=>e.jsxs("li",{children:["• ",s]},u))})]})]})]}),e.jsxs(ns,{defaultValue:"today",className:"space-y-4",children:[e.jsxs(rs,{className:"grid w-full grid-cols-5",children:[e.jsx(X,{value:"today",children:"Today's Work"}),e.jsx(X,{value:"history",children:"History"}),e.jsx(X,{value:"time-off",children:"Time Off"}),e.jsx(X,{value:"weekly-rest",children:"Weekly Rest"}),e.jsx(X,{value:"statistics",children:"Statistics"})]}),e.jsx(z,{value:"today",className:"space-y-4",children:e.jsxs(o,{children:[e.jsx(j,{children:e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx($,{className:"w-5 h-5"}),e.jsx("span",{children:"Current Session"})]})}),e.jsx(x,{children:C?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{children:"Loading current session..."})]}):l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:F(we())}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Current Session"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:l.total_hours?F(l.total_hours*60):"00:00"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Today"})]})]}),e.jsx("div",{className:"flex justify-center space-x-4",children:l.status==="active"?e.jsxs(e.Fragment,{children:[e.jsxs(g,{onClick:()=>h(!0),disabled:U.isPending,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),U.isPending?"Signing Off...":"Sign Off Work"]}),l.break_start_time&&!l.break_end_time?e.jsxs(g,{onClick:ee,disabled:oe.isPending,variant:"outline",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),oe.isPending?"Ending Break...":"End Break"]}):e.jsxs(g,{onClick:P,disabled:de.isPending,variant:"outline",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),de.isPending?"Starting Break...":"Start Break"]})]}):e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-4",children:[e.jsx(je,{className:"w-6 h-6 text-green-600"}),e.jsx("span",{className:"text-lg font-medium text-green-600",children:"Successfully Signed Off"})]}),e.jsx("p",{className:"text-muted-foreground",children:"You have completed your work day. Have a good rest!"})]})}),l.status==="active"&&e.jsx("div",{className:"text-center",children:e.jsx(E,{variant:l.break_start_time&&!l.break_end_time?"secondary":"default",children:l.break_start_time&&!l.break_end_time?"On Break":"Working"})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(is,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"You are off duty"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:'Click "Clock In" to start your work day'}),e.jsxs(g,{onClick:Z,disabled:H.isPending,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),H.isPending?"Clocking In...":"Clock In"]})]})})]})}),e.jsx(z,{value:"history",className:"space-y-4",children:e.jsxs(o,{children:[e.jsx(j,{children:e.jsx(f,{children:"Time Entry History"})}),e.jsx(x,{children:I?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{children:"Loading time entries..."})]}):e.jsxs(Ie,{children:[e.jsx(Ae,{children:e.jsxs(ne,{children:[e.jsx(k,{children:"Date"}),e.jsx(k,{children:"Clock In"}),e.jsx(k,{children:"Clock Out"}),e.jsx(k,{children:"Total Hours"}),e.jsx(k,{children:"Break Time"}),e.jsx(k,{children:"Status"})]})}),e.jsx(Fe,{children:Q.map(s=>{var u,G;return e.jsxs(ne,{children:[e.jsx(b,{children:s.entry_date?p(W(s.entry_date),"MMM dd, yyyy"):"N/A"}),e.jsx(b,{children:s.clock_in_time?s.clock_in_time:"-"}),e.jsx(b,{children:s.clock_out_time?s.clock_out_time:"-"}),e.jsxs(b,{children:[((u=s.total_hours)==null?void 0:u.toFixed(2))||"0.00","h"]}),e.jsxs(b,{children:[((G=s.break_hours)==null?void 0:G.toFixed(2))||"0.00","h"]}),e.jsx(b,{children:e.jsx(E,{variant:s.status==="completed"?"default":"secondary",children:s.status==="completed"?"Signed Off":s.status})})]},s.id)})})]})})]})}),e.jsx(z,{value:"time-off",className:"space-y-4",children:e.jsxs(o,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(f,{children:"Time Off Requests"}),e.jsxs(g,{onClick:()=>T(!0),children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Request Time Off"]})]})}),e.jsx(x,{children:e.jsxs(Ie,{children:[e.jsx(Ae,{children:e.jsxs(ne,{children:[e.jsx(k,{children:"Type"}),e.jsx(k,{children:"Start Date"}),e.jsx(k,{children:"End Date"}),e.jsx(k,{children:"Status"}),e.jsx(k,{children:"Reason"})]})}),e.jsx(Fe,{children:A.map(s=>e.jsxs(ne,{children:[e.jsx(b,{className:"capitalize",children:s.request_type.replace("_"," ")}),e.jsx(b,{children:p(W(s.start_date),"MMM dd, yyyy")}),e.jsx(b,{children:p(W(s.end_date),"MMM dd, yyyy")}),e.jsx(b,{children:e.jsx(E,{variant:s.status==="approved"?"default":s.status==="rejected"?"destructive":"secondary",children:s.status})}),e.jsx(b,{className:"max-w-xs truncate",children:s.reason})]},s.id))})]})})]})}),e.jsx(z,{value:"statistics",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(o,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Total Hours"}),e.jsx($,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[q.totalHours.toFixed(1),"h"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This period"})]})]}),e.jsxs(o,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Overtime"}),e.jsx(Vs,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[q.totalOvertime.toFixed(1),"h"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Extra hours worked"})]})]}),e.jsxs(o,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Break Time"}),e.jsx(le,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[q.totalBreaks.toFixed(1),"h"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total breaks taken"})]})]}),e.jsxs(o,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Average/Day"}),e.jsx(Us,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[q.averageHoursPerDay.toFixed(1),"h"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Daily average"})]})]})]})}),e.jsxs(z,{value:"weekly-rest",className:"space-y-4",children:[R&&e.jsxs(o,{children:[e.jsx(j,{children:e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(Ge,{className:"w-5 h-5"}),e.jsx("span",{children:"Weekly Rest Compliance"}),e.jsx(E,{variant:R.restCompliance?"default":"destructive",children:R.restCompliance?"Compliant":"Non-Compliant"})]})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[R.actualRestHours.toFixed(1),"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Actual Rest"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[R.requiredWeeklyRest,"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Required Rest"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[R.totalWorkHours.toFixed(1),"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Work Hours"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Rest Type:"}),e.jsx(E,{variant:"outline",className:"capitalize",children:R.restType.replace("_"," ")})]}),R.compensationRequired&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Compensation Required:"}),e.jsx(E,{variant:"destructive",children:"Yes"})]}),R.compensationDate&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Compensation Date:"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:p(R.compensationDate,"MMM dd, yyyy")})]})]}),R.violations.length>0&&e.jsxs(_e,{className:"border-red-200 bg-red-50",children:[e.jsx(fe,{className:"h-4 w-4 text-red-600"}),e.jsxs(Te,{className:"text-red-800",children:[e.jsx("strong",{children:"Violations:"})," ",R.violations.join(", ")]})]}),R.warnings.length>0&&e.jsxs(_e,{className:"border-yellow-200 bg-yellow-50",children:[e.jsx(He,{className:"h-4 w-4 text-yellow-600"}),e.jsxs(Te,{className:"text-yellow-800",children:[e.jsx("strong",{children:"Warnings:"})," ",R.warnings.join(", ")]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(g,{onClick:()=>be.mutate(y||new Date),disabled:be.isPending,className:"flex-1",children:be.isPending?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"w-4 h-4 mr-2 animate-spin"}),"Recording..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"w-4 h-4 mr-2"}),"Record Weekly Rest"]})})})]})})]}),e.jsxs(o,{children:[e.jsx(j,{children:e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(ye,{className:"w-5 h-5"}),e.jsx("span",{children:"Weekly Rest History"})]})}),e.jsx(x,{children:J.length>0?e.jsx("div",{className:"space-y-4",children:J.map(s=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"font-medium",children:["Week of ",p(new Date(s.week_start_date),"MMM dd, yyyy")]}),e.jsx(E,{variant:"outline",className:"capitalize",children:s.rest_type.replace("_"," ")})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.total_rest_hours,"h rest"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Period:"}),e.jsxs("div",{children:[p(new Date(s.week_start_date),"MMM dd")," - ",p(new Date(s.week_end_date),"MMM dd, yyyy")]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Compensation:"}),e.jsx("div",{children:s.compensation_required?e.jsx(E,{variant:"destructive",className:"text-xs",children:"Required"}):e.jsx(E,{variant:"default",className:"text-xs",children:"Not Required"})})]})]}),s.notes&&e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",s.notes]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ge,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No weekly rest records found"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:'Click "Record Weekly Rest" to create your first rest record'})]})})]}),e.jsxs(o,{children:[e.jsx(j,{children:e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(Ee,{className:"w-5 h-5"}),e.jsx("span",{children:"WTD Weekly Rest Requirements"})]})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Full Weekly Rest"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[ve.FULL_WEEKLY_REST,"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Minimum uninterrupted rest"})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Reduced Weekly Rest"}),e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[ve.REDUCED_WEEKLY_REST,"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Once per week maximum"})]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Important Information"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"• Weekly rest must be taken every 6 x 24-hour periods"}),e.jsx("li",{children:"• Reduced rest requires compensation within 3 weeks"}),e.jsx("li",{children:"• Rest periods must be uninterrupted"}),e.jsx("li",{children:"• Compliance is monitored automatically"})]})]})]})})]})]})]}),e.jsx(Me,{open:i,onOpenChange:h,children:e.jsxs(De,{children:[e.jsxs(Se,{children:[e.jsxs(Re,{className:"flex items-center space-x-2",children:[e.jsx(xe,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{children:"Sign Off Work"})]}),e.jsx(Pe,{children:"You are about to sign off work for the day. This action will record your end time and complete your work session."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(ls,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900",children:"Session Summary"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Current Session:"}),e.jsx("div",{className:"font-semibold text-blue-900",children:F(we())})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Total Today:"}),e.jsx("div",{className:"font-semibold text-blue-900",children:l!=null&&l.total_hours?F(l.total_hours*60):"00:00"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"sign-off-reason",children:"End of Day Notes (Optional)"}),e.jsx(ie,{id:"sign-off-reason",placeholder:"Any notes about your work day, issues encountered, or important information...",value:N,onChange:s=>B(s.target.value),rows:3})]})]}),e.jsxs(Le,{children:[e.jsx(g,{variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsxs(g,{onClick:t,disabled:U.isPending,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),U.isPending?"Signing Off...":"Confirm Sign Off"]})]})]})}),e.jsx(Me,{open:Y,onOpenChange:T,children:e.jsxs(De,{children:[e.jsx(Se,{children:e.jsx(Re,{children:"Request Time Off"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"start-date",children:"Start Date"}),e.jsx(ge,{id:"start-date",type:"date",value:v.start_date,onChange:s=>K(D(M({},v),{start_date:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"end-date",children:"End Date"}),e.jsx(ge,{id:"end-date",type:"date",value:v.end_date,onChange:s=>K(D(M({},v),{end_date:s.target.value}))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"request-type",children:"Request Type"}),e.jsxs(Ve,{value:v.request_type,onValueChange:s=>K(D(M({},v),{request_type:s})),children:[e.jsx(Ue,{children:e.jsx(Xe,{})}),e.jsxs(ze,{children:[e.jsx(L,{value:"annual_leave",children:"Annual Leave"}),e.jsx(L,{value:"sick_leave",children:"Sick Leave"}),e.jsx(L,{value:"personal_leave",children:"Personal Leave"}),e.jsx(L,{value:"bereavement",children:"Bereavement"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"reason",children:"Reason"}),e.jsx(ie,{id:"reason",placeholder:"Please provide a reason for your time off request...",value:v.reason,onChange:s=>K(D(M({},v),{reason:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"notes",children:"Additional Notes"}),e.jsx(ie,{id:"notes",placeholder:"Any additional information...",value:v.notes,onChange:s=>K(D(M({},v),{notes:s.target.value}))})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(g,{variant:"outline",onClick:()=>T(!1),children:"Cancel"}),e.jsx(g,{onClick:se,disabled:he.isPending,children:he.isPending?"Submitting...":"Submit Request"})]})]})]})})]}),e.jsxs(z,{value:"time-tracking",className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(o,{children:[e.jsx(j,{children:e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx($,{className:"w-5 h-5"}),e.jsx("span",{children:"Quick Actions"})]})}),e.jsx(x,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(g,{onClick:c==="on_duty"?()=>h(!0):Z,disabled:H.isPending||U.isPending,variant:c==="on_duty"?"destructive":"default",className:"h-12",children:[H.isPending||U.isPending?e.jsx(me,{className:"w-4 h-4 animate-spin"}):c==="on_duty"?e.jsx(xe,{className:"w-4 h-4"}):e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:c==="on_duty"?"Clock Out":"Clock In"})]}),e.jsxs(g,{onClick:c==="on_break"?ee:P,disabled:c!=="on_duty"||de.isPending||oe.isPending,variant:"outline",className:"h-12",children:[de.isPending||oe.isPending?e.jsx(me,{className:"w-4 h-4 animate-spin"}):c==="on_break"?e.jsx(ws,{className:"w-4 h-4"}):e.jsx(le,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:c==="on_break"?"End Break":"Start Break"})]})]})})]}),e.jsxs(o,{children:[e.jsx(j,{children:e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(ls,{className:"w-5 h-5"}),e.jsx("span",{children:"Current Session"})]})}),e.jsxs(x,{children:[c==="on_duty"&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:F(we())}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Current Session Time"})]}),c!=="on_duty"&&e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx($,{className:"w-8 h-8 mx-auto mb-2"}),e.jsx("p",{children:"Not currently working"})]})]})]})]}),e.jsxs(o,{children:[e.jsx(j,{children:e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(cs,{className:"w-5 h-5"}),e.jsx("span",{children:"Recent Time Entries"})]})}),e.jsx(x,{children:Q.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx($,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No time entries found"})]}):e.jsxs(Ie,{children:[e.jsx(Ae,{children:e.jsxs(ne,{children:[e.jsx(k,{children:"Date"}),e.jsx(k,{children:"Clock In"}),e.jsx(k,{children:"Clock Out"}),e.jsx(k,{children:"Total Hours"}),e.jsx(k,{children:"Status"})]})}),e.jsx(Fe,{children:Q.slice(0,10).map(s=>{var u;return e.jsxs(ne,{children:[e.jsx(b,{children:p(W(s.entry_date),"MMM dd, yyyy")}),e.jsx(b,{children:s.clock_in_time}),e.jsx(b,{children:s.clock_out_time||"Active"}),e.jsxs(b,{children:[((u=s.total_hours)==null?void 0:u.toFixed(1))||"0.0","h"]}),e.jsx(b,{children:e.jsx(E,{variant:s.status==="completed"?"default":"secondary",children:s.status})})]},s.id)})})]})})]})]}),e.jsx(z,{value:"compliance",className:"space-y-6",children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(o,{children:[e.jsx(j,{children:e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(Ee,{className:"w-5 h-5"}),e.jsx("span",{children:"WTD Compliance Status"})]})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[ue.status==="compliant"?e.jsx(je,{className:"w-5 h-5 text-green-600"}):e.jsx(fe,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:Oe("font-medium",ue.color),children:ue.status==="compliant"?"Compliant":"Non-Compliant"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Daily Working Time"}),e.jsxs("span",{children:[r.dailyWorkingTime.toFixed(1),"h / ",ce.MAX_DAILY_WORKING_TIME,"h"]})]}),e.jsx(re,{value:r.dailyWorkingTime/ce.MAX_DAILY_WORKING_TIME*100,className:"h-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Weekly Working Time"}),e.jsxs("span",{children:[r.weeklyWorkingTime.toFixed(1),"h / ",ce.MAX_WEEKLY_WORKING_TIME,"h"]})]}),e.jsx(re,{value:r.weeklyWorkingTime/ce.MAX_WEEKLY_WORKING_TIME*100,className:"h-2"})]})]})]})})]}),e.jsxs(o,{children:[e.jsx(j,{children:e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(fe,{className:"w-5 h-5"}),e.jsx("span",{children:"Warnings & Violations"})]})}),e.jsx(x,{children:r.criticalViolations.length===0&&r.warnings.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(je,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),e.jsx("p",{className:"text-green-600 font-medium",children:"No violations or warnings"})]}):e.jsxs("div",{className:"space-y-3",children:[r.criticalViolations.map((s,u)=>e.jsxs(_e,{variant:"destructive",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsx(Te,{children:s})]},u)),r.warnings.map((s,u)=>e.jsxs(_e,{children:[e.jsx(He,{className:"w-4 h-4"}),e.jsx(Te,{children:s})]},u))]})})]})]})}),e.jsxs(z,{value:"time-off",className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Time Off Management"}),e.jsxs(g,{onClick:()=>T(!0),children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Request Time Off"]})]}),te.length>0&&e.jsxs(o,{children:[e.jsx(j,{children:e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(ye,{className:"w-5 h-5"}),e.jsx("span",{children:"Current Time Off"})]})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-3",children:te.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.request_type.replace("_"," ")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[p(W(s.start_date),"MMM dd")," - ",p(W(s.end_date),"MMM dd")]})]}),e.jsx(E,{variant:"default",children:"Active"})]},s.id))})})]}),e.jsxs(o,{children:[e.jsx(j,{children:e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(cs,{className:"w-5 h-5"}),e.jsx("span",{children:"Time Off Requests"})]})}),e.jsx(x,{children:A.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ye,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No time off requests found"})]}):e.jsxs(Ie,{children:[e.jsx(Ae,{children:e.jsxs(ne,{children:[e.jsx(k,{children:"Type"}),e.jsx(k,{children:"Start Date"}),e.jsx(k,{children:"End Date"}),e.jsx(k,{children:"Status"}),e.jsx(k,{children:"Actions"})]})}),e.jsx(Fe,{children:A.map(s=>e.jsxs(ne,{children:[e.jsx(b,{className:"capitalize",children:s.request_type.replace("_"," ")}),e.jsx(b,{children:p(W(s.start_date),"MMM dd, yyyy")}),e.jsx(b,{children:p(W(s.end_date),"MMM dd, yyyy")}),e.jsx(b,{children:e.jsx(E,{variant:s.status==="approved"?"default":s.status==="pending"?"secondary":"destructive",children:s.status})}),e.jsx(b,{children:e.jsx(g,{variant:"outline",size:"sm",children:"View Details"})})]},s.id))})]})})]})]})]})]})}export{dt as default};
