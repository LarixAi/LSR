var re=Object.defineProperty,te=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var B=(n,s,i)=>s in n?re(n,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[s]=i,O=(n,s)=>{for(var i in s||(s={}))ne.call(s,i)&&B(n,i,s[i]);if(V)for(var i of V(s))ae.call(s,i)&&B(n,i,s[i]);return n},H=(n,s)=>te(n,ie(s));var C=(n,s,i)=>new Promise((r,a)=>{var j=o=>{try{m(i.next(o))}catch(l){a(l)}},N=o=>{try{m(i.throw(o))}catch(l){a(l)}},m=o=>o.done?r(o.value):Promise.resolve(o.value).then(j,N);m((i=i.apply(n,s)).next())});import{j as e}from"./ui-vendor-DMUr7mTx.js";import{r as D}from"./react-vendor-BvqlMsL5.js";import{u as A,s as w,D as le,F as ce,B as _,m as de,n as oe,o as he,L as p,I as y,S as I,q as z,r as L,t as R,v as h,C as g,d as v,h as xe,i as je,j as F,k as M,a as q,b as P,e as x}from"./index-ZwIgorfy.js";import{u as Z}from"./query-vendor-B2F_wWlc.js";import{T as Q,a as G,b as T,c,d as K,e as d}from"./table-6WL4qh3Z.js";import{N as U}from"./router-vendor-CEyBJ8vK.js";import{n as W,E as me,s as J,T as ue,j as X,m as ge,a2 as ve,R as pe,J as ye}from"./icons-vendor-b0I7fGSL.js";import"./supabase-vendor-B984m0TI.js";import"./utils-vendor-B2FlkASS.js";import"./ui-components-7w1-MJre.js";const Y=()=>{const{user:n,profile:s}=A();return Z({queryKey:["tire_inventory",s==null?void 0:s.organization_id],queryFn:()=>C(void 0,null,function*(){if(!(s!=null&&s.organization_id))throw new Error("Organization ID is required");console.log("Fetching tire inventory from database...");try{const{data:i,error:r}=yield w.from("tire_inventory").select("*").eq("organization_id",s.organization_id).order("created_at",{ascending:!1});if(r){if(console.error("Error fetching tire inventory:",r),r.code==="42P01"||r.code==="PGRST205")return console.warn("tire_inventory table not found, returning empty data"),[];throw r}return console.log("Fetched tire inventory:",i),i||[]}catch(i){return console.error("Error in useTireInventory:",i),[]}}),enabled:!!(s!=null&&s.organization_id)})},$=()=>{const{user:n,profile:s}=A();return Z({queryKey:["vehicle_tires",s==null?void 0:s.organization_id],queryFn:()=>C(void 0,null,function*(){if(!(s!=null&&s.organization_id))throw new Error("Organization ID is required");console.log("Fetching vehicle tires from database...");try{const{data:i,error:r}=yield w.from("vehicle_tires").select("*").eq("organization_id",s.organization_id).order("created_at",{ascending:!1});if(r){if(console.error("Error fetching vehicle tires:",r),r.code==="42P01"||r.code==="PGRST205")return console.warn("vehicle_tires table not found, returning empty data"),[];throw r}if(!i||i.length===0)return[];const a=i.filter(l=>l.vehicle_id).map(l=>l.vehicle_id),j=i.filter(l=>l.tire_inventory_id).map(l=>l.tire_inventory_id),[N,m]=yield Promise.all([a.length>0?w.from("vehicles").select("id, vehicle_number, make, model").in("id",a):Promise.resolve({data:[],error:null}),j.length>0?w.from("tire_inventory").select("*").in("id",j):Promise.resolve({data:[],error:null})]),o=i.map(l=>{var b,u;const S=(b=N.data)==null?void 0:b.find(f=>f.id===l.vehicle_id),k=(u=m.data)==null?void 0:u.find(f=>f.id===l.tire_inventory_id);return H(O({},l),{vehicle:S||null,tire_inventory:k||null})});return console.log("Fetched vehicle tires with relations:",o),o||[]}catch(i){return console.error("Error in useVehicleTires:",i),[]}}),enabled:!!(s!=null&&s.organization_id)})},Ne=()=>{const{data:n=[]}=Y(),{data:s=[]}=$();return{total_inventory:n.length,low_stock_items:n.filter(r=>r.stock_quantity<=r.minimum_stock).length,total_stock_value:n.reduce((r,a)=>r+(a.cost_per_tire||0)*a.stock_quantity,0),total_installed_tires:s.length,tires_due_inspection:s.filter(r=>r.next_inspection_due?new Date(r.next_inspection_due)<=new Date:!1).length,worn_tires:s.filter(r=>r.status==="worn").length,damaged_tires:s.filter(r=>r.status==="damaged").length,by_position:s.reduce((r,a)=>(r[a.position]=(r[a.position]||0)+1,r),{}),by_status:s.reduce((r,a)=>(r[a.status]=(r[a.status]||0)+1,r),{})}},Le=()=>{const{user:n,profile:s,loading:i}=A(),[r,a]=D.useState(""),[j,N]=D.useState(""),[m,o]=D.useState(!1),{data:l=[],isLoading:S}=Y(),{data:k=[],isLoading:b}=$(),u=Ne();if(i||S||b)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading tire management..."})]})});if(!n||!s)return e.jsx(U,{to:"/auth",replace:!0});if(!["admin","council"].includes(s.role))return e.jsx(U,{to:"/unauthorized",replace:!0});const f=(t,E)=>t<=E?"critical":t<=E*1.5?"low":"good",ee=t=>{switch(t){case"good":return e.jsx(x,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"Good"});case"worn":return e.jsx(x,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"Worn"});case"critical":return e.jsx(x,{className:"bg-red-100 text-red-800 hover:bg-red-100",children:"Replace"});default:return e.jsx(x,{variant:"secondary",children:t})}},se=t=>{switch(t){case"good":return e.jsx(x,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"In Stock"});case"low":return e.jsx(x,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"Low Stock"});case"critical":return e.jsx(x,{className:"bg-red-100 text-red-800 hover:bg-red-100",children:"Critical"});default:return e.jsx(x,{variant:"secondary",children:t})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(W,{className:"w-8 h-8 text-red-600"}),"Tire Management"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage tire inventory and vehicle tire tracking"})]}),e.jsxs(le,{open:m,onOpenChange:o,children:[e.jsx(ce,{asChild:!0,children:e.jsxs(_,{className:"bg-red-600 hover:bg-red-700",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Add Tire Stock"]})}),e.jsxs(de,{className:"max-w-md",children:[e.jsx(oe,{children:e.jsx(he,{children:"Add Tire Stock"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"brand",children:"Brand"}),e.jsx(y,{id:"brand",placeholder:"e.g., Michelin"})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"model",children:"Model"}),e.jsx(y,{id:"model",placeholder:"e.g., XZE"})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"size",children:"Size"}),e.jsx(y,{id:"size",placeholder:"e.g., 295/80R22.5"})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"type",children:"Type"}),e.jsxs(I,{children:[e.jsx(z,{children:e.jsx(L,{placeholder:"Select tire type"})}),e.jsxs(R,{children:[e.jsx(h,{value:"steer",children:"Steer"}),e.jsx(h,{value:"drive",children:"Drive"}),e.jsx(h,{value:"trailer",children:"Trailer"}),e.jsx(h,{value:"all_position",children:"All Position"})]})]})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"quantity",children:"Quantity"}),e.jsx(y,{id:"quantity",type:"number",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"cost",children:"Cost Per Tire"}),e.jsx(y,{id:"cost",type:"number",step:"0.01",placeholder:"0.00"})]}),e.jsx(_,{className:"w-full bg-red-600 hover:bg-red-700",children:"Add to Inventory"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(g,{children:e.jsx(v,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(J,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Stock"}),e.jsx("p",{className:"text-2xl font-bold",children:u.total_inventory})]})]})})}),e.jsx(g,{children:e.jsx(v,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ue,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Low Stock Items"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:u.low_stock_items})]})]})})}),e.jsx(g,{children:e.jsx(v,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"w-8 h-8 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Due for Replacement"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:u.tires_due_inspection})]})]})})}),e.jsx(g,{children:e.jsx(v,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Monthly Cost"}),e.jsxs("p",{className:"text-2xl font-bold",children:["Â£",u.total_stock_value.toLocaleString()]})]})]})})})]}),e.jsxs(xe,{defaultValue:"inventory",className:"space-y-6",children:[e.jsxs(je,{className:"grid w-full grid-cols-3",children:[e.jsx(F,{value:"inventory",children:"Inventory Management"}),e.jsx(F,{value:"vehicle-tires",children:"Vehicle Tires"}),e.jsx(F,{value:"maintenance",children:"Tire Maintenance"})]}),e.jsx(M,{value:"inventory",className:"space-y-4",children:e.jsxs(g,{children:[e.jsxs(q,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5"}),"Tire Inventory"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(y,{placeholder:"Search tires...",value:r,onChange:t=>a(t.target.value),className:"pl-10"})]}),e.jsxs(I,{children:[e.jsx(z,{className:"w-48",children:e.jsx(L,{placeholder:"Filter by type"})}),e.jsxs(R,{children:[e.jsx(h,{value:"all",children:"All Types"}),e.jsx(h,{value:"steer",children:"Steer Tires"}),e.jsx(h,{value:"drive",children:"Drive Tires"}),e.jsx(h,{value:"trailer",children:"Trailer Tires"})]})]})]})]}),e.jsx(v,{children:e.jsxs(Q,{children:[e.jsx(G,{children:e.jsxs(T,{children:[e.jsx(c,{children:"Brand & Model"}),e.jsx(c,{children:"Size"}),e.jsx(c,{children:"Type"}),e.jsx(c,{children:"Stock"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Cost/Unit"}),e.jsx(c,{children:"Supplier"}),e.jsx(c,{children:"Location"})]})}),e.jsx(K,{children:l.map(t=>e.jsxs(T,{children:[e.jsxs(d,{className:"font-medium",children:[t.brand," ",t.model]}),e.jsx(d,{children:t.size}),e.jsx(d,{className:"capitalize",children:t.type}),e.jsxs(d,{children:[t.stockQuantity," / ",t.minimumStock," min"]}),e.jsx(d,{children:se(f(t.stockQuantity,t.minimumStock))}),e.jsxs(d,{children:["Â£",t.costPerTire.toFixed(2)]}),e.jsx(d,{children:t.supplier}),e.jsx(d,{children:t.location})]},t.id))})]})})]})}),e.jsx(M,{value:"vehicle-tires",className:"space-y-4",children:e.jsxs(g,{children:[e.jsxs(q,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5"}),"Vehicle Tire Tracking"]}),e.jsx("div",{className:"flex gap-4",children:e.jsxs(I,{value:j,onValueChange:N,children:[e.jsx(z,{className:"w-48",children:e.jsx(L,{placeholder:"Filter by vehicle"})}),e.jsxs(R,{children:[e.jsx(h,{value:"all",children:"All Vehicles"}),e.jsx(h,{value:"LSR-001",children:"LSR-001"}),e.jsx(h,{value:"LSR-002",children:"LSR-002"}),e.jsx(h,{value:"LSR-003",children:"LSR-003"})]})]})})]}),e.jsx(v,{children:e.jsxs(Q,{children:[e.jsx(G,{children:e.jsxs(T,{children:[e.jsx(c,{children:"Vehicle"}),e.jsx(c,{children:"Position"}),e.jsx(c,{children:"Tire Model"}),e.jsx(c,{children:"Installation Date"}),e.jsx(c,{children:"Tread Depth (mm)"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Next Inspection"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(K,{children:k.map(t=>e.jsxs(T,{children:[e.jsx(d,{className:"font-medium",children:t.vehicleNumber}),e.jsx(d,{children:t.position}),e.jsx(d,{children:t.tireModel}),e.jsx(d,{children:t.installationDate}),e.jsx(d,{children:t.currentTread}),e.jsx(d,{children:ee(t.status)}),e.jsx(d,{children:t.nextInspection}),e.jsx(d,{children:e.jsxs(_,{variant:"outline",size:"sm",children:[e.jsx(pe,{className:"w-4 h-4 mr-1"}),"Replace"]})})]},t.id))})]})})]})}),e.jsx(M,{value:"maintenance",className:"space-y-4",children:e.jsxs(g,{children:[e.jsx(q,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"Tire Maintenance Schedule"]})}),e.jsx(v,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(X,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Maintenance Tracking"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Set up automatic reminders for tire rotations, inspections, and replacements."}),e.jsx(_,{className:"bg-red-600 hover:bg-red-700",children:"Configure Maintenance Schedule"})]})})]})})]})]})};export{Le as default};
