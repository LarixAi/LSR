var le=Object.defineProperty,de=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var U=(s,r,a)=>r in s?le(s,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[r]=a,m=(s,r)=>{for(var a in r||(r={}))he.call(r,a)&&U(s,a,r[a]);if(B)for(var a of B(r))ue.call(r,a)&&U(s,a,r[a]);return s},x=(s,r)=>de(s,oe(r));var N=(s,r,a)=>new Promise((i,t)=>{var d=h=>{try{u(a.next(h))}catch(o){t(o)}},c=h=>{try{u(a.throw(h))}catch(o){t(o)}},u=h=>h.done?i(h.value):Promise.resolve(h.value).then(d,c);u((a=a.apply(s,r)).next())});import{j as e}from"./ui-vendor-DMUr7mTx.js";import{r as v}from"./react-vendor-BvqlMsL5.js";import{u as Q,s as F,l as me,B as _,C,a as T,b as E,d as k,e as q,D,m as V,n as I,o as O,L as j,I as S,S as A,q as L,r as M,t as P,v as f,T as $,E as b}from"./index-ZwIgorfy.js";import{u as H,a as K,b as z}from"./query-vendor-B2F_wWlc.js";import{u as xe}from"./useVehicleCheckQuestions-BCe3ek2l.js";import{E as W,aa as je,ak as Y,aF as G}from"./icons-vendor-b0I7fGSL.js";import"./supabase-vendor-B984m0TI.js";import"./utils-vendor-B2FlkASS.js";import"./router-vendor-CEyBJ8vK.js";import"./ui-components-7w1-MJre.js";const fe=(s,r,a)=>{const{profile:i}=Q();return H({queryKey:["vehicle-check-templates",s,r,a],queryFn:()=>N(void 0,null,function*(){if(!(i!=null&&i.organization_id))return[];try{let t=F.from("vehicle_check_templates").select(`
            *,
            created_by_profile:profiles!vehicle_check_templates_created_by_fkey(
              id,
              first_name,
              last_name
            )
          `).eq("organization_id",i.organization_id).order("created_at",{ascending:!1});const{data:d,error:c}=yield t;if(c)throw console.error("Error fetching vehicle check templates:",c),c;return d||[]}catch(t){throw console.error("Error in useVehicleCheckTemplates:",t),t}}),enabled:!!(i!=null&&i.organization_id),staleTime:5*60*1e3,gcTime:10*60*1e3})},ve=()=>{const{profile:s}=Q(),r=K();return z({mutationFn:a=>N(void 0,null,function*(){var i,t,d,c;if(!(s!=null&&s.organization_id))throw new Error("Organization ID is required");try{const{data:u,error:h}=yield F.from("vehicle_check_templates").insert(x(m({},a),{organization_id:s.organization_id,created_by:s.id,version:a.version||"1.0",is_active:(i=a.is_active)!=null?i:!0,is_default:(t=a.is_default)!=null?t:!1,required_checks:a.required_checks||0,optional_checks:a.optional_checks||0,safety_critical:(d=a.safety_critical)!=null?d:!1,compliance_required:(c=a.compliance_required)!=null?c:!1,compliance_standards:a.compliance_standards||[]})).select().single();if(h)throw console.error("Error creating vehicle check template:",h),h;return u}catch(u){throw console.error("Error in useCreateVehicleCheckTemplate:",u),u}}),onSuccess:()=>{r.invalidateQueries({queryKey:["vehicle-check-templates"]})}})},_e=()=>{const{profile:s}=Q(),r=K();return z({mutationFn:t=>N(void 0,[t],function*({templateId:a,templateData:i}){if(!(s!=null&&s.organization_id))throw new Error("Organization ID is required");try{const{data:d,error:c}=yield F.from("vehicle_check_templates").update(x(m({},i),{updated_at:new Date().toISOString()})).eq("id",a).eq("organization_id",s.organization_id).select().single();if(c)throw console.error("Error updating vehicle check template:",c),c;return d}catch(d){throw console.error("Error in useUpdateVehicleCheckTemplate:",d),d}}),onSuccess:(a,{templateId:i})=>{r.invalidateQueries({queryKey:["vehicle-check-templates"]}),r.invalidateQueries({queryKey:["vehicle-check-template",i]})}})},pe=()=>{const{profile:s}=Q(),r=K();return z({mutationFn:a=>N(void 0,null,function*(){if(!(s!=null&&s.organization_id))throw new Error("Organization ID is required");try{const{error:i}=yield F.from("vehicle_check_templates").delete().eq("id",a).eq("organization_id",s.organization_id);if(i)throw console.error("Error deleting vehicle check template:",i),i;return{success:!0}}catch(i){throw console.error("Error in useDeleteVehicleCheckTemplate:",i),i}}),onSuccess:()=>{r.invalidateQueries({queryKey:["vehicle-check-templates"]})}})},ge=s=>{const{profile:r}=Q();return H({queryKey:["vehicle-check-template-stats",s],queryFn:()=>N(void 0,null,function*(){if(!(r!=null&&r.organization_id))return{total:0,active:0,inactive:0,byCategory:{},defaultTemplates:0};try{const{data:a,error:i}=yield F.from("vehicle_check_templates").select("is_active, category, is_default").eq("organization_id",r.organization_id);if(i)throw console.error("Error fetching vehicle check template stats:",i),i;const t=a||[];return{total:t.length,active:t.filter(c=>c.is_active).length,inactive:t.filter(c=>!c.is_active).length,byCategory:t.reduce((c,u)=>(c[u.category]=(c[u.category]||0)+1,c),{}),defaultTemplates:t.filter(c=>c.is_default).length}}catch(a){throw console.error("Error in useVehicleCheckTemplateStats:",a),a}}),enabled:!!(r!=null&&r.organization_id),staleTime:10*60*1e3,gcTime:15*60*1e3})};function Ve(){const{toast:s}=me(),[r,a]=v.useState(null),[i,t]=v.useState(!1),[d,c]=v.useState(!1),[u,h]=v.useState(null),[o,l]=v.useState(null),{data:J=[],isLoading:X}=fe(),{data:Z=[],isLoading:ee}=xe(r==null?void 0:r.id),{data:w}=ge(),p=ve(),g=_e(),y=pe();v.useEffect(()=>{p.isSuccess&&(t(!1),l(null),s({title:"Template Created",description:"Vehicle check template has been created successfully."}))},[p.isSuccess,s]),v.useEffect(()=>{var n;p.isError&&s({title:"Error",description:`Failed to create template: ${(n=p.error)==null?void 0:n.message}`,variant:"destructive"})},[p.isError,p.error,s]),v.useEffect(()=>{g.isSuccess&&(t(!1),l(null),s({title:"Template Updated",description:"Vehicle check template has been updated successfully."}))},[g.isSuccess,s]),v.useEffect(()=>{var n;g.isError&&s({title:"Error",description:`Failed to update template: ${(n=g.error)==null?void 0:n.message}`,variant:"destructive"})},[g.isError,g.error,s]),v.useEffect(()=>{y.isSuccess&&s({title:"Template Deleted",description:"Vehicle check template has been deleted successfully."})},[y.isSuccess,s]),v.useEffect(()=>{var n;y.isError&&s({title:"Error",description:`Failed to delete template: ${(n=y.error)==null?void 0:n.message}`,variant:"destructive"})},[y.isError,y.error,s]);const R=z({mutationFn:n=>N(this,null,function*(){throw new Error("Vehicle check questions table not yet implemented")}),onSuccess:()=>{c(!1),h(null),s({title:"Question Added",description:"Question has been added to the template."})},onError:n=>{s({title:"Error",description:`Failed to add question: ${n.message}`,variant:"destructive"})}}),se=()=>{l(null),t(!0)},ie=n=>{l(n),t(!0)},re=n=>N(this,null,function*(){confirm("Are you sure you want to delete this template? This action cannot be undone.")&&y.mutate(n)}),te=()=>{h(null),c(!0)},ae=n=>{h(n),c(!0)},ce=n=>{s({title:"Question Deleted",description:"The question has been removed from the template."})},ne=n=>{o?g.mutate({templateId:o.id,templateData:n}):p.mutate(n)};return X?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading templates..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Vehicle Check Templates"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage vehicle inspection templates and questions"})]}),e.jsxs(_,{onClick:se,children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"New Template"]})]}),w&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(C,{children:[e.jsx(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(E,{className:"text-sm font-medium",children:"Total Templates"})}),e.jsx(k,{children:e.jsx("div",{className:"text-2xl font-bold",children:w.total})})]}),e.jsxs(C,{children:[e.jsx(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(E,{className:"text-sm font-medium",children:"Active Templates"})}),e.jsx(k,{children:e.jsx("div",{className:"text-2xl font-bold",children:w.active})})]}),e.jsxs(C,{children:[e.jsx(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(E,{className:"text-sm font-medium",children:"Default Templates"})}),e.jsx(k,{children:e.jsx("div",{className:"text-2xl font-bold",children:w.defaultTemplates})})]}),e.jsxs(C,{children:[e.jsx(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(E,{className:"text-sm font-medium",children:"Categories"})}),e.jsx(k,{children:e.jsx("div",{className:"text-2xl font-bold",children:Object.keys(w.byCategory).length})})]})]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:J.map(n=>e.jsxs(C,{className:"hover:shadow-md transition-shadow",children:[e.jsxs(T,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(E,{className:"text-lg",children:n.name}),e.jsx(q,{variant:n.is_active?"default":"secondary",children:n.is_active?"Active":"Inactive"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n.description}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(q,{variant:"outline",children:n.category}),n.is_default&&e.jsx(q,{variant:"secondary",children:"Default"})]})]}),e.jsxs(k,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Version:"}),e.jsx("span",{className:"font-medium",children:n.version})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Required Checks:"}),e.jsx("span",{className:"font-medium",children:n.required_checks})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Optional Checks:"}),e.jsx("span",{className:"font-medium",children:n.optional_checks})]}),n.estimated_completion_time_minutes&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Est. Time:"}),e.jsxs("span",{className:"font-medium",children:[n.estimated_completion_time_minutes," min"]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>a(n),children:[e.jsx(je,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>ie(n),children:[e.jsx(Y,{className:"w-4 h-4 mr-1"}),"Edit"]}),e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>re(n.id),disabled:y.isPending,children:[e.jsx(G,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]})]},n.id))}),e.jsx(D,{open:i,onOpenChange:t,children:e.jsxs(V,{className:"max-w-2xl",children:[e.jsx(I,{children:e.jsx(O,{children:o?"Edit Template":"Create New Template"})}),e.jsx(ye,{template:o,onSubmit:ne,isLoading:p.isPending||g.isPending})]})}),r&&e.jsx(D,{open:!!r,onOpenChange:()=>a(null),children:e.jsxs(V,{className:"max-w-4xl",children:[e.jsx(I,{children:e.jsxs(O,{children:["Template Questions: ",r.name]})}),e.jsx(Ne,{template:r,questions:Z,isLoading:ee,onAddQuestion:te,onEditQuestion:ae,onDeleteQuestion:ce})]})}),e.jsx(D,{open:d,onOpenChange:c,children:e.jsxs(V,{className:"max-w-2xl",children:[e.jsx(I,{children:e.jsx(O,{children:u?"Edit Question":"Add New Question"})}),e.jsx(Ce,{question:u,templateId:r==null?void 0:r.id,onSubmit:n=>R.mutate(n),isLoading:R.isPending})]})})]})}function ye({template:s,onSubmit:r,isLoading:a}){var c,u,h,o;const[i,t]=v.useState({name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",category:(s==null?void 0:s.category)||"pre_trip",vehicle_types:(s==null?void 0:s.vehicle_types)||[],is_active:(c=s==null?void 0:s.is_active)!=null?c:!0,is_default:(u=s==null?void 0:s.is_default)!=null?u:!1,safety_critical:(h=s==null?void 0:s.safety_critical)!=null?h:!1,compliance_required:(o=s==null?void 0:s.compliance_required)!=null?o:!1,required_checks:(s==null?void 0:s.required_checks)||0,optional_checks:(s==null?void 0:s.optional_checks)||0,estimated_completion_time_minutes:(s==null?void 0:s.estimated_completion_time_minutes)||0,compliance_standards:(s==null?void 0:s.compliance_standards)||[]}),d=l=>{l.preventDefault(),r(i)};return e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"name",children:"Template Name"}),e.jsx(S,{id:"name",value:i.name,onChange:l=>t(x(m({},i),{name:l.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"category",children:"Category"}),e.jsxs(A,{value:i.category,onValueChange:l=>t(x(m({},i),{category:l})),children:[e.jsx(L,{children:e.jsx(M,{})}),e.jsxs(P,{children:[e.jsx(f,{value:"pre_trip",children:"Pre-Trip"}),e.jsx(f,{value:"post_trip",children:"Post-Trip"}),e.jsx(f,{value:"weekly",children:"Weekly"}),e.jsx(f,{value:"monthly",children:"Monthly"}),e.jsx(f,{value:"custom",children:"Custom"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"description",children:"Description"}),e.jsx($,{id:"description",value:i.description,onChange:l=>t(x(m({},i),{description:l.target.value})),rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"required_checks",children:"Required Checks"}),e.jsx(S,{id:"required_checks",type:"number",value:i.required_checks,onChange:l=>t(x(m({},i),{required_checks:parseInt(l.target.value)||0})),min:"0"})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"optional_checks",children:"Optional Checks"}),e.jsx(S,{id:"optional_checks",type:"number",value:i.optional_checks,onChange:l=>t(x(m({},i),{optional_checks:parseInt(l.target.value)||0})),min:"0"})]})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"estimated_time",children:"Estimated Completion Time (minutes)"}),e.jsx(S,{id:"estimated_time",type:"number",value:i.estimated_completion_time_minutes,onChange:l=>t(x(m({},i),{estimated_completion_time_minutes:parseInt(l.target.value)||0})),min:"0"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{id:"is_active",checked:i.is_active,onCheckedChange:l=>t(x(m({},i),{is_active:l}))}),e.jsx(j,{htmlFor:"is_active",children:"Active"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{id:"is_default",checked:i.is_default,onCheckedChange:l=>t(x(m({},i),{is_default:l}))}),e.jsx(j,{htmlFor:"is_default",children:"Default Template"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{id:"safety_critical",checked:i.safety_critical,onCheckedChange:l=>t(x(m({},i),{safety_critical:l}))}),e.jsx(j,{htmlFor:"safety_critical",children:"Safety Critical"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{id:"compliance_required",checked:i.compliance_required,onCheckedChange:l=>t(x(m({},i),{compliance_required:l}))}),e.jsx(j,{htmlFor:"compliance_required",children:"Compliance Required"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(_,{type:"button",variant:"outline",children:"Cancel"}),e.jsx(_,{type:"submit",disabled:a,children:a?"Saving...":s?"Update Template":"Create Template"})]})]})}function Ne({template:s,questions:r,isLoading:a,onAddQuestion:i,onEditQuestion:t,onDeleteQuestion:d}){return a?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading questions..."})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Questions (",r.length,")"]}),e.jsxs(_,{onClick:i,size:"sm",children:[e.jsx(W,{className:"w-4 h-4 mr-1"}),"Add Question"]})]}),r.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No questions added to this template yet."}),e.jsx(_,{onClick:i,className:"mt-2",children:"Add First Question"})]}):e.jsx("div",{className:"space-y-2",children:r.map(c=>e.jsx(C,{children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium",children:c.question_text}),getQuestionTypeBadge(c.question_type),getCategoryBadge(c.category),c.is_required&&e.jsx(q,{variant:"destructive",children:"Required"}),c.is_critical&&e.jsx(q,{variant:"destructive",children:"Critical"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Order: ",c.order_index," | Type: ",c.question_type]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(_,{variant:"outline",size:"sm",onClick:()=>t(c),children:e.jsx(Y,{className:"w-4 h-4"})}),e.jsx(_,{variant:"outline",size:"sm",onClick:()=>d(c.id),children:e.jsx(G,{className:"w-4 h-4"})})]})]})})},c.id))})]})}function Ce({question:s,templateId:r,onSubmit:a,isLoading:i}){var u,h;const[t,d]=v.useState({question_text:(s==null?void 0:s.question_text)||"",question_type:(s==null?void 0:s.question_type)||"yes_no",is_required:(u=s==null?void 0:s.is_required)!=null?u:!1,is_critical:(h=s==null?void 0:s.is_critical)!=null?h:!1,order_index:(s==null?void 0:s.order_index)||1,category:(s==null?void 0:s.category)||"safety",options:(s==null?void 0:s.options)||[]}),c=o=>{o.preventDefault(),r&&a(x(m({},t),{template_id:r}))};return e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"question_text",children:"Question Text"}),e.jsx($,{id:"question_text",value:t.question_text,onChange:o=>d(x(m({},t),{question_text:o.target.value})),required:!0,rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"question_type",children:"Question Type"}),e.jsxs(A,{value:t.question_type,onValueChange:o=>d(x(m({},t),{question_type:o})),children:[e.jsx(L,{children:e.jsx(M,{})}),e.jsxs(P,{children:[e.jsx(f,{value:"yes_no",children:"Yes/No"}),e.jsx(f,{value:"multiple_choice",children:"Multiple Choice"}),e.jsx(f,{value:"text",children:"Text"}),e.jsx(f,{value:"number",children:"Number"})]})]})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"category",children:"Category"}),e.jsxs(A,{value:t.category,onValueChange:o=>d(x(m({},t),{category:o})),children:[e.jsx(L,{children:e.jsx(M,{})}),e.jsxs(P,{children:[e.jsx(f,{value:"exterior",children:"Exterior"}),e.jsx(f,{value:"interior",children:"Interior"}),e.jsx(f,{value:"engine",children:"Engine"}),e.jsx(f,{value:"safety",children:"Safety"}),e.jsx(f,{value:"documentation",children:"Documentation"}),e.jsx(f,{value:"driver",children:"Driver"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"order_index",children:"Order Index"}),e.jsx(S,{id:"order_index",type:"number",value:t.order_index,onChange:o=>d(x(m({},t),{order_index:parseInt(o.target.value)||1})),min:"1"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{id:"is_required",checked:t.is_required,onCheckedChange:o=>d(x(m({},t),{is_required:o}))}),e.jsx(j,{htmlFor:"is_required",children:"Required"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{id:"is_critical",checked:t.is_critical,onCheckedChange:o=>d(x(m({},t),{is_critical:o}))}),e.jsx(j,{htmlFor:"is_critical",children:"Critical"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(_,{type:"button",variant:"outline",children:"Cancel"}),e.jsx(_,{type:"submit",disabled:i||!r,children:i?"Saving...":s?"Update Question":"Add Question"})]})]})}export{Ve as default};
