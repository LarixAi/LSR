var L=(j,_,p)=>new Promise((y,i)=>{var S=r=>{try{g(p.next(r))}catch(a){i(a)}},m=r=>{try{g(p.throw(r))}catch(a){i(a)}},g=r=>r.done?y(r.value):Promise.resolve(r.value).then(S,m);g((p=p.apply(j,_)).next())});import{j as e}from"./ui-vendor-DMUr7mTx.js";import{r as T}from"./react-vendor-BvqlMsL5.js";import{u as Z,l as K,f as O,B as n,C as x,a as f,b as N,d as h,h as Q,i as X,j as E,k as M,c as A,L as P,I as Y,S as ee,q as se,r as te,t as ae,v as w,e as l}from"./index-ZwIgorfy.js";import{T as le,a as ie,b as C,c as u,d as re,e as c}from"./table-6WL4qh3Z.js";import{u as ne}from"./useVehicleChecks-CNNWSOHF.js";import{u as ce}from"./useVehicles-uD3YILF5.js";import{a as de}from"./router-vendor-CEyBJ8vK.js";import{Z as xe,ab as F,E as me,_ as D,J as oe,T as he,j as ue,k as z,a2 as je,aa as H,ak as I}from"./icons-vendor-b0I7fGSL.js";import{f as v}from"./utils-vendor-B2FlkASS.js";import"./supabase-vendor-B984m0TI.js";import"./query-vendor-B2F_wWlc.js";import"./ui-components-7w1-MJre.js";const Ve=()=>{Z();const{toast:j}=K(),_=de();O();const[p,y]=T.useState("new-check"),[i,S]=T.useState(""),[m,g]=T.useState("all"),{data:r=[],isLoading:a,refetch:B}=ne(),{data:R=[],isLoading:V,refetch:q}=ce(),d=r.map(s=>{const t=R.find(W=>W.id===s.vehicle_id),o=s.driver_profile;return{id:s.id,vehicle_id:s.vehicle_id||"",vehicle_number:(t==null?void 0:t.vehicle_number)||"Unknown",license_plate:(t==null?void 0:t.license_plate)||"Unknown",check_date:s.created_at?v(new Date(s.created_at),"yyyy-MM-dd"):"",status:s.status||"pending",issues_found:Array.isArray(s.defects_found)?s.defects_found:Array.isArray(s.issues_found)?s.issues_found:[],notes:s.notes||"",created_at:s.created_at||"",driver_name:o?`${o.first_name} ${o.last_name}`:"Unknown Driver",check_type:s.check_type||"daily"}}),b=d.filter(s=>{const t=s.vehicle_number.toLowerCase().includes(i.toLowerCase())||s.license_plate.toLowerCase().includes(i.toLowerCase())||s.driver_name.toLowerCase().includes(i.toLowerCase()),o=m==="all"||s.status===m;return t&&o}),k=s=>{switch(s){case"completed":return e.jsx(l,{variant:"default",className:"bg-green-100 text-green-800",children:"Completed"});case"pending":return e.jsx(l,{variant:"secondary",children:"Pending"});case"failed":return e.jsx(l,{variant:"destructive",children:"Failed"});default:return e.jsx(l,{variant:"outline",children:s})}},U=s=>{switch(s){case"daily":return e.jsx(l,{variant:"outline",className:"text-blue-600",children:"Daily"});case"weekly":return e.jsx(l,{variant:"outline",className:"text-purple-600",children:"Weekly"});case"comprehensive":return e.jsx(l,{variant:"outline",className:"text-orange-600",children:"Comprehensive"});default:return e.jsx(l,{variant:"outline",children:s})}},$=()=>{y("new-check"),j({title:"New Vehicle Check",description:"Starting new vehicle inspection..."})},G=()=>{const s=b.map(t=>({"Vehicle Number":t.vehicle_number,"License Plate":t.license_plate,Date:t.check_date,Status:t.status,Type:t.check_type,Driver:t.driver_name,Issues:t.issues_found.join(", "),Notes:t.notes}));console.log("Exporting data:",s),j({title:"Export Successful",description:"Vehicle check data exported to CSV"})},J=()=>L(void 0,null,function*(){try{yield Promise.all([B(),q()]),j({title:"Data Refreshed",description:"Vehicle checks and vehicles data updated"})}catch(s){j({title:"Refresh Failed",description:"Failed to refresh data. Please try again.",variant:"destructive"})}});return e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsxs("div",{className:"flex flex-col space-y-3 sm:flex-row sm:items-center sm:justify-between sm:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight sm:text-3xl",children:"Vehicle Checks"}),e.jsx("p",{className:"text-sm text-muted-foreground sm:text-base",children:"Daily vehicle inspections and safety checks"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(n,{onClick:J,variant:"outline",size:"sm",className:"text-xs sm:text-sm",disabled:a||V,children:[e.jsx(xe,{className:`w-4 h-4 mr-1 sm:mr-2 ${a||V?"animate-spin":""}`}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"}),e.jsx("span",{className:"sm:hidden",children:"Sync"})]}),e.jsxs(n,{onClick:G,variant:"outline",size:"sm",className:"text-xs sm:text-sm",children:[e.jsx(F,{className:"w-4 h-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Export"}),e.jsx("span",{className:"sm:hidden",children:"Save"})]}),e.jsxs(n,{onClick:$,className:"text-xs sm:text-sm",children:[e.jsx(me,{className:"w-4 h-4 mr-1 sm:mr-2"}),"New Check"]})]})]}),e.jsxs("div",{className:"grid gap-3 grid-cols-2 sm:gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(x,{className:"mobile-card",children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-xs font-medium sm:text-sm",children:"Total Checks"}),e.jsx(D,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[a?e.jsx("div",{className:"text-2xl font-bold text-muted-foreground",children:"..."}):e.jsx("div",{className:"text-xl font-bold sm:text-2xl",children:d.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This month"})]})]}),e.jsxs(x,{className:"mobile-card",children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-xs font-medium sm:text-sm",children:"Completed"}),e.jsx(oe,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(h,{children:[a?e.jsx("div",{className:"text-2xl font-bold text-muted-foreground",children:"..."}):e.jsx("div",{className:"text-xl font-bold text-green-600 sm:text-2xl",children:d.filter(s=>s.status==="completed").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Passed inspections"})]})]}),e.jsxs(x,{className:"mobile-card",children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-xs font-medium sm:text-sm",children:"Issues Found"}),e.jsx(he,{className:"h-4 w-4 text-orange-600"})]}),e.jsxs(h,{children:[a?e.jsx("div",{className:"text-2xl font-bold text-muted-foreground",children:"..."}):e.jsx("div",{className:"text-xl font-bold text-orange-600 sm:text-2xl",children:d.reduce((s,t)=>s+t.issues_found.length,0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total issues reported"})]})]}),e.jsxs(x,{className:"mobile-card",children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-xs font-medium sm:text-sm",children:"Last Check"}),e.jsx(ue,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[a?e.jsx("div",{className:"text-2xl font-bold text-muted-foreground",children:"..."}):e.jsx("div",{className:"text-xl font-bold sm:text-2xl",children:d.length>0?v(new Date(d[0].created_at),"MMM dd"):"N/A"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a?"":d.length>0?v(new Date(d[0].created_at),"HH:mm"):""})]})]})]}),e.jsxs(Q,{value:p,onValueChange:y,className:"space-y-4",children:[e.jsxs(X,{className:"grid w-full grid-cols-2",children:[e.jsx(E,{value:"new-check",className:"text-xs sm:text-sm",children:"New Check"}),e.jsx(E,{value:"history",className:"text-xs sm:text-sm",children:"History"})]}),e.jsx(M,{value:"new-check",className:"space-y-4",children:e.jsxs(x,{className:"mobile-card",children:[e.jsxs(f,{children:[e.jsxs(N,{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-lg sm:text-xl",children:"Enhanced Vehicle Check"})]}),e.jsx(A,{className:"text-sm",children:"Complete vehicle inspection with GPS tracking, photo capture, and unique reference numbers"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 sm:p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2 text-sm sm:text-base",children:"Enhanced Features"}),e.jsxs("ul",{className:"text-blue-700 space-y-1 text-xs sm:text-sm",children:[e.jsx("li",{children:"• GPS tracking during inspection"}),e.jsx("li",{children:"• Photo capture of registration plate"}),e.jsx("li",{children:"• Unique reference numbers for each check"}),e.jsx("li",{children:"• Digital signature capture"}),e.jsx("li",{children:"• Comprehensive reporting"}),e.jsx("li",{children:"• Admin-managed question templates"})]})]}),e.jsxs(n,{className:"w-full mobile-button",onClick:()=>_("/driver/enhanced-vehicle-check"),size:"lg",children:[e.jsx(z,{className:"w-5 h-5 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Start Enhanced Vehicle Check"}),e.jsx("span",{className:"sm:hidden",children:"Start Vehicle Check"})]})]})]})}),e.jsxs(M,{value:"history",className:"space-y-4",children:[e.jsxs(x,{className:"mobile-card",children:[e.jsxs(f,{children:[e.jsx(N,{className:"text-lg sm:text-xl",children:"Check History"}),e.jsx(A,{className:"text-sm",children:"View and manage your vehicle inspection history"})]}),e.jsx(h,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(P,{htmlFor:"search",className:"text-sm",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(Y,{id:"search",placeholder:"Search by vehicle number or license plate...",value:i,onChange:s=>S(s.target.value),className:"pl-8 text-sm"})]})]}),e.jsxs("div",{className:"w-full sm:w-48",children:[e.jsx(P,{htmlFor:"status",className:"text-sm",children:"Status"}),e.jsxs(ee,{value:m,onValueChange:g,children:[e.jsx(se,{className:"text-sm",children:e.jsx(te,{})}),e.jsxs(ae,{children:[e.jsx(w,{value:"all",children:"All Status"}),e.jsx(w,{value:"completed",children:"Completed"}),e.jsx(w,{value:"pending",children:"Pending"}),e.jsx(w,{value:"failed",children:"Failed"})]})]})]})]})})]}),e.jsx(x,{className:"mobile-card",children:e.jsxs(h,{className:"p-0",children:[e.jsx("div",{className:"hidden sm:block",children:e.jsxs(le,{children:[e.jsx(ie,{children:e.jsxs(C,{children:[e.jsx(u,{children:"Vehicle"}),e.jsx(u,{children:"Date"}),e.jsx(u,{children:"Type"}),e.jsx(u,{children:"Status"}),e.jsx(u,{children:"Issues"}),e.jsx(u,{children:"Notes"}),e.jsx(u,{className:"text-right",children:"Actions"})]})}),e.jsx(re,{children:a?e.jsx(C,{children:e.jsx(c,{colSpan:7,className:"text-center py-8",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-muted-foreground",children:"Loading vehicle checks..."})]})})}):b.length===0?e.jsx(C,{children:e.jsx(c,{colSpan:7,className:"text-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(D,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"No vehicle checks found"}),e.jsx("p",{className:"text-muted-foreground",children:i||m!=="all"?"Try adjusting your search or filter criteria":"Start your first vehicle inspection to see it here"})]})})}):b.map(s=>e.jsxs(C,{children:[e.jsx(c,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.vehicle_number}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.license_plate})]})}),e.jsx(c,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:v(new Date(s.check_date),"MMM dd, yyyy")}),e.jsx("div",{className:"text-sm text-muted-foreground",children:v(new Date(s.created_at),"HH:mm")})]})}),e.jsx(c,{children:U(s.check_type)}),e.jsx(c,{children:k(s.status)}),e.jsx(c,{children:s.issues_found.length>0?e.jsxs("div",{className:"space-y-1",children:[s.issues_found.slice(0,2).map((t,o)=>e.jsx(l,{variant:"outline",className:"text-xs",children:t},o)),s.issues_found.length>2&&e.jsxs(l,{variant:"outline",className:"text-xs",children:["+",s.issues_found.length-2," more"]})]}):e.jsx("span",{className:"text-green-600 text-sm",children:"No issues"})}),e.jsx(c,{children:e.jsx("div",{className:"max-w-xs truncate",children:s.notes||"No notes"})}),e.jsx(c,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(n,{variant:"ghost",size:"sm",children:e.jsx(H,{className:"w-4 h-4"})}),e.jsx(n,{variant:"ghost",size:"sm",children:e.jsx(I,{className:"w-4 h-4"})}),e.jsx(n,{variant:"ghost",size:"sm",children:e.jsx(F,{className:"w-4 h-4"})})]})})]},s.id))})]})}),e.jsx("div",{className:"sm:hidden space-y-3 p-4",children:a?e.jsxs("div",{className:"flex items-center justify-center space-x-2 py-8",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-muted-foreground text-sm",children:"Loading vehicle checks..."})]}):b.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(D,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"No vehicle checks found"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:i||m!=="all"?"Try adjusting your search or filter criteria":"Start your first vehicle inspection to see it here"})]}):b.map(s=>e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:s.vehicle_number}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.license_plate})]}),k(s.status)]}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Date:"}),e.jsx("span",{children:v(new Date(s.check_date),"MMM dd, yyyy")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Type:"}),e.jsx("span",{className:"capitalize",children:s.check_type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Issues:"}),e.jsx("span",{children:s.issues_found.length})]}),s.notes&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx("span",{className:"text-muted-foreground",children:"Notes:"}),e.jsx("p",{className:"text-xs mt-1",children:s.notes})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-3 pt-3 border-t",children:[e.jsxs(n,{variant:"outline",size:"sm",className:"text-xs",children:[e.jsx(H,{className:"w-3 h-3 mr-1"}),"View"]}),e.jsxs(n,{variant:"outline",size:"sm",className:"text-xs",children:[e.jsx(I,{className:"w-3 h-3 mr-1"}),"Edit"]})]})]},s.id))})]})})]})]})]})};export{Ve as default};
