var Ye=Object.defineProperty,ze=Object.defineProperties;var Je=Object.getOwnPropertyDescriptors;var Me=Object.getOwnPropertySymbols;var Xe=Object.prototype.hasOwnProperty,Ze=Object.prototype.propertyIsEnumerable;var Le=(a,d,r)=>d in a?Ye(a,d,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[d]=r,ie=(a,d)=>{for(var r in d||(d={}))Xe.call(d,r)&&Le(a,r,d[r]);if(Me)for(var r of Me(d))Ze.call(d,r)&&Le(a,r,d[r]);return a},ne=(a,d)=>ze(a,Je(d));var R=(a,d,r)=>new Promise((B,k)=>{var b=y=>{try{u(r.next(y))}catch(s){k(s)}},I=y=>{try{u(r.throw(y))}catch(s){k(s)}},u=y=>y.done?B(y.value):Promise.resolve(y.value).then(b,I);u((r=r.apply(a,d)).next())});import{j as e}from"./ui-vendor-DMUr7mTx.js";import{r as N}from"./react-vendor-BvqlMsL5.js";import{u as je,s as C,z as $e,J as ce,B as M,C as x,d as h,a as p,b as g,e as A,I as es,S as de,q as oe,r as me,t as xe,v as _,h as ss,i as ts,j as K,k as as,D as Fe,m as qe,n as Ae,o as Te,p as Ee,G as ls}from"./index-ZwIgorfy.js";import{u as te,a as rs,b as is}from"./query-vendor-B2F_wWlc.js";import{d as ns,T as ae,J as he,ao as Ie,j as ue,M as Pe,_ as He,U as cs,F as le,ba as ds,W as os,ab as ms,a1 as xs,bb as hs,l as us,k as Oe,b7 as js,n as ps,a3 as gs,Y as Ve,S as ys,E as fs,aJ as Ns,bc as vs,g as ws,aa as Be,c as _s}from"./icons-vendor-b0I7fGSL.js";import{f as E}from"./utils-vendor-B2FlkASS.js";import"./supabase-vendor-B984m0TI.js";import"./router-vendor-CEyBJ8vK.js";import"./ui-components-7w1-MJre.js";const bs=(a,d)=>{const{profile:r}=je(),{data:B=[],isLoading:k,error:b}=te({queryKey:["enhanced-vehicle-inspections",a,d],queryFn:()=>R(void 0,null,function*(){if(!a)return[];try{let s=C.from("vehicle_inspections").select("*").order("created_at",{ascending:!1});d&&(s=s.eq("driver_id",d));const{data:m,error:c}=yield s;if(c)return console.error("Error fetching vehicle inspections:",c),[];if(!m||m.length===0)return[];const l=[...new Set(m.map(i=>i.vehicle_id).filter(Boolean))],v=[...new Set(m.map(i=>i.driver_id).filter(Boolean))],f=[...new Set(m.map(i=>i.schedule_id).filter(Boolean))],[w,H,L]=yield Promise.all([l.length>0?C.from("vehicles").select("id, vehicle_number, make, model, license_plate").in("id",l).eq("organization_id",a):{data:[]},v.length>0?C.from("profiles").select("id, first_name, last_name").in("id",v).eq("organization_id",a):{data:[]},f.length>0?C.from("inspection_schedules").select("id, scheduled_date, status").in("id",f):{data:[]}]),P=new Map((w.data||[]).map(i=>[i.id,i])),O=new Map((H.data||[]).map(i=>[i.id,i])),V=new Map((L.data||[]).map(i=>[i.id,i]));return m.map(i=>ne(ie({},i),{vehicle:P.get(i.vehicle_id),driver:O.get(i.driver_id),schedule:V.get(i.schedule_id)}))}catch(s){return console.error("Error in vehicle inspections query:",s),[]}}),enabled:!!a&&!!(r!=null&&r.id)}),{data:I=[]}=te({queryKey:["inspection-schedules",a,d],queryFn:()=>R(void 0,null,function*(){if(!a)return[];try{let s=C.from("inspection_schedules").select("*").order("scheduled_date",{ascending:!0});d&&(s=s.eq("assigned_driver_id",d));const{data:m,error:c}=yield s;if(c)return console.error("Error fetching inspection schedules:",c),[];if(!m||m.length===0)return[];const l=[...new Set(m.map(i=>i.vehicle_id).filter(Boolean))],v=[...new Set(m.map(i=>i.assigned_driver_id).filter(Boolean))],f=[...new Set(m.map(i=>i.template_id).filter(Boolean))],[w,H,L]=yield Promise.all([l.length>0?C.from("vehicles").select("id, vehicle_number, make, model, license_plate").in("id",l).eq("organization_id",a):{data:[]},v.length>0?C.from("profiles").select("id, first_name, last_name").in("id",v).eq("organization_id",a):{data:[]},f.length>0?C.from("inspection_templates").select("id, name, description, inspection_type, frequency_days").in("id",f):{data:[]}]),P=new Map((w.data||[]).map(i=>[i.id,i])),O=new Map((H.data||[]).map(i=>[i.id,i])),V=new Map((L.data||[]).map(i=>[i.id,i]));return m.map(i=>ne(ie({},i),{vehicle:P.get(i.vehicle_id),driver:O.get(i.assigned_driver_id),template:V.get(i.template_id)}))}catch(s){return console.error("Error in inspection schedules query:",s),[]}}),enabled:!!a&&!!(r!=null&&r.id)}),{data:u=[]}=te({queryKey:["inspection-templates",a],queryFn:()=>R(void 0,null,function*(){if(!a)return[];try{const{data:s,error:m}=yield C.from("inspection_templates").select("*").eq("organization_id",a).eq("is_active",!0).order("frequency_days",{ascending:!0});return m?(console.error("Error fetching inspection templates:",m),[]):s||[]}catch(s){return console.error("Error in inspection templates query:",s),[]}}),enabled:!!a&&!!(r!=null&&r.id)}),{data:y}=te({queryKey:["enhanced-inspection-stats",a,d],queryFn:()=>R(void 0,null,function*(){if(!a)return null;try{const[s,m]=yield Promise.all([C.from("vehicle_inspections").select("overall_status, inspection_category, inspection_type, defects_found, created_at").eq("organization_id",a).then(l=>l.data||[]),C.from("inspection_schedules").select("scheduled_date, status").eq("organization_id",a).then(l=>l.data||[])]);return{total:s.length,byStatus:{pending:s.filter(l=>l.overall_status==="pending").length,passed:s.filter(l=>l.overall_status==="passed").length,flagged:s.filter(l=>l.overall_status==="flagged").length,failed:s.filter(l=>l.overall_status==="failed").length},byCategory:{daily:s.filter(l=>l.inspection_category==="daily").length,weekly:s.filter(l=>l.inspection_category==="weekly").length,"4_weekly":s.filter(l=>l.inspection_category==="4_weekly").length,"6_weekly":s.filter(l=>l.inspection_category==="6_weekly").length,pre_trip:s.filter(l=>l.inspection_category==="pre_trip").length,post_trip:s.filter(l=>l.inspection_category==="post_trip").length,breakdown:s.filter(l=>l.inspection_category==="breakdown").length},byType:{daily_check:s.filter(l=>l.inspection_type==="daily_check").length,weekly:s.filter(l=>l.inspection_type==="weekly").length,"4_weekly":s.filter(l=>l.inspection_type==="4_weekly").length,"6_weekly":s.filter(l=>l.inspection_type==="6_weekly").length,pre_trip:s.filter(l=>l.inspection_type==="pre_trip").length,post_trip:s.filter(l=>l.inspection_type==="post_trip").length,breakdown:s.filter(l=>l.inspection_type==="breakdown").length},defectsFound:s.filter(l=>l.defects_found).length,recentInspections:s.filter(l=>{const v=new Date(l.created_at),f=new Date;return f.setDate(f.getDate()-7),v>=f}).length,upcomingSchedules:m.filter(l=>{const v=new Date(l.scheduled_date),f=new Date,w=new Date;return w.setDate(w.getDate()+7),v>=f&&v<=w&&l.status==="scheduled"}).length,overdueSchedules:m.filter(l=>new Date(l.scheduled_date)<new Date&&l.status==="scheduled").length}}catch(s){return console.error("Error fetching enhanced inspection stats:",s),null}}),enabled:!!a&&!!(r!=null&&r.id)});return{inspections:B,schedules:I,templates:u,inspectionStats:y,isLoading:k,error:b}},Cs=({inspection:a,onClose:d})=>{var Q,re;const{profile:r}=je(),{selectedOrganizationId:B}=$e(),k=rs(),[b,I]=N.useState([]),[u,y]=N.useState(null),[s,m]=N.useState(null),[c,l]=N.useState(null),[v,f]=N.useState(!0),[w,H]=N.useState(!1);N.useEffect(()=>{R(void 0,null,function*(){try{if(a.walkaround_data){const o=a.walkaround_data;o.questions&&I(o.questions)}if(a.location_data){const o=a.location_data;y({latitude:o.latitude,longitude:o.longitude,accuracy:o.accuracy||0,timestamp:o.timestamp||a.start_time,address:o.address})}if(a.vehicle_id){const{data:o}=yield C.from("vehicles").select("*").eq("id",a.vehicle_id).single();o&&m(o)}if(a.driver_id){const{data:o}=yield C.from("profiles").select("*").eq("id",a.driver_id).single();o&&l(o)}}catch(o){console.error("Error fetching inspection details:",o),ce.error("Failed to load inspection details")}finally{f(!1)}})},[a]);const L=is({mutationFn:()=>R(void 0,null,function*(){if(!B)throw new Error("No organization selected");const n={title:"ðŸš¨ Failed Vehicle Inspection Alert",body:`Vehicle ${s==null?void 0:s.vehicle_number} (${s==null?void 0:s.license_plate}) failed inspection on ${E(new Date(a.inspection_date),"MMM dd, yyyy")}. Driver: ${c==null?void 0:c.first_name} ${c==null?void 0:c.last_name}. Inspection type: ${a.inspection_category.replace("_"," ")}.`,type:"error",priority:"high",category:"safety",channels:["in_app","email"],metadata:{inspection_id:a.id,vehicle_id:a.vehicle_id,driver_id:a.driver_id,failed_questions:b.filter(G=>G.answer==="fail").length,total_questions:b.length},organization_id:B,sender_id:r==null?void 0:r.id,sender_name:`${r==null?void 0:r.first_name} ${r==null?void 0:r.last_name}`,sender_role:(r==null?void 0:r.role)||"user",recipient_role:"admin"},{error:o}=yield C.from("notification_messages").insert(n);if(o)throw o;return!0}),onSuccess:()=>{ce.success("Alert sent to admin and mechanics"),k.invalidateQueries({queryKey:["notifications"]})},onError:n=>{ce.error(`Failed to send alert: ${n.message}`)}}),P=n=>{switch(n.toLowerCase()){case"engine":return e.jsx(gs,{className:"w-4 h-4"});case"tires":return e.jsx(ps,{className:"w-4 h-4"});case"lights":return e.jsx(js,{className:"w-4 h-4"});case"brakes":return e.jsx(Oe,{className:"w-4 h-4"});case"fuel":return e.jsx(us,{className:"w-4 h-4"});case"temperature":return e.jsx(hs,{className:"w-4 h-4"});case"navigation":return e.jsx(xs,{className:"w-4 h-4"});default:return e.jsx(le,{className:"w-4 h-4"})}},O=n=>{switch(n){case"pass":return e.jsxs(A,{className:"bg-green-100 text-green-800 border-green-200",children:[e.jsx(he,{className:"w-3 h-3 mr-1"}),"Pass"]});case"fail":return e.jsxs(A,{className:"bg-red-100 text-red-800 border-red-200",children:[e.jsx(Ie,{className:"w-3 h-3 mr-1"}),"Fail"]});case"na":return e.jsx(A,{className:"bg-gray-100 text-gray-800 border-gray-200",children:"N/A"});default:return e.jsx(A,{variant:"secondary",children:n})}},V=n=>{switch(n.toLowerCase()){case"engine":return"text-orange-600 bg-orange-50";case"tires":return"text-blue-600 bg-blue-50";case"lights":return"text-yellow-600 bg-yellow-50";case"brakes":return"text-red-600 bg-red-50";case"fuel":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}},W=b.filter(n=>n.answer==="fail"),i=b.filter(n=>n.answer==="pass");return b.filter(n=>n.answer==="na"),v?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading inspection details..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Inspection Details"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[s==null?void 0:s.vehicle_number," - ",s==null?void 0:s.make," ",s==null?void 0:s.model]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[a.overall_status==="failed"&&e.jsxs(M,{variant:"destructive",size:"sm",onClick:()=>L.mutate(),disabled:L.isPending,children:[e.jsx(ns,{className:"w-4 h-4 mr-2"}),L.isPending?"Sending...":"Alert Admin & Mechanics"]}),e.jsx(M,{variant:"outline",size:"sm",onClick:d,children:"Close"})]})]}),a.overall_status==="failed"&&e.jsx(x,{className:"border-red-200 bg-red-50",children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ae,{className:"h-6 w-6 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-red-900",children:"Failed Inspection Alert"}),e.jsxs("p",{className:"text-red-700 text-sm",children:["This vehicle failed ",W.length," out of ",b.length," inspection checks. Immediate attention required by admin and mechanics."]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(x,{children:[e.jsx(p,{className:"pb-2",children:e.jsxs(g,{className:"text-sm font-medium flex items-center",children:[e.jsx(he,{className:"w-4 h-4 text-green-600 mr-2"}),"Passed"]})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:i.length}),e.jsx("p",{className:"text-xs text-gray-600",children:"Checks passed"})]})]}),e.jsxs(x,{children:[e.jsx(p,{className:"pb-2",children:e.jsxs(g,{className:"text-sm font-medium flex items-center",children:[e.jsx(Ie,{className:"w-4 h-4 text-red-600 mr-2"}),"Failed"]})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:W.length}),e.jsx("p",{className:"text-xs text-gray-600",children:"Checks failed"})]})]}),e.jsxs(x,{children:[e.jsx(p,{className:"pb-2",children:e.jsxs(g,{className:"text-sm font-medium flex items-center",children:[e.jsx(ue,{className:"w-4 h-4 text-gray-600 mr-2"}),"Duration"]})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a.start_time&&a.end_time?Math.round((new Date(a.end_time).getTime()-new Date(a.start_time).getTime())/6e4):"N/A"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Minutes"})]})]}),e.jsxs(x,{children:[e.jsx(p,{className:"pb-2",children:e.jsxs(g,{className:"text-sm font-medium flex items-center",children:[e.jsx(Pe,{className:"w-4 h-4 text-blue-600 mr-2"}),"Location"]})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-sm font-medium",children:u?`${u.latitude.toFixed(4)}, ${u.longitude.toFixed(4)}`:"N/A"}),e.jsx("p",{className:"text-xs text-gray-600",children:"GPS Coordinates"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(x,{children:[e.jsx(p,{children:e.jsxs(g,{className:"flex items-center",children:[e.jsx(He,{className:"w-5 h-5 mr-2"}),"Vehicle Information"]})}),e.jsx(h,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Vehicle Number:"}),e.jsx("p",{className:"text-gray-600",children:s==null?void 0:s.vehicle_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"License Plate:"}),e.jsx("p",{className:"text-gray-600",children:s==null?void 0:s.license_plate})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Make/Model:"}),e.jsxs("p",{className:"text-gray-600",children:[s==null?void 0:s.make," ",s==null?void 0:s.model]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Year:"}),e.jsx("p",{className:"text-gray-600",children:(s==null?void 0:s.year)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"VIN:"}),e.jsx("p",{className:"text-gray-600",children:(s==null?void 0:s.vin)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Fuel Type:"}),e.jsx("p",{className:"text-gray-600",children:(s==null?void 0:s.fuel_type)||"N/A"})]})]})})]}),e.jsxs(x,{children:[e.jsx(p,{children:e.jsxs(g,{className:"flex items-center",children:[e.jsx(cs,{className:"w-5 h-5 mr-2"}),"Driver Information"]})}),e.jsx(h,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Name:"}),e.jsxs("p",{className:"text-gray-600",children:[c==null?void 0:c.first_name," ",c==null?void 0:c.last_name]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Email:"}),e.jsx("p",{className:"text-gray-600",children:c==null?void 0:c.email})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Phone:"}),e.jsx("p",{className:"text-gray-600",children:(c==null?void 0:c.phone)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"License:"}),e.jsx("p",{className:"text-gray-600",children:(c==null?void 0:c.license_number)||"N/A"})]})]})})]})]}),u&&e.jsxs(x,{children:[e.jsx(p,{children:e.jsxs(g,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Pe,{className:"w-5 h-5 mr-2"}),"Inspection Location"]}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>H(!w),children:w?"Hide Map":"Show Map"})]})}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Latitude:"}),e.jsx("p",{className:"text-gray-600",children:u.latitude.toFixed(6)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Longitude:"}),e.jsx("p",{className:"text-gray-600",children:u.longitude.toFixed(6)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Accuracy:"}),e.jsxs("p",{className:"text-gray-600",children:[u.accuracy,"m"]})]})]}),u.address&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Address:"}),e.jsx("p",{className:"text-gray-600",children:u.address})]}),w&&e.jsx("div",{className:"border rounded-lg p-4 bg-gray-50",children:e.jsx("iframe",{width:"100%",height:"300",frameBorder:"0",style:{border:0},src:`https://www.google.com/maps/embed/v1/view?key=YOUR_GOOGLE_MAPS_API_KEY&center=${u.latitude},${u.longitude}&zoom=15`,allowFullScreen:!0})})]})})]}),e.jsxs(x,{children:[e.jsx(p,{children:e.jsxs(g,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(le,{className:"w-5 h-5 mr-2"}),"Inspection Questions & Results"]}),e.jsx(A,{variant:a.overall_status==="failed"?"destructive":"default",children:a.overall_status.toUpperCase()})]})}),e.jsx(h,{children:e.jsx("div",{className:"space-y-4",children:b.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No detailed inspection questions available"}):b.map((n,o)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[P(n.category),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:n.question}),e.jsx(A,{className:`mt-1 ${V(n.category)}`,children:n.category})]})]}),O(n.answer)]}),n.notes&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded",children:e.jsx("p",{className:"text-sm text-gray-700",children:n.notes})}),n.photo_url&&e.jsx("div",{className:"mt-3",children:e.jsxs(M,{variant:"outline",size:"sm",children:[e.jsx(ds,{className:"w-4 h-4 mr-2"}),"View Photo"]})}),e.jsxs("div",{className:"mt-3 text-xs text-gray-500",children:["Timestamp: ",E(new Date(n.timestamp),"MMM dd, yyyy HH:mm:ss")]})]},n.id||o))})})]}),a.defects_found&&e.jsxs(x,{className:"border-red-200 bg-red-50",children:[e.jsx(p,{children:e.jsxs(g,{className:"flex items-center text-red-900",children:[e.jsx(ae,{className:"w-5 h-5 mr-2"}),"Defects Found"]})}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-3",children:[((Q=a.defects_details)==null?void 0:Q.description)&&e.jsx("p",{className:"text-red-800",children:a.defects_details.description}),((re=a.defects_details)==null?void 0:re.items)&&e.jsx("ul",{className:"list-disc list-inside space-y-1 text-red-800",children:a.defects_details.items.map((n,o)=>e.jsx("li",{children:n},o))}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(M,{variant:"destructive",size:"sm",children:[e.jsx(os,{className:"w-4 h-4 mr-2"}),"Create Work Order"]}),e.jsxs(M,{variant:"outline",size:"sm",children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Export Report"]})]})]})})]}),e.jsxs(x,{children:[e.jsx(p,{children:e.jsxs(g,{className:"flex items-center",children:[e.jsx(ue,{className:"w-5 h-5 mr-2"}),"Inspection Metadata"]})}),e.jsx(h,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Inspection Date:"}),e.jsx("p",{className:"text-gray-600",children:E(new Date(a.inspection_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Start Time:"}),e.jsx("p",{className:"text-gray-600",children:E(new Date(a.start_time),"HH:mm:ss")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"End Time:"}),e.jsx("p",{className:"text-gray-600",children:a.end_time?E(new Date(a.end_time),"HH:mm:ss"):"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Inspection Type:"}),e.jsx("p",{className:"text-gray-600",children:a.inspection_category.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Created:"}),e.jsx("p",{className:"text-gray-600",children:E(new Date(a.created_at),"MMM dd, yyyy HH:mm:ss")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Last Updated:"}),e.jsx("p",{className:"text-gray-600",children:E(new Date(a.updated_at),"MMM dd, yyyy HH:mm:ss")})]})]})})]})]})},Ss=()=>{var fe,Ne,ve,we,_e,be,Ce,Se,ke;const{profile:a}=je(),{selectedOrganizationId:d}=$e(),[r,B]=N.useState(""),[k,b]=N.useState("all"),[I,u]=N.useState("all"),[y,s]=N.useState("all"),[m,c]=N.useState(null),[l,v]=N.useState(null),[f,w]=N.useState(!1),[H,L]=N.useState(!1),[P,O]=N.useState("all"),V=(a==null?void 0:a.role)==="driver",W=V?a==null?void 0:a.id:void 0,{inspections:i,schedules:Q,templates:re,inspectionStats:n,isLoading:o,error:G}=bs(d,W),Re=t=>{switch(t){case"passed":return e.jsx(he,{className:"w-4 h-4 text-green-600"});case"failed":return e.jsx(Ve,{className:"w-4 h-4 text-red-600"});case"flagged":return e.jsx(ae,{className:"w-4 h-4 text-yellow-600"});default:return e.jsx(ue,{className:"w-4 h-4 text-gray-600"})}},We=t=>{const j={passed:"bg-green-100 text-green-800 border-green-200",failed:"bg-red-100 text-red-800 border-red-200",flagged:"bg-yellow-100 text-yellow-800 border-yellow-200",pending:"bg-gray-100 text-gray-800 border-gray-200"};return j[t]||j.pending},Qe=t=>({daily:"bg-blue-100 text-blue-800 border-blue-200",weekly:"bg-purple-100 text-purple-800 border-purple-200","4_weekly":"bg-indigo-100 text-indigo-800 border-indigo-200","6_weekly":"bg-cyan-100 text-cyan-800 border-cyan-200",pre_trip:"bg-orange-100 text-orange-800 border-orange-200",post_trip:"bg-pink-100 text-pink-800 border-pink-200",breakdown:"bg-red-100 text-red-800 border-red-200"})[t]||"bg-gray-100 text-gray-800 border-gray-200",pe=t=>{const j={scheduled:"bg-blue-100 text-blue-800 border-blue-200",in_progress:"bg-yellow-100 text-yellow-800 border-yellow-200",completed:"bg-green-100 text-green-800 border-green-200",overdue:"bg-red-100 text-red-800 border-red-200",cancelled:"bg-gray-100 text-gray-800 border-gray-200"};return j[t]||j.scheduled},ge=i.filter(t=>{var F,q,$,U,Y,z,J,X,Z,ee,se,De;const j=!r||((q=(F=t.vehicle)==null?void 0:F.vehicle_number)==null?void 0:q.toLowerCase().includes(r.toLowerCase()))||((U=($=t.vehicle)==null?void 0:$.make)==null?void 0:U.toLowerCase().includes(r.toLowerCase()))||((z=(Y=t.vehicle)==null?void 0:Y.model)==null?void 0:z.toLowerCase().includes(r.toLowerCase()))||((X=(J=t.vehicle)==null?void 0:J.license_plate)==null?void 0:X.toLowerCase().includes(r.toLowerCase()))||((ee=(Z=t.driver)==null?void 0:Z.first_name)==null?void 0:ee.toLowerCase().includes(r.toLowerCase()))||((De=(se=t.driver)==null?void 0:se.last_name)==null?void 0:De.toLowerCase().includes(r.toLowerCase())),D=k==="all"||t.overall_status===k,S=I==="all"||t.inspection_category===I,T=y==="all"||t.driver_id===y;return j&&D&&S&&T}),ye=Q.filter(t=>{var T,F,q,$,U,Y,z,J,X,Z,ee,se;const j=!r||((F=(T=t.vehicle)==null?void 0:T.vehicle_number)==null?void 0:F.toLowerCase().includes(r.toLowerCase()))||(($=(q=t.vehicle)==null?void 0:q.make)==null?void 0:$.toLowerCase().includes(r.toLowerCase()))||((Y=(U=t.vehicle)==null?void 0:U.model)==null?void 0:Y.toLowerCase().includes(r.toLowerCase()))||((J=(z=t.vehicle)==null?void 0:z.license_plate)==null?void 0:J.toLowerCase().includes(r.toLowerCase()))||((Z=(X=t.driver)==null?void 0:X.first_name)==null?void 0:Z.toLowerCase().includes(r.toLowerCase()))||((se=(ee=t.driver)==null?void 0:ee.last_name)==null?void 0:se.toLowerCase().includes(r.toLowerCase())),D=k==="all"||t.status===k,S=y==="all"||t.assigned_driver_id===y;return j&&D&&S}),Ge=Array.from(new Set([...i.map(t=>t.driver_id),...Q.map(t=>t.assigned_driver_id)])).map(t=>{var j,D;return((j=i.find(S=>S.driver_id===t))==null?void 0:j.driver)||((D=Q.find(S=>S.assigned_driver_id===t))==null?void 0:D.driver)}).filter(Boolean),Ke=t=>{c(t),w(!0)},Ue=t=>{v(t),L(!0)};return G&&((fe=G.message)!=null&&fe.includes("inspection_schedules")||(Ne=G.message)!=null&&Ne.includes("inspection_templates"))?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Oe,{className:"h-16 w-16 text-blue-600 mx-auto mb-6"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Enhanced Vehicle Inspections System"}),e.jsx("p",{className:"text-lg text-gray-600 mb-8",children:"The enhanced vehicle inspections system needs to be set up in your database."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 max-w-2xl mx-auto",children:[e.jsx("h2",{className:"text-xl font-semibold text-blue-900 mb-4",children:"Setup Required"}),e.jsxs("ol",{className:"text-left text-blue-800 space-y-2",children:[e.jsx("li",{children:"1. Go to your Supabase Dashboard"}),e.jsx("li",{children:"2. Open SQL Editor"}),e.jsxs("li",{children:["3. Run the script: ",e.jsx("code",{className:"bg-blue-100 px-2 py-1 rounded",children:"sql/fixes/enhanced_vehicle_inspections_system.sql"})]}),e.jsx("li",{children:"4. Refresh this page"})]}),e.jsx("div",{className:"mt-6",children:e.jsx(M,{onClick:()=>window.open("https://supabase.com/dashboard","_blank"),className:"bg-blue-600 hover:bg-blue-700",children:"Open Supabase Dashboard"})})]})]})}):o?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading inspections..."})]})}):G?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(Ve,{className:"h-12 w-12 text-red-500 mx-auto"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Error Loading Inspections"}),e.jsx("p",{className:"text-gray-600",children:"Failed to load vehicle inspections. Please try again."})]})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Vehicle Inspections"}),e.jsx("p",{className:"text-gray-600 mt-2",children:V?"Your vehicle inspection history":"All vehicle inspections and schedules"})]}),!V&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(M,{variant:"outline",onClick:()=>window.location.href="/vehicle-management-settings",children:[e.jsx(ys,{className:"h-4 w-4 mr-2"}),"Inspection Settings"]}),e.jsxs(M,{children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Schedule Inspection"]})]})]}),n&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs(x,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Total Inspections"}),e.jsx(le,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.total}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n.recentInspections," in last 7 days"]})]})]}),e.jsxs(x,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Upcoming Schedules"}),e.jsx(Ns,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.upcomingSchedules}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Next 7 days"})]})]}),e.jsxs(x,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Overdue Schedules"}),e.jsx(vs,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.overdueSchedules}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Requires attention"})]})]}),e.jsxs(x,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Defects Found"}),e.jsx(ae,{className:"h-4 w-4 text-yellow-600"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.defectsFound}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total issues detected"})]})]})]}),n&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsxs(x,{children:[e.jsx(p,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium",children:"Daily Checks"})}),e.jsx(h,{children:e.jsx("div",{className:"text-xl font-bold",children:n.byCategory.daily})})]}),e.jsxs(x,{children:[e.jsx(p,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium",children:"4-Weekly"})}),e.jsx(h,{children:e.jsx("div",{className:"text-xl font-bold",children:n.byCategory["4_weekly"]})})]}),e.jsxs(x,{children:[e.jsx(p,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium",children:"6-Weekly"})}),e.jsx(h,{children:e.jsx("div",{className:"text-xl font-bold",children:n.byCategory["6_weekly"]})})]}),e.jsxs(x,{children:[e.jsx(p,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium",children:"Pre/Post Trip"})}),e.jsx(h,{children:e.jsx("div",{className:"text-xl font-bold",children:n.byCategory.pre_trip+n.byCategory.post_trip})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx(es,{placeholder:"Search vehicles, drivers, or license plates...",value:r,onChange:t=>B(t.target.value),className:"w-full"})}),e.jsxs(de,{value:k,onValueChange:b,children:[e.jsx(oe,{className:"w-full sm:w-48",children:e.jsx(me,{placeholder:"Filter by status"})}),e.jsxs(xe,{children:[e.jsx(_,{value:"all",children:"All Statuses"}),e.jsx(_,{value:"pending",children:"Pending"}),e.jsx(_,{value:"passed",children:"Passed"}),e.jsx(_,{value:"flagged",children:"Flagged"}),e.jsx(_,{value:"failed",children:"Failed"})]})]}),e.jsxs(de,{value:I,onValueChange:u,children:[e.jsx(oe,{className:"w-full sm:w-48",children:e.jsx(me,{placeholder:"Filter by category"})}),e.jsxs(xe,{children:[e.jsx(_,{value:"all",children:"All Categories"}),e.jsx(_,{value:"daily",children:"Daily"}),e.jsx(_,{value:"weekly",children:"Weekly"}),e.jsx(_,{value:"4_weekly",children:"4-Weekly"}),e.jsx(_,{value:"6_weekly",children:"6-Weekly"}),e.jsx(_,{value:"pre_trip",children:"Pre-Trip"}),e.jsx(_,{value:"post_trip",children:"Post-Trip"}),e.jsx(_,{value:"breakdown",children:"Breakdown"})]})]}),e.jsxs(de,{value:y,onValueChange:s,children:[e.jsx(oe,{className:"w-full sm:w-48",children:e.jsx(me,{placeholder:"Filter by driver"})}),e.jsxs(xe,{children:[e.jsx(_,{value:"all",children:"All Drivers"}),Ge.map(t=>e.jsxs(_,{value:(t==null?void 0:t.id)||"",children:[t==null?void 0:t.first_name," ",t==null?void 0:t.last_name]},t==null?void 0:t.id))]})]})]}),e.jsxs(ss,{value:P,onValueChange:O,className:"w-full",children:[e.jsxs(ts,{className:"grid w-full grid-cols-6",children:[e.jsx(K,{value:"all",children:"All"}),e.jsx(K,{value:"pending",children:"Pending"}),e.jsx(K,{value:"passed",children:"Passed"}),e.jsx(K,{value:"flagged",children:"Flagged"}),e.jsx(K,{value:"failed",children:"Failed"}),e.jsx(K,{value:"scheduled",children:"Scheduled"})]}),e.jsx(as,{value:P,className:"mt-6",children:P==="scheduled"?e.jsx("div",{className:"space-y-4",children:ye.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ws,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Scheduled Inspections"}),e.jsx("p",{className:"text-gray-600",children:"No inspection schedules found for the selected filters."})]}):ye.map(t=>{var j,D,S,T,F,q,$;return e.jsx(x,{className:"hover:shadow-md transition-shadow",children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(He,{className:"h-8 w-8 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold",children:[(j=t.vehicle)==null?void 0:j.vehicle_number," - ",(D=t.vehicle)==null?void 0:D.make," ",(S=t.vehicle)==null?void 0:S.model]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[(T=t.vehicle)==null?void 0:T.license_plate," â€¢ ",(F=t.template)==null?void 0:F.name]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Assigned to: ",(q=t.driver)==null?void 0:q.first_name," ",($=t.driver)==null?void 0:$.last_name]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium",children:E(new Date(t.scheduled_date),"MMM dd, yyyy")}),e.jsx(A,{className:pe(t.status),children:t.status.replace("_"," ")})]}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>Ue(t),children:e.jsx(Be,{className:"h-4 w-4"})})]})]})})},t.id)})}):e.jsx("div",{className:"space-y-4",children:ge.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(le,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Inspections Found"}),e.jsx("p",{className:"text-gray-600",children:"No inspections found for the selected filters."})]}):ge.map(t=>{var j,D,S,T,F,q;return e.jsx(x,{className:"hover:shadow-md transition-shadow",children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(_s,{className:"h-8 w-8 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold",children:[(j=t.vehicle)==null?void 0:j.vehicle_number," - ",(D=t.vehicle)==null?void 0:D.make," ",(S=t.vehicle)==null?void 0:S.model]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsxs(A,{className:We(t.overall_status),children:[Re(t.overall_status),t.overall_status]}),t.inspection_category&&e.jsx(A,{className:Qe(t.inspection_category),children:t.inspection_category.replace("_"," ")})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[(T=t.vehicle)==null?void 0:T.license_plate," â€¢ ",(F=t.driver)==null?void 0:F.first_name," ",(q=t.driver)==null?void 0:q.last_name]}),e.jsx("p",{className:"text-sm text-gray-500",children:E(new Date(t.inspection_date),"MMM dd, yyyy")})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[t.defects_found&&e.jsx(A,{variant:"destructive",className:"text-xs",children:"Defects Found"}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>Ke(t),children:e.jsx(Be,{className:"h-4 w-4"})})]})]})})},t.id)})})})]}),e.jsx(Fe,{open:f,onOpenChange:w,children:e.jsxs(qe,{className:"max-w-6xl max-h-[90vh] overflow-y-auto","aria-describedby":"inspection-details-description",children:[e.jsxs(Ae,{children:[e.jsx(Te,{children:"Inspection Details"}),e.jsx(Ee,{id:"inspection-details-description",children:"View comprehensive inspection information including GPS coordinates, detailed questions, and inspection results."})]}),m&&e.jsx(Cs,{inspection:m,onClose:()=>w(!1)})]})}),e.jsx(Fe,{open:H,onOpenChange:L,children:e.jsxs(qe,{className:"max-w-2xl","aria-describedby":"schedule-details-description",children:[e.jsxs(Ae,{children:[e.jsx(Te,{children:"Scheduled Inspection Details"}),e.jsx(Ee,{id:"schedule-details-description",children:"View details of scheduled vehicle inspections including vehicle, driver, and inspection type information."})]}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Vehicle"}),e.jsxs("p",{className:"text-sm",children:[(ve=l.vehicle)==null?void 0:ve.vehicle_number," - ",(we=l.vehicle)==null?void 0:we.make," ",(_e=l.vehicle)==null?void 0:_e.model]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"License Plate"}),e.jsx("p",{className:"text-sm",children:(be=l.vehicle)==null?void 0:be.license_plate})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Assigned Driver"}),e.jsxs("p",{className:"text-sm",children:[(Ce=l.driver)==null?void 0:Ce.first_name," ",(Se=l.driver)==null?void 0:Se.last_name]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Scheduled Date"}),e.jsx("p",{className:"text-sm",children:E(new Date(l.scheduled_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Inspection Type"}),e.jsx("p",{className:"text-sm",children:(ke=l.template)==null?void 0:ke.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Status"}),e.jsx(A,{className:pe(l.status),children:l.status.replace("_"," ")})]})]}),l.notes&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Notes"}),e.jsx("p",{className:"text-sm mt-1",children:l.notes})]})]}),e.jsx(ls,{children:e.jsx(M,{variant:"outline",onClick:()=>L(!1),children:"Close"})})]})})]})},Ps=()=>(console.log("VehicleInspections component is rendering"),e.jsx("div",{children:e.jsx(Ss,{})}));export{Ps as default};
