var l=(t,d,n)=>new Promise((i,a)=>{var e=r=>{try{o(n.next(r))}catch(s){a(s)}},c=r=>{try{o(n.throw(r))}catch(s){a(s)}},o=r=>r.done?i(r.value):Promise.resolve(r.value).then(e,c);o((n=n.apply(t,d)).next())});import{u as D}from"./query-vendor-B2F_wWlc.js";import{u as h,s as u}from"./index-ZwIgorfy.js";import"./react-vendor-BvqlMsL5.js";const I=()=>{const{profile:t}=h();return D({queryKey:["trial-status",t==null?void 0:t.organization_id],queryFn:()=>l(void 0,null,function*(){var d,n;if(!(t!=null&&t.organization_id))throw new Error("No organization ID found");try{const{data:i,error:a}=yield u.from("organization_trials").select("*").eq("organization_id",t.organization_id).order("created_at",{ascending:!1}).limit(1);if(a)if(a.code==="PGRST116"||a.code==="406"||(d=a.message)!=null&&d.includes('relation "organization_trials" does not exist')||(n=a.message)!=null&&n.includes("Cannot coerce the result to a single JSON object"))console.warn("organization_trials table does not exist or is not accessible:",a.message);else throw a;const e=i&&i.length>0?i[0]:null,{data:c,error:o}=yield u.from("profiles").select("id").eq("organization_id",t.organization_id).eq("role","driver");if(o)throw o;const r=(c==null?void 0:c.length)||0,s=(e==null?void 0:e.trial_end_date)||new Date().toISOString(),S=(e==null?void 0:e.trial_start_date)||new Date().toISOString(),_=new Date(s),m=new Date,g=Math.max(0,Math.ceil((_.getTime()-m.getTime())/(1e3*60*60*24))),z=(e==null?void 0:e.trial_status)==="active"&&g>0,w=(e==null?void 0:e.max_drivers)||10;return{isActive:z,daysLeft:g,trialEndDate:s,maxDrivers:w,currentDrivers:r,organizationId:t.organization_id}}catch(i){return console.warn("Trial status check failed:",i),{isActive:!1,daysLeft:0,trialEndDate:new Date().toISOString(),maxDrivers:10,currentDrivers:0,organizationId:(t==null?void 0:t.organization_id)||""}}}),enabled:!!(t!=null&&t.organization_id),staleTime:1e3*60*5})};export{I as u};
