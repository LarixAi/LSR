import{m as Oe,a1 as Te,r as d,ca as Ie,cb as Pe,cc as Be,cd as ze,ce as $e,j as e,E as de,B as c,aq as Ee,n as g,bp as Ue,am as We,e as R,k as q,au as He,I as P,aU as Xe,aY as Ge,aX as Ye,aV as Je,aW as Ke,q as i,ab as o,ac as m,ad as h,ae as u,af as t,f as xe,ax as B,C as oe,ak as z,F as Qe,a4 as $,a5 as E,a6 as U,a7 as W,a8 as me,s as he,aA as H,D as Ze,ar as es,a$ as ue,ap as ss,cf as as,a9 as rs,cg as is}from"./main-DVuL102c.js";import{u as ts}from"./useDrivers-BoUOpm5H.js";const ds=()=>{var te,le,ne,ce;Oe();const{toast:je}=Te(),[j,ve]=d.useState(""),[w,ge]=d.useState("all"),[y,pe]=d.useState("all"),[D,Ne]=d.useState("all"),[F,fe]=d.useState("list"),[X,we]=d.useState("dueDate"),[A,ye]=d.useState("asc"),[G,De]=d.useState(!1),[a,M]=d.useState(null),[Ce,C]=d.useState(!1),[_e,_]=d.useState(!1),[be,L]=d.useState(!1),[r,x]=d.useState({name:"",category:"",description:"",driver_id:"",due_date:"",priority:"medium",is_urgent:!1}),[v,V]=d.useState({status:"approved",notes:""}),{data:Y=[],isLoading:Se,error:ke,refetch:Re}=Ie(),{data:J=[]}=ts(),{data:qe=[]}=Pe(),O=Be(),T=ze();$e();const K=[...Y.filter(s=>{var p,N,f;const n=s.name.toLowerCase().includes(j.toLowerCase())||((p=s.description)==null?void 0:p.toLowerCase().includes(j.toLowerCase()))||s.category.toLowerCase().includes(j.toLowerCase())||`${(N=s.driver)==null?void 0:N.first_name} ${(f=s.driver)==null?void 0:f.last_name}`.toLowerCase().includes(j.toLowerCase()),l=w==="all"||s.status===w,S=y==="all"||s.category===y,k=D==="all"||s.driver_id===D;return n&&l&&S&&k})].sort((s,n)=>{var S,k,p,N;let l=0;switch(X){case"name":l=s.name.localeCompare(n.name);break;case"dueDate":!s.due_date&&!n.due_date?l=0:s.due_date?n.due_date?l=new Date(s.due_date).getTime()-new Date(n.due_date).getTime():l=-1:l=1;break;case"status":l=s.status.localeCompare(n.status);break;case"priority":const f={critical:4,high:3,medium:2,low:1};l=f[s.priority]-f[n.priority];break;case"driver":const Le=`${(S=s.driver)==null?void 0:S.first_name} ${(k=s.driver)==null?void 0:k.last_name}`,Ve=`${(p=n.driver)==null?void 0:p.first_name} ${(N=n.driver)==null?void 0:N.last_name}`;l=Le.localeCompare(Ve);break}return A==="asc"?l:-l}),I=s=>{switch(s){case"approved":return"bg-green-100 text-green-800 border-green-200";case"uploaded":return"bg-blue-100 text-blue-800 border-blue-200";case"pending_review":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"required":return"bg-red-100 text-red-800 border-red-200";case"expired":return"bg-gray-100 text-gray-800 border-gray-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},Q=s=>{switch(s){case"approved":return e.jsx(is,{className:"w-4 h-4"});case"uploaded":return e.jsx(rs,{className:"w-4 h-4"});case"pending_review":return e.jsx(as,{className:"w-4 h-4"});case"required":return e.jsx(ss,{className:"w-4 h-4"});case"expired":return e.jsx(ue,{className:"w-4 h-4"});case"rejected":return e.jsx(ue,{className:"w-4 h-4"});default:return e.jsx(es,{className:"w-4 h-4"})}},Z=s=>{switch(s){case"critical":return"bg-red-500";case"high":return"bg-orange-500";case"medium":return"bg-yellow-500";case"low":return"bg-green-500";default:return"bg-gray-500"}},Fe=async()=>{if(!r.name||!r.category||!r.driver_id){je({title:"Missing required fields",description:"Please fill in all required fields.",variant:"destructive"});return}try{await O.mutateAsync({name:r.name,category:r.category,description:r.description,driver_id:r.driver_id,due_date:r.due_date||void 0,priority:r.priority,is_urgent:r.is_urgent}),C(!1),x({name:"",category:"",description:"",driver_id:"",due_date:"",priority:"medium",is_urgent:!1})}catch(s){console.error("Failed to request document:",s)}},Ae=async()=>{if(a)try{await T.mutateAsync({documentId:a.id,status:v.status,notes:v.notes}),_(!1),V({status:"approved",notes:""}),M(null)}catch(s){console.error("Failed to review document:",s)}},ee=s=>{M(s),L(!0)},se=s=>{M(s),_(!0)},ae=[{id:"License",name:"License Documents"},{id:"Medical",name:"Medical Certificates"},{id:"Training",name:"Training Certificates"},{id:"Insurance",name:"Insurance Documents"},{id:"Background",name:"Background Checks"},{id:"Other",name:"Other Documents"}],Me=[{id:"required",name:"Required"},{id:"uploaded",name:"Uploaded"},{id:"pending_review",name:"Pending Review"},{id:"approved",name:"Approved"},{id:"rejected",name:"Rejected"},{id:"expired",name:"Expired"}],b=K.filter(s=>s.is_urgent||s.status==="required"),re=K.filter(s=>!s.is_urgent&&s.status!=="required"),ie=qe.filter(s=>!s.is_read);return Se?e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading driver documents..."})]})}):ke?e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(de,{className:"h-8 w-8 text-red-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Failed to load driver documents."}),e.jsxs(c,{onClick:()=>Re(),className:"mt-4",children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Retry"]})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Driver Documents Management"}),e.jsxs("p",{className:"text-gray-600",children:[Y.length," total documents • ",b.length," require attention"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[ie.length>0&&e.jsxs(g,{variant:"destructive",className:"flex items-center space-x-1",children:[e.jsx(Ue,{className:"w-3 h-3"}),e.jsx("span",{children:ie.length})]}),e.jsxs(c,{onClick:()=>C(!0),children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Request Document"]})]})]}),e.jsx(R,{children:e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(He,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(P,{placeholder:"Search documents, drivers...",value:j,onChange:s=>ve(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>De(!G),children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"Filters"]}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>fe(F==="list"?"grid":"list"),children:F==="list"?e.jsx(Ge,{className:"w-4 h-4"}):e.jsx(Ye,{className:"w-4 h-4"})}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>ye(A==="asc"?"desc":"asc"),children:A==="asc"?e.jsx(Je,{className:"w-4 h-4"}):e.jsx(Ke,{className:"w-4 h-4"})})]}),G&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Category"}),e.jsxs(o,{value:y,onValueChange:pe,children:[e.jsx(m,{children:e.jsx(h,{placeholder:"All Categories"})}),e.jsxs(u,{children:[e.jsx(t,{value:"all",children:"All Categories"}),ae.map(s=>e.jsx(t,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Status"}),e.jsxs(o,{value:w,onValueChange:ge,children:[e.jsx(m,{children:e.jsx(h,{placeholder:"All Status"})}),e.jsxs(u,{children:[e.jsx(t,{value:"all",children:"All Status"}),Me.map(s=>e.jsx(t,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Driver"}),e.jsxs(o,{value:D,onValueChange:Ne,children:[e.jsx(m,{children:e.jsx(h,{placeholder:"All Drivers"})}),e.jsxs(u,{children:[e.jsx(t,{value:"all",children:"All Drivers"}),J.map(s=>e.jsxs(t,{value:s.id,children:[s.first_name," ",s.last_name]},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Sort By"}),e.jsxs(o,{value:X,onValueChange:s=>we(s),children:[e.jsx(m,{children:e.jsx(h,{})}),e.jsxs(u,{children:[e.jsx(t,{value:"name",children:"Name"}),e.jsx(t,{value:"dueDate",children:"Due Date"}),e.jsx(t,{value:"status",children:"Status"}),e.jsx(t,{value:"priority",children:"Priority"}),e.jsx(t,{value:"driver",children:"Driver"})]})]})]})]})]})})}),b.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-red-700 flex items-center",children:[e.jsx(de,{className:"w-5 h-5 mr-2"}),"Requires Attention (",b.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:b.map(s=>{var n,l;return e.jsx(R,{className:"border-red-200 bg-red-50",children:e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:`w-3 h-3 rounded-full ${Z(s.priority)}`})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[s.category," • ",s.description]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Driver: ",(n=s.driver)==null?void 0:n.first_name," ",(l=s.driver)==null?void 0:l.last_name]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(g,{className:I(s.status),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[Q(s.status),e.jsx("span",{className:"text-xs",children:s.status.replace("_"," ")})]})}),s.is_urgent&&e.jsx(g,{variant:"destructive",className:"text-xs",children:"Urgent"})]}),e.jsx("div",{className:"flex items-center space-x-4 text-xs text-gray-500 mt-2",children:s.due_date&&e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(xe,{className:"w-3 h-3"}),e.jsxs("span",{children:["Due: ",B(new Date(s.due_date),"MMM dd, yyyy")]})]})})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[s.status==="uploaded"&&e.jsx(c,{variant:"default",size:"sm",onClick:()=>se(s),className:"bg-blue-600 hover:bg-blue-700",children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>ee(s),className:"p-1",children:e.jsx(z,{className:"w-4 h-4"})})]})]})})]})})},s.id)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"All Documents"}),re.length===0?e.jsx(R,{children:e.jsxs(q,{className:"p-8 text-center",children:[e.jsx(Qe,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:j||y!=="all"||w!=="all"||D!=="all"?"No documents match your filters":"No other documents available"})]})}):e.jsx("div",{className:F==="grid"?"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4":"space-y-4",children:re.map(s=>{var n,l;return e.jsx(R,{children:e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:`w-3 h-3 rounded-full ${Z(s.priority)}`})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[s.category," • ",s.description]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Driver: ",(n=s.driver)==null?void 0:n.first_name," ",(l=s.driver)==null?void 0:l.last_name]}),e.jsx("div",{className:"flex items-center space-x-2 mt-2",children:e.jsx(g,{className:I(s.status),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[Q(s.status),e.jsx("span",{className:"text-xs",children:s.status.replace("_"," ")})]})})}),e.jsx("div",{className:"flex items-center space-x-4 text-xs text-gray-500 mt-2",children:s.due_date&&e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(xe,{className:"w-3 h-3"}),e.jsxs("span",{children:["Due: ",B(new Date(s.due_date),"MMM dd, yyyy")]})]})})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[s.status==="uploaded"&&e.jsx(c,{variant:"default",size:"sm",onClick:()=>se(s),className:"bg-blue-600 hover:bg-blue-700",children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>ee(s),className:"p-1",children:e.jsx(z,{className:"w-4 h-4"})})]})]})})]})})},s.id)})})]}),e.jsx($,{open:Ce,onOpenChange:C,children:e.jsxs(E,{className:"max-w-md",children:[e.jsxs(U,{children:[e.jsx(W,{children:"Request Document from Driver"}),e.jsx(me,{children:"Create a new document request for a driver."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Document Name *"}),e.jsx(P,{value:r.name,onChange:s=>x({...r,name:s.target.value}),placeholder:"e.g., Driver License"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Category *"}),e.jsxs(o,{value:r.category,onValueChange:s=>x({...r,category:s}),children:[e.jsx(m,{children:e.jsx(h,{placeholder:"Select category"})}),e.jsx(u,{children:ae.map(s=>e.jsx(t,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Driver *"}),e.jsxs(o,{value:r.driver_id,onValueChange:s=>x({...r,driver_id:s}),children:[e.jsx(m,{children:e.jsx(h,{placeholder:"Select driver"})}),e.jsx(u,{children:J.map(s=>e.jsxs(t,{value:s.id,children:[s.first_name," ",s.last_name]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Description"}),e.jsx(he,{value:r.description,onChange:s=>x({...r,description:s.target.value}),placeholder:"Document description...",rows:3})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Due Date"}),e.jsx(P,{type:"date",value:r.due_date,onChange:s=>x({...r,due_date:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Priority"}),e.jsxs(o,{value:r.priority,onValueChange:s=>x({...r,priority:s}),children:[e.jsx(m,{children:e.jsx(h,{})}),e.jsxs(u,{children:[e.jsx(t,{value:"low",children:"Low"}),e.jsx(t,{value:"medium",children:"Medium"}),e.jsx(t,{value:"high",children:"High"}),e.jsx(t,{value:"critical",children:"Critical"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"urgent",checked:r.is_urgent,onChange:s=>x({...r,is_urgent:s.target.checked}),className:"rounded"}),e.jsx(i,{htmlFor:"urgent",children:"Mark as urgent"})]})]}),e.jsxs(H,{children:[e.jsx(c,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsx(c,{onClick:Fe,disabled:O.isPending,children:O.isPending?"Creating...":"Request Document"})]})]})}),e.jsx($,{open:_e,onOpenChange:_,children:e.jsxs(E,{className:"max-w-md",children:[e.jsxs(U,{children:[e.jsx(W,{children:"Review Document"}),e.jsx(me,{children:"Review and approve or reject the uploaded document."})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Driver: ",(te=a.driver)==null?void 0:te.first_name," ",(le=a.driver)==null?void 0:le.last_name]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Category: ",a.category]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Status"}),e.jsxs(o,{value:v.status,onValueChange:s=>V({...v,status:s}),children:[e.jsx(m,{children:e.jsx(h,{})}),e.jsxs(u,{children:[e.jsx(t,{value:"approved",children:"Approve"}),e.jsx(t,{value:"rejected",children:"Reject"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Notes"}),e.jsx(he,{value:v.notes,onChange:s=>V({...v,notes:s.target.value}),placeholder:"Add review notes...",rows:3})]})]}),e.jsxs(H,{children:[e.jsx(c,{variant:"outline",onClick:()=>_(!1),children:"Cancel"}),e.jsx(c,{onClick:Ae,disabled:T.isPending,children:T.isPending?"Reviewing...":"Submit Review"})]})]})}),e.jsx($,{open:be,onOpenChange:L,children:e.jsxs(E,{className:"max-w-2xl",children:[e.jsx(U,{children:e.jsx(W,{children:"Document Details"})}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Document Name"}),e.jsx("p",{className:"text-sm",children:a.name})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Category"}),e.jsx("p",{className:"text-sm",children:a.category})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Driver"}),e.jsxs("p",{className:"text-sm",children:[(ne=a.driver)==null?void 0:ne.first_name," ",(ce=a.driver)==null?void 0:ce.last_name]})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Status"}),e.jsx(g,{className:I(a.status),children:a.status.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Priority"}),e.jsx(g,{variant:"outline",children:a.priority})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Due Date"}),e.jsx("p",{className:"text-sm",children:a.due_date?B(new Date(a.due_date),"MMM dd, yyyy"):"Not set"})]})]}),a.description&&e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Description"}),e.jsx("p",{className:"text-sm",children:a.description})]}),a.file_url&&e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"File"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>window.open(a.file_url,"_blank"),children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"View File"]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>window.open(a.file_url,"_blank"),children:[e.jsx(Ze,{className:"w-4 h-4 mr-2"}),"Download"]})]})]}),a.driver_notes&&e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Driver Notes"}),e.jsx("p",{className:"text-sm",children:a.driver_notes})]}),a.admin_notes&&e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:"Admin Notes"}),e.jsx("p",{className:"text-sm",children:a.admin_notes})]})]}),e.jsx(H,{children:e.jsx(c,{variant:"outline",onClick:()=>L(!1),children:"Close"})})]})})]})};export{ds as default};
