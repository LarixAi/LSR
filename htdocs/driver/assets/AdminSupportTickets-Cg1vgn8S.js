import{m as $,a1 as G,r as t,J as I,j as e,E as U,B as n,l as K,e as c,k as d,g as P,h as A,aU as Q,q as a,au as W,I as X,ab as f,ac as y,ad as w,ae as b,af as r,bp as Z,n as m,aO as k,v as ee,d as se,a4 as ae,as as re,ak as le,a5 as te,a6 as ie,a7 as ne}from"./main-DVuL102c.js";import{L as ce}from"./lightbulb-BaDmslCX.js";function he(){const{profile:S}=$(),{toast:u}=G(),[C,M]=t.useState([]),[_,T]=t.useState(!0);t.useState(null);const[o,R]=t.useState(""),[j,z]=t.useState("all"),[p,O]=t.useState("all"),[g,V]=t.useState("all"),q={low:"bg-green-100 text-green-800",medium:"bg-yellow-100 text-yellow-800",high:"bg-orange-100 text-orange-800",urgent:"bg-red-100 text-red-800"},B={low:"ðŸŸ¢",medium:"ðŸŸ¡",high:"ðŸŸ ",urgent:"ðŸ”´"},H={open:"bg-blue-100 text-blue-800",in_progress:"bg-yellow-100 text-yellow-800",resolved:"bg-green-100 text-green-800",closed:"bg-gray-100 text-gray-800"};t.useEffect(()=>{v()},[]);const v=async()=>{try{T(!0);const{data:s,error:l}=await I.from("support_tickets").select("*").order("created_at",{ascending:!1});if(l)throw l;M(s||[])}catch(s){console.error("Error fetching tickets:",s),u({title:"Error",description:"Failed to fetch support tickets.",variant:"destructive"})}finally{T(!1)}},x=async(s,l)=>{try{const{error:i}=await I.from("support_tickets").update({status:l,resolved_at:l==="resolved"?new Date().toISOString():null}).eq("id",s);if(i)throw i;u({title:"Success",description:`Ticket status updated to ${l}.`}),v()}catch(i){console.error("Error updating ticket:",i),u({title:"Error",description:"Failed to update ticket status.",variant:"destructive"})}},N=C.filter(s=>{var D,F,L,E;const l=(((D=s.subject)==null?void 0:D.toLowerCase())||"").includes(o.toLowerCase())||(((F=s.user_name)==null?void 0:F.toLowerCase())||"").includes(o.toLowerCase())||(((L=s.user_email)==null?void 0:L.toLowerCase())||"").includes(o.toLowerCase())||(((E=s.ticket_id)==null?void 0:E.toLowerCase())||"").includes(o.toLowerCase()),i=j==="all"||s.status===j,J=p==="all"||s.type===p,Y=g==="all"||s.priority===g;return l&&i&&J&&Y}),h=(()=>{const s={open:0,in_progress:0,resolved:0,closed:0};return C.forEach(l=>{l.status&&s.hasOwnProperty(l.status)&&s[l.status]++}),s})();return!S||!["admin","council"].includes(S.role)?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(U,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-muted-foreground",children:"You don't have permission to view support tickets."})]})}):e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Support Tickets"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage support requests and feature suggestions"})]}),e.jsxs(n,{onClick:v,disabled:_,children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(c,{children:e.jsxs(d,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),e.jsx("span",{className:"text-sm font-medium",children:"Open"})]}),e.jsx("p",{className:"text-2xl font-bold",children:h.open})]})}),e.jsx(c,{children:e.jsxs(d,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),e.jsx("span",{className:"text-sm font-medium",children:"In Progress"})]}),e.jsx("p",{className:"text-2xl font-bold",children:h.in_progress})]})}),e.jsx(c,{children:e.jsxs(d,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-sm font-medium",children:"Resolved"})]}),e.jsx("p",{className:"text-2xl font-bold",children:h.resolved})]})}),e.jsx(c,{children:e.jsxs(d,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-500 rounded-full"}),e.jsx("span",{className:"text-sm font-medium",children:"Closed"})]}),e.jsx("p",{className:"text-2xl font-bold",children:h.closed})]})})]}),e.jsxs(c,{children:[e.jsx(P,{children:e.jsxs(A,{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"w-5 h-5"}),e.jsx("span",{children:"Filters"})]})}),e.jsx(d,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"search",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(X,{id:"search",placeholder:"Search tickets...",value:o,onChange:s=>R(s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"status",children:"Status"}),e.jsxs(f,{value:j,onValueChange:z,children:[e.jsx(y,{children:e.jsx(w,{})}),e.jsxs(b,{children:[e.jsx(r,{value:"all",children:"All Status"}),e.jsx(r,{value:"open",children:"Open"}),e.jsx(r,{value:"in_progress",children:"In Progress"}),e.jsx(r,{value:"resolved",children:"Resolved"}),e.jsx(r,{value:"closed",children:"Closed"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"type",children:"Type"}),e.jsxs(f,{value:p,onValueChange:O,children:[e.jsx(y,{children:e.jsx(w,{})}),e.jsxs(b,{children:[e.jsx(r,{value:"all",children:"All Types"}),e.jsx(r,{value:"support",children:"Support"}),e.jsx(r,{value:"suggestion",children:"Suggestion"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"priority",children:"Priority"}),e.jsxs(f,{value:g,onValueChange:V,children:[e.jsx(y,{children:e.jsx(w,{})}),e.jsxs(b,{children:[e.jsx(r,{value:"all",children:"All Priorities"}),e.jsx(r,{value:"low",children:"Low"}),e.jsx(r,{value:"medium",children:"Medium"}),e.jsx(r,{value:"high",children:"High"}),e.jsx(r,{value:"urgent",children:"Urgent"})]})]})]})]})})]}),e.jsxs(c,{children:[e.jsx(P,{children:e.jsxs(A,{children:["Tickets (",N.length,")"]})}),e.jsx(d,{children:_?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):N.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Z,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No tickets found."})]}):e.jsx("div",{className:"space-y-4",children:N.map(s=>e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[(s.type||"support")==="support"?e.jsx(U,{className:"w-4 h-4 text-red-600"}):e.jsx(ce,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium",children:s.subject||"No Subject"}),e.jsx(m,{variant:"outline",className:"text-xs",children:s.ticket_id||"No ID"})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground mb-2",children:[e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(k,{className:"w-3 h-3"}),e.jsx("span",{children:s.user_name||"Unknown User"})]}),e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(ee,{className:"w-3 h-3"}),e.jsx("span",{children:s.user_email||"No Email"})]}),e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(se,{className:"w-3 h-3"}),e.jsx("span",{children:s.created_at?new Date(s.created_at).toLocaleDateString():"Unknown Date"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(m,{className:q[s.priority]||"bg-gray-100 text-gray-800",children:[B[s.priority]||"âšª"," ",s.priority||"unknown"]}),e.jsx(m,{className:H[s.status]||"bg-gray-100 text-gray-800",children:(s.status||"unknown").replace("_"," ")}),e.jsx(m,{variant:"outline",children:(s.type||"support")==="support"?"IT Support":"Feature Suggestion"})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(ae,{children:[e.jsx(re,{asChild:!0,children:e.jsx(n,{variant:"outline",size:"sm",children:e.jsx(le,{className:"w-4 h-4"})})}),e.jsxs(te,{className:"max-w-2xl",children:[e.jsx(ie,{children:e.jsxs(ne,{children:["Ticket Details - ",s.ticket_id||"No ID"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{children:"Type"}),e.jsx("p",{className:"text-sm",children:(s.type||"support")==="support"?"IT Support":"Feature Suggestion"})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Priority"}),e.jsx("p",{className:"text-sm",children:s.priority})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Status"}),e.jsx("p",{className:"text-sm",children:s.status})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Created"}),e.jsx("p",{className:"text-sm",children:s.created_at?new Date(s.created_at).toLocaleString():"Unknown Date"})]})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Subject"}),e.jsx("p",{className:"text-sm font-medium",children:s.subject||"No Subject"})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Description"}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.description||"No description provided"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{children:"User Name"}),e.jsx("p",{className:"text-sm",children:s.user_name||"Unknown User"})]}),e.jsxs("div",{children:[e.jsx(a,{children:"User Email"}),e.jsx("p",{className:"text-sm",children:s.user_email||"No Email"})]}),s.user_phone&&e.jsxs("div",{children:[e.jsx(a,{children:"Phone"}),e.jsx("p",{className:"text-sm",children:s.user_phone})]}),s.app_version&&e.jsxs("div",{children:[e.jsx(a,{children:"App Version"}),e.jsx("p",{className:"text-sm",children:s.app_version})]})]}),s.device_info&&e.jsxs("div",{children:[e.jsx(a,{children:"Device Info"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.device_info})]}),e.jsxs("div",{className:"flex space-x-2",children:[s.status==="open"&&e.jsxs(e.Fragment,{children:[e.jsx(n,{size:"sm",onClick:()=>x(s.id,"in_progress"),children:"Mark In Progress"}),e.jsx(n,{size:"sm",variant:"outline",onClick:()=>x(s.id,"resolved"),children:"Mark Resolved"})]}),s.status==="in_progress"&&e.jsx(n,{size:"sm",onClick:()=>x(s.id,"resolved"),children:"Mark Resolved"}),s.status==="resolved"&&e.jsx(n,{size:"sm",variant:"outline",onClick:()=>x(s.id,"closed"),children:"Close Ticket"})]})]})]})]})})]})},s.id))})})]})]})}export{he as default};
