import{m as U,r as l,J as V,a3 as h,j as e,a4 as X,as as Y,B as N,am as Z,a5 as ee,a6 as se,a7 as ae,q as _,ab as F,ac as k,ad as O,ae as M,af as A,I as te,bU as ne,bV as re,f as H,ax as J,bW as ie,s as le,$ as ce,x as de,N as R,aq as oe,e as f,k as v,C as me,d as q,E as xe,aO as I,g as ge,h as ue,U as he,ak as je,aa as pe,n as S}from"./main-DVuL102c.js";import{C as fe}from"./calendar-CxP_DU9g.js";import{A as $}from"./award-D5hdS4i_.js";import"./isSameDay-X0xWrpXd.js";import"./subDays-D26s8zcO.js";import"./addDays-CXxLH7jZ.js";import"./addWeeks-D7_dq2Pd.js";import"./endOfWeek-aLw_agy5.js";import"./chevron-left-CejOeOBB.js";const L=[{value:"driver-safety-fundamentals",label:"Driver Safety Fundamentals"},{value:"vehicle-inspection-training",label:"Daily Vehicle Inspection Procedures"},{value:"emergency-procedures",label:"Emergency Response Procedures"},{value:"legal-compliance",label:"Legal Compliance and Documentation"},{value:"passenger-assistance",label:"Passenger Assistance Training"},{value:"defensive-driving",label:"Defensive Driving Techniques"},{value:"first-aid",label:"First Aid Training"},{value:"customer-service",label:"Customer Service Excellence"},{value:"hazardous-materials",label:"Hazardous Materials Handling"},{value:"route-optimization",label:"Route Optimization Training"}],B=({onTrainingAssigned:y})=>{const{user:t,profile:c}=U(),[r,x]=l.useState(!1),[j,b]=l.useState(!1),[E,g]=l.useState([]),[w,u]=l.useState(""),[o,T]=l.useState(""),[C,P]=l.useState(""),[m,s]=l.useState(void 0),[n,d]=l.useState("");l.useEffect(()=>{r&&(c!=null&&c.organization_id)&&i()},[r,c==null?void 0:c.organization_id]);const i=async()=>{try{const{data:a,error:D}=await V.from("profiles").select("id, email, first_name, last_name").eq("role","driver").eq("organization_id",c==null?void 0:c.organization_id).order("first_name",{ascending:!0});if(D){console.error("Error fetching drivers:",D),h.error("Failed to load drivers");return}g(a||[])}catch(a){console.error("Error fetching drivers:",a),h.error("Failed to load drivers")}},z=async a=>{var D;if(a.preventDefault(),!w||!o||!m){h.error("Please fill in all required fields");return}b(!0);try{const p=await fetch("https://dznbihypzmvcmradijqn.supabase.co/functions/v1/assign-driver-training",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t==null?void 0:t.access_token}`},body:JSON.stringify({driver_id:w,training_type:o,training_name:C||((D=L.find(Q=>Q.value===o))==null?void 0:D.label)||o,due_date:m.toISOString(),notes:n||null})}),K=await p.json();if(!p.ok)throw new Error(K.error||"Failed to assign training");h.success("Training assigned successfully!"),x(!1),W(),y==null||y()}catch(p){console.error("Error assigning training:",p),h.error(p instanceof Error?p.message:"Failed to assign training")}finally{b(!1)}},W=()=>{u(""),T(""),P(""),s(void 0),d("")},G=a=>a.first_name&&a.last_name?`${a.first_name} ${a.last_name}`:a.email;return e.jsxs(X,{open:r,onOpenChange:x,children:[e.jsx(Y,{asChild:!0,children:e.jsxs(N,{className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Assign Training"]})}),e.jsxs(ee,{className:"sm:max-w-[500px]",children:[e.jsx(se,{children:e.jsx(ae,{children:"Assign Training to Driver"})}),e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"driver",children:"Driver *"}),e.jsxs(F,{value:w,onValueChange:u,children:[e.jsx(k,{children:e.jsx(O,{placeholder:"Select a driver"})}),e.jsx(M,{children:E.map(a=>e.jsx(A,{value:a.id,children:G(a)},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"training-type",children:"Training Type *"}),e.jsxs(F,{value:o,onValueChange:T,children:[e.jsx(k,{children:e.jsx(O,{placeholder:"Select training type"})}),e.jsxs(M,{children:[L.map(a=>e.jsx(A,{value:a.value,children:a.label},a.value)),e.jsx(A,{value:"custom",children:"Custom Training"})]})]})]}),o==="custom"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"custom-name",children:"Custom Training Name *"}),e.jsx(te,{id:"custom-name",value:C,onChange:a=>P(a.target.value),placeholder:"Enter custom training name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Due Date *"}),e.jsxs(ne,{children:[e.jsx(re,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),m?J(m,"PPP"):"Pick a date"]})}),e.jsx(ie,{className:"w-auto p-0",children:e.jsx(fe,{mode:"single",selected:m,onSelect:s,initialFocus:!0,disabled:a=>a<new Date})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"notes",children:"Notes (Optional)"}),e.jsx(le,{id:"notes",value:n,onChange:a=>d(a.target.value),placeholder:"Add any additional notes or instructions...",rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>x(!1),disabled:j,children:"Cancel"}),e.jsxs(N,{type:"submit",disabled:j,children:[j&&e.jsx(ce,{className:"w-4 h-4 mr-2 animate-spin"}),"Assign Training"]})]})]})]})]})},Ce=()=>{const{user:y,profile:t,loading:c}=U(),r=de(),[x,j]=l.useState(!0),[b,E]=l.useState([]),[g,w]=l.useState({total:0,completed:0,inProgress:0,overdue:0,notStarted:0});l.useEffect(()=>{t!=null&&t.organization_id&&u()},[t==null?void 0:t.organization_id]);const u=async()=>{j(!0);try{const{data:s,error:n}=await V.from("training_completions").select(`
          *,
          driver:profiles!training_completions_driver_id_fkey(
            email,
            first_name,
            last_name
          )
        `).eq("organization_id",t==null?void 0:t.organization_id).order("created_at",{ascending:!1});if(n){console.error("Error fetching training records:",n),h.error("Failed to load training records");return}E(s||[]),o(s||[])}catch(s){console.error("Error fetching training records:",s),h.error("Failed to load training records")}finally{j(!1)}},o=s=>{const n=new Date,d={total:s.length,completed:s.filter(i=>i.status==="completed").length,inProgress:s.filter(i=>i.status==="in_progress").length,overdue:s.filter(i=>new Date(i.due_date)<n&&i.status!=="completed").length,notStarted:s.filter(i=>i.status==="not_started").length};w(d)},T=(s,n)=>{const d=new Date;if(new Date(n)<d&&s!=="completed")return e.jsx(S,{className:"bg-red-100 text-red-800",children:"Overdue"});switch(s){case"completed":return e.jsx(S,{className:"bg-green-100 text-green-800",children:"Completed"});case"in_progress":return e.jsx(S,{className:"bg-blue-100 text-blue-800",children:"In Progress"});case"not_started":return e.jsx(S,{className:"bg-gray-100 text-gray-800",children:"Not Started"});default:return e.jsx(S,{variant:"secondary",children:s})}},C=s=>s.first_name&&s.last_name?`${s.first_name} ${s.last_name}`:s.email,P=s=>{const n=new Date,i=new Date(s).getTime()-n.getTime();return Math.ceil(i/(1e3*60*60*24))};if(c||x)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading training management..."})]})});if(!y||!t)return e.jsx(R,{to:"/auth",replace:!0});if(!["admin","council"].includes(t.role))return e.jsx(R,{to:"/dashboard",replace:!0});const m=e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:`${r?"space-y-3":"flex justify-between items-center"}`,children:[e.jsxs("div",{children:[e.jsxs("h1",{className:`${r?"text-2xl":"text-3xl"} font-bold text-gray-900 flex items-center gap-2 sm:gap-3`,children:[e.jsx($,{className:`${r?"w-6 h-6":"w-8 h-8"} text-blue-600`}),"Training Management"]}),e.jsx("p",{className:"text-gray-600 mt-1 text-sm sm:text-base",children:"Manage driver training assignments and track progress"})]}),e.jsxs("div",{className:`flex items-center gap-2 ${r?"w-full":"space-x-2"}`,children:[e.jsxs(N,{onClick:u,variant:"outline",disabled:x,size:r?"sm":"default",className:r?"flex-1":"",children:[e.jsx(oe,{className:`w-4 h-4 ${r?"mr-1":"mr-2"} ${x?"animate-spin":""}`}),r?"Refresh":"Refresh Data"]}),e.jsx(B,{onTrainingAssigned:u})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(f,{children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Assignments"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:g.total})]}),e.jsx($,{className:"w-8 h-8 text-blue-600"})]})})}),e.jsx(f,{children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:g.completed})]}),e.jsx(me,{className:"w-8 h-8 text-green-600"})]})})}),e.jsx(f,{children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"In Progress"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:g.inProgress})]}),e.jsx(q,{className:"w-8 h-8 text-blue-600"})]})})}),e.jsx(f,{children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Overdue"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:g.overdue})]}),e.jsx(xe,{className:"w-8 h-8 text-red-600"})]})})}),e.jsx(f,{children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Not Started"}),e.jsx("p",{className:"text-2xl font-bold text-gray-600",children:g.notStarted})]}),e.jsx(I,{className:"w-8 h-8 text-gray-600"})]})})})]}),e.jsxs(f,{children:[e.jsx(ge,{children:e.jsxs(ue,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5"}),"Training Assignments"]})}),e.jsx(v,{children:b.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx($,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Training Assignments"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Start by assigning training to your drivers"}),e.jsx(B,{onTrainingAssigned:u})]}):e.jsx("div",{className:"space-y-4",children:b.map(s=>{const n=P(s.due_date),d=n<0&&s.status!=="completed";return e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(I,{className:"w-8 h-8 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:C(s.driver)}),e.jsx("p",{className:"text-sm text-gray-600",children:s.training_name})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[T(s.status,s.due_date),e.jsx(N,{variant:"outline",size:"sm",children:e.jsx(je,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Due: ",J(new Date(s.due_date),"MMM dd, yyyy")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:`text-sm ${d?"text-red-600":"text-gray-600"}`,children:d?`${Math.abs(n)} days overdue`:`${n} days remaining`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Progress: ",s.progress,"%"]})]})]}),e.jsx(pe,{value:s.progress,className:"mb-2"}),s.notes&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[e.jsx("strong",{children:"Notes:"})," ",s.notes]})]},s.id)})})})]})]});return r?e.jsx("div",{className:"container mx-auto px-4 py-6",children:m}):e.jsx("div",{className:"container mx-auto px-6 py-8",children:m})};export{Ce as default};
