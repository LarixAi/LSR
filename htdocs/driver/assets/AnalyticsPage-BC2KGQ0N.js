import{c as V,m as J,H as M,J as R,r as E,j as e,N as H,at as k,M as Q,bC as G,K as q,C as Y,a as U,ab as W,ac as X,ad as Z,ae as ee,af as _,B as T,D as L,e as o,k as d,O as ae,Q as te,V as S,Y as C,g as f,h as y,b as $,aa as se,U as ne,T as re,d as ie,n as ce}from"./main-DVuL102c.js";import{T as O}from"./target-BxcoNXI1.js";import{T as le}from"./trending-down-DwD0VVi4.js";import{M as B}from"./minus-DMHj-3FD.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=V("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=V("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=V("ChartPie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]),he=()=>{const{profile:a}=J(),{data:g=[]}=M({queryKey:["analytics-vehicles",a==null?void 0:a.organization_id],queryFn:async()=>{if(!(a!=null&&a.organization_id))return[];const{data:r,error:s}=await R.from("vehicles").select("*").eq("organization_id",a.organization_id);return s?(console.error("Error fetching vehicles for analytics:",s),[]):r||[]},enabled:!!(a!=null&&a.organization_id)}),{data:v=[]}=M({queryKey:["analytics-drivers",a==null?void 0:a.organization_id],queryFn:async()=>{if(!(a!=null&&a.organization_id))return[];const{data:r,error:s}=await R.from("profiles").select("*").eq("role","driver").eq("organization_id",a.organization_id);return s?(console.error("Error fetching drivers for analytics:",s),[]):r||[]},enabled:!!(a!=null&&a.organization_id)}),{data:m=[]}=M({queryKey:["analytics-jobs",a==null?void 0:a.organization_id],queryFn:async()=>{if(!(a!=null&&a.organization_id))return[];const{data:r,error:s}=await R.from("jobs").select("*").eq("organization_id",a.organization_id).order("created_at",{ascending:!1}).limit(1e3);return s?(console.error("Error fetching jobs for analytics:",s),[]):r||[]},enabled:!!(a!=null&&a.organization_id)}),{data:b=[]}=M({queryKey:["analytics-routes",a==null?void 0:a.organization_id],queryFn:async()=>{if(!(a!=null&&a.organization_id))return[];const{data:r,error:s}=await R.from("routes").select("*").eq("organization_id",a.organization_id);return s?(console.error("Error fetching routes for analytics:",s),[]):r||[]},enabled:!!(a!=null&&a.organization_id)}),z=(()=>{const s=m.filter(u=>u.status==="completed").reduce((u,A)=>u+(A.total_amount||0),0),N=m.length;m.filter(u=>{const A=new Date(u.created_at),F=new Date;return F.setMonth(F.getMonth()-1),A>=F}).length;const p=g.filter(u=>u.status==="active"||u.is_active).length,x=g.length,w=x>0?p/x*100:0,j=v.filter(u=>u.is_active).length,t=0,l=0,c=v.length>0?j/v.length*100:0,h=x>0?p/x*100:0,I=(c+h)/2;return{revenue:{value:`£${s.toLocaleString()}`,change:0,changeType:"neutral"},trips:{value:N.toString(),change:0,changeType:"neutral"},efficiency:{value:`${w.toFixed(1)}%`,change:0,changeType:"neutral"},drivers:{value:j.toString(),change:0,changeType:"neutral"},routes:{value:b.length.toString(),change:0,changeType:"neutral"},vehicles:{value:x.toString(),change:0,changeType:"neutral"},fuel:{value:`£${t.toLocaleString()}`,change:0,changeType:"neutral"},maintenance:{value:`£${l.toLocaleString()}`,change:0,changeType:"neutral"},compliance:{value:`${I.toFixed(1)}%`,change:0,changeType:"neutral"}}})(),D=[{name:"This Month",value:parseInt(z.revenue.value.replace(/[£,]/g,"")),trend:"neutral"},{name:"Last Month",value:0,trend:"neutral"},{name:"2 Months Ago",value:0,trend:"neutral"},{name:"3 Months Ago",value:0,trend:"neutral"}],n=[{name:"School Runs",value:m.filter(r=>r.job_type==="school_run").length,color:"bg-blue-500"},{name:"Regular Routes",value:b.filter(r=>r.status==="active").length,color:"bg-green-500"},{name:"Special Events",value:m.filter(r=>r.job_type==="special_event").length,color:"bg-purple-500"},{name:"Maintenance",value:g.filter(r=>r.status==="maintenance").length,color:"bg-orange-500"}],P=(()=>{const r=v.filter(h=>h.is_active).length,s=g.length,N=g.filter(h=>h.status==="active"||h.is_active).length,p=g.filter(h=>h.status==="maintenance").length,x=m.filter(h=>h.status==="completed").length,w=s>0?N/s*100:0,j=s>0?p/s*100:0,t=s>0?(s-p)/s*100:100,l="0.0/5",c="0.0%";return{driverPerformance:{averageRating:l,punctuality:c,safetyScore:c,fuelEfficiency:c},vehicleUtilization:{averageUtilization:`${w.toFixed(1)}%`,downtime:`${j.toFixed(1)}%`,maintenanceSchedule:c,availability:`${t.toFixed(1)}%`},customerSatisfaction:{overallRating:l,onTimePerformance:c,complaintResolution:c,repeatCustomers:c},quickStats:{activeDrivers:r,fleetVehicles:s,onTimeRate:c,targetAchievement:`${Math.min(x/Math.max(m.length,1)*100,100).toFixed(1)}%`}}})();return{metrics:z,revenueData:D,serviceData:n,performanceMetrics:P,rawData:{vehicles:g,drivers:v,jobs:m,routes:b},isLoading:!1}},pe=()=>{const{user:a,profile:g,loading:v}=J(),[m,b]=E.useState("30d");E.useState("revenue");const{metrics:i,revenueData:z,serviceData:D,performanceMetrics:n,rawData:K,isLoading:P}=he();if(v)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading analytics dashboard..."})]})});if(!a||!g)return e.jsx(H,{to:"/auth",replace:!0});if(v||P||!n)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading analytics data..."})]})});const r=[{id:"revenue",title:"Total Revenue",value:i.revenue.value,change:i.revenue.change,changeType:i.revenue.changeType,icon:k,color:"text-green-600",description:"Estimated revenue from completed jobs"},{id:"trips",title:"Total Trips",value:i.trips.value,change:i.trips.change,changeType:i.trips.changeType,icon:Q,color:"text-blue-600",description:"Jobs completed this period"},{id:"efficiency",title:"Fleet Efficiency",value:i.efficiency.value,change:i.efficiency.change,changeType:i.efficiency.changeType,icon:O,color:"text-orange-600",description:"Active vehicles / total vehicles"},{id:"fuel",title:"Fuel Costs",value:i.fuel.value,change:i.fuel.change,changeType:i.fuel.changeType,icon:G,color:"text-purple-600",description:"Estimated monthly fuel expenditure"},{id:"maintenance",title:"Maintenance Costs",value:i.maintenance.value,change:i.maintenance.change,changeType:i.maintenance.changeType,icon:q,color:"text-red-600",description:"Vehicle maintenance expenses"},{id:"compliance",title:"Compliance Score",value:i.compliance.value,change:i.compliance.change,changeType:i.compliance.changeType,icon:Y,color:"text-emerald-600",description:"Driver and vehicle compliance rating"}],s=(t,l)=>{const c=parseFloat(t.replace(/[%/]/g,""));switch(l){case"rating":return c>=4.5?"excellent":c>=4?"good":"warning";case"percentage":return c>=95?"excellent":c>=85?"good":"warning";case"downtime":return c<=5?"excellent":c<=15?"good":"warning";default:return"good"}},N=[{category:"Driver Performance",metrics:[{name:"Average Rating",value:n.driverPerformance.averageRating,status:s(n.driverPerformance.averageRating,"rating")},{name:"Punctuality",value:n.driverPerformance.punctuality,status:s(n.driverPerformance.punctuality,"percentage")},{name:"Safety Score",value:n.driverPerformance.safetyScore,status:s(n.driverPerformance.safetyScore,"percentage")},{name:"Fuel Efficiency",value:n.driverPerformance.fuelEfficiency,status:s(n.driverPerformance.fuelEfficiency,"percentage")}]},{category:"Vehicle Utilization",metrics:[{name:"Average Utilization",value:n.vehicleUtilization.averageUtilization,status:s(n.vehicleUtilization.averageUtilization,"percentage")},{name:"Downtime",value:n.vehicleUtilization.downtime,status:s(n.vehicleUtilization.downtime,"downtime")},{name:"Maintenance Schedule",value:n.vehicleUtilization.maintenanceSchedule,status:s(n.vehicleUtilization.maintenanceSchedule,"percentage")},{name:"Availability",value:n.vehicleUtilization.availability,status:s(n.vehicleUtilization.availability,"percentage")}]},{category:"Customer Satisfaction",metrics:[{name:"Overall Rating",value:n.customerSatisfaction.overallRating,status:s(n.customerSatisfaction.overallRating,"rating")},{name:"On-Time Performance",value:n.customerSatisfaction.onTimePerformance,status:s(n.customerSatisfaction.onTimePerformance,"percentage")},{name:"Complaint Resolution",value:n.customerSatisfaction.complaintResolution,status:s(n.customerSatisfaction.complaintResolution,"percentage")},{name:"Repeat Customers",value:n.customerSatisfaction.repeatCustomers,status:s(n.customerSatisfaction.repeatCustomers,"percentage")}]}],p=t=>{switch(t){case"increase":return e.jsx(de,{className:"w-4 h-4 text-green-600"});case"decrease":return e.jsx(oe,{className:"w-4 h-4 text-red-600"});default:return e.jsx(B,{className:"w-4 h-4 text-gray-600"})}},x=t=>{switch(t){case"increase":return"text-green-600";case"decrease":return"text-red-600";default:return"text-gray-600"}},w=t=>{switch(t){case"excellent":return"text-emerald-600";case"good":return"text-green-600";case"warning":return"text-yellow-600";case"critical":return"text-red-600";default:return"text-gray-600"}},j=t=>{const l={excellent:"bg-emerald-100 text-emerald-800",good:"bg-green-100 text-green-800",warning:"bg-yellow-100 text-yellow-800",critical:"bg-red-100 text-red-800"};return e.jsx(ce,{className:l[t]||"bg-gray-100 text-gray-800",children:t})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(U,{className:"w-8 h-8 text-blue-600"}),"Analytics Dashboard"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Comprehensive business intelligence and performance metrics"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(W,{value:m,onValueChange:b,children:[e.jsx(X,{className:"w-32",children:e.jsx(Z,{})}),e.jsxs(ee,{children:[e.jsx(_,{value:"7d",children:"Last 7 days"}),e.jsx(_,{value:"30d",children:"Last 30 days"}),e.jsx(_,{value:"90d",children:"Last 90 days"}),e.jsx(_,{value:"1y",children:"Last year"})]})]}),e.jsxs(T,{className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Export Report"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(t=>e.jsx(o,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(d,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gray-100",children:e.jsx(t.icon,{className:`w-6 h-6 ${t.color}`})}),e.jsxs("div",{className:"flex items-center gap-2",children:[p(t.changeType),e.jsxs("span",{className:`text-sm font-medium ${x(t.changeType)}`,children:[Math.abs(t.change),"%"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t.title}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mb-1",children:t.value}),e.jsx("p",{className:"text-sm text-gray-600",children:t.description})]})]})},t.id))}),e.jsxs(ae,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(te,{className:"grid w-full grid-cols-5",children:[e.jsx(S,{value:"overview",children:"Overview"}),e.jsx(S,{value:"financial",children:"Financial"}),e.jsx(S,{value:"operational",children:"Operational"}),e.jsx(S,{value:"performance",children:"Performance"}),e.jsx(S,{value:"reports",children:"Reports"})]}),e.jsxs(C,{value:"overview",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(o,{children:[e.jsx(f,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5"}),"Revenue Trend"]})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-4",children:z.map((t,l)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:t.name}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm",children:["£",t.value.toLocaleString()]}),t.trend==="up"?e.jsx($,{className:"w-4 h-4 text-green-600"}):t.trend==="down"?e.jsx(le,{className:"w-4 h-4 text-red-600"}):e.jsx(B,{className:"w-4 h-4 text-gray-600"})]})]},t.name))})})]}),e.jsxs(o,{children:[e.jsx(f,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5"}),"Service Distribution"]})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-4",children:D.map(t=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:t.name}),e.jsxs("span",{className:"text-sm",children:[t.value,"%"]})]}),e.jsx(se,{value:t.value,className:"h-2"})]},t.name))})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(o,{children:e.jsxs(d,{className:"p-6 text-center",children:[e.jsx(ne,{className:"w-8 h-8 text-blue-600 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Active Drivers"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:n.quickStats.activeDrivers}),e.jsx("p",{className:"text-sm text-gray-600",children:"Currently available"})]})}),e.jsx(o,{children:e.jsxs(d,{className:"p-6 text-center",children:[e.jsx(re,{className:"w-8 h-8 text-green-600 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Fleet Vehicles"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:n.quickStats.fleetVehicles}),e.jsx("p",{className:"text-sm text-gray-600",children:"Operational vehicles"})]})}),e.jsx(o,{children:e.jsxs(d,{className:"p-6 text-center",children:[e.jsx(ie,{className:"w-8 h-8 text-purple-600 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"On-Time Rate"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:n.quickStats.onTimeRate}),e.jsx("p",{className:"text-sm text-gray-600",children:"This month"})]})}),e.jsx(o,{children:e.jsxs(d,{className:"p-6 text-center",children:[e.jsx(O,{className:"w-8 h-8 text-orange-600 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Target Achievement"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:n.quickStats.targetAchievement}),e.jsx("p",{className:"text-sm text-gray-600",children:"Monthly target"})]})})]})]}),e.jsx(C,{value:"financial",className:"space-y-4",children:e.jsxs(o,{children:[e.jsx(f,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"Financial Analytics"]})}),e.jsx(d,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Financial Performance Analysis"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Detailed revenue analysis, cost breakdown, and profitability metrics."}),e.jsx(T,{className:"bg-blue-600 hover:bg-blue-700",children:"View Financial Dashboard"})]})})]})}),e.jsx(C,{value:"operational",className:"space-y-4",children:e.jsxs(o,{children:[e.jsx(f,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),"Operational Metrics"]})}),e.jsx(d,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(q,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Operational Performance"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Fleet utilization, route optimization, and operational efficiency metrics."}),e.jsx(T,{className:"bg-blue-600 hover:bg-blue-700",children:"View Operational Dashboard"})]})})]})}),e.jsx(C,{value:"performance",className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:N.map(t=>e.jsxs(o,{children:[e.jsx(f,{children:e.jsx(y,{children:t.category})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-4",children:t.metrics.map(l=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:l.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm font-medium ${w(l.status)}`,children:l.value}),j(l.status)]})]},l.name))})})]},t.category))})}),e.jsx(C,{value:"reports",className:"space-y-4",children:e.jsxs(o,{children:[e.jsx(f,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5"}),"Custom Reports"]})}),e.jsx(d,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(U,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Generate Custom Reports"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Create detailed analytical reports with custom date ranges and metrics."}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(T,{className:"bg-blue-600 hover:bg-blue-700",children:"Create Report"}),e.jsxs(T,{variant:"outline",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Export Data"]})]})]})})]})})]})]})};export{pe as default};
