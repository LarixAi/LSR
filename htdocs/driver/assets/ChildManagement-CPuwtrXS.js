import{c as ve,m as je,a1 as _e,G as ye,r as v,H as Ne,a2 as Ce,J as X,j as e,a4 as ee,a5 as se,a6 as ae,a7 as ne,a8 as te,aa as be,C as y,B as x,bO as we,$ as ke,aO as pe,ag as Se,P as M,S as Fe,e as N,g as C,h as b,k as w,n as E,q as t,am as ge,I as d,s as f,ab as L,ac as B,ad as O,ae as $,af as j,ci as Te,cj as Ae,ck as De,ax as ce,cl as Ee,N as de,E as Me,U as oe,an as Pe,M as Z,d as H,b4 as me,ap as he,f as xe,O as qe,Q as Re,V,Y as U,aA as Ie}from"./main-DVuL102c.js";import{E as Le}from"./EmergencyContacts-CMDgzTFP.js";import{C as u}from"./checkbox-BmxDZ4wY.js";import{C as Be}from"./chevron-left-CejOeOBB.js";import{H as Oe}from"./heart-CNuKn9NJ.js";import"./star-Dk-sf7Q0.js";import"./trash-2-uDLx8yM9.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=ve("School",[["path",{d:"M14 22v-4a2 2 0 1 0-4 0v4",key:"hhkicm"}],["path",{d:"m18 10 3.447 1.724a1 1 0 0 1 .553.894V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-7.382a1 1 0 0 1 .553-.894L6 10",key:"1xqip1"}],["path",{d:"M18 5v17",key:"1sw6gf"}],["path",{d:"m4 6 7.106-3.553a2 2 0 0 1 1.788 0L20 6",key:"9d2mlk"}],["path",{d:"M6 5v17",key:"1xfsm0"}],["circle",{cx:"12",cy:"9",r:"2",key:"1092wv"}]]),ze=({open:J,onOpenChange:P,onChildAdded:q})=>{const{user:T}=je(),{toast:A}=_e(),z=ye(),[p,G]=v.useState(1),[n,m]=v.useState({first_name:"",last_name:"",date_of_birth:"",gender:"",nationality:"British",student_id:"",school_name:"",school_address:"",grade_level:"",class_name:"",school_start_date:"",pickup_location:"",dropoff_location:"",alternative_pickup_locations:[],transport_days:["monday","tuesday","wednesday","thursday","friday"],transport_type:"both",morning_pickup_time:"",afternoon_dropoff_time:"",special_schedule_notes:"",holiday_transport_needed:!1,allergies:[],medical_conditions:[],medications:[],emergency_procedures:"",medical_alert_info:"",mobility_requirements:"",communication_needs:"",behavioral_considerations:"",required_equipment:[],transport_consent:!1,medical_consent:!1,photo_consent:!1,data_protection_consent:!1,emergency_contacts:[],payment_method:"",billing_address:"",discount_eligible:!1,payment_schedule:"",notification_preferences:{sms:!0,email:!0,app:!0,emergency_alerts:!0},language_preference:"english"}),{data:D=[]}=Ne({queryKey:["schools"],queryFn:async()=>{const{data:s,error:i}=await X.from("schools").select("*").eq("is_active",!0).order("name");if(i)throw i;return s||[]}}),l=6,o=p/l*100,Q=[{id:1,name:"Basic Information",icon:pe},{id:2,name:"Transport Details",icon:Se},{id:3,name:"Medical Information",icon:Oe},{id:4,name:"Emergency Contacts",icon:M},{id:5,name:"Legal & Consent",icon:Fe},{id:6,name:"Review & Submit",icon:y}],k=Ce({mutationFn:async s=>{if(!(T!=null&&T.id))throw new Error("User not authenticated");const{data:i,error:c}=await X.from("child_profiles").insert({parent_id:T.id,...s,emergency_contacts:void 0}).select().single();if(c)throw c;if(s.emergency_contacts.length>0){const g=s.emergency_contacts.map(I=>({child_id:i.id,...I})),{error:h}=await X.from("emergency_contacts").insert(g);if(h)throw h}return i},onSuccess:()=>{z.invalidateQueries({queryKey:["parent-children"]}),A({title:"Child Registration Successful",description:"Your child has been registered for transport services."}),P(!1),q==null||q(),S()},onError:s=>{console.error("Error creating child:",s),A({title:"Registration Failed",description:"There was an error registering your child. Please try again.",variant:"destructive"})}}),S=()=>{m({first_name:"",last_name:"",date_of_birth:"",gender:"",nationality:"British",student_id:"",school_name:"",school_address:"",grade_level:"",class_name:"",school_start_date:"",pickup_location:"",dropoff_location:"",alternative_pickup_locations:[],transport_days:["monday","tuesday","wednesday","thursday","friday"],transport_type:"both",morning_pickup_time:"",afternoon_dropoff_time:"",special_schedule_notes:"",holiday_transport_needed:!1,allergies:[],medical_conditions:[],medications:[],emergency_procedures:"",medical_alert_info:"",mobility_requirements:"",communication_needs:"",behavioral_considerations:"",required_equipment:[],transport_consent:!1,medical_consent:!1,photo_consent:!1,data_protection_consent:!1,emergency_contacts:[],payment_method:"",billing_address:"",discount_eligible:!1,payment_schedule:"",notification_preferences:{sms:!0,email:!0,app:!0,emergency_alerts:!0},language_preference:"english"}),G(1)},ie=()=>{p<l&&G(p+1)},R=()=>{p>1&&G(p-1)},re=()=>{k.mutate(n)},r=(s,i)=>{m(c=>({...c,[s]:i}))},_=(s,i,c)=>{m(g=>({...g,emergency_contacts:g.emergency_contacts.map((h,I)=>I===s?{...h,[i]:c}:h)}))},Y=()=>{m(s=>({...s,emergency_contacts:[...s.emergency_contacts,{contact_name:"",relationship:"",phone:"",email:"",address:"",contact_type:"general",is_primary:!1,can_authorize_treatment:!1}]}))},W=s=>{m(i=>({...i,emergency_contacts:i.emergency_contacts.filter((c,g)=>g!==s)}))},K=()=>{switch(p){case 1:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"first_name",children:"First Name *"}),e.jsx(d,{id:"first_name",value:n.first_name,onChange:s=>r("first_name",s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"last_name",children:"Last Name *"}),e.jsx(d,{id:"last_name",value:n.last_name,onChange:s=>r("last_name",s.target.value),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"date_of_birth",children:"Date of Birth *"}),e.jsx(d,{id:"date_of_birth",type:"date",value:n.date_of_birth,onChange:s=>r("date_of_birth",s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"gender",children:"Gender"}),e.jsxs(L,{value:n.gender,onValueChange:s=>r("gender",s),children:[e.jsx(B,{children:e.jsx(O,{placeholder:"Select gender"})}),e.jsxs($,{children:[e.jsx(j,{value:"male",children:"Male"}),e.jsx(j,{value:"female",children:"Female"}),e.jsx(j,{value:"other",children:"Other"}),e.jsx(j,{value:"prefer_not_to_say",children:"Prefer not to say"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"nationality",children:"Nationality"}),e.jsx(d,{id:"nationality",value:n.nationality,onChange:s=>r("nationality",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"student_id",children:"Student ID"}),e.jsx(d,{id:"student_id",value:n.student_id,onChange:s=>r("student_id",s.target.value),placeholder:"School student ID"})]})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"school_name",children:"School *"}),e.jsxs(L,{value:n.school_name,onValueChange:s=>r("school_name",s),children:[e.jsx(B,{children:e.jsx(O,{placeholder:"Select school"})}),e.jsx($,{children:D.map(s=>e.jsx(j,{value:s.name,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"grade_level",children:"Grade/Year Level *"}),e.jsx(d,{id:"grade_level",value:n.grade_level,onChange:s=>r("grade_level",s.target.value),placeholder:"e.g., Year 3, Grade 5",required:!0})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"class_name",children:"Class"}),e.jsx(d,{id:"class_name",value:n.class_name,onChange:s=>r("class_name",s.target.value),placeholder:"e.g., Class 3A"})]})]})]});case 2:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"pickup_location",children:"Pickup Location *"}),e.jsx(d,{id:"pickup_location",value:n.pickup_location,onChange:s=>r("pickup_location",s.target.value),placeholder:"Full address",required:!0})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"dropoff_location",children:"Dropoff Location *"}),e.jsx(d,{id:"dropoff_location",value:n.dropoff_location,onChange:s=>r("dropoff_location",s.target.value),placeholder:"School address",required:!0})]})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"transport_type",children:"Transport Type *"}),e.jsxs(L,{value:n.transport_type,onValueChange:s=>r("transport_type",s),children:[e.jsx(B,{children:e.jsx(O,{placeholder:"Select transport type"})}),e.jsxs($,{children:[e.jsx(j,{value:"morning_only",children:"Morning Only"}),e.jsx(j,{value:"afternoon_only",children:"Afternoon Only"}),e.jsx(j,{value:"both",children:"Both Morning & Afternoon"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"morning_pickup_time",children:"Morning Pickup Time"}),e.jsx(d,{id:"morning_pickup_time",type:"time",value:n.morning_pickup_time,onChange:s=>r("morning_pickup_time",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"afternoon_dropoff_time",children:"Afternoon Dropoff Time"}),e.jsx(d,{id:"afternoon_dropoff_time",type:"time",value:n.afternoon_dropoff_time,onChange:s=>r("afternoon_dropoff_time",s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"special_schedule_notes",children:"Special Schedule Notes"}),e.jsx(f,{id:"special_schedule_notes",value:n.special_schedule_notes,onChange:s=>r("special_schedule_notes",s.target.value),placeholder:"Any special scheduling requirements"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{id:"holiday_transport",checked:n.holiday_transport_needed,onCheckedChange:s=>r("holiday_transport_needed",s)}),e.jsx(t,{htmlFor:"holiday_transport",children:"Holiday transport needed"})]})]});case 3:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"allergies",children:"Allergies"}),e.jsx(f,{id:"allergies",value:n.allergies.join(", "),onChange:s=>r("allergies",s.target.value.split(",").map(i=>i.trim()).filter(Boolean)),placeholder:"List any allergies (separate with commas)"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"medical_conditions",children:"Medical Conditions"}),e.jsx(f,{id:"medical_conditions",value:n.medical_conditions.join(", "),onChange:s=>r("medical_conditions",s.target.value.split(",").map(i=>i.trim()).filter(Boolean)),placeholder:"List any medical conditions (separate with commas)"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"medications",children:"Medications"}),e.jsx(f,{id:"medications",value:n.medications.join(", "),onChange:s=>r("medications",s.target.value.split(",").map(i=>i.trim()).filter(Boolean)),placeholder:"List any medications (separate with commas)"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"emergency_procedures",children:"Emergency Procedures"}),e.jsx(f,{id:"emergency_procedures",value:n.emergency_procedures,onChange:s=>r("emergency_procedures",s.target.value),placeholder:"Emergency procedures for medical conditions"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"medical_alert_info",children:"Medical Alert Information"}),e.jsx(f,{id:"medical_alert_info",value:n.medical_alert_info,onChange:s=>r("medical_alert_info",s.target.value),placeholder:"Any medical alert information"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"mobility_requirements",children:"Mobility Requirements"}),e.jsx(f,{id:"mobility_requirements",value:n.mobility_requirements,onChange:s=>r("mobility_requirements",s.target.value),placeholder:"Any mobility requirements or assistance needed"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"communication_needs",children:"Communication Needs"}),e.jsx(f,{id:"communication_needs",value:n.communication_needs,onChange:s=>r("communication_needs",s.target.value),placeholder:"Any communication needs or preferences"})]})]});case 4:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Emergency Contacts"}),e.jsxs(x,{type:"button",variant:"outline",size:"sm",onClick:Y,children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Add Contact"]})]}),n.emergency_contacts.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(M,{className:"w-12 h-12 mx-auto mb-4"}),e.jsx("p",{children:"No emergency contacts added yet."}),e.jsx("p",{className:"text-sm",children:'Click "Add Contact" to add emergency contacts.'})]}):e.jsx("div",{className:"space-y-4",children:n.emergency_contacts.map((s,i)=>e.jsxs(N,{children:[e.jsx(C,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(b,{className:"text-base",children:["Contact ",i+1]}),e.jsx(x,{type:"button",variant:"ghost",size:"sm",onClick:()=>W(i),children:"Remove"})]})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{children:"Contact Name *"}),e.jsx(d,{value:s.contact_name,onChange:c=>_(i,"contact_name",c.target.value),placeholder:"Full name"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Relationship *"}),e.jsx(d,{value:s.relationship,onChange:c=>_(i,"relationship",c.target.value),placeholder:"e.g., Mother, Father, Grandparent"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{children:"Phone Number *"}),e.jsx(d,{value:s.phone,onChange:c=>_(i,"phone",c.target.value),placeholder:"Phone number"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Email"}),e.jsx(d,{type:"email",value:s.email,onChange:c=>_(i,"email",c.target.value),placeholder:"Email address"})]})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Address"}),e.jsx(f,{value:s.address,onChange:c=>_(i,"address",c.target.value),placeholder:"Full address",rows:2})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{checked:s.is_primary,onCheckedChange:c=>_(i,"is_primary",c)}),e.jsx(t,{children:"Primary Contact"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{checked:s.can_authorize_treatment,onCheckedChange:c=>_(i,"can_authorize_treatment",c)}),e.jsx(t,{children:"Can Authorize Medical Treatment"})]})]})]})]},i))})]});case 5:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Consent Forms"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{id:"transport_consent",checked:n.transport_consent,onCheckedChange:s=>r("transport_consent",s)}),e.jsx(t,{htmlFor:"transport_consent",children:"I consent to my child using the transport service"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{id:"medical_consent",checked:n.medical_consent,onCheckedChange:s=>r("medical_consent",s)}),e.jsx(t,{htmlFor:"medical_consent",children:"I consent to emergency medical treatment if required"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{id:"photo_consent",checked:n.photo_consent,onCheckedChange:s=>r("photo_consent",s)}),e.jsx(t,{htmlFor:"photo_consent",children:"I consent to photos/videos being taken for safety purposes"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{id:"data_protection_consent",checked:n.data_protection_consent,onCheckedChange:s=>r("data_protection_consent",s)}),e.jsx(t,{htmlFor:"data_protection_consent",children:"I consent to my data being processed in accordance with GDPR"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Communication Preferences"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{id:"sms_notifications",checked:n.notification_preferences.sms,onCheckedChange:s=>r("notification_preferences",{...n.notification_preferences,sms:s})}),e.jsx(t,{htmlFor:"sms_notifications",children:"SMS Notifications"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{id:"email_notifications",checked:n.notification_preferences.email,onCheckedChange:s=>r("notification_preferences",{...n.notification_preferences,email:s})}),e.jsx(t,{htmlFor:"email_notifications",children:"Email Notifications"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{id:"app_notifications",checked:n.notification_preferences.app,onCheckedChange:s=>r("notification_preferences",{...n.notification_preferences,app:s})}),e.jsx(t,{htmlFor:"app_notifications",children:"App Notifications"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{id:"emergency_alerts",checked:n.notification_preferences.emergency_alerts,onCheckedChange:s=>r("notification_preferences",{...n.notification_preferences,emergency_alerts:s})}),e.jsx(t,{htmlFor:"emergency_alerts",children:"Emergency Alerts"})]})]})]})]});case 6:return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Review Registration Details"}),e.jsxs(N,{children:[e.jsx(C,{children:e.jsx(b,{className:"text-base",children:"Basic Information"})}),e.jsx(w,{className:"space-y-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Name:"})," ",n.first_name," ",n.last_name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date of Birth:"})," ",n.date_of_birth]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Gender:"})," ",n.gender]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Nationality:"})," ",n.nationality]}),e.jsxs("div",{children:[e.jsx("strong",{children:"School:"})," ",n.school_name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Grade:"})," ",n.grade_level]})]})})]}),e.jsxs(N,{children:[e.jsx(C,{children:e.jsx(b,{className:"text-base",children:"Transport Details"})}),e.jsx(w,{className:"space-y-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Pickup:"})," ",n.pickup_location]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Dropoff:"})," ",n.dropoff_location]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Type:"})," ",n.transport_type]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Morning Time:"})," ",n.morning_pickup_time]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Afternoon Time:"})," ",n.afternoon_dropoff_time]})]})})]}),e.jsxs(N,{children:[e.jsx(C,{children:e.jsx(b,{className:"text-base",children:"Emergency Contacts"})}),e.jsx(w,{children:n.emergency_contacts.length===0?e.jsx("p",{className:"text-gray-500",children:"No emergency contacts added"}):e.jsx("div",{className:"space-y-2",children:n.emergency_contacts.map((s,i)=>e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:s.contact_name})," (",s.relationship,") - ",s.phone,s.is_primary&&e.jsx(E,{className:"ml-2",children:"Primary"})]},i))})})]}),e.jsxs(N,{children:[e.jsx(C,{children:e.jsx(b,{className:"text-base",children:"Consent Status"})}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{className:`w-4 h-4 ${n.transport_consent?"text-green-500":"text-gray-300"}`}),e.jsx("span",{children:"Transport Consent"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{className:`w-4 h-4 ${n.medical_consent?"text-green-500":"text-gray-300"}`}),e.jsx("span",{children:"Medical Consent"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{className:`w-4 h-4 ${n.photo_consent?"text-green-500":"text-gray-300"}`}),e.jsx("span",{children:"Photo Consent"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{className:`w-4 h-4 ${n.data_protection_consent?"text-green-500":"text-gray-300"}`}),e.jsx("span",{children:"Data Protection Consent"})]})]})})]})]})});default:return null}};return e.jsx(ee,{open:J,onOpenChange:P,children:e.jsxs(se,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ae,{children:[e.jsx(ne,{children:"Register Child for Transport"}),e.jsx(te,{children:"Complete the registration process for your child's transport service."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{children:["Step ",p," of ",l]}),e.jsxs("span",{children:[Math.round(o),"% Complete"]})]}),e.jsx(be,{value:o,className:"w-full"}),e.jsx("div",{className:"flex items-center justify-between",children:Q.map((s,i)=>{const c=s.icon,g=p===s.id,h=p>s.id;return e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${h?"bg-green-500 text-white":g?"bg-blue-500 text-white":"bg-gray-200 text-gray-500"}`,children:h?e.jsx(y,{className:"w-4 h-4"}):e.jsx(c,{className:"w-4 h-4"})}),e.jsx("span",{className:`text-xs text-center ${g?"text-blue-600 font-medium":"text-gray-500"}`,children:s.name})]},s.id)})})]}),e.jsx("div",{className:"py-6",children:K()}),e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t",children:[e.jsxs(x,{type:"button",variant:"outline",onClick:R,disabled:p===1,children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Previous"]}),e.jsx("div",{className:"flex items-center space-x-2",children:p<l?e.jsxs(x,{onClick:ie,children:["Next",e.jsx(we,{className:"w-4 h-4 ml-2"})]}):e.jsx(x,{onClick:re,disabled:k.isPending,children:k.isPending?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-4 h-4 mr-2 animate-spin"}),"Registering..."]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Complete Registration"]})})})]})]})})},We=()=>{var le;const{user:J,profile:P,loading:q}=je();v.useState(!1);const[T,A]=v.useState(!1),[z,p]=v.useState(null),[G,n]=v.useState(null),[m,D]=v.useState(null),[l,o]=v.useState(null),[Q,k]=v.useState(!1),[S,ie]=v.useState(null),{data:R=[],isLoading:re,error:r}=Te();if(Ae(),De(S==null?void 0:S.id,ce(new Date().setDate(new Date().getDate()-7),"yyyy-MM-dd"),ce(new Date,"yyyy-MM-dd")),Ee(S==null?void 0:S.id),q)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading child management..."})]})});if(!J||!P)return e.jsx(de,{to:"/auth",replace:!0});if(P.role!=="parent")return e.jsx(de,{to:"/dashboard",replace:!0});if(r)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Me,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Error Loading Children"}),e.jsx("p",{className:"text-muted-foreground",children:"Failed to load child information. Please try again."})]})});const _=[{id:"1",childId:"1",childName:"Emma",type:"pickup",time:"15:35",date:"2024-01-15",location:"Elmwood Primary School",status:"completed",driver:"John Smith",vehicle:"LSR-001"},{id:"2",childId:"2",childName:"James",type:"dropoff",time:"08:02",date:"2024-01-15",location:"Elmwood Primary School",status:"completed",driver:"John Smith",vehicle:"LSR-001"},{id:"3",childId:"1",childName:"Emma",type:"absence",date:"2024-01-12",reason:"Medical appointment",status:"approved"}],Y=a=>{switch(a){case"at_home":return e.jsx(E,{className:"bg-blue-100 text-blue-800 hover:bg-blue-100",children:"At Home"});case"on_transport":return e.jsx(E,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"On Transport"});case"at_school":return e.jsx(E,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"At School"});case"absent":return e.jsx(E,{className:"bg-gray-100 text-gray-800 hover:bg-gray-100",children:"Absent"});default:return e.jsx(E,{variant:"secondary",children:a})}},W=a=>{switch(a){case"pickup":return e.jsx(Z,{className:"w-4 h-4 text-green-600"});case"dropoff":return e.jsx(Z,{className:"w-4 h-4 text-blue-600"});case"absence":return e.jsx(he,{className:"w-4 h-4 text-red-600"});default:return e.jsx(H,{className:"w-4 h-4"})}},K=(a,F)=>{p(a),console.log(`Starting live tracking for ${F}`),window.open(`/tracking/${a}`,"_blank")},s=(a,F)=>{n(a),console.log(`Opening schedule for ${F}`),window.open(`/schedule/${a}`,"_blank")},i=(a,F)=>{D(a),console.log(`Opening call options for ${F}`)},c=a=>{window.location.href=`tel:${a}`,D(null)},g=a=>{window.location.href=`tel:${a}`,D(null)},h=a=>R.find(F=>F.id===a),I=a=>{o({...a}),k(!0)},ue=()=>{l&&(console.log("Saving child updates:",l),k(!1),o(null))},fe=()=>{k(!1),o(null)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(oe,{className:"w-8 h-8 text-blue-600"}),"My Children"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your children's transport and school information"})]}),e.jsxs(x,{className:"bg-blue-600 hover:bg-blue-700",onClick:()=>A(!0),children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Add Child (Comprehensive)"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:R.map(a=>e.jsxs(N,{className:"relative",children:[e.jsx(C,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(oe,{className:"w-8 h-8 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs(b,{className:"text-xl",children:[a.firstName," ",a.lastName]}),e.jsxs("p",{className:"text-gray-600",children:[a.grade," • Age ",a.age]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[Y(a.currentStatus),e.jsx(x,{variant:"outline",size:"sm",onClick:()=>I(a),children:e.jsx(Pe,{className:"w-4 h-4"})})]})]})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{children:a.school})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{children:a.route})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{children:["Pickup: ",a.pickupTime]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{children:["Dropoff: ",a.dropoffTime]})]}),a.currentStatus==="on_transport"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 col-span-2",children:[e.jsx(me,{className:"w-4 h-4 text-orange-600"}),e.jsxs("span",{className:"text-orange-600 font-medium",children:["Last seen: ",a.lastSeen," • ETA: ",a.estimatedArrival]})]}),e.jsxs("div",{className:"flex items-center gap-2 col-span-2",children:[e.jsx(pe,{className:"w-4 h-4 text-gray-600"}),e.jsxs("span",{className:"text-gray-600",children:["Driver: ",a.driver]})]})]})]}),a.medicalNotes&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-yellow-800 mb-1",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Medical Notes"})]}),e.jsx("p",{className:"text-yellow-700 text-sm",children:a.medicalNotes})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{size:"sm",className:"flex-1 bg-blue-600 hover:bg-blue-700",onClick:()=>K(a.id,a.firstName),disabled:z===a.id,children:[e.jsx(me,{className:"w-4 h-4 mr-1"}),z===a.id?"Tracking...":"Track Live"]}),e.jsxs(x,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>s(a.id,a.firstName),children:[e.jsx(xe,{className:"w-4 h-4 mr-1"}),"Schedule"]}),e.jsx(x,{variant:"outline",size:"sm",onClick:()=>i(a.id,a.firstName),children:e.jsx(M,{className:"w-4 h-4"})})]})]})]},a.id))}),e.jsxs(qe,{defaultValue:"activity",className:"space-y-6",children:[e.jsxs(Re,{className:"grid w-full grid-cols-4",children:[e.jsx(V,{value:"activity",children:"Recent Activity"}),e.jsx(V,{value:"schedule",children:"Weekly Schedule"}),e.jsx(V,{value:"attendance",children:"Attendance"}),e.jsx(V,{value:"contacts",children:"Emergency Contacts"})]}),e.jsx(U,{value:"activity",className:"space-y-4",children:e.jsxs(N,{children:[e.jsx(C,{children:e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Recent Transport Activity"]})}),e.jsx(w,{children:e.jsx("div",{className:"space-y-4",children:_.map(a=>e.jsxs("div",{className:"flex items-center gap-4 p-3 border rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0",children:W(a.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-medium",children:[a.childName," - ",a.type==="pickup"?"Picked up":a.type==="dropoff"?"Dropped off":"Absence reported"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[a.time&&e.jsxs("span",{children:[a.time," • "]}),a.date,a.location&&e.jsxs("span",{children:[" • ",a.location]}),a.driver&&e.jsxs("span",{children:[" • Driver: ",a.driver]})]}),a.reason&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Reason: ",a.reason]})]}),e.jsx("div",{children:e.jsx(y,{className:"w-5 h-5 text-green-600"})})]},a.id))})})]})}),e.jsx(U,{value:"schedule",className:"space-y-4",children:e.jsxs(N,{children:[e.jsx(C,{children:e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),"Weekly Transport Schedule"]})}),e.jsx(w,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-7 gap-4",children:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(a=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsx("h3",{className:"font-medium text-center mb-3",children:a}),e.jsx("div",{className:"space-y-2",children:a!=="Saturday"&&a!=="Sunday"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs",children:[e.jsx("div",{className:"font-medium",children:"Morning Pickup"}),e.jsx("div",{className:"text-gray-600",children:"08:00 - Route 1"})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("div",{className:"font-medium",children:"Afternoon Return"}),e.jsx("div",{className:"text-gray-600",children:"15:30 - Route 1"})]})]}):e.jsx("div",{className:"text-center text-gray-400 text-xs py-4",children:"No transport"})})]},a))})})]})}),e.jsx(U,{value:"attendance",className:"space-y-4",children:e.jsxs(N,{children:[e.jsx(C,{children:e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5"}),"Attendance Summary"]})}),e.jsx(w,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:R.map(a=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold mb-3",children:[a.firstName," ",a.lastName]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"This Month"}),e.jsx("span",{className:"font-medium",children:"18/20 days"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"This Term"}),e.jsx("span",{className:"font-medium",children:"85/90 days"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Attendance Rate"}),e.jsx("span",{className:"font-medium text-green-600",children:"94%"})]}),e.jsx("div",{className:"bg-green-100 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 rounded-full h-2 w-[94%]"})})]})]},a.id))})})]})}),e.jsx(U,{value:"contacts",className:"space-y-4",children:e.jsx(Le,{})})]}),e.jsx(ze,{open:T,onOpenChange:A,onChildAdded:()=>{A(!1)}}),e.jsx(ee,{open:!!m,onOpenChange:()=>D(null),children:e.jsxs(se,{className:"max-w-md",children:[e.jsxs(ae,{children:[e.jsxs(ne,{children:["Contact Options - ",m&&((le=h(m))==null?void 0:le.firstName)]}),e.jsx(te,{children:"Choose who you'd like to contact regarding your child's transport."})]}),e.jsx("div",{className:"space-y-4",children:m&&h(m)&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{className:"w-full bg-red-600 hover:bg-red-700",onClick:()=>c(h(m).emergencyContact),children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Emergency Contact"]}),e.jsxs(x,{variant:"outline",className:"w-full",onClick:()=>g(h(m).driverPhone),children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Call Driver (",h(m).driver,")"]}),e.jsxs(x,{variant:"outline",className:"w-full",onClick:()=>g(h(m).transportOffice),children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Call Transport Office"]})]})})]})}),e.jsx(ee,{open:Q,onOpenChange:k,children:e.jsxs(se,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ae,{children:[e.jsx(ne,{children:"Edit Child Information"}),e.jsx(te,{children:"Update your child's transport and school information."})]}),l&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-firstName",children:"First Name"}),e.jsx(d,{id:"edit-firstName",value:l.firstName,onChange:a=>o({...l,firstName:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-lastName",children:"Last Name"}),e.jsx(d,{id:"edit-lastName",value:l.lastName,onChange:a=>o({...l,lastName:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-age",children:"Age"}),e.jsx(d,{id:"edit-age",type:"number",value:l.age,onChange:a=>o({...l,age:parseInt(a.target.value)})})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-grade",children:"Grade"}),e.jsx(d,{id:"edit-grade",value:l.grade,onChange:a=>o({...l,grade:a.target.value})})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"School Information"}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-school",children:"School"}),e.jsx(d,{id:"edit-school",value:l.school,onChange:a=>o({...l,school:a.target.value})})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Transport Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-pickupTime",children:"Pickup Time"}),e.jsx(d,{id:"edit-pickupTime",type:"time",value:l.pickupTime,onChange:a=>o({...l,pickupTime:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-dropoffTime",children:"Dropoff Time"}),e.jsx(d,{id:"edit-dropoffTime",type:"time",value:l.dropoffTime,onChange:a=>o({...l,dropoffTime:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-route",children:"Route"}),e.jsx(d,{id:"edit-route",value:l.route,onChange:a=>o({...l,route:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-emergencyContact",children:"Emergency Contact"}),e.jsx(d,{id:"edit-emergencyContact",value:l.emergencyContact,onChange:a=>o({...l,emergencyContact:a.target.value})})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Medical Information"}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-medicalNotes",children:"Medical Notes"}),e.jsx(f,{id:"edit-medicalNotes",value:l.medicalNotes,onChange:a=>o({...l,medicalNotes:a.target.value}),rows:3,placeholder:"Any medical conditions, allergies, or special requirements..."})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Status Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-currentStatus",children:"Current Status"}),e.jsxs(L,{value:l.currentStatus,onValueChange:a=>o({...l,currentStatus:a}),children:[e.jsx(B,{children:e.jsx(O,{})}),e.jsxs($,{children:[e.jsx(j,{value:"at_home",children:"At Home"}),e.jsx(j,{value:"on_transport",children:"On Transport"}),e.jsx(j,{value:"at_school",children:"At School"}),e.jsx(j,{value:"absent",children:"Absent"})]})]})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"edit-transportStatus",children:"Transport Status"}),e.jsxs(L,{value:l.transportStatus,onValueChange:a=>o({...l,transportStatus:a}),children:[e.jsx(B,{children:e.jsx(O,{})}),e.jsxs($,{children:[e.jsx(j,{value:"active",children:"Active"}),e.jsx(j,{value:"suspended",children:"Suspended"}),e.jsx(j,{value:"cancelled",children:"Cancelled"})]})]})]})]})]})]}),e.jsxs(Ie,{className:"flex gap-2",children:[e.jsx(x,{variant:"outline",onClick:fe,children:"Cancel"}),e.jsx(x,{onClick:ue,className:"bg-blue-600 hover:bg-blue-700",children:"Save Changes"})]})]})})]})};export{We as default};
