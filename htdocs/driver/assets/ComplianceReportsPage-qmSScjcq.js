import{m as T,j as e,N as f,H as U,J as g,S as N,B as d,aq as q,D as A,e as a,g as n,h as i,U as E,k as l,E as v,b as M,C as w,n as y,F as B,d as S}from"./main-DVuL102c.js";import{u as V}from"./useComplianceData-vVMk3D_F.js";const G=()=>{const{user:b,profile:c,loading:C}=T();if(C)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading..."})]})});if(!b||!c)return e.jsx(f,{to:"/auth",replace:!0});if(c.role!=="admin"&&c.role!=="council")return e.jsx(f,{to:"/",replace:!0});const{data:t,isLoading:_}=V(),{data:x,isLoading:k}=U({queryKey:["recent-violations"],queryFn:async()=>{try{const{data:s,error:m}=await g.from("compliance_violations").select("*").eq("organization_id",c.organization_id).order("violation_date",{ascending:!1}).limit(10);if(m)return console.warn("Error fetching compliance violations:",m),[];const h=[...new Set((s==null?void 0:s.filter(r=>r.driver_id).map(r=>r.driver_id))||[])];let u=[];if(h.length>0){const{data:r}=await g.from("profiles").select("id, first_name, last_name").in("id",h);u=r||[]}const o=new Map(u.map(r=>[r.id,r]));return(s==null?void 0:s.map(r=>{var j,p;return{id:r.id,driver:r.driver_id&&o.has(r.driver_id)&&`${((j=o.get(r.driver_id))==null?void 0:j.first_name)||""} ${((p=o.get(r.driver_id))==null?void 0:p.last_name)||""}`.trim()||"Unknown Driver",type:r.violation_type||"Unknown Violation",severity:r.severity||"Unknown",date:new Date(r.violation_date).toLocaleDateString(),status:r.status||"Unknown"}}))||[]}catch(s){return console.warn("Error fetching compliance violations:",s),[]}},enabled:!!(c!=null&&c.organization_id)}),D=_||k,R=s=>{switch(s){case"high":return"destructive";case"medium":return"secondary";case"low":return"outline";default:return"outline"}},L=s=>{switch(s){case"resolved":return"default";case"pending":return"secondary";default:return"outline"}};return D?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading compliance reports..."})]})}):e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(N,{className:"w-8 h-8 text-green-600"}),"Compliance Reports"]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Monitor compliance analytics and generate comprehensive reports"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(d,{variant:"outline",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Refresh"]}),e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4"}),"Export Report"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(a,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Total Drivers"}),e.jsx(E,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(t==null?void 0:t.totalDrivers)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Active drivers"})]})]}),e.jsxs(a,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Active Violations"}),e.jsx(v,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:(t==null?void 0:t.activeViolations)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Requires attention"})]})]}),e.jsxs(a,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Critical Issues"}),e.jsx(N,{className:"h-4 w-4 text-red-500"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:(t==null?void 0:t.criticalAlerts)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Requires immediate attention"})]})]}),e.jsxs(a,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Compliance Score"}),e.jsx(M,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(l,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[(t==null?void 0:t.overallScore)||0,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Overall compliance"})]})]})]}),e.jsxs(a,{children:[e.jsx(n,{children:e.jsxs(i,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5"}),"Recent Compliance Issues"]})}),e.jsx(l,{children:e.jsx("div",{className:"space-y-3",children:!x||x.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(w,{className:"h-12 w-12 mx-auto mb-4 text-green-600"}),e.jsx("p",{className:"text-lg font-medium",children:"No recent violations"}),e.jsx("p",{children:"All compliance requirements are being met"})]}):x.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.driver}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.type})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{variant:R(s.severity),children:s.severity}),e.jsx(y,{variant:L(s.status),children:s.status}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.date})]})]},s.id))})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs(a,{children:[e.jsx(n,{children:e.jsxs(i,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),"Driver Compliance"]})}),e.jsxs(l,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Comprehensive report on driver licenses, certifications, and violations."}),e.jsx(d,{variant:"outline",className:"w-full",children:"Generate Report"})]})]}),e.jsxs(a,{children:[e.jsx(n,{children:e.jsxs(i,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5"}),"Expiry Tracking"]})}),e.jsxs(l,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Track upcoming expirations for licenses, MOTs, and insurance."}),e.jsx(d,{variant:"outline",className:"w-full",children:"Generate Report"})]})]}),e.jsxs(a,{children:[e.jsx(n,{children:e.jsxs(i,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"Audit Summary"]})}),e.jsxs(l,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Monthly audit summary with compliance scores and recommendations."}),e.jsx(d,{variant:"outline",className:"w-full",children:"Generate Report"})]})]})]}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["Last updated: ",new Date().toLocaleDateString()]})]})};export{G as default};
