import{u as $,y as z,j as e,A as _,n as h,B as l,X as C,z as T,E as N,d as E,m as I,x as F,G as B,N as D,H as b,J as y,e as x,k as m,g as j,h as g,T as A,U as q,W as S,K as Y,O as K,Q as P,V as M,Y as R,C as V,b as Q,f as H,R as W,F as G}from"./main-DVuL102c.js";import{u as k}from"./useTrialManagement-BpZIu_cZ.js";import{S as J}from"./star-Dk-sf7Q0.js";import{A as U}from"./award-D5hdS4i_.js";import{U as L}from"./user-check-ocIY3ZDi.js";const O=({className:a=""})=>{const{data:s,isLoading:c,error:d}=k(),i=$(),[o,n]=z.useState(!0);if(c||!o||d||!s||!s.isActive)return null;const v=t=>t<=3?"destructive":(t<=7,"default"),f=t=>t<=3?e.jsx(N,{className:"h-4 w-4"}):t<=7?e.jsx(E,{className:"h-4 w-4"}):e.jsx(J,{className:"h-4 w-4"}),p=t=>t<=3?"Trial Expiring Soon":t<=7?"Trial Ending Soon":"Free Trial Active",w=t=>t<=3?`Your trial expires in ${t} day${t===1?"":"s"}. Upgrade now to continue using all features.`:t<=7?`Your trial ends in ${t} days. Upgrade to keep your data and continue using the platform.`:`You have ${t} days left in your free trial. Upgrade anytime to unlock all features.`;return e.jsxs(_,{className:`mb-6 ${a}`,variant:v(s.daysLeft),children:[f(s.daysLeft),e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:p(s.daysLeft)}),e.jsxs(h,{variant:"outline",children:[s.currentDrivers,"/",s.maxDrivers," Drivers"]}),e.jsxs(h,{variant:"secondary",children:[s.daysLeft," days left"]})]}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>n(!1),className:"h-6 w-6 p-0 hover:bg-background/20",children:e.jsx(C,{className:"h-4 w-4"})})]}),e.jsxs(T,{className:"flex items-center justify-between",children:[e.jsx("span",{children:w(s.daysLeft)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{size:"sm",onClick:()=>i("/subscriptions"),variant:s.daysLeft<=3?"default":"outline",children:s.daysLeft<=3?"Upgrade Now":"View Plans"}),s.daysLeft>3&&e.jsx(l,{size:"sm",variant:"ghost",onClick:()=>i("/subscriptions"),children:"Learn More"})]})]})]})},X=({className:a=""})=>{const{data:s,isLoading:c}=k(),d=$(),[i,o]=z.useState(!0);return c||!s||!i||s.isActive||s.daysLeft>0?null:e.jsxs(_,{className:`mb-6 ${a}`,variant:"destructive",children:[e.jsx(N,{className:"h-4 w-4"}),e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:"font-medium",children:"Trial Expired"}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>o(!1),className:"h-6 w-6 p-0 hover:bg-destructive/20",children:e.jsx(C,{className:"h-4 w-4"})})]}),e.jsxs(T,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Your free trial has expired. Upgrade to a paid plan to continue using the platform and access your data."}),e.jsx(l,{size:"sm",onClick:()=>d("/subscriptions"),variant:"destructive",children:"Upgrade Now"})]})]})},Z=({className:a=""})=>{const{data:s,isLoading:c}=k(),d=$(),[i,o]=z.useState(!0);if(c||!s||!i)return null;const n=s.currentDrivers/s.maxDrivers*100;return n<80?null:e.jsxs(_,{className:`mb-6 ${a}`,variant:n>=100?"destructive":"default",children:[e.jsx(N,{className:"h-4 w-4"}),e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:"font-medium",children:n>=100?"Driver Limit Reached":"Approaching Driver Limit"}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>o(!1),className:"h-6 w-6 p-0 hover:bg-background/20",children:e.jsx(C,{className:"h-4 w-4"})})]}),e.jsxs(T,{className:"flex items-center justify-between",children:[e.jsx("span",{children:n>=100?`You've reached your limit of ${s.maxDrivers} drivers. Upgrade to add more drivers.`:`You're using ${s.currentDrivers} of ${s.maxDrivers} drivers. Consider upgrading soon.`}),e.jsx(l,{size:"sm",onClick:()=>d("/subscriptions"),variant:n>=100?"destructive":"outline",children:n>=100?"Upgrade Now":"View Plans"})]})]})};function ne(){const{profile:a}=I(),s=F();if(B(),(a==null?void 0:a.role)==="driver")return e.jsx(D,{to:"/driver-dashboard",replace:!0});if((a==null?void 0:a.role)==="mechanic")return e.jsx(D,{to:"/mechanic-dashboard",replace:!0});const{data:c=[]}=b({queryKey:["vehicles",a==null?void 0:a.organization_id],queryFn:async()=>{if(!(a!=null&&a.organization_id))return[];const{data:t,error:r}=await y.from("vehicles").select("*").eq("organization_id",a.organization_id).limit(100);return r?(console.error("Error fetching vehicles:",r),[]):t||[]},enabled:!!(a!=null&&a.organization_id)}),{data:d=[]}=b({queryKey:["drivers",a==null?void 0:a.organization_id],queryFn:async()=>{if(!(a!=null&&a.organization_id))return[];const{data:t,error:r}=await y.from("profiles").select("*").eq("role","driver").eq("organization_id",a.organization_id).limit(100);return r?(console.error("Error fetching drivers:",r),[]):t||[]},enabled:!!(a!=null&&a.organization_id)}),{data:i=[]}=b({queryKey:["recent-incidents",a==null?void 0:a.organization_id],queryFn:async()=>{if(!(a!=null&&a.organization_id))return[];const{data:t,error:r}=await y.from("incidents").select("*").eq("organization_id",a.organization_id).order("created_at",{ascending:!1}).limit(5);return r?(console.error("Error fetching incidents:",r),[]):t||[]},enabled:!!(a!=null&&a.organization_id)}),{data:o=[]}=b({queryKey:["maintenance-requests",a==null?void 0:a.organization_id],queryFn:async()=>{if(!(a!=null&&a.organization_id))return[];const{data:t,error:r}=await y.from("maintenance_requests").select("*").eq("organization_id",a.organization_id).order("created_at",{ascending:!1}).limit(10);return r?(console.error("Error fetching maintenance requests:",r),[]):t||[]},enabled:!!(a!=null&&a.organization_id)}),n=c.filter(t=>t.status==="active").length,v=d.filter(t=>t.is_active).length,f=o.filter(t=>t.status==="pending").length,p=i.length,w=[{label:"Add Vehicle",icon:A,href:"/vehicles"},{label:"Add Driver",icon:q,href:"/drivers"},{label:"Create Route",icon:W,href:"/routes"},{label:"View Reports",icon:G,href:"/analytics"}];return e.jsxs("div",{className:`${s?"space-y-4":"space-y-6"}`,children:[e.jsx(O,{}),e.jsx(X,{}),e.jsx(Z,{}),e.jsxs("div",{className:`${s?"space-y-3":"flex items-center justify-between"}`,children:[e.jsxs("div",{children:[e.jsx("h1",{className:`${s?"text-2xl":"text-3xl"} font-bold`,children:"Dashboard"}),e.jsxs("p",{className:`text-muted-foreground ${s?"text-sm":""}`,children:["Welcome back, ",(a==null?void 0:a.first_name)||"User","! Here's your fleet overview."]})]}),e.jsx("div",{className:`flex ${s?"flex-col space-y-2":"gap-2"}`})]}),(a==null?void 0:a.role)==="admin"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(x,{className:"border-purple-200 bg-purple-50 action-card",children:e.jsx(m,{className:`${s?"p-3":"p-4"}`,children:e.jsxs("div",{className:`${s?"space-y-3":"flex items-center justify-between"}`,children:[e.jsxs("div",{className:`flex items-center ${s?"space-x-2":"space-x-3"}`,children:[e.jsx(U,{className:`${s?"h-4 w-4":"h-5 w-5"} text-purple-600`}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-medium text-purple-900 ${s?"text-sm":""}`,children:"Driver Training Management"}),e.jsx("p",{className:`${s?"text-xs":"text-sm"} text-purple-700`,children:"Assign training modules to drivers and track their completion progress."})]})]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>window.location.href="/admin/training-management",className:`border-purple-300 text-purple-700 hover:bg-purple-100 admin-button-secondary ${s?"w-full":""}`,children:[e.jsx(U,{className:`${s?"mr-1":"mr-2"} h-4 w-4`}),s?"Manage":"Manage Training"]})]})})}),e.jsx(x,{className:"border-blue-200 bg-blue-50 action-card",children:e.jsx(m,{className:`${s?"p-3":"p-4"}`,children:e.jsxs("div",{className:`${s?"space-y-3":"flex items-center justify-between"}`,children:[e.jsxs("div",{className:`flex items-center ${s?"space-x-2":"space-x-3"}`,children:[e.jsx(L,{className:`${s?"h-4 w-4":"h-5 w-5"} text-blue-600`}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-medium text-blue-900 ${s?"text-sm":""}`,children:"Mechanic Request Management"}),e.jsx("p",{className:`${s?"text-xs":"text-sm"} text-blue-700`,children:"Manage mechanic requests and working relationships for your organization."})]})]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>window.location.href="/admin/mechanic-requests",className:`border-blue-300 text-blue-700 hover:bg-blue-100 admin-button-secondary ${s?"w-full":""}`,children:[e.jsx(L,{className:`${s?"mr-1":"mr-2"} h-4 w-4`}),s?"Manage":"Manage Requests"]})]})})})]}),e.jsxs("div",{className:`grid ${s?"grid-cols-2 gap-3":"gap-4 md:grid-cols-2 lg:grid-cols-4"}`,children:[e.jsxs(x,{className:"stats-card",children:[e.jsxs(j,{className:`flex flex-row items-center justify-between space-y-0 ${s?"pb-1":"pb-2"}`,children:[e.jsx(g,{className:`${s?"text-xs":"text-sm"} font-medium stats-label`,children:"Total Vehicles"}),e.jsx(A,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{className:s?"pt-1":"",children:[e.jsx("div",{className:`${s?"text-lg":"text-2xl"} font-bold stats-number`,children:c.length}),e.jsxs("p",{className:"text-xs text-muted-foreground stats-label",children:[n," active"]})]})]}),e.jsxs(x,{className:"stats-card",children:[e.jsxs(j,{className:`flex flex-row items-center justify-between space-y-0 ${s?"pb-1":"pb-2"}`,children:[e.jsx(g,{className:`${s?"text-xs":"text-sm"} font-medium stats-label`,children:"Active Drivers"}),e.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{className:s?"pt-1":"",children:[e.jsx("div",{className:`${s?"text-lg":"text-2xl"} font-bold stats-number`,children:v}),e.jsxs("p",{className:"text-xs text-muted-foreground stats-label",children:["of ",d.length," total drivers"]})]})]}),e.jsxs(x,{className:"stats-card",children:[e.jsxs(j,{className:`flex flex-row items-center justify-between space-y-0 ${s?"pb-1":"pb-2"}`,children:[e.jsx(g,{className:`${s?"text-xs":"text-sm"} font-medium stats-label`,children:"Pending Maintenance"}),e.jsx(S,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{className:s?"pt-1":"",children:[e.jsx("div",{className:`${s?"text-lg":"text-2xl"} font-bold stats-number`,children:f}),e.jsx("p",{className:"text-xs text-muted-foreground stats-label",children:"requests awaiting attention"})]})]}),e.jsxs(x,{className:"stats-card",children:[e.jsxs(j,{className:`flex flex-row items-center justify-between space-y-0 ${s?"pb-1":"pb-2"}`,children:[e.jsx(g,{className:`${s?"text-xs":"text-sm"} font-medium stats-label`,children:"Recent Incidents"}),e.jsx(N,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{className:s?"pt-1":"",children:[e.jsx("div",{className:`${s?"text-lg":"text-2xl"} font-bold stats-number`,children:p}),e.jsx("p",{className:"text-xs text-muted-foreground stats-label",children:"in the last 7 days"})]})]})]}),e.jsxs("div",{className:`grid ${s?"gap-4":"gap-6 md:grid-cols-2 lg:grid-cols-7"}`,children:[e.jsxs(x,{className:`${s?"":"col-span-4"} dashboard-card`,children:[e.jsx(j,{className:s?"pb-3":"",children:e.jsxs(g,{className:`flex items-center space-x-2 ${s?"text-lg":""}`,children:[e.jsx(Y,{className:`${s?"w-4 h-4":"w-5 h-5"}`}),e.jsx("span",{children:"Recent Activity"})]})}),e.jsx(m,{children:e.jsxs(K,{defaultValue:"incidents",className:"w-full",children:[e.jsxs(P,{className:"grid w-full grid-cols-2 tabs-list",children:[e.jsx(M,{value:"incidents",className:"tabs-trigger",children:"Recent Incidents"}),e.jsx(M,{value:"maintenance",className:"tabs-trigger",children:"Maintenance"})]}),e.jsx(R,{value:"incidents",className:"space-y-4",children:i.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(V,{className:"w-12 h-12 mx-auto mb-2 text-green-500"}),e.jsx("p",{children:"No recent incidents - Great job!"})]}):i.slice(0,5).map((t,r)=>{var u;return e.jsxs("div",{className:"flex items-center space-x-4 rounded-lg border p-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(N,{className:"w-5 h-5 text-orange-500"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:t.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[(u=t.description)==null?void 0:u.substring(0,100),"..."]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(t.created_at).toLocaleDateString()})]}),e.jsx(h,{variant:t.severity==="high"?"destructive":t.severity==="medium"?"default":"secondary",children:t.severity})]},t.id||r)})}),e.jsx(R,{value:"maintenance",className:"space-y-4",children:o.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(V,{className:"w-12 h-12 mx-auto mb-2 text-green-500"}),e.jsx("p",{children:"No pending maintenance requests"})]}):o.slice(0,5).map((t,r)=>{var u;return e.jsxs("div",{className:"flex items-center space-x-4 rounded-lg border p-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(S,{className:"w-5 h-5 text-blue-500"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:"Maintenance Request"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[(u=t.description)==null?void 0:u.substring(0,100),"..."]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(t.created_at).toLocaleDateString()})]}),e.jsx(h,{variant:t.status==="pending"?"default":t.status==="in_progress"?"secondary":"outline",children:t.status})]},t.id||r)})})]})})]}),e.jsxs(x,{className:"col-span-3",children:[e.jsx(j,{children:e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"w-5 h-5"}),e.jsx("span",{children:"Quick Actions"})]})}),e.jsxs(m,{className:"space-y-4",children:[e.jsx("div",{className:"grid gap-3",children:w.map((t,r)=>{const u=t.icon;return e.jsxs(l,{variant:"outline",className:"w-full justify-start",onClick:()=>window.location.href=t.href,children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),t.label]},r)})}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Fleet Status"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Vehicles Active"}),e.jsxs(h,{variant:"secondary",children:[n,"/",c.length]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Drivers Available"}),e.jsxs(h,{variant:"secondary",children:[v,"/",d.length]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Maintenance Due"}),e.jsx(h,{variant:f>0?"destructive":"secondary",children:f})]})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center space-x-2",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{children:"Today's Summary"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Active Routes"}),e.jsx("span",{className:"font-medium",children:"0"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Completed Jobs"}),e.jsx("span",{className:"font-medium",children:"0"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"New Incidents"}),e.jsx("span",{className:"font-medium",children:p})]})]})]})]})]})]})]})}export{ne as default};
