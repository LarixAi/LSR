import{m as _e,G as Ce,H as $,a2 as ee,J as D,al as X,j as e,E as T,B as c,X as De,e as j,g as y,h as N,k as g,W as L,i as se,n as v,aa as Te,C as ce,ao as Oe,r as m,N as ge,aq as pe,am as fe,S as ve,F as ye,au as Ne,I as J,ab as I,ac as V,ad as M,ae as K,af as a,O as Fe,Q as Re,V as Q,Y as We,ak as qe,an as Le,a4 as te,a5 as re,a6 as ae,a7 as le,a8 as ie,q as o,s as ze,aA as we,d as Ee,ag as Pe,Z as Ae}from"./main-DVuL102c.js";import{O as Ie}from"./OrganizationSelector-tvCrlQBp.js";import{P as be}from"./play-DTkR-tax.js";const Ve=({defectId:n,onClose:l})=>{const{profile:x}=_e(),p=Ce(),{data:d,isLoading:z}=$({queryKey:["defect",n],queryFn:async()=>{console.log("ðŸ” Fetching defect:",n);const{data:t,error:i}=await D.from("combined_defects").select(`
          id,
          defect_number,
          title,
          description,
          defect_type,
          severity,
          status,
          organization_id,
          source_type
        `).eq("id",n).single();if(i)throw console.error("âŒ Error fetching defect:",i),i;return console.log("âœ… Defect fetched:",t),t}}),{data:_=[],isLoading:O}=$({queryKey:["work-order-stages",n],queryFn:async()=>{console.log("ðŸ” Fetching work order stages for defect:",n);const{data:t,error:i}=await D.from("work_order_stages").select("*").eq("defect_id",n).order("stage_order");if(i)throw console.error("âŒ Error fetching stages:",i),i;return console.log("âœ… Stages fetched:",t),t||[]},enabled:!!n}),C=ee({mutationFn:async()=>{console.log("ðŸ”§ Starting work order for defect:",n),console.log("ðŸ”§ Using mechanic ID:",x==null?void 0:x.id),console.log("ðŸ”§ Defect type:",d==null?void 0:d.defect_type);const{data:t,error:i}=await D.rpc("start_work_order",{p_defect_id:n,p_mechanic_id:x==null?void 0:x.id});if(i)throw console.error("âŒ Error starting work order:",i),i;return console.log("âœ… Work order started:",t),t},onSuccess:()=>{p.invalidateQueries({queryKey:["work-order-stages",n]}),p.invalidateQueries({queryKey:["defect",n]}),X({title:"Work Order Started",description:"Work order has been initiated successfully."})},onError:t=>{console.error("âŒ Start work order failed:",t),X({title:"Error",description:"Failed to start work order. Please try again.",variant:"destructive"})}}),F=ee({mutationFn:async({stageId:t,status:i})=>{const{data:H,error:U}=await D.from("work_order_stages").update({status:i,started_at:i==="in_progress"?new Date().toISOString():void 0,completed_at:i==="completed"?new Date().toISOString():void 0,mechanic_id:x==null?void 0:x.id,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(U)throw U;return H},onSuccess:()=>{p.invalidateQueries({queryKey:["work-order-stages",n]})}}),B=ee({mutationFn:async()=>{const{data:t,error:i}=await D.rpc("complete_work_order",{p_defect_id:n,p_mechanic_id:x==null?void 0:x.id});if(i)throw i;return t},onSuccess:()=>{p.invalidateQueries({queryKey:["work-order-stages",n]}),p.invalidateQueries({queryKey:["defect",n]}),X({title:"Work Order Completed",description:"Work order has been completed successfully."})}});if(z)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading workflow..."})]})});if(!d)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx(T,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("p",{className:"text-red-500 mb-4",children:"Defect not found"}),e.jsx(c,{onClick:l,variant:"outline",children:"Close"})]});const w=_.filter(t=>t.status==="completed").length,b=_.length,E=b>0?w/b*100:0,R=d.status==="repairing",W=d.status==="reported"||d.status==="investigating";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Defect Workflow"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[d.defect_number," - ",d.title]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Type: ",d.defect_type," | Source: ",d.source_type]})]}),e.jsx(c,{onClick:l,variant:"outline",children:e.jsx(De,{className:"w-4 h-4"})})]}),e.jsxs(j,{className:"border-yellow-200 bg-yellow-50",children:[e.jsx(y,{children:e.jsx(N,{className:"text-yellow-800",children:"Debug Information"})}),e.jsx(g,{children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Defect ID:"})," ",n]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Defect Type:"})," ",d.defect_type]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",d.status]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Work Order Number:"})," Not Available"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Stages:"})," ",b]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Completed Stages:"})," ",w]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Can Start Work Order:"})," ",W?"Yes":"No"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Is Work Order Started:"})," ",R?"Yes":"No"]})]})})]}),e.jsxs(j,{children:[e.jsxs(y,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5"}),"Work Order Status"]}),e.jsx(se,{children:"Work Order Status"})]}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Progress"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[w," of ",b," stages completed"]})]}),e.jsx(v,{variant:d.status==="resolved"?"default":"secondary",children:d.status})]}),e.jsx(Te,{value:E,className:"w-full"}),W&&e.jsxs(c,{onClick:()=>C.mutate(),disabled:C.isPending,className:"w-full",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),C.isPending?"Starting...":"Start Work Order"]})]})})]}),R&&_.length>0&&e.jsxs(j,{children:[e.jsxs(y,{children:[e.jsx(N,{children:"Workflow Stages"}),e.jsx(se,{children:"Follow the workflow to complete the repair"})]}),e.jsx(g,{children:e.jsx("div",{className:"space-y-4",children:_.map(t=>e.jsxs("div",{className:`p-4 border rounded-lg ${t.status==="completed"?"border-green-500 bg-green-50":t.status==="in_progress"?"border-yellow-500 bg-yellow-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:t.stage_name}),e.jsx(v,{variant:t.status==="completed"?"default":t.status==="in_progress"?"secondary":"outline",children:t.status})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.status==="pending"&&e.jsx(c,{onClick:()=>F.mutate({stageId:t.id,status:"in_progress"}),size:"sm",children:"Start"}),t.status==="in_progress"&&e.jsx(c,{onClick:()=>F.mutate({stageId:t.id,status:"completed"}),size:"sm",variant:"outline",children:"Complete"})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:t.notes})]},t.id))})})]}),R&&_.length===0&&e.jsxs(j,{className:"border-red-200 bg-red-50",children:[e.jsx(y,{children:e.jsxs(N,{className:"text-red-800 flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"No Workflow Stages Found"]})}),e.jsxs(g,{children:[e.jsx("p",{className:"text-red-700 mb-4",children:"The work order was started but no workflow stages were created. This might be due to:"}),e.jsxs("ul",{className:"text-red-700 text-sm space-y-1 mb-4",children:[e.jsxs("li",{children:["â€¢ No workflow template found for defect type: ",e.jsx("strong",{children:d.defect_type})]}),e.jsx("li",{children:"â€¢ The start_work_order function failed to create stages"}),e.jsx("li",{children:"â€¢ Database permissions issue"})]}),e.jsxs(c,{onClick:()=>C.mutate(),disabled:C.isPending,variant:"outline",className:"border-red-300 text-red-700 hover:bg-red-100",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Retry Starting Work Order"]})]})]}),R&&w===b&&b>0&&e.jsxs(j,{className:"border-green-500 bg-green-50",children:[e.jsxs(y,{children:[e.jsxs(N,{className:"flex items-center gap-2 text-green-800",children:[e.jsx(ce,{className:"w-5 h-5"}),"Ready to Complete"]}),e.jsx(se,{className:"text-green-700",children:"All stages are completed. Ready to finalize the work order."})]}),e.jsx(g,{children:e.jsxs(c,{onClick:()=>B.mutate(),disabled:B.isPending,className:"w-full bg-green-600 hover:bg-green-700",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Complete Work Order"]})})]})]})},Ue=()=>{var me,ue;const{user:n,profile:l,loading:x}=_e(),{selectedOrganizationId:p,setSelectedOrganizationId:d}=Oe();Ce();const[z,_]=m.useState("all"),[O,C]=m.useState(""),[F,B]=m.useState("all"),[w,b]=m.useState("all"),[E,R]=m.useState("all"),[W,t]=m.useState(!1),[i,H]=m.useState(!1),[U,Y]=m.useState(!1),[Se,Z]=m.useState(!1),[r,G]=m.useState(null),[h,S]=m.useState({title:"",description:"",defect_type:"mechanical",severity:"medium",location:"",estimated_cost:0,vehicle_id:"",additional_notes:""}),f=(l==null?void 0:l.role)==="mechanic"?p:l==null?void 0:l.organization_id,{data:q=[],isLoading:ke,error:Me}=$({queryKey:["combined-defects",f,l==null?void 0:l.role],queryFn:async()=>{if(!f)return[];try{let s=D.from("combined_defects").select(`
            id,
            defect_number,
            vehicle_id,
            reported_by,
            title,
            description,
            defect_type,
            severity,
            status,
            location,
            defect_date,
            estimated_cost,
            actual_cost,
            created_at,
            updated_at,
            organization_id,
            source_type
          `).order("created_at",{ascending:!1});s=s.eq("organization_id",f);const{data:u,error:k}=await s;return k?(console.error("Error fetching defect reports:",k),[]):(u||[]).map(A=>({...A,defect_date:A.defect_date,source_type:A.source_type||"defect_report"}))}catch(s){return console.error("Error in defect fetching:",s),[]}},enabled:!!f,staleTime:0,gcTime:0,refetchOnWindowFocus:!0,refetchOnMount:!0,refetchInterval:5e3,refetchIntervalInBackground:!0});if($({queryKey:["vehicles",f],queryFn:async()=>{if(!f)return[];const{data:s,error:u}=await D.from("vehicles").select("id, make, model").eq("organization_id",f).order("make");return u?(console.error("Error fetching vehicles:",u),[]):s||[]},enabled:!!f,staleTime:0,gcTime:0}),m.useEffect(()=>{W&&S({title:"",description:"",defect_type:"mechanical",severity:"medium",location:"",estimated_cost:0,vehicle_id:"",additional_notes:""})},[W]),x)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading defect reports..."})]})});if(!n)return e.jsx(ge,{to:"/auth",replace:!0});if((l==null?void 0:l.role)==="mechanic"&&!p)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Select Organization"}),e.jsx(Ie,{onOrganizationSelect:d,selectedOrganizationId:p||void 0})]})});if(!l)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(T,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-red-900 mb-2",children:"Profile Loading Issue"}),e.jsx("p",{className:"text-red-500 mb-4",children:"Unable to load user profile. Please refresh the page."}),e.jsxs(c,{onClick:()=>window.location.reload(),variant:"outline",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Refresh Page"]})]})});if(l.role!=="mechanic"&&l.role!=="admin"&&l.role!=="council")return e.jsx(ge,{to:"/dashboard",replace:!0});const P=q.filter(s=>{const u=O===""||s.title.toLowerCase().includes(O.toLowerCase())||s.description.toLowerCase().includes(O.toLowerCase())||s.defect_number.toLowerCase().includes(O.toLowerCase()),k=F==="all"||s.severity===F,je=w==="all"||s.status===w,A=E==="all"||s.defect_type===E;return u&&k&&je&&A}),ne=(()=>{switch(z){case"reported":return P.filter(s=>s.status==="reported");case"investigating":return P.filter(s=>s.status==="investigating");case"repairing":return P.filter(s=>s.status==="repairing");case"resolved":return P.filter(s=>s.status==="resolved");default:return P}})(),de=s=>{switch(s){case"critical":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},oe=s=>{switch(s){case"reported":return"bg-blue-100 text-blue-800";case"investigating":return"bg-yellow-100 text-yellow-800";case"repairing":return"bg-orange-100 text-orange-800";case"resolved":return"bg-green-100 text-green-800";case"closed":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},xe=s=>{switch(s){case"reported":return e.jsx(T,{className:"w-4 h-4"});case"investigating":return e.jsx(Ne,{className:"w-4 h-4"});case"repairing":return e.jsx(L,{className:"w-4 h-4"});case"resolved":return e.jsx(ce,{className:"w-4 h-4"});case"closed":return e.jsx(ye,{className:"w-4 h-4"});default:return e.jsx(Ee,{className:"w-4 h-4"})}},he=s=>{switch(s){case"safety":return e.jsx(ve,{className:"w-4 h-4"});case"mechanical":return e.jsx(L,{className:"w-4 h-4"});case"electrical":return e.jsx(Ae,{className:"w-4 h-4"});case"cosmetic":return e.jsx(Pe,{className:"w-4 h-4"});default:return e.jsx(T,{className:"w-4 h-4"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Defect Reports"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage and track vehicle defects and issues"})]}),e.jsxs(c,{onClick:()=>t(!0),children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Create Defect Report"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(j,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Total Defects"}),e.jsx(T,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold",children:q.length}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[q.filter(s=>s.status==="resolved").length," resolved"]})]})]}),e.jsxs(j,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Critical Issues"}),e.jsx(ve,{className:"h-4 w-4 text-red-500"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:q.filter(s=>s.severity==="critical").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Require immediate attention"})]})]}),e.jsxs(j,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"In Progress"}),e.jsx(L,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:q.filter(s=>s.status==="investigating"||s.status==="repairing").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Being investigated or repaired"})]})]}),e.jsxs(j,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Total Cost"}),e.jsx(ye,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(g,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["Â£",q.reduce((s,u)=>s+(u.actual_cost||0),0).toLocaleString()]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total repair costs"})]})]})]}),e.jsx(j,{children:e.jsx(g,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(J,{placeholder:"Search defect...",value:O,onChange:s=>C(s.target.value),className:"pl-10"})]})}),e.jsxs(I,{value:F,onValueChange:B,children:[e.jsx(V,{className:"w-[180px]",children:e.jsx(M,{placeholder:"All Severity"})}),e.jsxs(K,{children:[e.jsx(a,{value:"all",children:"All Severity"}),e.jsx(a,{value:"critical",children:"Critical"}),e.jsx(a,{value:"high",children:"High"}),e.jsx(a,{value:"medium",children:"Medium"}),e.jsx(a,{value:"low",children:"Low"})]})]}),e.jsxs(I,{value:w,onValueChange:b,children:[e.jsx(V,{className:"w-[180px]",children:e.jsx(M,{placeholder:"All Status"})}),e.jsxs(K,{children:[e.jsx(a,{value:"all",children:"All Status"}),e.jsx(a,{value:"reported",children:"Reported"}),e.jsx(a,{value:"investigating",children:"Investigating"}),e.jsx(a,{value:"repairing",children:"Repairing"}),e.jsx(a,{value:"resolved",children:"Resolved"}),e.jsx(a,{value:"closed",children:"Closed"})]})]}),e.jsxs(I,{value:E,onValueChange:R,children:[e.jsx(V,{className:"w-[180px]",children:e.jsx(M,{placeholder:"All Types"})}),e.jsxs(K,{children:[e.jsx(a,{value:"all",children:"All Types"}),e.jsx(a,{value:"safety",children:"Safety"}),e.jsx(a,{value:"mechanical",children:"Mechanical"}),e.jsx(a,{value:"electrical",children:"Electrical"}),e.jsx(a,{value:"cosmetic",children:"Cosmetic"}),e.jsx(a,{value:"other",children:"Other"})]})]})]})})}),e.jsxs(Fe,{value:z,onValueChange:_,className:"space-y-4",children:[e.jsxs(Re,{children:[e.jsx(Q,{value:"all",children:"All Reports"}),e.jsx(Q,{value:"reported",children:"Reported"}),e.jsx(Q,{value:"investigating",children:"Investigating"}),e.jsx(Q,{value:"repairing",children:"Repairing"}),e.jsx(Q,{value:"resolved",children:"Resolved"})]}),e.jsx(We,{value:z,className:"space-y-4",children:ke?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})}):ne.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(T,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No defect reports found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"No defect reports found for the selected organization."}),f?e.jsxs(c,{onClick:()=>t(!0),children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Create Defect Report"]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-red-500 text-sm",children:"Organization ID is not set. This may prevent data from loading."}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(c,{onClick:()=>window.location.reload(),variant:"outline",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Refresh Page"]})})]})]}):e.jsx("div",{className:"space-y-4",children:ne.map(s=>{var u,k;return e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-semibold",children:s.defect_number}),e.jsx(v,{className:de(s.severity),children:s.severity}),e.jsxs(v,{className:oe(s.status),children:[xe(s.status),s.status]}),e.jsxs(v,{variant:"outline",className:"flex items-center gap-1",children:[he(s.defect_type),s.defect_type]}),e.jsx(v,{variant:"secondary",className:"text-xs",children:s.source_type==="vehicle_check"?"Vehicle Check":"Manual Report"})]}),e.jsx("h5",{className:"font-medium text-lg mb-1",children:s.title}),e.jsx("p",{className:"text-gray-600 text-sm mb-2",children:s.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Vehicle:"}),e.jsxs("p",{className:"font-medium",children:[(u=s.vehicle)==null?void 0:u.make," ",(k=s.vehicle)==null?void 0:k.model]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Location:"}),e.jsx("p",{className:"font-medium",children:s.location})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Reported:"}),e.jsx("p",{className:"font-medium",children:new Date(s.defect_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Cost:"}),e.jsxs("p",{className:"font-medium",children:["Â£",s.actual_cost||s.estimated_cost]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:()=>{G(s),Y(!0)},children:e.jsx(qe,{className:"w-4 h-4"})}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>{G(s),H(!0)},children:e.jsx(Le,{className:"w-4 h-4"})}),s.status==="reported"||s.status==="investigating"?e.jsxs(c,{variant:"default",size:"sm",onClick:()=>{G(s),Z(!0)},children:[e.jsx(L,{className:"w-4 h-4"}),"Start Work"]}):s.status==="repairing"?e.jsxs(c,{variant:"secondary",size:"sm",onClick:()=>{G(s),Z(!0)},children:[e.jsx(L,{className:"w-4 h-4"}),"Continue Work"]}):null]})]})},s.id)})})})]}),e.jsx(te,{open:W,onOpenChange:t,children:e.jsxs(re,{className:"max-w-2xl",children:[e.jsxs(ae,{children:[e.jsx(le,{children:"Create Defect Report"}),e.jsx(ie,{children:"Report a new vehicle defect or issue"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"title",children:"Title"}),e.jsx(J,{id:"title",value:h.title,onChange:s=>S({...h,title:s.target.value}),placeholder:"Brief description of the defect"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"description",children:"Description"}),e.jsx(ze,{id:"description",value:h.description,onChange:s=>S({...h,description:s.target.value}),placeholder:"Detailed description of the defect",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"defect_type",children:"Type"}),e.jsxs(I,{value:h.defect_type,onValueChange:s=>S({...h,defect_type:s}),children:[e.jsx(V,{children:e.jsx(M,{})}),e.jsxs(K,{children:[e.jsx(a,{value:"safety",children:"Safety"}),e.jsx(a,{value:"mechanical",children:"Mechanical"}),e.jsx(a,{value:"electrical",children:"Electrical"}),e.jsx(a,{value:"cosmetic",children:"Cosmetic"}),e.jsx(a,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"severity",children:"Severity"}),e.jsxs(I,{value:h.severity,onValueChange:s=>S({...h,severity:s}),children:[e.jsx(V,{children:e.jsx(M,{})}),e.jsxs(K,{children:[e.jsx(a,{value:"low",children:"Low"}),e.jsx(a,{value:"medium",children:"Medium"}),e.jsx(a,{value:"high",children:"High"}),e.jsx(a,{value:"critical",children:"Critical"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"location",children:"Location"}),e.jsx(J,{id:"location",value:h.location,onChange:s=>S({...h,location:s.target.value}),placeholder:"Where the defect is located"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"estimated_cost",children:"Estimated Cost"}),e.jsx(J,{id:"estimated_cost",type:"number",value:h.estimated_cost,onChange:s=>S({...h,estimated_cost:parseFloat(s.target.value)||0}),placeholder:"0.00"})]})]}),e.jsxs(we,{children:[e.jsx(c,{variant:"outline",onClick:()=>t(!1),children:"Cancel"}),e.jsx(c,{onClick:()=>{t(!1),X({title:"Defect Report Created",description:"The defect report has been created successfully."})},children:"Create Report"})]})]})}),e.jsx(te,{open:U,onOpenChange:Y,children:e.jsxs(re,{className:"max-w-2xl",children:[e.jsxs(ae,{children:[e.jsx(le,{children:"Defect Report Details"}),e.jsx(ie,{children:r==null?void 0:r.defect_number})]}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-medium text-gray-500",children:"Title"}),e.jsx("p",{className:"text-lg font-medium",children:r.title})]}),e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-medium text-gray-500",children:"Status"}),e.jsxs(v,{className:oe(r.status),children:[xe(r.status),r.status]})]})]}),e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-medium text-gray-500",children:"Description"}),e.jsx("p",{className:"text-gray-700",children:r.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-medium text-gray-500",children:"Vehicle"}),e.jsxs("p",{className:"font-medium",children:[(me=r.vehicle)==null?void 0:me.make," ",(ue=r.vehicle)==null?void 0:ue.model]})]}),e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-medium text-gray-500",children:"Location"}),e.jsx("p",{className:"font-medium",children:r.location})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-medium text-gray-500",children:"Severity"}),e.jsx(v,{className:de(r.severity),children:r.severity})]}),e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-medium text-gray-500",children:"Type"}),e.jsxs(v,{variant:"outline",className:"flex items-center gap-1",children:[he(r.defect_type),r.defect_type]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-medium text-gray-500",children:"Estimated Cost"}),e.jsxs("p",{className:"font-medium",children:["Â£",r.estimated_cost]})]}),e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-medium text-gray-500",children:"Actual Cost"}),e.jsxs("p",{className:"font-medium",children:["Â£",r.actual_cost||0]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-medium text-gray-500",children:"Reported"}),e.jsx("p",{className:"font-medium",children:new Date(r.defect_date).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-medium text-gray-500",children:"Last Updated"}),e.jsx("p",{className:"font-medium",children:new Date(r.updated_at).toLocaleString()})]})]})]}),e.jsxs(we,{children:[e.jsx(c,{variant:"outline",onClick:()=>Y(!1),children:"Close"}),r&&e.jsx(c,{onClick:()=>{Y(!1),H(!0)},children:"Edit Defect Report"})]})]})}),e.jsx(te,{open:Se,onOpenChange:Z,children:e.jsxs(re,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ae,{children:[e.jsx(le,{children:"Defect Workflow"}),e.jsxs(ie,{children:[r==null?void 0:r.defect_number," - ",r==null?void 0:r.title]})]}),r&&e.jsx(Ve,{defectId:r.id,onClose:()=>Z(!1)})]})})]})};export{Ue as default};
