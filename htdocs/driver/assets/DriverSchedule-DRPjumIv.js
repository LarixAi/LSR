import{m as J,x as K,r as N,j as e,N as E,ay as Q,B as h,aq as X,e as u,g as j,h as T,S as Z,k as b,A,E as ee,z as O,ax as l,bO as se,bU as te,bV as ae,bW as re,aB as g,n as le,aD as v,aF as y,d as _,ar as ne,aE as ie}from"./main-DVuL102c.js";import{C as ce}from"./calendar-CxP_DU9g.js";import{u as de}from"./useSchedules-BsgTF3-B.js";import{k as oe,a as xe,d as me,l as he,j as ue}from"./useDailyRest-CzA17-bf.js";import{C as je}from"./chevron-left-CejOeOBB.js";import{C as ge}from"./calendar-days-Bkcdzd58.js";import{e as ye}from"./endOfWeek-aLw_agy5.js";import{e as fe}from"./eachDayOfInterval-CZlqfhSB.js";import{s as pe}from"./subDays-D26s8zcO.js";import{a as Ne}from"./addDays-CXxLH7jZ.js";import{i as be}from"./isToday-RtUDijym.js";import{i as ve}from"./isYesterday-BT5AP3zL.js";import"./isSameDay-X0xWrpXd.js";import"./addWeeks-D7_dq2Pd.js";import"./parseISO-1k6pJICp.js";const Le=()=>{const{user:H,profile:w,loading:I}=J();K();const[i,f]=N.useState(new Date);N.useState("week");const[L,D]=N.useState(!1),{data:P=[],isLoading:z}=de(),{data:F=[],isLoading:B}=oe(),{data:V=[]}=xe(),{analysis:k}=me(i),{data:c}=he(),x=ue(),R=V||[],C=F||[],S=P||[];if(I||z||B)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading schedule..."})]})});if(!H||!w)return e.jsx(E,{to:"/auth",replace:!0});if(w.role!=="driver")return e.jsx(E,{to:"/dashboard",replace:!0});const m=Q(i,{weekStartsOn:1}),p=ye(i,{weekStartsOn:1}),U=fe({start:m,end:p}),Y=s=>{const a=l(s,"yyyy-MM-dd"),r=R.some(t=>t.entry_date===a),n=C.some(t=>t.rest_date===a),d=S.some(t=>l(new Date(t.start_time),"yyyy-MM-dd")===a);return r?"worked":n?"rest":d?"scheduled":"off"},q=s=>{const a=l(s,"yyyy-MM-dd"),r=S.filter(t=>l(new Date(t.start_time),"yyyy-MM-dd")===a),n=C.find(t=>t.rest_date===a),d=R.find(t=>t.entry_date===a);return{schedules:r,rest:n,timeEntry:d}},$=async()=>{try{await x.mutateAsync({startDate:m,endDate:p})}catch(s){console.error("Error auto-recording rest days:",s)}},G=s=>{switch(s){case"worked":return{icon:v,color:"text-green-600",bgColor:"bg-green-100",label:"Worked"};case"rest":return{icon:y,color:"text-blue-600",bgColor:"bg-blue-100",label:"Rest"};case"scheduled":return{icon:_,color:"text-orange-600",bgColor:"bg-orange-100",label:"Scheduled"};default:return{icon:ie,color:"text-gray-600",bgColor:"bg-gray-100",label:"Off"}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"My Schedule"}),e.jsx("p",{className:"text-muted-foreground",children:"View your work schedule and rest periods"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(h,{onClick:$,disabled:x.isPending,variant:"outline",size:"sm",children:[e.jsx(X,{className:`w-4 h-4 mr-2 ${x.isPending?"animate-spin":""}`}),x.isPending?"Recording Rest...":"Record Rest Days"]})})]}),c&&e.jsxs(u,{children:[e.jsx(j,{children:e.jsxs(T,{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"w-5 h-5"}),e.jsx("span",{children:"Weekly Rest Summary"})]})}),e.jsx(b,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:c.workedDays}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Work Days"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:c.restDays}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Rest Days"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[c.totalWorkHours.toFixed(1),"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Work Hours"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[c.totalRestHours.toFixed(1),"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Rest Hours"})]})]})})]}),k.criticalViolations.length>0&&e.jsxs(A,{className:"border-red-200 bg-red-50",children:[e.jsx(ee,{className:"h-4 w-4 text-red-600"}),e.jsxs(O,{className:"text-red-800",children:[e.jsx("strong",{children:"WTD Compliance Issues:"})," ",k.criticalViolations[0]]})]}),e.jsx(u,{children:e.jsx(j,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:()=>f(pe(i,7)),children:e.jsx(je,{className:"w-4 h-4"})}),e.jsxs("div",{className:"text-center",children:[e.jsxs("h2",{className:"text-lg font-semibold",children:[l(m,"MMM dd")," - ",l(p,"MMM dd, yyyy")]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Week of ",l(m,"MMMM yyyy")]})]}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>f(Ne(i,7)),children:e.jsx(se,{className:"w-4 h-4"})})]}),e.jsxs(te,{open:L,onOpenChange:D,children:[e.jsx(ae,{asChild:!0,children:e.jsxs(h,{variant:"outline",size:"sm",children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Select Week"]})}),e.jsx(re,{className:"w-auto p-0",align:"end",children:e.jsx(ce,{mode:"single",selected:i,onSelect:s=>{s&&(f(s),D(!1))},initialFocus:!0})})]})]})})}),e.jsx("div",{className:"grid gap-4 md:grid-cols-7",children:U.map(s=>{var W;const a=Y(s),r=q(s),n=G(a),d=n.icon,t=be(s),M=ve(s);return e.jsxs(u,{className:g("min-h-[200px]",t&&"ring-2 ring-blue-500",M&&"ring-1 ring-gray-300"),children:[e.jsxs(j,{className:"pb-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:l(s,"EEE")}),e.jsx("p",{className:g("text-lg font-bold",t&&"text-blue-600",M&&"text-gray-600"),children:l(s,"dd")})]}),e.jsx("div",{className:g("p-2 rounded-full",n.bgColor),children:e.jsx(d,{className:g("w-4 h-4",n.color)})})]}),e.jsx(le,{variant:"outline",className:"text-xs",children:n.label})]}),e.jsx(b,{className:"pt-0",children:e.jsxs("div",{className:"space-y-2",children:[r.timeEntry&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(v,{className:"w-3 h-3 text-green-600"}),e.jsxs("span",{className:"text-green-700",children:["Worked: ",((W=r.timeEntry.total_hours)==null?void 0:W.toFixed(1))||"0.0","h"]})]}),r.rest&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(y,{className:"w-3 h-3 text-blue-600"}),e.jsxs("span",{className:"text-blue-700",children:["Rest: ",r.rest.duration_hours,"h"]})]}),r.schedules.map(o=>e.jsxs("div",{className:"text-xs p-2 bg-orange-50 rounded border-l-2 border-orange-300",children:[e.jsxs("div",{className:"font-medium text-orange-800",children:[l(new Date(o.start_time),"HH:mm")," - ",o.job_type]}),o.notes&&e.jsx("div",{className:"text-orange-600 mt-1",children:o.notes})]},o.id)),a==="off"&&!r.schedules.length&&e.jsx("div",{className:"text-xs text-gray-500 italic",children:"No scheduled activities"})]})})]},s.toISOString())})}),e.jsxs(u,{children:[e.jsx(j,{children:e.jsxs(T,{className:"flex items-center space-x-2",children:[e.jsx(y,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{children:"Daily Rest Tracking"})]})}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-full",children:e.jsx(v,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Work Days"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Days when you clocked in and worked"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:e.jsx(y,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Rest Days"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Days automatically recorded as rest when no work activity"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-full",children:e.jsx(_,{className:"w-4 h-4 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Scheduled"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Days with scheduled activities but no work recorded"})]})]})]}),e.jsxs(A,{className:"border-blue-200 bg-blue-50",children:[e.jsx(ne,{className:"h-4 w-4 text-blue-600"}),e.jsxs(O,{className:"text-blue-800",children:[e.jsx("strong",{children:"Automatic Rest Recording:"}),' Days without work activity are automatically recorded as rest days for WTD compliance. Use the "Record Rest Days" button to manually process rest days for the current week.']})]})]})})]})]})};export{Le as default};
