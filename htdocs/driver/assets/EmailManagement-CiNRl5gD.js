import{H as me,G as C,a1 as w,a2 as T,J as x,m as Ee,r as v,j as e,N as J,v as L,a4 as W,as as Y,B as c,am as $,a5 as X,a6 as Z,a7 as ee,a8 as se,q as d,I as f,ab as ae,ac as te,ad as ne,ae as ie,af as o,s as le,$ as b,t as re,e as p,k as h,U as Se,ak as _e,C as Fe,b as qe,O as Le,Q as De,V as K,Y as I,g as U,h as B,au as ke,an as ce,F as M,l as de,n as Oe}from"./main-DVuL102c.js";import{T as Pe,a as ze,b as D,c as j,d as Re,e as m}from"./table-Jjtal2IW.js";import{T as oe}from"./trash-2-uDLx8yM9.js";const Ae=()=>me({queryKey:["email-campaigns"],queryFn:async()=>{const{data:l,error:a}=await x.from("email_campaigns").select("*").order("created_at",{ascending:!1});if(a)throw a;return l||[]}}),Qe=()=>me({queryKey:["email-templates"],queryFn:async()=>{const{data:l,error:a}=await x.from("email_templates").select("*").order("created_at",{ascending:!1});if(a)throw a;return l||[]}}),Ke=()=>{const l=C(),{toast:a}=w();return T({mutationFn:async n=>{const{data:i,error:r}=await x.from("email_campaigns").insert(n).select().single();if(r)throw r;return i},onSuccess:()=>{l.invalidateQueries({queryKey:["email-campaigns"]}),a({title:"Success",description:"Email campaign created successfully"})},onError:n=>{a({title:"Error",description:"Failed to create email campaign",variant:"destructive"})}})},Ie=()=>{const l=C(),{toast:a}=w();return T({mutationFn:async({id:n,...i})=>{const{data:r,error:g}=await x.from("email_campaigns").update(i).eq("id",n).select().single();if(g)throw g;return r},onSuccess:()=>{l.invalidateQueries({queryKey:["email-campaigns"]}),a({title:"Success",description:"Email campaign updated successfully"})},onError:n=>{a({title:"Error",description:"Failed to update email campaign",variant:"destructive"})}})},Ue=()=>{const l=C(),{toast:a}=w();return T({mutationFn:async n=>{const{error:i}=await x.from("email_campaigns").delete().eq("id",n);if(i)throw i},onSuccess:()=>{l.invalidateQueries({queryKey:["email-campaigns"]}),a({title:"Success",description:"Email campaign deleted successfully"})},onError:n=>{a({title:"Error",description:"Failed to delete email campaign",variant:"destructive"})}})},Be=()=>{const l=C(),{toast:a}=w();return T({mutationFn:async n=>{const{data:i,error:r}=await x.from("email_templates").insert(n).select().single();if(r)throw r;return i},onSuccess:()=>{l.invalidateQueries({queryKey:["email-templates"]}),a({title:"Success",description:"Email template created successfully"})},onError:n=>{a({title:"Error",description:"Failed to create email template",variant:"destructive"})}})},Me=()=>{const l=C(),{toast:a}=w();return T({mutationFn:async({id:n,...i})=>{const{data:r,error:g}=await x.from("email_templates").update(i).eq("id",n).select().single();if(g)throw g;return r},onSuccess:()=>{l.invalidateQueries({queryKey:["email-templates"]}),a({title:"Success",description:"Email template updated successfully"})},onError:n=>{a({title:"Error",description:"Failed to update email template",variant:"destructive"})}})},He=()=>{const l=C(),{toast:a}=w();return T({mutationFn:async n=>{const{error:i}=await x.from("email_templates").delete().eq("id",n);if(i)throw i},onSuccess:()=>{l.invalidateQueries({queryKey:["email-templates"]}),a({title:"Success",description:"Email template deleted successfully"})},onError:n=>{a({title:"Error",description:"Failed to delete email template",variant:"destructive"})}})},Ve=()=>{const l=C(),{toast:a}=w();return T({mutationFn:async n=>{const{data:i,error:r}=await x.from("email_campaigns").update({status:"sent",sent_at:new Date().toISOString()}).eq("id",n).select().single();if(r)throw r;return i},onSuccess:()=>{l.invalidateQueries({queryKey:["email-campaigns"]}),a({title:"Success",description:"Email campaign sent successfully"})},onError:n=>{a({title:"Error",description:"Failed to send email campaign",variant:"destructive"})}})},Ye=()=>{const{user:l,profile:a,loading:n}=Ee(),[i,r]=v.useState(""),[g,F]=v.useState(!1),[xe,q]=v.useState(!1),[k,ue]=v.useState(null),[O,H]=v.useState(null),{data:_=[],isLoading:pe}=Ae(),{data:he=[],isLoading:je}=Qe(),P=Ke();Ie();const z=Ue(),R=Be();Me();const A=He(),Q=Ve(),[E,y]=v.useState({name:"",subject:"",content:"",type:"newsletter",status:"draft",recipients_count:0}),[S,u]=v.useState({name:"",subject:"",content:"",type:"newsletter",description:""});if(n)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading email management..."})]})});if(!l||!a)return e.jsx(J,{to:"/auth",replace:!0});if(!["admin","council"].includes(a.role))return e.jsx(J,{to:"/unauthorized",replace:!0});const V=_.filter(s=>s.name.toLowerCase().includes(i.toLowerCase())||s.subject.toLowerCase().includes(i.toLowerCase())),G=he.filter(s=>{var t;return s.name.toLowerCase().includes(i.toLowerCase())||((t=s.description)==null?void 0:t.toLowerCase().includes(i.toLowerCase()))}),ge=s=>{const t={sent:"bg-green-100 text-green-800",scheduled:"bg-blue-100 text-blue-800",draft:"bg-gray-100 text-gray-800",sending:"bg-yellow-100 text-yellow-800",failed:"bg-red-100 text-red-800"};return e.jsx(Oe,{className:t[s]||"bg-gray-100 text-gray-800",children:s})},N={totalCampaigns:_.length,totalRecipients:_.reduce((s,t)=>s+t.recipients_count,0),totalOpened:_.reduce((s,t)=>s+t.opened_count,0),totalClicked:_.reduce((s,t)=>s+t.clicked_count,0)},ye=N.totalRecipients>0?N.totalOpened/N.totalRecipients*100:0,Ne=async()=>{a!=null&&a.organization_id&&(await P.mutateAsync({...E,organization_id:a.organization_id,created_by:a.id}),y({name:"",subject:"",content:"",type:"newsletter",status:"draft",recipients_count:0}),F(!1))},ve=async()=>{a!=null&&a.organization_id&&(await R.mutateAsync({...S,organization_id:a.organization_id,created_by:a.id,is_default:!1,used_count:0}),u({name:"",subject:"",content:"",type:"newsletter",description:""}),q(!1))},fe=s=>{ue(s),y({name:s.name,subject:s.subject,content:s.content,type:s.type,status:s.status,recipients_count:s.recipients_count}),F(!0)},be=s=>{H(s),u({name:s.name,subject:s.subject,content:s.content,type:s.type,description:s.description||""}),q(!0)},Ce=async s=>{confirm("Are you sure you want to delete this campaign?")&&await z.mutateAsync(s)},we=async s=>{confirm("Are you sure you want to delete this template?")&&await A.mutateAsync(s)},Te=async s=>{confirm("Are you sure you want to send this campaign?")&&await Q.mutateAsync(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(L,{className:"w-8 h-8 text-blue-600"}),"Email Management"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage email campaigns, templates, and communications"})]}),e.jsxs(W,{open:g,onOpenChange:F,children:[e.jsx(Y,{asChild:!0,children:e.jsxs(c,{className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Compose Email"]})}),e.jsxs(X,{className:"max-w-3xl",children:[e.jsxs(Z,{children:[e.jsx(ee,{children:k?"Edit Email Campaign":"Compose New Email"}),e.jsx(se,{children:k?"Edit your email campaign.":"Create and send email campaigns to your customers and stakeholders."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"campaign-name",children:"Campaign Name"}),e.jsx(f,{id:"campaign-name",placeholder:"Internal campaign name",value:E.name,onChange:s=>y(t=>({...t,name:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"email-type",children:"Email Type"}),e.jsxs(ae,{value:E.type,onValueChange:s=>y(t=>({...t,type:s})),children:[e.jsx(te,{children:e.jsx(ne,{placeholder:"Select type"})}),e.jsxs(ie,{children:[e.jsx(o,{value:"newsletter",children:"Newsletter"}),e.jsx(o,{value:"announcement",children:"Announcement"}),e.jsx(o,{value:"reminder",children:"Reminder"}),e.jsx(o,{value:"promotional",children:"Promotional"}),e.jsx(o,{value:"notification",children:"Notification"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"recipients-count",children:"Recipients Count"}),e.jsx(f,{id:"recipients-count",type:"number",placeholder:"Number of recipients",value:E.recipients_count,onChange:s=>y(t=>({...t,recipients_count:parseInt(s.target.value)||0}))})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"subject",children:"Subject Line"}),e.jsx(f,{id:"subject",placeholder:"Email subject line",value:E.subject,onChange:s=>y(t=>({...t,subject:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"content",children:"Email Content"}),e.jsx(le,{id:"content",placeholder:"Compose your email message...",rows:8,value:E.content,onChange:s=>y(t=>({...t,content:s.target.value}))})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(c,{className:"flex-1 bg-blue-600 hover:bg-blue-700",onClick:Ne,disabled:P.isPending,children:[P.isPending?e.jsx(b,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(re,{className:"w-4 h-4 mr-2"}),k?"Update Campaign":"Create Campaign"]}),e.jsx(c,{variant:"outline",className:"flex-1",onClick:()=>F(!1),children:"Cancel"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6",children:[e.jsx(p,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Campaigns"}),e.jsx("p",{className:"text-2xl font-bold",children:N.totalCampaigns})]})]})})}),e.jsx(p,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Se,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Recipients"}),e.jsx("p",{className:"text-2xl font-bold",children:N.totalRecipients})]})]})})}),e.jsx(p,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_e,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Emails Opened"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:N.totalOpened})]})]})})}),e.jsx(p,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Fe,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Links Clicked"}),e.jsx("p",{className:"text-2xl font-bold",children:N.totalClicked})]})]})})}),e.jsx(p,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(qe,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Open Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[ye.toFixed(0),"%"]})]})]})})})]}),e.jsxs(Le,{defaultValue:"campaigns",className:"space-y-6",children:[e.jsxs(De,{className:"grid w-full grid-cols-3",children:[e.jsx(K,{value:"campaigns",children:"Campaigns"}),e.jsx(K,{value:"templates",children:"Templates"}),e.jsx(K,{value:"settings",children:"Settings"})]}),e.jsx(I,{value:"campaigns",className:"space-y-4",children:e.jsxs(p,{children:[e.jsxs(U,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5"}),"Email Campaigns"]}),e.jsx("div",{className:"flex gap-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(f,{placeholder:"Search campaigns...",value:i,onChange:s=>r(s.target.value),className:"pl-10"})]})})]}),e.jsx(h,{children:e.jsxs(Pe,{children:[e.jsx(ze,{children:e.jsxs(D,{children:[e.jsx(j,{children:"Campaign"}),e.jsx(j,{children:"Type"}),e.jsx(j,{children:"Recipients"}),e.jsx(j,{children:"Opened"}),e.jsx(j,{children:"Clicked"}),e.jsx(j,{children:"Status"}),e.jsx(j,{children:"Date"}),e.jsx(j,{children:"Actions"})]})}),e.jsx(Re,{children:pe?e.jsx(D,{children:e.jsxs(m,{colSpan:8,className:"text-center py-8",children:[e.jsx(b,{className:"w-6 h-6 animate-spin mx-auto mb-2"}),e.jsx("p",{children:"Loading campaigns..."})]})}):V.length===0?e.jsx(D,{children:e.jsxs(m,{colSpan:8,className:"text-center py-8",children:[e.jsx(L,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No campaigns found"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Create your first email campaign to get started"})]})}):V.map(s=>e.jsxs(D,{children:[e.jsx(m,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.subject})]})}),e.jsx(m,{className:"capitalize",children:s.type}),e.jsx(m,{children:s.recipients_count}),e.jsx(m,{children:s.opened_count}),e.jsx(m,{children:s.clicked_count}),e.jsx(m,{children:ge(s.status)}),e.jsx(m,{children:s.sent_at?new Date(s.sent_at).toLocaleDateString():"Not sent"}),e.jsx(m,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:()=>fe(s),children:e.jsx(ce,{className:"w-4 h-4"})}),s.status==="draft"&&e.jsx(c,{variant:"outline",size:"sm",onClick:()=>Te(s.id),disabled:Q.isPending,children:Q.isPending?e.jsx(b,{className:"w-4 h-4 animate-spin"}):e.jsx(re,{className:"w-4 h-4"})}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>Ce(s.id),disabled:z.isPending,children:z.isPending?e.jsx(b,{className:"w-4 h-4 animate-spin"}):e.jsx(oe,{className:"w-4 h-4"})})]})})]},s.id))})]})})]})}),e.jsx(I,{value:"templates",className:"space-y-4",children:e.jsxs(p,{children:[e.jsxs(U,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5"}),"Email Templates"]}),e.jsxs(W,{open:xe,onOpenChange:q,children:[e.jsx(Y,{asChild:!0,children:e.jsxs(c,{className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Create Template"]})}),e.jsxs(X,{className:"max-w-3xl",children:[e.jsxs(Z,{children:[e.jsx(ee,{children:O?"Edit Email Template":"Create New Template"}),e.jsx(se,{children:O?"Edit your email template.":"Create a reusable email template for your campaigns."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"template-name",children:"Template Name"}),e.jsx(f,{id:"template-name",placeholder:"Template name",value:S.name,onChange:s=>u(t=>({...t,name:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"template-type",children:"Template Type"}),e.jsxs(ae,{value:S.type,onValueChange:s=>u(t=>({...t,type:s})),children:[e.jsx(te,{children:e.jsx(ne,{placeholder:"Select type"})}),e.jsxs(ie,{children:[e.jsx(o,{value:"newsletter",children:"Newsletter"}),e.jsx(o,{value:"billing",children:"Billing"}),e.jsx(o,{value:"onboarding",children:"Onboarding"}),e.jsx(o,{value:"notification",children:"Notification"}),e.jsx(o,{value:"promotional",children:"Promotional"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"template-subject",children:"Subject Line"}),e.jsx(f,{id:"template-subject",placeholder:"Email subject line",value:S.subject,onChange:s=>u(t=>({...t,subject:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"template-description",children:"Description"}),e.jsx(f,{id:"template-description",placeholder:"Template description",value:S.description,onChange:s=>u(t=>({...t,description:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"template-content",children:"Email Content"}),e.jsx(le,{id:"template-content",placeholder:"Write your email template content...",className:"min-h-[200px]",value:S.content,onChange:s=>u(t=>({...t,content:s.target.value}))})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{variant:"outline",onClick:()=>{q(!1),H(null),u({name:"",subject:"",content:"",type:"newsletter",description:""})},children:"Cancel"}),e.jsxs(c,{className:"bg-blue-600 hover:bg-blue-700",onClick:ve,disabled:R.isPending,children:[R.isPending?e.jsx(b,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(M,{className:"w-4 h-4 mr-2"}),O?"Update Template":"Create Template"]})]})]})]})]})]}),e.jsx(h,{children:je?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(b,{className:"w-6 h-6 animate-spin mx-auto mb-2"}),e.jsx("p",{children:"Loading templates..."})]}):G.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(M,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No templates found"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Create your first email template to get started"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:G.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:s.type})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:()=>be(s),children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>we(s.id),disabled:A.isPending,children:A.isPending?e.jsx(b,{className:"w-4 h-4 animate-spin"}):e.jsx(oe,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["Used ",s.used_count," times"]}),e.jsxs("span",{children:["Modified: ",new Date(s.updated_at).toLocaleDateString()]})]})]},s.id))})})]})}),e.jsx(I,{value:"settings",className:"space-y-4",children:e.jsxs(p,{children:[e.jsx(U,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5"}),"Email Settings"]})}),e.jsx(h,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(de,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Email Configuration"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Configure SMTP settings, sender information, and email delivery options."}),e.jsx(c,{className:"bg-blue-600 hover:bg-blue-700",children:"Configure Settings"})]})})]})})]})]})};export{Ye as default};
