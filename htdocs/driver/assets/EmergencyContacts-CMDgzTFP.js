import{m as V,H as W,J as p,a1 as j,G as F,a2 as w,cm as X,r as x,j as e,e as _,g as Y,h as Z,P as N,B as m,am as k,k as S,$ as E,an as ee,n as O,v as se,M as ae,a4 as M,a5 as T,a6 as U,a7 as Q,a8 as K,q as o,I as h,s as L}from"./main-DVuL102c.js";import{S as te}from"./star-Dk-sf7Q0.js";import{T as ne}from"./trash-2-uDLx8yM9.js";const re=c=>{const{user:i}=V();return W({queryKey:["emergency-contacts",i==null?void 0:i.id,c],queryFn:async()=>{if(!(i!=null&&i.id))return[];console.log("Fetching emergency contacts for child:",c);try{let t=p.from("emergency_contacts").select(`
            *,
            child_profiles:child_profiles(
              id,
              first_name,
              last_name
            )
          `).eq("is_active",!0).order("is_primary",{ascending:!1}).order("contact_name");c?t=t.eq("child_id",c):t=t.in("child_id",p.from("child_profiles").select("id").eq("parent_id",i.id).eq("is_active",!0));const{data:n,error:d}=await t;if(d)throw console.error("Error fetching emergency contacts:",d),d;return console.log("Fetched emergency contacts:",n),n||[]}catch(t){return console.error("Error in useEmergencyContacts:",t),[]}},enabled:!!(i!=null&&i.id)})},ie=()=>{const{toast:c}=j(),i=F();return w({mutationFn:async t=>{const{data:n,error:d}=await p.from("emergency_contacts").insert(t).select().single();if(d)throw d;return n},onSuccess:t=>{i.invalidateQueries({queryKey:["emergency-contacts"]}),c({title:"Emergency Contact Added",description:"The emergency contact has been added successfully."})},onError:t=>{console.error("Error creating emergency contact:",t),c({title:"Error",description:"Failed to add emergency contact. Please try again.",variant:"destructive"})}})},ce=()=>{const{toast:c}=j(),i=F();return w({mutationFn:async({id:t,...n})=>{const{data:d,error:u}=await p.from("emergency_contacts").update(n).eq("id",t).select().single();if(u)throw u;return d},onSuccess:t=>{i.invalidateQueries({queryKey:["emergency-contacts"]}),c({title:"Emergency Contact Updated",description:"The emergency contact has been updated successfully."})},onError:t=>{console.error("Error updating emergency contact:",t),c({title:"Error",description:"Failed to update emergency contact. Please try again.",variant:"destructive"})}})},le=()=>{const{toast:c}=j(),i=F();return w({mutationFn:async t=>{const{error:n}=await p.from("emergency_contacts").delete().eq("id",t);if(n)throw n;return t},onSuccess:t=>{i.invalidateQueries({queryKey:["emergency-contacts"]}),c({title:"Emergency Contact Removed",description:"The emergency contact has been removed successfully."})},onError:t=>{console.error("Error deleting emergency contact:",t),c({title:"Error",description:"Failed to remove emergency contact. Please try again.",variant:"destructive"})}})},he=({className:c})=>{const{toast:i}=j(),{children:t}=X(),[n,d]=x.useState(null),[u,g]=x.useState(!1),[R,y]=x.useState(!1),[b,P]=x.useState(null),[r,l]=x.useState({contact_name:"",relationship:"",phone:"",email:"",address:"",is_primary:!1}),{data:A=[],isLoading:$}=re(n),v=ie(),f=ce(),B=le(),G=async()=>{if(!n){i({title:"Error",description:"Please select a child first.",variant:"destructive"});return}try{await v.mutateAsync({child_id:n,...r}),g(!1),C()}catch(s){console.error("Failed to add emergency contact:",s)}},H=async()=>{if(b)try{await f.mutateAsync({id:b.id,...r}),y(!1),P(null),C()}catch(s){console.error("Failed to update emergency contact:",s)}},z=async s=>{if(confirm("Are you sure you want to delete this emergency contact?"))try{await B.mutateAsync(s)}catch(a){console.error("Failed to delete emergency contact:",a)}},C=()=>{l({contact_name:"",relationship:"",phone:"",email:"",address:"",is_primary:!1})},I=s=>{P(s),l({contact_name:s.contact_name,relationship:s.relationship,phone:s.phone,email:s.email||"",address:s.address||"",is_primary:s.is_primary}),y(!0)},q=()=>{C(),g(!0)},D=s=>{const a=t.find(J=>J.id===s);return a?`${a.first_name} ${a.last_name}`:"Unknown Child"};return e.jsxs("div",{className:`space-y-6 ${c}`,children:[e.jsx(_,{children:e.jsx(Y,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Z,{className:"flex items-center space-x-2",children:[e.jsx(N,{className:"w-5 h-5"}),e.jsx("span",{children:"Emergency Contacts"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("select",{value:n||"",onChange:s=>d(s.target.value?Number(s.target.value):null),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Children"}),t.map(s=>e.jsxs("option",{value:s.id,children:[s.first_name," ",s.last_name]},s.id))]}),e.jsxs(m,{onClick:q,disabled:!n,children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Add Contact"]})]})]})})}),e.jsx(_,{children:e.jsx(S,{className:"p-6",children:$?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(E,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-2",children:"Loading emergency contacts..."})]}):A.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(N,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Emergency Contacts"}),e.jsx("p",{className:"text-gray-600 mb-4",children:n?"No emergency contacts found for this child.":"No emergency contacts found. Select a child to add contacts."}),n&&e.jsxs(m,{onClick:q,children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Add First Contact"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:A.map(s=>e.jsx(_,{className:"relative",children:e.jsxs(S,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.contact_name}),s.is_primary&&e.jsx(te,{className:"w-4 h-4 text-yellow-500 fill-current"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>I(s),children:e.jsx(ee,{className:"w-4 h-4"})}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>z(s.id),className:"text-red-600 hover:text-red-700",children:e.jsx(ne,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{variant:"outline",className:"text-xs",children:s.relationship}),!n&&e.jsx(O,{variant:"secondary",className:"text-xs",children:D(s.child_id)})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:s.phone})]}),s.email&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:s.email})]}),s.address&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-xs",children:s.address})]})]})]})]})},s.id))})})}),e.jsx(M,{open:u,onOpenChange:g,children:e.jsxs(T,{children:[e.jsxs(U,{children:[e.jsx(Q,{children:"Add Emergency Contact"}),e.jsxs(K,{children:["Add a new emergency contact for ",n?D(n):"your child","."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"contact_name",children:"Contact Name"}),e.jsx(h,{id:"contact_name",value:r.contact_name,onChange:s=>l(a=>({...a,contact_name:s.target.value})),placeholder:"Full name"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"relationship",children:"Relationship"}),e.jsx(h,{id:"relationship",value:r.relationship,onChange:s=>l(a=>({...a,relationship:s.target.value})),placeholder:"e.g., Mother, Father, Grandparent"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"phone",children:"Phone Number"}),e.jsx(h,{id:"phone",value:r.phone,onChange:s=>l(a=>({...a,phone:s.target.value})),placeholder:"Phone number"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"email",children:"Email (Optional)"}),e.jsx(h,{id:"email",type:"email",value:r.email,onChange:s=>l(a=>({...a,email:s.target.value})),placeholder:"Email address"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"address",children:"Address (Optional)"}),e.jsx(L,{id:"address",value:r.address,onChange:s=>l(a=>({...a,address:s.target.value})),placeholder:"Full address",rows:2})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"is_primary",checked:r.is_primary,onChange:s=>l(a=>({...a,is_primary:s.target.checked})),className:"rounded"}),e.jsx(o,{htmlFor:"is_primary",children:"Primary contact"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(m,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsxs(m,{onClick:G,disabled:!r.contact_name||!r.relationship||!r.phone||v.isPending,children:[v.isPending&&e.jsx(E,{className:"w-4 h-4 mr-2 animate-spin"}),"Add Contact"]})]})]})]})}),e.jsx(M,{open:R,onOpenChange:y,children:e.jsxs(T,{children:[e.jsxs(U,{children:[e.jsx(Q,{children:"Edit Emergency Contact"}),e.jsx(K,{children:"Update the emergency contact information."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"edit_contact_name",children:"Contact Name"}),e.jsx(h,{id:"edit_contact_name",value:r.contact_name,onChange:s=>l(a=>({...a,contact_name:s.target.value})),placeholder:"Full name"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"edit_relationship",children:"Relationship"}),e.jsx(h,{id:"edit_relationship",value:r.relationship,onChange:s=>l(a=>({...a,relationship:s.target.value})),placeholder:"e.g., Mother, Father, Grandparent"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"edit_phone",children:"Phone Number"}),e.jsx(h,{id:"edit_phone",value:r.phone,onChange:s=>l(a=>({...a,phone:s.target.value})),placeholder:"Phone number"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"edit_email",children:"Email (Optional)"}),e.jsx(h,{id:"edit_email",type:"email",value:r.email,onChange:s=>l(a=>({...a,email:s.target.value})),placeholder:"Email address"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"edit_address",children:"Address (Optional)"}),e.jsx(L,{id:"edit_address",value:r.address,onChange:s=>l(a=>({...a,address:s.target.value})),placeholder:"Full address",rows:2})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"edit_is_primary",checked:r.is_primary,onChange:s=>l(a=>({...a,is_primary:s.target.checked})),className:"rounded"}),e.jsx(o,{htmlFor:"edit_is_primary",children:"Primary contact"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(m,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsxs(m,{onClick:H,disabled:!r.contact_name||!r.relationship||!r.phone||f.isPending,children:[f.isPending&&e.jsx(E,{className:"w-4 h-4 mr-2 animate-spin"}),"Update Contact"]})]})]})]})})]})};export{he as E};
