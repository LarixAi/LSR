import{m as ee,r as M,j as e,N as A,H as D,J as f,T as b,ab as k,ac as z,ad as q,ae as I,af as o,B as v,aq as se,D as _,e as l,k as i,b as ae,U as re,bC as S,C as ne,O as te,Q as le,V as C,Y as L,g as x,h as m,K as ie,n as E,at as ce,I as de,ak as oe,a as xe,f as me,F as he,d as je}from"./main-DVuL102c.js";const ge=()=>{const{user:B,profile:n,loading:O}=ee(),[U,G]=M.useState("30d"),[K,P]=M.useState("overview"),[h,H]=M.useState("");if(O)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading fleet reports..."})]})});if(!B||!n)return e.jsx(A,{to:"/auth",replace:!0});if(!["admin","council"].includes(n.role))return e.jsx(A,{to:"/unauthorized",replace:!0});const{data:a,isLoading:Q}=D({queryKey:["fleet-stats",n.organization_id],queryFn:async()=>{try{const{data:s,error:d}=await f.from("vehicles").select("*").eq("organization_id",n.organization_id);if(d)return console.error("Error fetching vehicles:",d),null;const{data:g,error:r}=await f.from("profiles").select("*").eq("organization_id",n.organization_id).eq("role","driver");if(r)return console.error("Error fetching drivers:",r),null;const{data:c,error:p}=await f.from("fuel_purchases").select("*").eq("organization_id",n.organization_id);p&&console.error("Error fetching fuel purchases:",p);const y=(s==null?void 0:s.length)||0,F=(s==null?void 0:s.filter(t=>t.status==="active").length)||0,N=(s==null?void 0:s.filter(t=>t.status==="maintenance").length)||0,j=(g==null?void 0:g.length)||0,w=(s==null?void 0:s.reduce((t,u)=>t+(u.mileage||0),0))||0,Y=(s==null?void 0:s.length)>0?s.reduce((t,u)=>t+(u.fuel_efficiency||0),0)/s.length:0,W=(c==null?void 0:c.reduce((t,u)=>t+(u.total_cost||0),0))||0,X=(s==null?void 0:s.reduce((t,u)=>t+(u.maintenance_cost||0),0))||0,Z=(s==null?void 0:s.length)>0?s.filter(t=>t.compliance_status==="compliant").length/s.length*100:100;return{totalVehicles:y,activeVehicles:F,maintenanceVehicles:N,totalDrivers:j,totalMileage:w,averageFuelEfficiency:Y,totalFuelCost:W,totalMaintenanceCost:X,complianceRate:Z,incidentsThisMonth:0}}catch(s){return console.error("Error calculating fleet stats:",s),null}},enabled:!!(n!=null&&n.organization_id)}),{data:T,isLoading:$}=D({queryKey:["vehicle-reports",n.organization_id],queryFn:async()=>{try{const{data:s,error:d}=await f.from("vehicles").select("*").eq("organization_id",n.organization_id);if(d)return console.error("Error fetching vehicles:",d),[];let g=new Map;try{const{data:r,error:c}=await f.from("driver_vehicle_assignments").select("vehicle_id, driver_id, status").eq("organization_id",n.organization_id).eq("status","active");if(!c&&r&&r.length>0){const p=[...new Set(r.map(N=>N.driver_id))],{data:y,error:F}=await f.from("profiles").select("id, first_name, last_name").in("id",p);if(!F&&y){const N=new Map;y.forEach(j=>{N.set(j.id,j)}),r.forEach(j=>{const w=N.get(j.driver_id);w&&g.set(j.vehicle_id,w)})}}else c&&console.warn("Driver assignments table not available:",c.message)}catch{console.warn("Driver assignments table not available, showing vehicles without driver info")}return d?(console.error("Error fetching vehicle reports:",d),[]):(s==null?void 0:s.map(r=>{const c=g.get(r.id),p=c?`${c.first_name||""} ${c.last_name||""}`.trim():"Unassigned";return{id:r.id,vehicleNumber:r.vehicle_number||"N/A",make:r.make||"N/A",model:r.model||"N/A",licensePlate:r.license_plate||"N/A",status:r.status||"unknown",mileage:r.mileage||0,fuelEfficiency:r.fuel_efficiency||0,lastMaintenance:r.last_maintenance_date?new Date(r.last_maintenance_date).toLocaleDateString():"N/A",nextMaintenance:r.next_maintenance_date?new Date(r.next_maintenance_date).toLocaleDateString():"N/A",driver:p,complianceStatus:r.compliance_status||"unknown"}}))||[]}catch(s){return console.error("Error fetching vehicle reports:",s),[]}},enabled:!!(n!=null&&n.organization_id)}),J=Q||$,R=s=>{const d={active:"bg-green-100 text-green-800 border-green-200",maintenance:"bg-yellow-100 text-yellow-800 border-yellow-200",inactive:"bg-gray-100 text-gray-800 border-gray-200",compliant:"bg-green-100 text-green-800 border-green-200",non_compliant:"bg-red-100 text-red-800 border-red-200",unknown:"bg-gray-100 text-gray-800 border-gray-200"};return d[s]||d.unknown},V=(T==null?void 0:T.filter(s=>!h||s.vehicleNumber.toLowerCase().includes(h.toLowerCase())||s.make.toLowerCase().includes(h.toLowerCase())||s.model.toLowerCase().includes(h.toLowerCase())||s.licensePlate.toLowerCase().includes(h.toLowerCase())||s.driver.toLowerCase().includes(h.toLowerCase())))||[];return J?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading fleet data..."})]})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(b,{className:"w-8 h-8 text-blue-600"}),"Fleet Reports"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Comprehensive fleet analytics and reporting"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(k,{value:U,onValueChange:G,children:[e.jsx(z,{className:"w-40",children:e.jsx(q,{})}),e.jsxs(I,{children:[e.jsx(o,{value:"7d",children:"Last 7 days"}),e.jsx(o,{value:"30d",children:"Last 30 days"}),e.jsx(o,{value:"90d",children:"Last 90 days"}),e.jsx(o,{value:"1y",children:"Last year"})]})]}),e.jsxs(v,{variant:"outline",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Refresh"]}),e.jsxs(v,{children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Export Report"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(l,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Vehicles"}),e.jsx("p",{className:"text-2xl font-bold",children:(a==null?void 0:a.totalVehicles)||0}),e.jsxs("p",{className:"text-xs text-green-600 flex items-center gap-1",children:[e.jsx(ae,{className:"w-3 h-3"}),(a==null?void 0:a.activeVehicles)||0," active"]})]})]})})}),e.jsx(l,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Drivers"}),e.jsx("p",{className:"text-2xl font-bold",children:(a==null?void 0:a.totalDrivers)||0}),e.jsx("p",{className:"text-xs text-blue-600",children:"Assigned to vehicles"})]})]})})}),e.jsx(l,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(S,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Fuel Efficiency"}),e.jsxs("p",{className:"text-2xl font-bold",children:[(a==null?void 0:a.averageFuelEfficiency.toFixed(1))||0," mpg"]}),e.jsx("p",{className:"text-xs text-orange-600",children:"Average across fleet"})]})]})})}),e.jsx(l,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Compliance Rate"}),e.jsxs("p",{className:"text-2xl font-bold",children:[(a==null?void 0:a.complianceRate.toFixed(1))||100,"%"]}),e.jsx("p",{className:"text-xs text-green-600",children:"All vehicles compliant"})]})]})})})]}),e.jsxs(te,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(le,{className:"grid w-full grid-cols-4",children:[e.jsx(C,{value:"overview",children:"Overview"}),e.jsx(C,{value:"vehicles",children:"Vehicles"}),e.jsx(C,{value:"analytics",children:"Analytics"}),e.jsx(C,{value:"reports",children:"Reports"})]}),e.jsx(L,{value:"overview",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsx(x,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5"}),"Fleet Status"]})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Active Vehicles"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:(a==null?void 0:a.activeVehicles)||0}),e.jsx(E,{variant:"outline",className:"bg-green-100 text-green-800",children:"Operational"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Maintenance"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:(a==null?void 0:a.maintenanceVehicles)||0}),e.jsx(E,{variant:"outline",className:"bg-yellow-100 text-yellow-800",children:"Service"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Total Mileage"}),e.jsxs("span",{className:"font-medium",children:[(a==null?void 0:a.totalMileage.toLocaleString())||0," miles"]})]})]})})]}),e.jsxs(l,{children:[e.jsx(x,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5"}),"Cost Analysis"]})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Fuel Costs"}),e.jsxs("span",{className:"font-medium",children:["£",(a==null?void 0:a.totalFuelCost.toLocaleString())||0]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Maintenance Costs"}),e.jsxs("span",{className:"font-medium",children:["£",(a==null?void 0:a.totalMaintenanceCost.toLocaleString())||0]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Total Operating Cost"}),e.jsxs("span",{className:"font-medium text-lg",children:["£",(((a==null?void 0:a.totalFuelCost)||0)+((a==null?void 0:a.totalMaintenanceCost)||0)).toLocaleString()]})]})]})})]})]})}),e.jsxs(L,{value:"vehicles",className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(de,{placeholder:"Search vehicles...",value:h,onChange:s=>H(s.target.value),className:"max-w-sm"})}),e.jsxs(k,{value:K,onValueChange:P,children:[e.jsx(z,{className:"w-40",children:e.jsx(q,{})}),e.jsxs(I,{children:[e.jsx(o,{value:"all",children:"All Vehicles"}),e.jsx(o,{value:"active",children:"Active Only"}),e.jsx(o,{value:"maintenance",children:"In Maintenance"}),e.jsx(o,{value:"non_compliant",children:"Non-Compliant"})]})]})]}),e.jsxs(l,{children:[e.jsx(x,{children:e.jsx(m,{children:"Vehicle Details"})}),e.jsx(i,{children:e.jsx("div",{className:"space-y-4",children:V.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(b,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium",children:"No vehicles found"}),e.jsx("p",{children:"Try adjusting your search criteria"})]}):V.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(b,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.vehicleNumber}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.make," ",s.model," • ",s.licensePlate]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Driver: ",s.driver," • Mileage: ",s.mileage.toLocaleString()," miles"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:R(s.status),children:s.status}),e.jsx(E,{className:R(s.complianceStatus),children:s.complianceStatus}),e.jsx(v,{variant:"outline",size:"sm",children:e.jsx(oe,{className:"w-4 h-4"})})]})]},s.id))})})]})]}),e.jsx(L,{value:"analytics",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsx(x,{children:e.jsx(m,{children:"Fuel Efficiency Trends"})}),e.jsx(i,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(xe,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"Fuel efficiency analytics chart will be displayed here"})]})})]}),e.jsxs(l,{children:[e.jsx(x,{children:e.jsx(m,{children:"Maintenance Schedule"})}),e.jsx(i,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(me,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"Maintenance schedule chart will be displayed here"})]})})]})]})}),e.jsx(L,{value:"reports",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(l,{children:[e.jsx(x,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5"}),"Fleet Summary"]})}),e.jsxs(i,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Comprehensive fleet summary with vehicle status and performance metrics."}),e.jsxs(v,{variant:"outline",className:"w-full",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Generate Report"]})]})]}),e.jsxs(l,{children:[e.jsx(x,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5"}),"Fuel Analysis"]})}),e.jsxs(i,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Detailed fuel consumption analysis and cost breakdown."}),e.jsxs(v,{variant:"outline",className:"w-full",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Generate Report"]})]})]}),e.jsxs(l,{children:[e.jsx(x,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5"}),"Maintenance Report"]})}),e.jsxs(i,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Maintenance history and upcoming service schedules."}),e.jsxs(v,{variant:"outline",className:"w-full",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Generate Report"]})]})]})]})})]}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["Last updated: ",new Date().toLocaleDateString()]})]})};export{ge as default};
