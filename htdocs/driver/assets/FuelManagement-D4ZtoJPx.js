import{m as he,a1 as ue,r as u,j as e,N as R,B as c,aq as me,am as I,e as r,k as d,at as je,bC as P,b as pe,a as ve,O as fe,Q as ge,V as S,Y as D,g as y,h as N,ax as f,au as ye,I as p,ab as L,ac as q,ad as A,ae as k,af as o,ak as Ne,an as be,a4 as Q,a5 as U,a6 as z,a7 as Y,a8 as _e,q as a,s as we,n as Fe}from"./main-DVuL102c.js";import{T as Ce,a as Te,b as G,c as x,d as Pe,e as h}from"./table-Jjtal2IW.js";import{u as Se,a as De,b as Le,c as qe,d as Ae}from"./useFuelPurchases-D-HO7J6e.js";import{u as ke}from"./useVehicles-DG5ys_xt.js";import{T as Me}from"./trash-2-uDLx8yM9.js";const Ie=()=>{const{user:J,profile:v,loading:K}=he();ue();const[W,X]=u.useState("overview"),[g,Z]=u.useState(""),[b,$]=u.useState("all"),[ee,m]=u.useState(!1),[_,M]=u.useState(null),[l,V]=u.useState(null),{data:E=[],isLoading:se,error:Ve,refetch:te}=Se(),{data:ae=[]}=ke(),w=De(),F=Le(),le=qe(),{statistics:j}=Ae(),ie=E,[t,n]=u.useState({vehicle_id:"",fuel_type:"diesel",quantity:0,unit_price:0,total_cost:0,location:"",odometer_reading:0,purchase_date:new Date().toISOString().split("T")[0],notes:""});if(K)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading..."})]})});if(!J||!v)return e.jsx(R,{to:"/auth",replace:!0});if(!["admin","council","driver"].includes(v.role))return e.jsx(R,{to:"/",replace:!0});const ne=["admin","council"].includes(v.role)?ie:E,ce=se,C=ne.filter(s=>{var O,H,B;const i=((O=s.vehicle_number)==null?void 0:O.toLowerCase().includes(g.toLowerCase()))||((H=s.location)==null?void 0:H.toLowerCase().includes(g.toLowerCase()))||((B=s.driver_name)==null?void 0:B.toLowerCase().includes(g.toLowerCase())),xe=b==="all"||s.fuel_type===b;return i&&xe}),T=s=>{const i={diesel:"bg-blue-100 text-blue-800",petrol:"bg-green-100 text-green-800",electric:"bg-purple-100 text-purple-800"};return e.jsx(Fe,{className:i[s]||"bg-gray-100 text-gray-800",children:s.charAt(0).toUpperCase()+s.slice(1)})},re=async s=>{s.preventDefault();try{_?(await F.mutateAsync({id:_.id,updates:t}),M(null)):await w.mutateAsync(t),m(!1),n({vehicle_id:"",fuel_type:"diesel",quantity:0,unit_price:0,total_cost:0,location:"",odometer_reading:0,purchase_date:new Date().toISOString().split("T")[0],notes:""})}catch(i){console.error("Error saving fuel purchase:",i)}},de=s=>{M(s),n({vehicle_id:s.vehicle_id,fuel_type:s.fuel_type,quantity:s.quantity,unit_price:s.unit_price,total_cost:s.total_cost,location:s.location||"",odometer_reading:s.odometer_reading||0,purchase_date:s.purchase_date,notes:s.notes||""}),m(!0)},oe=async s=>{confirm("Are you sure you want to delete this fuel purchase?")&&await le.mutateAsync(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Fuel Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Track and manage fuel consumption, costs, and efficiency"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{onClick:()=>te(),variant:"outline",size:"sm",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Refresh"]}),e.jsxs(c,{onClick:()=>m(!0),children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Add Purchase"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(r,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Spent"}),e.jsxs("p",{className:"text-2xl font-bold",children:["£",j.totalSpent.toFixed(2)]})]}),e.jsx(je,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(r,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Fuel"}),e.jsxs("p",{className:"text-2xl font-bold",children:[j.totalQuantity.toFixed(1),"L"]})]}),e.jsx(P,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(r,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Avg Price/L"}),e.jsxs("p",{className:"text-2xl font-bold",children:["£",j.averagePrice.toFixed(2)]})]}),e.jsx(pe,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(r,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Purchases"}),e.jsx("p",{className:"text-2xl font-bold",children:j.purchaseCount})]}),e.jsx(ve,{className:"h-8 w-8 text-muted-foreground"})]})})})]}),e.jsxs(fe,{value:W,onValueChange:X,className:"space-y-4",children:[e.jsxs(ge,{children:[e.jsx(S,{value:"overview",children:"Overview"}),e.jsx(S,{value:"purchases",children:"Purchase History"}),e.jsx(S,{value:"analytics",children:"Analytics"})]}),e.jsx(D,{value:"overview",className:"space-y-4",children:e.jsxs(r,{children:[e.jsx(y,{children:e.jsx(N,{children:"Recent Fuel Purchases"})}),e.jsx(d,{children:ce?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{children:"Loading fuel purchases..."})]}):C.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(P,{className:"h-16 w-16 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No fuel purchases found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Start tracking your fuel consumption by adding your first purchase."}),e.jsxs(c,{onClick:()=>m(!0),children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Add First Purchase"]})]}):e.jsx("div",{className:"space-y-4",children:C.slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(P,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.vehicle_number}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[f(new Date(s.purchase_date),"MMM dd, yyyy")," • ",s.location]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium",children:["£",s.total_cost.toFixed(2)]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.quantity,"L ",s.fuel_type]})]})]},s.id))})})]})}),e.jsx(D,{value:"purchases",className:"space-y-4",children:e.jsxs(r,{children:[e.jsx(y,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{children:"Purchase History"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(p,{placeholder:"Search purchases...",value:g,onChange:s=>Z(s.target.value),className:"pl-10 w-64"})]}),e.jsxs(L,{value:b,onValueChange:$,children:[e.jsx(q,{className:"w-32",children:e.jsx(A,{})}),e.jsxs(k,{children:[e.jsx(o,{value:"all",children:"All Types"}),e.jsx(o,{value:"diesel",children:"Diesel"}),e.jsx(o,{value:"petrol",children:"Petrol"}),e.jsx(o,{value:"electric",children:"Electric"})]})]})]})]})}),e.jsx(d,{children:e.jsxs(Ce,{children:[e.jsx(Te,{children:e.jsxs(G,{children:[e.jsx(x,{children:"Vehicle"}),["admin","council"].includes(v.role)&&e.jsx(x,{children:"Driver"}),e.jsx(x,{children:"Date"}),e.jsx(x,{children:"Fuel Type"}),e.jsx(x,{children:"Quantity"}),e.jsx(x,{children:"Total Cost"}),e.jsx(x,{children:"Location"}),e.jsx(x,{className:"text-right",children:"Actions"})]})}),e.jsx(Pe,{children:C.map(s=>e.jsxs(G,{children:[e.jsx(h,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.vehicle_number}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.license_plate})]})}),["admin","council"].includes(v.role)&&e.jsx(h,{children:s.driver_name}),e.jsx(h,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:f(new Date(s.purchase_date),"MMM dd, yyyy")}),e.jsx("div",{className:"text-sm text-muted-foreground",children:f(new Date(s.created_at),"HH:mm")})]})}),e.jsx(h,{children:T(s.fuel_type)}),e.jsx(h,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.quantity,"L"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["£",s.unit_price,"/L"]})]})}),e.jsxs(h,{children:["£",s.total_cost.toFixed(2)]}),e.jsx(h,{children:s.location}),e.jsx(h,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>V(s),children:e.jsx(Ne,{className:"w-4 h-4"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>de(s),children:e.jsx(be,{className:"w-4 h-4"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>oe(s.id),children:e.jsx(Me,{className:"w-4 h-4"})})]})})]},s.id))})]})})]})}),e.jsx(D,{value:"analytics",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(r,{children:[e.jsx(y,{children:e.jsx(N,{children:"Fuel Type Breakdown"})}),e.jsx(d,{children:Object.entries(j.byFuelType).map(([s,i])=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[T(s),e.jsx("span",{className:"font-medium",children:s.charAt(0).toUpperCase()+s.slice(1)})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:[i.quantity.toFixed(1),"L"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["£",i.cost.toFixed(2)]})]})]},s))})]}),e.jsxs(r,{children:[e.jsx(y,{children:e.jsx(N,{children:"Monthly Trends"})}),e.jsx(d,{children:Object.entries(j.monthlyData).slice(0,6).map(([s,i])=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"font-medium",children:f(new Date(s+"-01"),"MMM yyyy")}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:[i.quantity.toFixed(1),"L"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["£",i.cost.toFixed(2)]})]})]},s))})]})]})})]}),e.jsx(Q,{open:ee,onOpenChange:m,children:e.jsxs(U,{className:"max-w-md",children:[e.jsxs(z,{children:[e.jsx(Y,{children:_?"Edit Fuel Purchase":"Add Fuel Purchase"}),e.jsx(_e,{children:"Record a new fuel purchase for your vehicle."})]}),e.jsxs("form",{onSubmit:re,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"vehicle",children:"Vehicle"}),e.jsxs(L,{value:t.vehicle_id,onValueChange:s=>n({...t,vehicle_id:s}),children:[e.jsx(q,{children:e.jsx(A,{placeholder:"Select vehicle"})}),e.jsx(k,{children:ae.map(s=>e.jsxs(o,{value:s.id,children:[s.vehicle_number," - ",s.license_plate]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"fuel_type",children:"Fuel Type"}),e.jsxs(L,{value:t.fuel_type,onValueChange:s=>n({...t,fuel_type:s}),children:[e.jsx(q,{children:e.jsx(A,{})}),e.jsxs(k,{children:[e.jsx(o,{value:"diesel",children:"Diesel"}),e.jsx(o,{value:"petrol",children:"Petrol"}),e.jsx(o,{value:"electric",children:"Electric"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"quantity",children:"Quantity (L)"}),e.jsx(p,{id:"quantity",type:"number",step:"0.01",value:t.quantity,onChange:s=>n({...t,quantity:parseFloat(s.target.value)||0}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"unit_price",children:"Price per L"}),e.jsx(p,{id:"unit_price",type:"number",step:"0.01",value:t.unit_price,onChange:s=>n({...t,unit_price:parseFloat(s.target.value)||0}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"total_cost",children:"Total Cost"}),e.jsx(p,{id:"total_cost",type:"number",step:"0.01",value:t.total_cost,onChange:s=>n({...t,total_cost:parseFloat(s.target.value)||0}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"location",children:"Location"}),e.jsx(p,{id:"location",value:t.location,onChange:s=>n({...t,location:s.target.value}),placeholder:"Fuel station name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"purchase_date",children:"Purchase Date"}),e.jsx(p,{id:"purchase_date",type:"date",value:t.purchase_date,onChange:s=>n({...t,purchase_date:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"notes",children:"Notes"}),e.jsx(we,{id:"notes",value:t.notes,onChange:s=>n({...t,notes:s.target.value}),placeholder:"Any additional notes..."})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(c,{type:"submit",disabled:w.isPending||F.isPending,children:w.isPending||F.isPending?"Saving...":"Save Purchase"})]})]})]})}),e.jsx(Q,{open:!!l,onOpenChange:()=>V(null),children:e.jsxs(U,{children:[e.jsx(z,{children:e.jsx(Y,{children:"Fuel Purchase Details"})}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium",children:"Vehicle"}),e.jsxs("p",{children:[l.vehicle_number," - ",l.license_plate]})]}),e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium",children:"Fuel Type"}),e.jsx("p",{children:T(l.fuel_type)})]}),e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium",children:"Quantity"}),e.jsxs("p",{children:[l.quantity,"L"]})]}),e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium",children:"Unit Price"}),e.jsxs("p",{children:["£",l.unit_price,"/L"]})]}),e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium",children:"Total Cost"}),e.jsxs("p",{children:["£",l.total_cost.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium",children:"Purchase Date"}),e.jsx("p",{children:f(new Date(l.purchase_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium",children:"Location"}),e.jsx("p",{children:l.location||"N/A"})]}),e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium",children:"Odometer"}),e.jsx("p",{children:l.odometer_reading||"N/A"})]})]}),l.notes&&e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium",children:"Notes"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.notes})]})]})]})})]})};export{Ie as default};
