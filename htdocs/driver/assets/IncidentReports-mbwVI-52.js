import{c as _e,j as e,a4 as je,a5 as pe,a6 as ge,a7 as fe,B as I,b1 as He,p as Ye,W as Ze,I as S,ab as F,ac as M,ad as O,ae as U,af as o,s as $,q as R,M as H,U as Xe,X as he,am as X,ak as Le,a9 as Qe,b2 as es,r as w,b3 as ss,e as D,g as z,h as K,b4 as be,k as E,J as ts,aA as as,ai as te,f as Y,d as Z,a1 as De,i as rs,az as ie,E as ee,O as ns,Q as ls,V as ce,Y as oe,au as is,aU as cs,F as se,n as q,ax as xe,ap as os,P as re,S as ds,a0 as Ee,C as Te,m as hs,x as xs,N as we,A as ms,z as us,aq as js,aO as Se,ag as Ie,an as ps,v as gs,a8 as fs}from"./main-DVuL102c.js";import{H as vs}from"./heart-CNuKn9NJ.js";import{F as p,a as g,b as f,c as v,d as N,o as Ns,s as k,e as Ce,f as ys,g as de,h as bs,i as ws}from"./zod-DmcAZk49.js";import{u as Ss}from"./index.esm-Wi9rdkmu.js";import{u as Ae,a as Is,b as Cs}from"./useIncidents-yoctCb7n.js";import{B as ks}from"./book-open-gFg9M0j_.js";import{p as ke}from"./parseISO-1k6pJICp.js";import{S as _s}from"./save-D41s1EFm.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=_e("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=_e("Plane",[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]]);var P=(t=>(t.transportation="transportation",t.school="school",t.wedding="wedding",t.airport="airport",t.privateJob="privateJob",t))(P||{});function Pe(t){switch(t){case P.transportation:return"Transportation";case P.school:return"School";case P.wedding:return"Wedding";case P.airport:return"Airport Run";case P.privateJob:return"Private Job";default:return"Unknown"}}function Es(t){switch(t){case P.transportation:return"directions_bus";case P.school:return"school";case P.wedding:return"favorite";case P.airport:return"flight_takeoff";case P.privateJob:return"build";default:return"help"}}const Ts=({open:t,onOpenChange:a,onSelect:r})=>{const s=Object.values(P),i=l=>{const h={directions_bus:Ye,school:Ls,favorite:vs,flight_takeoff:Ds,build:Ze}[l]||He;return e.jsx(h,{className:"w-8 h-8"})};return e.jsx(je,{open:t,onOpenChange:a,children:e.jsxs(pe,{className:"max-w-md",children:[e.jsx(ge,{children:e.jsx(fe,{children:"Select Incident Type"})}),e.jsx("div",{className:"grid grid-cols-2 gap-4 p-4",children:s.map(l=>e.jsxs(I,{variant:"outline",className:"h-24 flex flex-col items-center justify-center space-y-2",onClick:()=>{r(l),a(!1)},children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center text-blue-600",children:i(Es(l))}),e.jsx("span",{className:"text-sm font-medium text-center",children:Pe(l)})]},l))})]})})},As=({form:t})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{control:t.control,name:"title",render:({field:a})=>e.jsxs(g,{children:[e.jsx(f,{children:"Incident Title"}),e.jsx(v,{children:e.jsx(S,{placeholder:"Brief description of the incident",...a})}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"severity",render:({field:a})=>e.jsxs(g,{children:[e.jsx(f,{children:"Severity"}),e.jsxs(F,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(v,{children:e.jsx(M,{children:e.jsx(O,{placeholder:"Select severity"})})}),e.jsxs(U,{children:[e.jsx(o,{value:"low",children:"Low"}),e.jsx(o,{value:"medium",children:"Medium"}),e.jsx(o,{value:"high",children:"High"}),e.jsx(o,{value:"critical",children:"Critical"})]})]}),e.jsx(N,{})]})})]}),e.jsx(p,{control:t.control,name:"description",render:({field:a})=>e.jsxs(g,{children:[e.jsx(f,{children:"Detailed Description"}),e.jsx(v,{children:e.jsx($,{placeholder:"Provide a detailed description of what happened...",className:"min-h-[100px]",...a})}),e.jsx(N,{})]})})]}),Ps=({selectedLocation:t,onLocationPickerOpen:a})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs(R,{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{children:"Location"})]}),t?e.jsxs("div",{className:"p-4 border rounded-lg bg-gray-50",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Latitude: ",t.lat.toFixed(6),", Longitude: ",t.lng.toFixed(6)]}),e.jsx(I,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:a,children:"Change Location"})]}):e.jsxs(I,{type:"button",variant:"outline",onClick:a,children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Pick Location"]})]}),Rs=({peopleInvolved:t,setPeopleInvolved:a,witnesses:r,setWitnesses:s})=>{const i=()=>{a([...t,""])},l=x=>{a(t.filter((u,j)=>j!==x))},d=(x,u)=>{const j=[...t];j[x]=u,a(j)},h=()=>{s([...r,""])},m=x=>{s(r.filter((u,j)=>j!==x))},b=(x,u)=>{const j=[...r];j[x]=u,s(j)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs(R,{className:"flex items-center space-x-2",children:[e.jsx(Xe,{className:"w-4 h-4"}),e.jsx("span",{children:"People Involved"})]}),t.map((x,u)=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(S,{placeholder:"Name of person involved",value:x,onChange:j=>d(u,j.target.value)}),t.length>1&&e.jsx(I,{type:"button",variant:"outline",size:"icon",onClick:()=>l(u),children:e.jsx(he,{className:"w-4 h-4"})})]},u)),e.jsxs(I,{type:"button",variant:"outline",onClick:i,children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Add Person"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(R,{className:"flex items-center space-x-2",children:[e.jsx(Le,{className:"w-4 h-4"}),e.jsx("span",{children:"Witnesses"})]}),r.map((x,u)=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(S,{placeholder:"Name of witness",value:x,onChange:j=>b(u,j.target.value)}),r.length>1&&e.jsx(I,{type:"button",variant:"outline",size:"icon",onClick:()=>m(u),children:e.jsx(he,{className:"w-4 h-4"})})]},u)),e.jsxs(I,{type:"button",variant:"outline",onClick:h,children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Add Witness"]})]})]})},Fs=({attachments:t,setAttachments:a})=>{const r=i=>{const l=Array.from(i.target.files||[]);a([...t,...l])},s=i=>{a(t.filter((l,d)=>d!==i))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(R,{className:"flex items-center space-x-2",children:[e.jsx(Qe,{className:"w-4 h-4"}),e.jsx("span",{children:"Attachments"})]}),e.jsx(S,{type:"file",multiple:!0,accept:"image/*,application/pdf,.doc,.docx",onChange:r}),t.length>0&&e.jsx("div",{className:"space-y-2",children:t.map((i,l)=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsx("span",{className:"text-sm",children:i.name}),e.jsx(I,{type:"button",variant:"outline",size:"sm",onClick:()=>s(l),children:e.jsx(he,{className:"w-4 h-4"})})]},l))})]})};var me={exports:{}};function Ms(t,a,r,s){function i(l){return l instanceof r?l:new r(function(d){d(l)})}return new(r||(r=Promise))(function(l,d){function h(x){try{b(s.next(x))}catch(u){d(u)}}function m(x){try{b(s.throw(x))}catch(u){d(u)}}function b(x){x.done?l(x.value):i(x.value).then(h,m)}b((s=s.apply(t,[])).next())})}function Os(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Us=function t(a,r){if(a===r)return!0;if(a&&r&&typeof a=="object"&&typeof r=="object"){if(a.constructor!==r.constructor)return!1;var s,i,l;if(Array.isArray(a)){if(s=a.length,s!=r.length)return!1;for(i=s;i--!==0;)if(!t(a[i],r[i]))return!1;return!0}if(a.constructor===RegExp)return a.source===r.source&&a.flags===r.flags;if(a.valueOf!==Object.prototype.valueOf)return a.valueOf()===r.valueOf();if(a.toString!==Object.prototype.toString)return a.toString()===r.toString();if(l=Object.keys(a),s=l.length,s!==Object.keys(r).length)return!1;for(i=s;i--!==0;)if(!Object.prototype.hasOwnProperty.call(r,l[i]))return!1;for(i=s;i--!==0;){var d=l[i];if(!t(a[d],r[d]))return!1}return!0}return a!==a&&r!==r},Vs=Os(Us);const ue="__googleMapsScriptId";var W;(function(t){t[t.INITIALIZED=0]="INITIALIZED",t[t.LOADING=1]="LOADING",t[t.SUCCESS=2]="SUCCESS",t[t.FAILURE=3]="FAILURE"})(W||(W={}));class J{constructor({apiKey:a,authReferrerPolicy:r,channel:s,client:i,id:l=ue,language:d,libraries:h=[],mapIds:m,nonce:b,region:x,retries:u=3,url:j="https://maps.googleapis.com/maps/api/js",version:C}){if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=a,this.authReferrerPolicy=r,this.channel=s,this.client=i,this.id=l||ue,this.language=d,this.libraries=h,this.mapIds=m,this.nonce=b,this.region=x,this.retries=u,this.url=j,this.version=C,J.instance){if(!Vs(this.options,J.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(J.instance.options)}`);return J.instance}J.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?W.FAILURE:this.done?W.SUCCESS:this.loading?W.LOADING:W.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let a=this.url;return a+="?callback=__googleMapsCallback&loading=async",this.apiKey&&(a+=`&key=${this.apiKey}`),this.channel&&(a+=`&channel=${this.channel}`),this.client&&(a+=`&client=${this.client}`),this.libraries.length>0&&(a+=`&libraries=${this.libraries.join(",")}`),this.language&&(a+=`&language=${this.language}`),this.region&&(a+=`&region=${this.region}`),this.version&&(a+=`&v=${this.version}`),this.mapIds&&(a+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(a+=`&auth_referrer_policy=${this.authReferrerPolicy}`),a}deleteScript(){const a=document.getElementById(this.id);a&&a.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((a,r)=>{this.loadCallback(s=>{s?r(s.error):a(window.google)})})}importLibrary(a){return this.execute(),google.maps.importLibrary(a)}loadCallback(a){this.callbacks.push(a),this.execute()}setScript(){var a,r;if(document.getElementById(this.id)){this.callback();return}const s={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(s).forEach(l=>!s[l]&&delete s[l]),!((r=(a=window==null?void 0:window.google)===null||a===void 0?void 0:a.maps)===null||r===void 0)&&r.importLibrary||(l=>{let d,h,m,b="The Google Maps JavaScript API",x="google",u="importLibrary",j="__ib__",C=document,c=window;c=c[x]||(c[x]={});const _=c.maps||(c.maps={}),L=new Set,T=new URLSearchParams,A=()=>d||(d=new Promise((G,B)=>Ms(this,void 0,void 0,function*(){var y;yield h=C.createElement("script"),h.id=this.id,T.set("libraries",[...L]+"");for(m in l)T.set(m.replace(/[A-Z]/g,V=>"_"+V[0].toLowerCase()),l[m]);T.set("callback",x+".maps."+j),h.src=this.url+"?"+T,_[j]=G,h.onerror=()=>d=B(Error(b+" could not load.")),h.nonce=this.nonce||((y=C.querySelector("script[nonce]"))===null||y===void 0?void 0:y.nonce)||"",C.head.append(h)})));_[u]?console.warn(b+" only loads once. Ignoring:",l):_[u]=(G,...B)=>L.add(G)&&A().then(()=>_[u](G,...B))})(s);const i=this.libraries.map(l=>this.importLibrary(l));i.length||i.push(this.importLibrary("core")),Promise.all(i).then(()=>this.callback(),l=>{const d=new ErrorEvent("error",{error:l});this.loadErrorCallback(d)})}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(a){if(this.errors.push(a),this.errors.length<=this.retries){const r=this.errors.length*Math.pow(2,this.errors.length);console.error(`Failed to load Google Maps script, retrying in ${r} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},r)}else this.onerrorEvent=a,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(a=>{a(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),!this.loading)if(this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version){console.warn("Google Maps already loaded outside @googlemaps/js-api-loader. This may result in undesirable behavior as options and script parameters may not match."),this.callback();return}this.loading=!0,this.setScript()}}}const Gs=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_ID:ue,Loader:J,get LoaderStatus(){return W}},Symbol.toStringTag,{value:"Module"})),Bs=es(Gs);(function(t,a){(function(r,s){s(a,Bs,w)})(ss,function(r,s,i){function l(m){return m&&typeof m=="object"&&"default"in m?m:{default:m}}var d=l(i);r.Status=void 0,function(m){m.LOADING="LOADING",m.FAILURE="FAILURE",m.SUCCESS="SUCCESS"}(r.Status||(r.Status={}));const h=({children:m,render:b,callback:x,...u})=>{const[j,C]=i.useState(r.Status.LOADING);return i.useEffect(()=>{const c=new s.Loader(u),_=L=>{x&&x(L,c),C(L)};_(r.Status.LOADING),c.load().then(()=>_(r.Status.SUCCESS),()=>_(r.Status.FAILURE))},[]),j===r.Status.SUCCESS&&m?d.default.createElement(d.default.Fragment,null,m):b?b(j):d.default.createElement(d.default.Fragment,null)};r.Wrapper=h,Object.defineProperty(r,"__esModule",{value:!0})})})(me,me.exports);var ne=me.exports;const zs=({center:t,zoom:a,markers:r=[],routes:s=[]})=>{const i=w.useRef(null),[l,d]=w.useState();return w.useEffect(()=>{if(i.current&&!l){const h=new window.google.maps.Map(i.current,{center:t,zoom:a,mapTypeControl:!0,streetViewControl:!0,fullscreenControl:!0});d(h)}},[i,l,t,a]),w.useEffect(()=>{l&&(r.forEach(h=>{new google.maps.Marker({position:h.position,map:l,title:h.title,icon:h.type==="driver"?{url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(`
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="8" fill="#22c55e" stroke="white" stroke-width="2"/>
                <circle cx="12" cy="12" r="3" fill="white"/>
              </svg>
            `),scaledSize:new google.maps.Size(24,24)}:void 0})}),s.forEach(h=>{new google.maps.Polyline({path:h.path,geodesic:!0,strokeColor:h.color||"#3b82f6",strokeOpacity:1,strokeWeight:3,map:l})}))},[l,r,s]),e.jsx("div",{ref:i,className:"w-full h-full min-h-[400px] rounded-lg"})},Ks=({status:t,center:a,zoom:r,markers:s,routes:i})=>{switch(t){case ne.Status.LOADING:return e.jsxs("div",{className:"flex items-center justify-center h-[400px]",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2",children:"Loading map..."})]});case ne.Status.FAILURE:return e.jsx("div",{className:"flex items-center justify-center h-[400px] bg-gray-100 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(H,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Failed to load map"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Please check your Google Maps API key"})]})});case ne.Status.SUCCESS:return e.jsx(zs,{center:a,zoom:r,markers:s,routes:i});default:return null}},$s=({apiKey:t="",center:a={lat:-25.7479,lng:28.2293},zoom:r=10,markers:s=[],routes:i=[],title:l="Map View",showApiKeyInput:d=!1})=>{const[h,m]=w.useState(t),[b,x]=w.useState(!0);w.useEffect(()=>{h?x(!1):(async()=>{try{const{data:C,error:c}=await ts.functions.invoke("get-google-maps-key");if(C!=null&&C.apiKey)m(C.apiKey);else{console.log("No API key found in Supabase secrets, falling back to local storage");const _=localStorage.getItem("google_maps_api_key");_&&m(_)}}catch{console.log("Error fetching API key from Supabase, using local storage fallback");const c=localStorage.getItem("google_maps_api_key");c&&m(c)}finally{x(!1)}})()},[h]);const u=j=>{m(j),localStorage.setItem("google_maps_api_key",j)};return b?e.jsxs(D,{children:[e.jsx(z,{children:e.jsxs(K,{className:"flex items-center space-x-2",children:[e.jsx(be,{className:"w-5 h-5"}),e.jsx("span",{children:l})]})}),e.jsx(E,{children:e.jsxs("div",{className:"flex items-center justify-center h-[400px]",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2",children:"Loading map configuration..."})]})})]}):d&&!h?e.jsxs(D,{children:[e.jsx(z,{children:e.jsxs(K,{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"w-5 h-5"}),e.jsx("span",{children:l})]})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(R,{htmlFor:"apiKey",children:"Google Maps API Key"}),e.jsx(S,{id:"apiKey",type:"password",placeholder:"Enter your Google Maps API key",value:h,onChange:j=>u(j.target.value)}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Get your API key from"," ",e.jsx("a",{href:"https://console.cloud.google.com/google/maps-apis",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Google Cloud Console"})]})]})})})]}):h?e.jsxs(D,{children:[e.jsx(z,{children:e.jsxs(K,{className:"flex items-center space-x-2",children:[e.jsx(be,{className:"w-5 h-5"}),e.jsx("span",{children:l})]})}),e.jsx(E,{children:e.jsx(ne.Wrapper,{apiKey:h,render:j=>e.jsx(Ks,{status:j,center:a,zoom:r,markers:s,routes:i})})})]}):e.jsxs(D,{children:[e.jsx(z,{children:e.jsxs(K,{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"w-5 h-5"}),e.jsx("span",{children:l})]})}),e.jsx(E,{children:e.jsx("div",{className:"flex items-center justify-center h-[400px] bg-gray-100 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(H,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Google Maps API key required"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Configure your API key to view the map"})]})})})]})},qs=({open:t,onOpenChange:a,onLocationSelect:r,initialLocation:s={lat:-25.7479,lng:28.2293}})=>{const[i,l]=w.useState(s),d=()=>{r(i),a(!1)};return e.jsx(je,{open:t,onOpenChange:a,children:e.jsxs(pe,{className:"max-w-2xl",children:[e.jsx(ge,{children:e.jsx(fe,{children:"Pick Location"})}),e.jsx("div",{className:"h-96",children:e.jsx($s,{center:i,zoom:13,markers:[{position:i,title:"Selected Location",type:"stop"}],showApiKeyInput:!0})}),e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:["Selected: ",i.lat.toFixed(6),", ",i.lng.toFixed(6)]}),e.jsxs(as,{children:[e.jsx(I,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsx(I,{onClick:d,children:"Confirm Location"})]})]})})},Js=({form:t,selectedDate:a,selectedTime:r})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Incident Details"}),e.jsx(te,{className:"mb-4"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{control:t.control,name:"incidentType",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Incident Type"}),e.jsxs(F,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(v,{children:e.jsx(M,{children:e.jsx(O,{placeholder:"Select incident type"})})}),e.jsxs(U,{children:[e.jsx(o,{value:"Collision",children:"Collision"}),e.jsx(o,{value:"Breakdown",children:"Breakdown"}),e.jsx(o,{value:"Passenger Injury",children:"Passenger Injury"}),e.jsx(o,{value:"Other",children:"Other"})]})]}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"vehicleRoute",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Vehicle/Route"}),e.jsx(v,{children:e.jsx(S,{placeholder:"Enter vehicle or route details",...s})}),e.jsx(N,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(p,{control:t.control,name:"date",render:({field:s})=>e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{children:"Date"})]}),e.jsx(v,{children:e.jsx(S,{type:"date",...s,value:a})}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"time",render:({field:s})=>e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"Time"})]}),e.jsx(v,{children:e.jsx(S,{type:"time",...s,value:r})}),e.jsx(N,{})]})})]}),e.jsx(p,{control:t.control,name:"injuriesDamage",render:({field:s})=>e.jsxs(g,{className:"mt-4",children:[e.jsx(f,{children:"Injuries/Damage Details"}),e.jsx(v,{children:e.jsx($,{placeholder:"Describe any injuries or damage...",className:"min-h-[80px]",...s})}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"actionsTaken",render:({field:s})=>e.jsxs(g,{className:"mt-4",children:[e.jsx(f,{children:"Actions Taken"}),e.jsx(v,{children:e.jsx($,{placeholder:"Describe actions taken...",className:"min-h-[80px]",...s})}),e.jsx(N,{})]})})]})}),Ws=({form:t,selectedDate:a,selectedTime:r})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Incident Details"}),e.jsx(te,{className:"mb-4"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{control:t.control,name:"incidentType",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Incident Type"}),e.jsxs(F,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(v,{children:e.jsx(M,{children:e.jsx(O,{placeholder:"Select incident type"})})}),e.jsxs(U,{children:[e.jsx(o,{value:"Student Injury",children:"Student Injury"}),e.jsx(o,{value:"Bullying",children:"Bullying"}),e.jsx(o,{value:"Property Damage",children:"Property Damage"}),e.jsx(o,{value:"Other",children:"Other"})]})]}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"personName",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Student/Staff Name"}),e.jsx(v,{children:e.jsx(S,{placeholder:"Enter name",...s})}),e.jsx(N,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(p,{control:t.control,name:"classRole",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Class/Role"}),e.jsx(v,{children:e.jsx(S,{placeholder:"Enter class or role",...s})}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"schoolLocation",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"School Location"}),e.jsx(v,{children:e.jsx(S,{placeholder:"Enter location within school",...s})}),e.jsx(N,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(p,{control:t.control,name:"date",render:({field:s})=>e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{children:"Date"})]}),e.jsx(v,{children:e.jsx(S,{type:"date",...s,value:a})}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"time",render:({field:s})=>e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"Time"})]}),e.jsx(v,{children:e.jsx(S,{type:"time",...s,value:r})}),e.jsx(N,{})]})})]}),e.jsx(p,{control:t.control,name:"actionsTaken",render:({field:s})=>e.jsxs(g,{className:"mt-4",children:[e.jsx(f,{children:"Actions Taken"}),e.jsx(v,{children:e.jsx($,{placeholder:"Describe actions taken...",className:"min-h-[80px]",...s})}),e.jsx(N,{})]})})]})}),Hs=({form:t,selectedDate:a,selectedTime:r})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Incident Details"}),e.jsx(te,{className:"mb-4"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{control:t.control,name:"incidentType",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Incident Type"}),e.jsxs(F,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(v,{children:e.jsx(M,{children:e.jsx(O,{placeholder:"Select incident type"})})}),e.jsxs(U,{children:[e.jsx(o,{value:"Injury",children:"Injury"}),e.jsx(o,{value:"Property Damage",children:"Property Damage"}),e.jsx(o,{value:"Vendor Issue",children:"Vendor Issue"}),e.jsx(o,{value:"Guest Behavior",children:"Guest Behavior"}),e.jsx(o,{value:"Other",children:"Other"})]})]}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"personInvolved",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Person(s) Involved"}),e.jsx(v,{children:e.jsx(S,{placeholder:"Enter names of people involved",...s})}),e.jsx(N,{})]})})]}),e.jsx(p,{control:t.control,name:"venueLocation",render:({field:s})=>e.jsxs(g,{className:"mt-4",children:[e.jsx(f,{children:"Location (venue/area)"}),e.jsx(v,{children:e.jsx(S,{placeholder:"Enter venue or area details",...s})}),e.jsx(N,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(p,{control:t.control,name:"date",render:({field:s})=>e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{children:"Date"})]}),e.jsx(v,{children:e.jsx(S,{type:"date",...s,value:a})}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"time",render:({field:s})=>e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"Time"})]}),e.jsx(v,{children:e.jsx(S,{type:"time",...s,value:r})}),e.jsx(N,{})]})})]}),e.jsx(p,{control:t.control,name:"actionsTaken",render:({field:s})=>e.jsxs(g,{className:"mt-4",children:[e.jsx(f,{children:"Actions Taken"}),e.jsx(v,{children:e.jsx($,{placeholder:"Describe actions taken...",className:"min-h-[80px]",...s})}),e.jsx(N,{})]})})]})}),Ys=({form:t,selectedDate:a,selectedTime:r})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Incident Details"}),e.jsx(te,{className:"mb-4"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{control:t.control,name:"incidentType",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Incident Type"}),e.jsxs(F,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(v,{children:e.jsx(M,{children:e.jsx(O,{placeholder:"Select incident type"})})}),e.jsxs(U,{children:[e.jsx(o,{value:"Baggage",children:"Baggage"}),e.jsx(o,{value:"Security",children:"Security"}),e.jsx(o,{value:"Injury",children:"Injury"}),e.jsx(o,{value:"Equipment",children:"Equipment"}),e.jsx(o,{value:"Delay",children:"Delay"}),e.jsx(o,{value:"Other",children:"Other"})]})]}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"flightVehicle",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Flight/Vehicle Details"}),e.jsx(v,{children:e.jsx(S,{placeholder:"Enter flight or vehicle details",...s})}),e.jsx(N,{})]})})]}),e.jsx(p,{control:t.control,name:"airportLocation",render:({field:s})=>e.jsxs(g,{className:"mt-4",children:[e.jsx(f,{children:"Location (terminal/gate/runway)"}),e.jsx(v,{children:e.jsx(S,{placeholder:"Enter airport location details",...s})}),e.jsx(N,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(p,{control:t.control,name:"date",render:({field:s})=>e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{children:"Date"})]}),e.jsx(v,{children:e.jsx(S,{type:"date",...s,value:a})}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"time",render:({field:s})=>e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"Time"})]}),e.jsx(v,{children:e.jsx(S,{type:"time",...s,value:r})}),e.jsx(N,{})]})})]}),e.jsx(p,{control:t.control,name:"actionsTaken",render:({field:s})=>e.jsxs(g,{className:"mt-4",children:[e.jsx(f,{children:"Actions Taken"}),e.jsx(v,{children:e.jsx($,{placeholder:"Describe actions taken...",className:"min-h-[80px]",...s})}),e.jsx(N,{})]})})]})}),Zs=({form:t,selectedDate:a,selectedTime:r})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Incident Details"}),e.jsx(te,{className:"mb-4"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{control:t.control,name:"incidentType",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Incident Type"}),e.jsxs(F,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(v,{children:e.jsx(M,{children:e.jsx(O,{placeholder:"Select incident type"})})}),e.jsxs(U,{children:[e.jsx(o,{value:"Injury",children:"Injury"}),e.jsx(o,{value:"Property",children:"Property"}),e.jsx(o,{value:"Theft",children:"Theft"}),e.jsx(o,{value:"Other",children:"Other"})]})]}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"clientStaffThirdParty",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"People Involved (client/staff/third party)"}),e.jsx(v,{children:e.jsx(S,{placeholder:"Enter details of people involved",...s})}),e.jsx(N,{})]})})]}),e.jsx(p,{control:t.control,name:"jobLocation",render:({field:s})=>e.jsxs(g,{className:"mt-4",children:[e.jsx(f,{children:"Location"}),e.jsx(v,{children:e.jsx(S,{placeholder:"Enter job location",...s})}),e.jsx(N,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(p,{control:t.control,name:"date",render:({field:s})=>e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{children:"Date"})]}),e.jsx(v,{children:e.jsx(S,{type:"date",...s,value:a})}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"time",render:({field:s})=>e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"Time"})]}),e.jsx(v,{children:e.jsx(S,{type:"time",...s,value:r})}),e.jsx(N,{})]})})]}),e.jsx(p,{control:t.control,name:"actionsTaken",render:({field:s})=>e.jsxs(g,{className:"mt-4",children:[e.jsx(f,{children:"Actions Taken"}),e.jsx(v,{children:e.jsx($,{placeholder:"Describe actions taken...",className:"min-h-[80px]",...s})}),e.jsx(N,{})]})})]})}),Xs=Ns({title:k().min(2,{message:"Title must be at least 2 characters."}),description:k().min(10,{message:"Description must be at least 10 characters."}),severity:Ce(["low","medium","high"]),status:Ce(["open","closed"]).optional(),date:k().optional(),time:k().optional(),locationAddress:k().optional(),peopleInvolved:ys(k()).optional(),vehicleInfo:k().optional(),weatherConditions:k().optional(),reportedBy:k().optional(),contactInfo:k().optional(),emergencyServices:de().optional(),policeReportNumber:k().optional(),insuranceClaim:de().optional(),estimatedDamages:k().optional(),followUpRequired:de().optional(),incidentType:k().optional(),vehicleRoute:k().optional(),injuriesDamage:k().optional(),actionsTaken:k().optional(),personName:k().optional(),classRole:k().optional(),schoolLocation:k().optional(),personInvolved:k().optional(),venueLocation:k().optional(),flightVehicle:k().optional(),airportLocation:k().optional(),clientStaffThirdParty:k().optional(),jobLocation:k().optional()}),Qs=({incidentType:t,onSubmit:a,onCancel:r})=>{const{toast:s}=De(),[i,l]=w.useState(!1),[d,h]=w.useState(null),[m,b]=w.useState(!1),[x,u]=w.useState([]),[j,C]=w.useState([""]),[c,_]=w.useState([""]),L=Ss({resolver:bs(Xs),defaultValues:{title:"",description:"",severity:"low",status:"open",date:new Date().toISOString().split("T")[0],time:new Date().toTimeString().slice(0,5),locationAddress:"",peopleInvolved:[],vehicleInfo:"",weatherConditions:"",reportedBy:"",contactInfo:"",emergencyServices:!1,policeReportNumber:"",insuranceClaim:!1,estimatedDamages:"",followUpRequired:!1}}),T=L.watch("date")||"",A=L.watch("time")||"",G=async y=>{l(!0);try{const V={type:t,title:y.title,description:y.description,severity:y.severity,status:y.status||"open",date:y.date?new Date(y.date):void 0,time:y.time,location:d?{lat:d.lat,lng:d.lng,address:y.locationAddress||""}:void 0,peopleInvolved:j.filter(Q=>Q.trim()!==""),witnesses:c.filter(Q=>Q.trim()!==""),vehicleInfo:y.vehicleInfo,weatherConditions:y.weatherConditions,reportedBy:y.reportedBy,contactInfo:y.contactInfo,emergencyServices:y.emergencyServices||!1,policeReportNumber:y.policeReportNumber,insuranceClaim:y.insuranceClaim||!1,estimatedDamages:y.estimatedDamages,followUpRequired:y.followUpRequired||!1,attachments:x,...y};await a(V),s({title:"Incident Reported",description:"Your incident report has been submitted successfully."})}catch(V){console.error("Error submitting incident:",V),s({title:"Error",description:"Failed to submit incident report. Please try again.",variant:"destructive"})}finally{l(!1)}},B=()=>{switch(t){case"transportation":return e.jsx(Js,{form:L,selectedDate:T,selectedTime:A});case"school":return e.jsx(Ws,{form:L,selectedDate:T,selectedTime:A});case"wedding":return e.jsx(Hs,{form:L,selectedDate:T,selectedTime:A});case"airport":return e.jsx(Ys,{form:L,selectedDate:T,selectedTime:A});case"privateJob":return e.jsx(Zs,{form:L,selectedDate:T,selectedTime:A});default:return null}};return e.jsxs(D,{className:"w-full max-w-4xl mx-auto",children:[e.jsxs(z,{children:[e.jsxs(K,{children:["Report ",t.charAt(0).toUpperCase()+t.slice(1)," Incident"]}),e.jsx(rs,{children:"Please provide detailed information about the incident"})]}),e.jsxs(E,{children:[e.jsx(ws,{...L,children:e.jsxs("form",{onSubmit:L.handleSubmit(G),className:"space-y-6",children:[e.jsx(As,{form:L}),B(),e.jsx(Ps,{selectedLocation:d,onLocationPickerOpen:()=>b(!0)}),e.jsx(Rs,{peopleInvolved:j,setPeopleInvolved:C,witnesses:c,setWitnesses:_}),e.jsx(Fs,{attachments:x,setAttachments:u}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-6",children:[e.jsx(I,{type:"button",variant:"outline",onClick:r,disabled:i,children:"Cancel"}),e.jsx(I,{type:"submit",disabled:i,children:i?"Submitting...":"Submit Report"})]})]})}),m&&e.jsx(qs,{open:m,onOpenChange:b,onLocationSelect:y=>{h(y),b(!1)}})]})]})};function et(){const{data:t=[],isLoading:a,error:r}=Ae(),[s,i]=w.useState(""),[l,d]=w.useState("all"),[h,m]=w.useState("incidents"),b=t.filter(c=>{var T;const _=c.title.toLowerCase().includes(s.toLowerCase())||c.description.toLowerCase().includes(s.toLowerCase())||((T=c.location_address)==null?void 0:T.toLowerCase().includes(s.toLowerCase())),L=l==="all"||c.status===l;return _&&L}),x=c=>{switch(c){case"open":return e.jsx(ee,{className:"w-3 h-3"});case"investigating":return e.jsx(Z,{className:"w-3 h-3"});case"resolved":return e.jsx(Te,{className:"w-3 h-3"});case"closed":return e.jsx(Ee,{className:"w-3 h-3"});default:return e.jsx(se,{className:"w-3 h-3"})}},u=c=>{switch(c){case"open":return"destructive";case"investigating":return"default";case"resolved":return"default";case"closed":return"secondary";default:return"secondary"}},j=c=>{switch(c){case"critical":return"destructive";case"high":return"destructive";case"medium":return"default";case"low":return"secondary";default:return"secondary"}},C={totalIncidents:t.length,pendingIncidents:t.filter(c=>c.status==="open"||c.status==="investigating").length,resolvedIncidents:t.filter(c=>c.status==="resolved").length,thisMonthIncidents:t.filter(c=>{const _=new Date(c.incident_date||c.created_at);return _.getMonth()===new Date().getMonth()&&_.getFullYear()===new Date().getFullYear()}).length};return a?e.jsx(ie,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading incident reports..."})]})})}):r?e.jsx(ie,{children:e.jsx("div",{className:"space-y-4 p-4",children:e.jsx(D,{className:"border-red-200 bg-red-50",children:e.jsx(E,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ee,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-red-900 mb-2",children:"Error Loading Reports"}),e.jsx("p",{className:"text-red-700",children:r.message})]})})})})}):e.jsx(ie,{children:e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"My Incident Reports"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Track and manage your incident reports"})]}),e.jsxs(I,{size:"sm",className:"ml-4 flex-shrink-0",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"New Report"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsx(D,{children:e.jsx(E,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:C.totalIncidents}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Incidents"})]})})}),e.jsx(D,{children:e.jsx(E,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:C.pendingIncidents}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending"})]})})}),e.jsx(D,{children:e.jsx(E,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:C.resolvedIncidents}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Resolved"})]})})}),e.jsx(D,{children:e.jsx(E,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:C.thisMonthIncidents}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This Month"})]})})})]}),e.jsxs(ns,{value:h,onValueChange:m,className:"w-full mobile-tabs",children:[e.jsxs(ls,{className:"grid w-full grid-cols-3 mb-6 gap-1",children:[e.jsx(ce,{value:"incidents",className:"text-xs sm:text-sm px-1 sm:px-3 py-2",children:"My Incidents"}),e.jsx(ce,{value:"emergency",className:"text-xs sm:text-sm px-1 sm:px-3 py-2",children:"Emergency Contact"}),e.jsx(ce,{value:"guidelines",className:"text-xs sm:text-sm px-1 sm:px-3 py-2",children:"Safety Guidelines"})]}),e.jsxs(oe,{value:"incidents",className:"space-y-4",children:[e.jsx(D,{className:"mb-6",children:e.jsx(E,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(is,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(S,{placeholder:"Search incidents",value:s,onChange:c=>i(c.target.value),className:"pl-10"})]}),e.jsxs(F,{value:l,onValueChange:d,children:[e.jsxs(M,{children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),e.jsx(O,{placeholder:"Filter by status"})]}),e.jsxs(U,{children:[e.jsx(o,{value:"all",children:"All Status"}),e.jsx(o,{value:"open",children:"Open"}),e.jsx(o,{value:"investigating",children:"Investigating"}),e.jsx(o,{value:"resolved",children:"Resolved"}),e.jsx(o,{value:"closed",children:"Closed"})]})]})]})})}),b.length===0?e.jsx(D,{children:e.jsx(E,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(se,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"No incidents found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:s||l!=="all"?"No incidents match your search criteria":"You haven't reported any incidents yet"}),e.jsxs(I,{children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Report New Incident"]})]})})}):e.jsxs("div",{className:"space-y-4",children:[b.map(c=>e.jsx(D,{className:"hover:shadow-md transition-shadow",children:e.jsx(E,{className:"pt-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"flex-1 pr-6 min-w-0",children:e.jsx("h3",{className:"text-lg font-semibold text-foreground leading-tight break-words",children:c.title})}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs(q,{variant:u(c.status),children:[x(c.status),e.jsx("span",{className:"ml-1 capitalize",children:c.status})]}),c.severity&&e.jsx(q,{variant:j(c.severity),children:c.severity})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-3 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:[c.incident_date?xe(ke(c.incident_date),"yyyy-MM-dd"):"Not specified"," at ",c.incident_time||"00:00"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"max-w-[120px] truncate",children:c.location_address||"Location not specified"})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed break-words max-h-[80px] overflow-hidden",children:c.description})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:"Vehicle:"}),e.jsx("span",{children:c.vehicle_id||"Not specified"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:"Damage:"}),e.jsx("span",{children:"Reported"}),e.jsx(Le,{className:"w-3 h-3 text-muted-foreground"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["ID: ",c.id]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Updated: ",xe(ke(c.updated_at),"MMM dd, yyyy")]})]}),e.jsx(I,{size:"sm",variant:"outline",children:"View Details"})]})]})]})})},c.id)),e.jsx(D,{children:e.jsx(E,{className:"pt-6",children:e.jsx("div",{className:"text-center",children:e.jsxs(I,{variant:"outline",className:"w-full",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"View All Reports"]})})})})]})]}),e.jsx(oe,{value:"emergency",className:"space-y-4",children:e.jsxs(D,{children:[e.jsx(z,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(os,{className:"w-5 h-5 text-red-600"}),"Emergency Contacts"]})}),e.jsx(E,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Emergency Services"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Police, Fire, Ambulance"})]}),e.jsxs(I,{size:"sm",variant:"destructive",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"999"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Control Room"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"24/7 Support"})]}),e.jsxs(I,{size:"sm",variant:"outline",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Call"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Manager"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Direct Line"})]}),e.jsxs(I,{size:"sm",variant:"outline",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Call"]})]})]})})]})}),e.jsx(oe,{value:"guidelines",className:"space-y-4",children:e.jsxs(D,{children:[e.jsx(z,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"w-5 h-5 text-blue-600"}),"Safety Guidelines"]})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-yellow-50 rounded-lg border-l-4 border-yellow-400",children:[e.jsx("h4",{className:"font-medium text-yellow-800 mb-2",children:"Pre-Trip Safety"}),e.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsx("li",{children:"• Complete vehicle inspection before departure"}),e.jsx("li",{children:"• Check all safety equipment"}),e.jsx("li",{children:"• Verify passenger count and seating"})]})]}),e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border-l-4 border-blue-400",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"During Journey"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• Maintain safe driving speed"}),e.jsx("li",{children:"• Regular breaks every 4.5 hours"}),e.jsx("li",{children:"• Monitor passenger safety"})]})]}),e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border-l-4 border-green-400",children:[e.jsx("h4",{className:"font-medium text-green-800 mb-2",children:"Emergency Procedures"}),e.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[e.jsx("li",{children:"• Stop safely if incident occurs"}),e.jsx("li",{children:"• Contact emergency services if needed"}),e.jsx("li",{children:"• Report incident within 24 hours"})]})]})]}),e.jsxs(I,{className:"w-full mt-4",children:[e.jsx(ks,{className:"w-4 h-4 mr-2"}),"View Full Safety Manual"]})]})]})})]})]})})}const ot=()=>{const{user:t,profile:a,loading:r}=hs(),s=xs(),{toast:i}=De(),[l,d]=w.useState(!1),[h,m]=w.useState(null),[b,x]=w.useState(""),[u,j]=w.useState("all"),[C,c]=w.useState("all"),[_,L]=w.useState(null),[T,A]=w.useState(!1),[G,B]=w.useState(""),[y,V]=w.useState(""),{data:Q=[],isLoading:Re,error:ve,refetch:Ne}=Ae(),Fe=Is(),Me=Cs(),Oe=[{id:"parent-1",source:"parent",title:"Child pickup delay",description:"My child was not picked up at the scheduled time",severity:"medium",status:"open",reported_by:"parent-1",reported_by_name:"Sarah Johnson",child_name:"Emma Johnson",incident_date:new Date().toISOString(),contact_info:{phone:"+1234567890",email:"sarah.johnson@email.com"},created_at:new Date().toISOString()},{id:"parent-2",source:"parent",title:"Safety concern on route",description:"Concerned about the route safety near the construction zone",severity:"high",status:"investigating",reported_by:"parent-2",reported_by_name:"Michael Chen",child_name:"Alex Chen",incident_date:new Date().toISOString(),contact_info:{phone:"+1234567891",email:"michael.chen@email.com"},created_at:new Date().toISOString()}],Ue=[...Q.map(n=>({...n,source:"driver"})),...Oe];if(r||Re)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading incident reports..."})]})});if(!t||!a)return e.jsx(we,{to:"/auth",replace:!0});if(!["driver","admin","council","mechanic"].includes(a.role))return e.jsx(we,{to:"/dashboard",replace:!0});if(s&&a.role==="driver")return e.jsx(et,{});const Ve=n=>{m(n)},Ge=async n=>{try{await Fe.mutateAsync({...n,incident_type:h,reported_by:t.id}),m(null)}catch(le){console.error("Error creating incident:",le)}},Be=()=>{m(null)},ze=async()=>{if(!(!_||!y))try{_.source==="driver"?await Me.mutateAsync({id:_.id,status:y}):i({title:"Parent incident updated",description:"Parent incident status has been updated."}),A(!1),L(null),B(""),V(""),Ne()}catch(n){console.error("Error resolving incident:",n),i({title:"Error",description:"Failed to resolve incident. Please try again.",variant:"destructive"})}},Ke=n=>{switch(n){case"open":return e.jsx(ee,{className:"w-4 h-4"});case"investigating":return e.jsx(Z,{className:"w-4 h-4"});case"resolved":return e.jsx(Te,{className:"w-4 h-4"});case"closed":return e.jsx(Ee,{className:"w-4 h-4"});default:return e.jsx(se,{className:"w-4 h-4"})}},$e=n=>{switch(n){case"open":return"destructive";case"investigating":return"default";case"resolved":return"default";case"closed":return"secondary";default:return"secondary"}},qe=n=>{switch(n){case"driver":return e.jsx(Ie,{className:"w-4 h-4"});case"parent":return e.jsx(Se,{className:"w-4 h-4"});default:return e.jsx(se,{className:"w-4 h-4"})}},ye=n=>{switch(n){case"driver":return"blue";case"parent":return"green";default:return"gray"}},ae=Ue.filter(n=>{const le=n.title.toLowerCase().includes(b.toLowerCase())||n.description.toLowerCase().includes(b.toLowerCase()),Je=u==="all"||n.status===u,We=C==="all"||n.source===C;return le&&Je&&We});return h?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsx(Qs,{incidentType:h,onSubmit:Ge,onCancel:Be})})}):ve?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsxs(ms,{variant:"destructive",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsxs(us,{children:["Error loading incidents: ",ve.message]})]})})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"container mx-auto px-6 py-8 space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Incident Reports"}),e.jsx("p",{className:"text-gray-600",children:a.role==="admin"||a.role==="council"?"Manage and resolve all incident reports from drivers and parents":"Manage and track incident reports"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(I,{onClick:()=>Ne(),variant:"outline",size:"sm",children:[e.jsx(js,{className:"w-4 h-4 mr-2"}),"Refresh"]}),e.jsxs(I,{onClick:()=>d(!0),children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"New Incident Report"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{htmlFor:"search",className:"text-sm font-medium",children:"Search"}),e.jsx(S,{id:"search",placeholder:"Search incidents...",value:b,onChange:n=>x(n.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(R,{htmlFor:"status-filter",className:"text-sm font-medium",children:"Status"}),e.jsxs(F,{value:u,onValueChange:j,children:[e.jsx(M,{className:"mt-1",children:e.jsx(O,{placeholder:"All statuses"})}),e.jsxs(U,{children:[e.jsx(o,{value:"all",children:"All Statuses"}),e.jsx(o,{value:"open",children:"Open"}),e.jsx(o,{value:"investigating",children:"Investigating"}),e.jsx(o,{value:"resolved",children:"Resolved"}),e.jsx(o,{value:"closed",children:"Closed"})]})]})]}),(a.role==="admin"||a.role==="council")&&e.jsxs("div",{children:[e.jsx(R,{htmlFor:"source-filter",className:"text-sm font-medium",children:"Source"}),e.jsxs(F,{value:C,onValueChange:c,children:[e.jsx(M,{className:"mt-1",children:e.jsx(O,{placeholder:"All sources"})}),e.jsxs(U,{children:[e.jsx(o,{value:"all",children:"All Sources"}),e.jsx(o,{value:"driver",children:"Driver Reports"}),e.jsx(o,{value:"parent",children:"Parent Reports"})]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(q,{variant:"outline",className:"text-sm",children:[ae.length," incident",ae.length!==1?"s":""]})})]}),ae.length===0?e.jsx(D,{children:e.jsxs(E,{className:"text-center py-12",children:[e.jsx(ee,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"No incidents found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:b||u!=="all"||C!=="all"?"Try adjusting your filters to see more results.":"Get started by creating your first incident report."}),e.jsxs(I,{onClick:()=>d(!0),children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Create Incident Report"]})]})}):e.jsx("div",{className:"space-y-4",children:ae.map(n=>e.jsxs(D,{className:"hover:shadow-md transition-shadow",children:[e.jsx(z,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(K,{className:"text-lg",children:n.title}),e.jsxs(q,{variant:"outline",className:`text-${ye(n.source)}-600 border-${ye(n.source)}-200`,children:[qe(n.source),e.jsx("span",{className:"ml-1 capitalize",children:n.source})]}),"incident_type"in n&&n.incident_type&&e.jsx(q,{variant:"outline",children:Pe(n.incident_type)})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:n.description}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(Y,{className:"w-3 h-3 mr-1"}),xe(new Date(n.created_at),"MMM dd, yyyy")]}),n.source==="parent"&&"child_name"in n&&n.child_name&&e.jsxs("span",{className:"flex items-center",children:[e.jsx(Se,{className:"w-3 h-3 mr-1"}),n.child_name]}),n.source==="driver"&&"vehicles"in n&&n.vehicles&&e.jsxs("span",{className:"flex items-center",children:[e.jsx(Ie,{className:"w-3 h-3 mr-1"}),n.vehicles.vehicle_number]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(q,{variant:$e(n.status),className:"flex items-center space-x-1",children:[Ke(n.status),e.jsx("span",{className:"capitalize",children:n.status.replace("_"," ")})]}),(a.role==="admin"||a.role==="council")&&n.status!=="resolved"&&n.status!=="closed"&&e.jsx(I,{size:"sm",variant:"outline",onClick:()=>{L(n),V(n.status),A(!0)},children:e.jsx(ps,{className:"w-4 h-4"})})]})]})}),e.jsx(E,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-600",children:"Severity"}),e.jsx(q,{variant:n.severity==="high"||n.severity==="critical"?"destructive":"secondary",children:n.severity})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-600",children:"Reported By"}),e.jsx("p",{children:n.source==="driver"?n.profiles?`${n.profiles.first_name} ${n.profiles.last_name}`:"Unknown":n.reported_by_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-600",children:"Contact"}),n.source==="parent"&&n.contact_info?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"flex items-center text-xs",children:[e.jsx(re,{className:"w-3 h-3 mr-1"}),n.contact_info.phone]}),e.jsxs("p",{className:"flex items-center text-xs",children:[e.jsx(gs,{className:"w-3 h-3 mr-1"}),n.contact_info.email]})]}):e.jsx("p",{className:"text-xs text-gray-500",children:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-600",children:"Location"}),e.jsx("p",{className:"text-xs",children:n.location_address||n.location||"Not specified"})]})]})})]},n.id))})]}),e.jsx(Ts,{open:l,onOpenChange:d,onSelect:Ve}),e.jsx(je,{open:T,onOpenChange:A,children:e.jsxs(pe,{className:"max-w-md",children:[e.jsxs(ge,{children:[e.jsx(fe,{children:"Resolve Incident"}),e.jsx(fs,{children:"Update the status and add resolution notes for this incident."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{htmlFor:"status",children:"Status"}),e.jsxs(F,{value:y,onValueChange:V,children:[e.jsx(M,{children:e.jsx(O,{placeholder:"Select status"})}),e.jsxs(U,{children:[e.jsx(o,{value:"open",children:"Open"}),e.jsx(o,{value:"investigating",children:"Investigating"}),e.jsx(o,{value:"resolved",children:"Resolved"}),e.jsx(o,{value:"closed",children:"Closed"})]})]})]}),e.jsxs("div",{children:[e.jsx(R,{htmlFor:"resolution-notes",children:"Resolution Notes"}),e.jsx($,{id:"resolution-notes",placeholder:"Add notes about how this incident was resolved...",value:G,onChange:n=>B(n.target.value),rows:4})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(I,{variant:"outline",onClick:()=>A(!1),className:"flex-1",children:"Cancel"}),e.jsxs(I,{onClick:ze,className:"flex-1",disabled:!y,children:[e.jsx(_s,{className:"w-4 h-4 mr-2"}),"Update Status"]})]})]})]})})]})};export{ot as default};
