import{m as Z,a1 as ee,r as i,c4 as se,c5 as ae,c6 as re,c7 as te,c8 as le,c9 as ie,j as e,aP as P,n as x,B as u,am as ne,I as M,ab as p,ac as g,ad as y,ae as j,af as r,O as ce,Q as de,V as L,Y as k,e as D,k as E,ax as I,t as F,a4 as oe,a5 as me,a6 as he,a7 as xe,a8 as ue,q as m,s as pe,d as ge,ar as ye,E as V,C as je}from"./main-DVuL102c.js";const fe=()=>{const{user:H,profile:n}=Z(),{toast:q}=ee(),[B,h]=i.useState(!1),[Y,$]=i.useState("received"),[c,z]=i.useState(""),[d,O]=i.useState("all"),[o,U]=i.useState("all"),[a,l]=i.useState({recipientType:"specific",recipientId:"",recipientRole:"",title:"",body:"",type:"info",priority:"normal",category:"general",channels:["in_app"],scheduledFor:"",isScheduled:!1}),{data:f=[],isLoading:Ne}=se(),{data:w=[],isLoading:ve}=ae(),N=re(),Q=te(),{data:C=0}=le();ie();const G=()=>{if(!(n!=null&&n.organization_id))return[];switch(n.role){case"admin":case"council":return[{id:"all_drivers",name:"All Drivers",role:"driver"},{id:"all_mechanics",name:"All Mechanics",role:"mechanic"},{id:"all_parents",name:"All Parents",role:"parent"},{id:"all_admins",name:"All Administrators",role:"admin"}];case"driver":return[{id:"all_admins",name:"All Administrators",role:"admin"},{id:"all_mechanics",name:"All Mechanics",role:"mechanic"},{id:"all_parents",name:"All Parents",role:"parent"}];case"parent":return[{id:"all_drivers",name:"All Drivers",role:"driver"},{id:"all_admins",name:"All Administrators",role:"admin"}];case"mechanic":return[{id:"all_admins",name:"All Administrators",role:"admin"},{id:"all_drivers",name:"All Drivers",role:"driver"}];default:return[]}},W=[{id:"safety_alert",name:"Safety Alert",title:"Safety Alert - Immediate Action Required",body:"Please review and acknowledge this safety alert. Your immediate attention is required.",type:"warning",priority:"high",category:"safety"},{id:"schedule_change",name:"Schedule Change",title:"Schedule Update",body:"There has been a change to your schedule. Please review the updated details.",type:"info",priority:"normal",category:"schedule"},{id:"maintenance_reminder",name:"Maintenance Reminder",title:"Vehicle Maintenance Due",body:"Your vehicle is due for maintenance. Please schedule an appointment.",type:"warning",priority:"normal",category:"maintenance"},{id:"emergency_notice",name:"Emergency Notice",title:"EMERGENCY - Immediate Response Required",body:"This is an emergency notification requiring immediate attention.",type:"error",priority:"emergency",category:"emergency"}],J=()=>{l({recipientType:"specific",recipientId:"",recipientRole:"",title:"",body:"",type:"info",priority:"normal",category:"general",channels:["in_app"],scheduledFor:"",isScheduled:!1})},K=s=>{l(t=>({...t,title:s.title,body:s.body,type:s.type,priority:s.priority,category:s.category}))},X=async()=>{if(!a.title.trim()||!a.body.trim()){q({title:"Validation Error",description:"Please fill in all required fields.",variant:"destructive"});return}const s={recipientType:a.recipientType,recipientId:a.recipientId,recipientRole:a.recipientRole,title:a.title,body:a.body,type:a.type,priority:a.priority,category:a.category,channels:a.channels,scheduledFor:a.scheduledFor,isScheduled:a.isScheduled};await N.mutateAsync(s),h(!1),J()},S=s=>{switch(s){case"success":return e.jsx(je,{className:"w-4 h-4 text-green-600"});case"warning":return e.jsx(V,{className:"w-4 h-4 text-yellow-600"});case"error":return e.jsx(V,{className:"w-4 h-4 text-red-600"});default:return e.jsx(ye,{className:"w-4 h-4 text-blue-600"})}},T=s=>{switch(s){case"emergency":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"normal":return"bg-blue-100 text-blue-800";case"low":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},A=s=>{switch(s){case"emergency":return"bg-red-50 border-red-200";case"safety":return"bg-yellow-50 border-yellow-200";case"maintenance":return"bg-orange-50 border-orange-200";case"schedule":return"bg-blue-50 border-blue-200";default:return"bg-gray-50 border-gray-200"}},_=f.filter(s=>{const t=s.title.toLowerCase().includes(c.toLowerCase())||s.body.toLowerCase().includes(c.toLowerCase()),v=d==="all"||s.type===d,b=o==="all"||s.priority===o;return t&&v&&b}),R=w.filter(s=>{const t=s.title.toLowerCase().includes(c.toLowerCase())||s.body.toLowerCase().includes(c.toLowerCase()),v=d==="all"||s.type===d,b=o==="all"||s.priority===o;return t&&v&&b});return!H||!n?null:e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-background border-b",children:e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(P,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-xl font-semibold",children:"Notifications"}),C>0&&e.jsxs(x,{variant:"destructive",className:"text-xs",children:[C," new"]})]}),e.jsxs(u,{size:"sm",onClick:()=>h(!0),className:"h-9 px-3",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"New"]})]})}),e.jsxs("div",{className:"p-4 space-y-3 border-b bg-muted/30",children:[e.jsx(M,{placeholder:"Search notifications...",value:c,onChange:s=>z(s.target.value),className:"h-10"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(p,{value:d,onValueChange:O,children:[e.jsx(g,{className:"h-9 text-sm",children:e.jsx(y,{placeholder:"Type"})}),e.jsxs(j,{children:[e.jsx(r,{value:"all",children:"All Types"}),e.jsx(r,{value:"info",children:"Info"}),e.jsx(r,{value:"warning",children:"Warning"}),e.jsx(r,{value:"success",children:"Success"}),e.jsx(r,{value:"error",children:"Error"})]})]}),e.jsxs(p,{value:o,onValueChange:U,children:[e.jsx(g,{className:"h-9 text-sm",children:e.jsx(y,{placeholder:"Priority"})}),e.jsxs(j,{children:[e.jsx(r,{value:"all",children:"All Priority"}),e.jsx(r,{value:"low",children:"Low"}),e.jsx(r,{value:"normal",children:"Normal"}),e.jsx(r,{value:"high",children:"High"}),e.jsx(r,{value:"emergency",children:"Emergency"})]})]})]})]}),e.jsxs(ce,{value:Y,onValueChange:$,className:"flex-1",children:[e.jsxs(de,{className:"grid w-full grid-cols-2 rounded-none",children:[e.jsxs(L,{value:"received",className:"rounded-none",children:["Received (",w.length,")"]}),e.jsxs(L,{value:"sent",className:"rounded-none",children:["Sent (",f.length,")"]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx(k,{value:"received",className:"m-0 space-y-3",children:R.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(P,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No notifications"}),e.jsx("p",{className:"text-sm",children:"You're all caught up!"})]}):R.map(s=>e.jsx(D,{className:`${A(s.category)} ${s.read_at?"":"ring-2 ring-blue-200"} cursor-pointer`,onClick:()=>{s.read_at||Q.mutate(s.id)},children:e.jsx(E,{className:"p-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[S(s.type),e.jsx("h4",{className:"font-medium text-base",children:s.title}),e.jsx(x,{className:`${T(s.priority)} text-xs`,children:s.priority}),!s.read_at&&e.jsx(x,{variant:"secondary",className:"bg-blue-100 text-blue-800 text-xs",children:"New"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.body}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:["From: ",s.sender_name]}),e.jsx("span",{children:I(new Date(s.created_at),"MMM dd, HH:mm")})]})]})})})},s.id))}),e.jsx(k,{value:"sent",className:"m-0 space-y-3",children:_.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(F,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No sent notifications"}),e.jsx("p",{className:"text-sm",children:"Start sending messages to your team!"})]}):_.map(s=>e.jsx(D,{className:`${A(s.category)}`,children:e.jsx(E,{className:"p-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[S(s.type),e.jsx("h4",{className:"font-medium text-base",children:s.title}),e.jsx(x,{className:`${T(s.priority)} text-xs`,children:s.priority})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.body}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:["To: ",s.recipient_role||"Specific User"]}),e.jsx("span",{children:I(new Date(s.created_at),"MMM dd, HH:mm")})]})]})})})},s.id))})]})]}),e.jsx(oe,{open:B,onOpenChange:h,children:e.jsxs(me,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(he,{children:[e.jsx(xe,{children:"Send Message"}),e.jsx(ue,{children:"Send a notification to your team."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Quick Templates"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:W.map(s=>e.jsxs(u,{variant:"outline",size:"sm",className:"h-auto p-3 text-left",onClick:()=>K(s),children:[e.jsx("div",{className:"text-sm font-medium",children:s.name}),e.jsx("div",{className:"text-xs text-muted-foreground truncate",children:s.title})]},s.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Send to"}),e.jsxs(p,{value:a.recipientRole,onValueChange:s=>l(t=>({...t,recipientRole:s,recipientType:"role"})),children:[e.jsx(g,{children:e.jsx(y,{placeholder:"Select recipients"})}),e.jsx(j,{children:G().map(s=>e.jsx(r,{value:s.role,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Title"}),e.jsx(M,{value:a.title,onChange:s=>l(t=>({...t,title:s.target.value})),placeholder:"Enter message title..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Message"}),e.jsx(pe,{value:a.body,onChange:s=>l(t=>({...t,body:s.target.value})),placeholder:"Enter your message...",rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Priority"}),e.jsxs(p,{value:a.priority,onValueChange:s=>l(t=>({...t,priority:s})),children:[e.jsx(g,{children:e.jsx(y,{})}),e.jsxs(j,{children:[e.jsx(r,{value:"low",children:"Low"}),e.jsx(r,{value:"normal",children:"Normal"}),e.jsx(r,{value:"high",children:"High"}),e.jsx(r,{value:"emergency",children:"Emergency"})]})]})]}),e.jsxs("div",{className:"flex space-x-2 pt-4",children:[e.jsx(u,{variant:"outline",onClick:()=>h(!1),className:"flex-1",children:"Cancel"}),e.jsx(u,{onClick:X,disabled:N.isPending||!a.body.trim()||!a.recipientRole,className:"flex-1",children:N.isPending?e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Send"]})})]})]})]})})]})};export{fe as default};
