import{m as M,a1 as S,r as d,x as D,cj as T,ct as _,j as e,e as k,g as F,h as I,bp as u,i as P,a4 as A,as as E,B as l,t as g,a5 as z,a6 as B,a7 as H,a8 as L,q as j,ab as $,ac as O,ad as R,ae as V,af as t,s as q,aA as G,k as X,n as Y,ax as J,a0 as K,C as p}from"./main-DVuL102c.js";const U=()=>{M();const{toast:m}=S(),[r,x]=d.useState(""),[h,o]=d.useState("general"),[f,i]=d.useState(!1),a=D(),{data:n=[],isLoading:y,refetch:N}=T(),c=_(),b=async()=>{if(r.trim())try{await c.mutateAsync({message_type:h,message:r,priority:"normal"}),m({title:"Message sent successfully",description:"Your message has been sent to the driver."}),x(""),o("general"),i(!1),N()}catch{m({title:"Failed to send message",description:"There was an error sending your message. Please try again.",variant:"destructive"})}},v=s=>{switch(s){case"delay":return"bg-orange-100 text-orange-800";case"incident":return"bg-red-100 text-red-800";case"absence":return"bg-yellow-100 text-yellow-800";case"emergency":return"bg-red-100 text-red-800";default:return"bg-blue-100 text-blue-800"}},w=s=>{switch(s){case"delay":return"Delay";case"incident":return"Incident";case"absence":return"Absence";case"emergency":return"Emergency";case"pickup":return"Pickup Change";default:return"General"}},C=s=>{switch(s){case"read":return e.jsx(p,{className:"w-4 h-4 text-green-500"});case"delivered":return e.jsx(p,{className:"w-4 h-4 text-blue-500"});case"sent":return e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"});case"failed":return e.jsx(K,{className:"w-4 h-4 text-red-500"});default:return e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"})}};return e.jsxs(k,{children:[e.jsx(F,{className:a?"pb-3":"",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(I,{className:`flex items-center space-x-2 ${a?"text-lg":""}`,children:[e.jsx(u,{className:`${a?"w-4 h-4":"w-5 h-5"}`}),e.jsx("span",{children:"Communication Center"})]}),e.jsx(P,{className:a?"text-sm":"",children:"Messages with your child's driver"})]}),e.jsxs(A,{open:f,onOpenChange:i,children:[e.jsx(E,{asChild:!0,children:e.jsxs(l,{size:a?"sm":"default",className:a?"text-xs":"",children:[e.jsx(g,{className:`${a?"w-3 h-3 mr-1":"w-4 h-4 mr-2"}`}),a?"New":"New Message"]})}),e.jsxs(z,{className:a?"w-[95vw] max-w-none mx-2":"",children:[e.jsxs(B,{children:[e.jsx(H,{className:a?"text-lg":"",children:"Send Message to Driver"}),e.jsx(L,{className:a?"text-sm":"",children:"Communicate with your child's driver about transport matters"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"messageType",className:a?"text-sm":"",children:"Message Type"}),e.jsxs($,{value:h,onValueChange:o,children:[e.jsx(O,{className:a?"h-12":"",children:e.jsx(R,{})}),e.jsxs(V,{className:"bg-white",children:[e.jsx(t,{value:"general",children:"General Information"}),e.jsx(t,{value:"absence",children:"Student Absence"}),e.jsx(t,{value:"pickup",children:"Pickup Change"}),e.jsx(t,{value:"delay",children:"Delay Notification"}),e.jsx(t,{value:"incident",children:"Incident Report"}),e.jsx(t,{value:"emergency",children:"Emergency"})]})]})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"message",className:a?"text-sm":"",children:"Message"}),e.jsx(q,{id:"message",placeholder:"Enter your message here...",value:r,onChange:s=>x(s.target.value),className:a?"min-h-[100px]":"min-h-[120px]"})]})]}),e.jsxs(G,{children:[e.jsx(l,{variant:"outline",onClick:()=>i(!1),size:a?"sm":"default",children:"Cancel"}),e.jsx(l,{onClick:b,disabled:!r.trim()||c.isPending,size:a?"sm":"default",children:c.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{className:`${a?"w-3 h-3 mr-1":"w-4 h-4 mr-2"}`}),"Send Message"]})})]})]})]})]})}),e.jsx(X,{children:y?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})}):n.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(u,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No communications yet"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Start a conversation with your child's driver"})]}):e.jsxs("div",{className:"space-y-4",children:[n.slice(0,10).map(s=>e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Y,{className:v(s.message_type),children:w(s.message_type)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:J(new Date(s.sent_at),"MMM dd, yyyy HH:mm")})]}),s.subject&&e.jsx("h4",{className:"font-medium mb-1",children:s.subject}),e.jsx("p",{className:"text-sm text-gray-600",children:s.message}),s.child_profiles&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Re: ",s.child_profiles.first_name," ",s.child_profiles.last_name]}),s.profiles&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["From: ",s.profiles.first_name," ",s.profiles.last_name]})]}),e.jsx("div",{className:"flex items-center space-x-1 ml-4",children:C(s.status)})]})},s.id)),n.length>10&&e.jsx("div",{className:"text-center pt-4",children:e.jsxs(l,{variant:"outline",size:"sm",children:["View All Messages (",n.length,")"]})})]})})]})};export{U as default};
