import{m as z,H as te,J as P,G as T,a2 as D,a1 as ne,r as g,j as e,N as ie,a4 as O,as as re,B as j,am as le,a5 as B,a6 as M,a7 as H,a8 as U,q as i,I as c,ab as p,ac as f,ad as N,ae as C,af as l,s as Q,e as h,k as x,U as ce,C as de,d as oe,S as he,E as xe,g as ue,h as me,i as je,P as ge,M as ve,n as V,an as _e}from"./main-DVuL102c.js";import{T as ye,a as pe,b as K,c as v,d as fe,e as _}from"./table-Jjtal2IW.js";import{A as Ne}from"./award-D5hdS4i_.js";import{T as Ce}from"./trash-2-uDLx8yM9.js";const be=()=>{const{profile:t}=z();return te({queryKey:["personal-assistants",t==null?void 0:t.organization_id],queryFn:async()=>{if(!(t!=null&&t.organization_id))throw new Error("Organization ID is required");const{data:r,error:d}=await P.from("personal_assistants").select("*").eq("organization_id",t.organization_id).order("last_name",{ascending:!0});if(d)throw d;return r||[]},enabled:!!(t!=null&&t.organization_id)})},ke=()=>{const t=T(),{profile:r}=z();return D({mutationFn:async d=>{if(!(r!=null&&r.organization_id))throw new Error("Organization ID is required");const{data:u,error:m}=await P.from("personal_assistants").insert({...d,organization_id:r.organization_id}).select().single();if(m)throw m;return u},onSuccess:()=>{t.invalidateQueries({queryKey:["personal-assistants"]})}})},Ae=()=>{const t=T();return D({mutationFn:async({id:r,...d})=>{const{data:u,error:m}=await P.from("personal_assistants").update(d).eq("id",r).select().single();if(m)throw m;return u},onSuccess:r=>{t.invalidateQueries({queryKey:["personal-assistants"]}),t.invalidateQueries({queryKey:["personal-assistant",r.id]})}})},Pe=()=>{const t=T();return D({mutationFn:async r=>{const{error:d}=await P.from("personal_assistants").delete().eq("id",r);if(d)throw d},onSuccess:()=>{t.invalidateQueries({queryKey:["personal-assistants"]})}})},ze=()=>{const{profile:t}=z(),{toast:r}=ne(),[d,u]=g.useState(!1),[m,b]=g.useState(!1),[E,L]=g.useState(null),[k,R]=g.useState(""),[w,Y]=g.useState("all"),[a,n]=g.useState({first_name:"",last_name:"",email:"",phone:"",date_of_birth:"",address:"",emergency_contact_name:"",emergency_contact_phone:"",emergency_contact_relationship:"",qualifications:[],certifications:[],experience_years:0,specializations:[],hourly_rate:0,status:"active",background_check_status:"pending",notes:""}),{data:o=[],isLoading:G}=be(),F=ke(),S=Ae(),J=Pe();if(!["admin","council"].includes((t==null?void 0:t.role)||""))return e.jsx(ie,{to:"/dashboard",replace:!0});const I=o.filter(s=>{const A=s.first_name.toLowerCase().includes(k.toLowerCase())||s.last_name.toLowerCase().includes(k.toLowerCase())||s.email.toLowerCase().includes(k.toLowerCase()),ae=w==="all"||s.status===w;return A&&ae}),y={total:o.length,active:o.filter(s=>s.status==="active").length,inactive:o.filter(s=>s.status==="inactive").length,onLeave:o.filter(s=>s.status==="on_leave").length,backgroundCheckPassed:o.filter(s=>s.background_check_status==="passed").length,backgroundCheckPending:o.filter(s=>s.background_check_status==="pending").length},W=async()=>{try{await F.mutateAsync({...a,organization_id:t==null?void 0:t.organization_id}),r({title:"Success",description:"Personal Assistant created successfully"}),u(!1),q()}catch{r({title:"Error",description:"Failed to create Personal Assistant",variant:"destructive"})}},X=async()=>{if(E)try{await S.mutateAsync({id:E.id,...a}),r({title:"Success",description:"Personal Assistant updated successfully"}),b(!1),L(null),q()}catch{r({title:"Error",description:"Failed to update Personal Assistant",variant:"destructive"})}},Z=async s=>{if(confirm("Are you sure you want to delete this Personal Assistant?"))try{await J.mutateAsync(s),r({title:"Success",description:"Personal Assistant deleted successfully"})}catch{r({title:"Error",description:"Failed to delete Personal Assistant",variant:"destructive"})}},$=s=>{L(s),n({first_name:s.first_name,last_name:s.last_name,email:s.email,phone:s.phone||"",date_of_birth:s.date_of_birth||"",address:s.address||"",emergency_contact_name:s.emergency_contact_name||"",emergency_contact_phone:s.emergency_contact_phone||"",emergency_contact_relationship:s.emergency_contact_relationship||"",qualifications:s.qualifications||[],certifications:s.certifications||[],experience_years:s.experience_years,specializations:s.specializations||[],hourly_rate:s.hourly_rate||0,status:s.status,background_check_status:s.background_check_status,notes:s.notes||""}),b(!0)},q=()=>{n({first_name:"",last_name:"",email:"",phone:"",date_of_birth:"",address:"",emergency_contact_name:"",emergency_contact_phone:"",emergency_contact_relationship:"",qualifications:[],certifications:[],experience_years:0,specializations:[],hourly_rate:0,status:"active",background_check_status:"pending",notes:""})},ee=s=>{switch(s){case"active":return"bg-green-100 text-green-800";case"inactive":return"bg-gray-100 text-gray-800";case"on_leave":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},se=s=>{switch(s){case"passed":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return G?e.jsx("div",{className:"container mx-auto p-6",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-lg",children:"Loading Personal Assistants..."})})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Personal Assistants"}),e.jsx("p",{className:"text-gray-600",children:"Manage Personal Assistants for school routes"})]}),e.jsxs(O,{open:d,onOpenChange:u,children:[e.jsx(re,{asChild:!0,children:e.jsxs(j,{onClick:()=>q(),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Add Personal Assistant"]})}),e.jsxs(B,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(M,{children:[e.jsx(H,{children:"Add Personal Assistant"}),e.jsx(U,{children:"Add a new Personal Assistant to your organization"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"first_name",children:"First Name *"}),e.jsx(c,{id:"first_name",value:a.first_name,onChange:s=>n({...a,first_name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"last_name",children:"Last Name *"}),e.jsx(c,{id:"last_name",value:a.last_name,onChange:s=>n({...a,last_name:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"email",children:"Email *"}),e.jsx(c,{id:"email",type:"email",value:a.email,onChange:s=>n({...a,email:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"phone",children:"Phone"}),e.jsx(c,{id:"phone",value:a.phone,onChange:s=>n({...a,phone:s.target.value})})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"address",children:"Address"}),e.jsx(c,{id:"address",value:a.address,onChange:s=>n({...a,address:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"experience_years",children:"Years of Experience"}),e.jsx(c,{id:"experience_years",type:"number",value:a.experience_years,onChange:s=>n({...a,experience_years:parseInt(s.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"hourly_rate",children:"Hourly Rate (£)"}),e.jsx(c,{id:"hourly_rate",type:"number",step:"0.01",value:a.hourly_rate,onChange:s=>n({...a,hourly_rate:parseFloat(s.target.value)||0})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"status",children:"Status"}),e.jsxs(p,{value:a.status,onValueChange:s=>n({...a,status:s}),children:[e.jsx(f,{children:e.jsx(N,{})}),e.jsxs(C,{children:[e.jsx(l,{value:"active",children:"Active"}),e.jsx(l,{value:"inactive",children:"Inactive"}),e.jsx(l,{value:"on_leave",children:"On Leave"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"background_check_status",children:"Background Check"}),e.jsxs(p,{value:a.background_check_status,onValueChange:s=>n({...a,background_check_status:s}),children:[e.jsx(f,{children:e.jsx(N,{})}),e.jsxs(C,{children:[e.jsx(l,{value:"pending",children:"Pending"}),e.jsx(l,{value:"passed",children:"Passed"}),e.jsx(l,{value:"failed",children:"Failed"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"notes",children:"Notes"}),e.jsx(Q,{id:"notes",value:a.notes,onChange:s=>n({...a,notes:s.target.value})})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(j,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsx(j,{onClick:W,disabled:F.isPending,children:F.isPending?"Creating...":"Create"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsx(h,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold",children:y.total})]})]})})}),e.jsx(h,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(de,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Active"}),e.jsx("p",{className:"text-2xl font-bold",children:y.active})]})]})})}),e.jsx(h,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oe,{className:"w-4 h-4 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"On Leave"}),e.jsx("p",{className:"text-2xl font-bold",children:y.onLeave})]})]})})}),e.jsx(h,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(he,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Background Check Passed"}),e.jsx("p",{className:"text-2xl font-bold",children:y.backgroundCheckPassed})]})]})})}),e.jsx(h,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xe,{className:"w-4 h-4 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Background Check Pending"}),e.jsx("p",{className:"text-2xl font-bold",children:y.backgroundCheckPending})]})]})})}),e.jsx(h,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Average Experience"}),e.jsxs("p",{className:"text-2xl font-bold",children:[o.length>0?Math.round(o.reduce((s,A)=>s+A.experience_years,0)/o.length):0,"y"]})]})]})})})]}),e.jsx(h,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{htmlFor:"search",children:"Search"}),e.jsx(c,{id:"search",placeholder:"Search by name or email...",value:k,onChange:s=>R(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"status-filter",children:"Status"}),e.jsxs(p,{value:w,onValueChange:Y,children:[e.jsx(f,{className:"w-32",children:e.jsx(N,{})}),e.jsxs(C,{children:[e.jsx(l,{value:"all",children:"All"}),e.jsx(l,{value:"active",children:"Active"}),e.jsx(l,{value:"inactive",children:"Inactive"}),e.jsx(l,{value:"on_leave",children:"On Leave"})]})]})]})]})})}),e.jsxs(h,{children:[e.jsxs(ue,{children:[e.jsx(me,{children:"Personal Assistants"}),e.jsxs(je,{children:[I.length," of ",o.length," Personal Assistants"]})]}),e.jsx(x,{children:e.jsxs(ye,{children:[e.jsx(pe,{children:e.jsxs(K,{children:[e.jsx(v,{children:"Name"}),e.jsx(v,{children:"Contact"}),e.jsx(v,{children:"Experience"}),e.jsx(v,{children:"Status"}),e.jsx(v,{children:"Background Check"}),e.jsx(v,{children:"Actions"})]})}),e.jsx(fe,{children:I.map(s=>e.jsxs(K,{children:[e.jsx(_,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.first_name," ",s.last_name]}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})}),e.jsx(_,{children:e.jsxs("div",{className:"space-y-1",children:[s.phone&&e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(ge,{className:"w-3 h-3 mr-1"}),s.phone]}),s.address&&e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(ve,{className:"w-3 h-3 mr-1"}),s.address]})]})}),e.jsx(_,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.experience_years," years"]}),s.hourly_rate>0&&e.jsxs("div",{className:"text-sm text-gray-500",children:["£",s.hourly_rate,"/hr"]})]})}),e.jsx(_,{children:e.jsx(V,{className:ee(s.status),children:s.status.replace("_"," ")})}),e.jsx(_,{children:e.jsx(V,{className:se(s.background_check_status),children:s.background_check_status})}),e.jsx(_,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(j,{variant:"outline",size:"sm",onClick:()=>$(s),children:e.jsx(_e,{className:"w-4 h-4"})}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>Z(s.id),children:e.jsx(Ce,{className:"w-4 h-4"})})]})})]},s.id))})]})})]}),e.jsx(O,{open:m,onOpenChange:b,children:e.jsxs(B,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(M,{children:[e.jsx(H,{children:"Edit Personal Assistant"}),e.jsx(U,{children:"Update Personal Assistant information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"edit_first_name",children:"First Name *"}),e.jsx(c,{id:"edit_first_name",value:a.first_name,onChange:s=>n({...a,first_name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"edit_last_name",children:"Last Name *"}),e.jsx(c,{id:"edit_last_name",value:a.last_name,onChange:s=>n({...a,last_name:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"edit_email",children:"Email *"}),e.jsx(c,{id:"edit_email",type:"email",value:a.email,onChange:s=>n({...a,email:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"edit_phone",children:"Phone"}),e.jsx(c,{id:"edit_phone",value:a.phone,onChange:s=>n({...a,phone:s.target.value})})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"edit_address",children:"Address"}),e.jsx(c,{id:"edit_address",value:a.address,onChange:s=>n({...a,address:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"edit_experience_years",children:"Years of Experience"}),e.jsx(c,{id:"edit_experience_years",type:"number",value:a.experience_years,onChange:s=>n({...a,experience_years:parseInt(s.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"edit_hourly_rate",children:"Hourly Rate (£)"}),e.jsx(c,{id:"edit_hourly_rate",type:"number",step:"0.01",value:a.hourly_rate,onChange:s=>n({...a,hourly_rate:parseFloat(s.target.value)||0})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"edit_status",children:"Status"}),e.jsxs(p,{value:a.status,onValueChange:s=>n({...a,status:s}),children:[e.jsx(f,{children:e.jsx(N,{})}),e.jsxs(C,{children:[e.jsx(l,{value:"active",children:"Active"}),e.jsx(l,{value:"inactive",children:"Inactive"}),e.jsx(l,{value:"on_leave",children:"On Leave"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"edit_background_check_status",children:"Background Check"}),e.jsxs(p,{value:a.background_check_status,onValueChange:s=>n({...a,background_check_status:s}),children:[e.jsx(f,{children:e.jsx(N,{})}),e.jsxs(C,{children:[e.jsx(l,{value:"pending",children:"Pending"}),e.jsx(l,{value:"passed",children:"Passed"}),e.jsx(l,{value:"failed",children:"Failed"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"edit_notes",children:"Notes"}),e.jsx(Q,{id:"edit_notes",value:a.notes,onChange:s=>n({...a,notes:s.target.value})})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(j,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(j,{onClick:X,disabled:S.isPending,children:S.isPending?"Updating...":"Update"})]})]})]})})]})};export{ze as default};
