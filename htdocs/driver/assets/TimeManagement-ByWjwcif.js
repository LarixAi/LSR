import{c as is,av as Ze,aw as Os,m as Re,ax as f,ay as Pe,H as ls,J as ge,G as cs,a2 as ds,a3 as we,r as K,j as e,az as Le,e as d,k as o,d as z,g as h,h as u,B as j,aq as de,ar as Es,S as _e,a4 as Ce,a5 as Te,a6 as Me,a7 as De,a8 as Ie,q as T,I as ue,ab as Ke,ac as He,ad as Ge,ae as Ve,af as I,s as ae,aA as Ae,aB as Se,aC as ce,aa as te,C as me,E as he,am as ze,n as D,x as Ws,N as es,O as ss,Q as ts,V as G,Y as V,aD as Is,aE as as,A as ke,f as As,z as be,ap as Ye,ag as Fs,a0 as Ps,b as qs,a as Ls,aF as Be,F as ns}from"./main-DVuL102c.js";import{T as Oe,a as Ee,b as se,c as k,d as We,e as b}from"./table-Jjtal2IW.js";import{u as os,a as xs,b as ms,c as hs,d as us,e as js,f as fs,g as gs,h as ys,i as ps,j as Ns,W as re}from"./useDailyRest-CzA17-bf.js";import{e as pe}from"./endOfWeek-aLw_agy5.js";import{P as je}from"./play-DTkR-tax.js";import{C as fe}from"./calendar-days-Bkcdzd58.js";import{S as vs}from"./square-BmtWbktP.js";import{p as S}from"./parseISO-1k6pJICp.js";import"./eachDayOfInterval-CZlqfhSB.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=is("Coffee",[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=is("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);function Ys(r){return a=>{const i=(r?Math[r]:Math.trunc)(a);return i===0?0:i}}function Bs(r,a){return+Ze(r)-+Ze(a)}function Fe(r,a,p){const i=Bs(r,a)/Os;return Ys(p==null?void 0:p.roundingMethod)(i)}const ye={FULL_WEEKLY_REST:45,REDUCED_WEEKLY_REST:24,COMPENSATION_REQUIRED:!0,COMPENSATION_PERIOD:3},ks=r=>{const{profile:a}=Re(),p=r?f(r,"yyyy-MM-dd"):f(Pe(new Date,{weekStartsOn:1}),"yyyy-MM-dd"),i=r?f(pe(r,{weekStartsOn:1}),"yyyy-MM-dd"):f(pe(new Date,{weekStartsOn:1}),"yyyy-MM-dd");return ls({queryKey:["weekly-rest",a==null?void 0:a.id,p,i],queryFn:async()=>{if(!(a!=null&&a.id))throw new Error("User profile is required");const{data:N,error:_}=await ge.from("weekly_rest").select("*").eq("driver_id",a.id).gte("week_start_date",p).lte("week_end_date",i).order("week_start_date",{ascending:!1});if(_){if(console.error("Error fetching weekly rest:",_),_.code==="PGRST205"||_.code==="42P01")return console.warn("weekly_rest table not found, returning empty data"),[];throw _}return N||[]},enabled:!!(a!=null&&a.id)})},Ks=()=>{const{profile:r}=Re(),a=cs();return ds({mutationFn:async p=>{if(!(r!=null&&r.id)||!(r!=null&&r.organization_id))throw new Error("User profile and organization information required");const{data:i,error:N}=await ge.from("weekly_rest").insert({...p,driver_id:r.id,organization_id:r.organization_id}).select().single();if(N)throw N.code==="PGRST205"||N.code==="42P01"?(console.warn("weekly_rest table not found, cannot create weekly rest record"),new Error("Weekly rest table not found. Please ensure the database is properly set up.")):N;return i},onSuccess:()=>{a.invalidateQueries({queryKey:["weekly-rest"]}),a.invalidateQueries({queryKey:["daily-rest"]}),we.success("Weekly rest recorded successfully")},onError:p=>{console.error("Error creating weekly rest:",p),we.error("Failed to record weekly rest: "+p.message)}})},bs=async(r,a)=>{const p=pe(a,{weekStartsOn:1}),i=f(a,"yyyy-MM-dd"),N=f(p,"yyyy-MM-dd"),{data:_,error:q}=await ge.from("time_entries").select("entry_date, total_hours").eq("driver_id",r).gte("entry_date",i).lte("entry_date",N);q&&console.warn("Error fetching time entries for weekly rest analysis:",q);const{data:A,error:x}=await ge.from("daily_rest").select("rest_date, duration_hours").eq("driver_id",r).gte("rest_date",i).lte("rest_date",N);x&&(x.code==="PGRST205"||x.code==="42P01")&&console.warn("daily_rest table not found for weekly rest analysis");const{data:g,error:y}=await ge.from("weekly_rest").select("*").eq("driver_id",r).gte("week_start_date",i).lte("week_end_date",N).order("week_start_date",{ascending:!1}).limit(1),P=(g==null?void 0:g[0])||null;y&&(y.code==="PGRST205"||y.code==="42P01")&&console.warn("weekly_rest table not found for weekly rest analysis");const v=(_==null?void 0:_.reduce((w,X)=>w+(X.total_hours||0),0))||0,L=(A==null?void 0:A.reduce((w,X)=>w+(X.duration_hours||0),0))||0,l=(P==null?void 0:P.total_rest_hours)||0;let C="missing",U=!1,R=!1,O;l>=ye.FULL_WEEKLY_REST?(C="full",U=!0):l>=ye.REDUCED_WEEKLY_REST&&(C="reduced",U=!0,R=!0,P!=null&&P.compensation_date&&(O=new Date(P.compensation_date)));const F=[],n=[];return v>60?n.push(`Weekly working time (${v}h) exceeds WTD limit (60h)`):v>55&&F.push(`Weekly working time (${v}h) approaching WTD limit (60h)`),C==="missing"?n.push("No weekly rest period recorded"):C==="reduced"&&!R&&F.push("Reduced weekly rest requires compensation"),R&&!O&&F.push("Compensation for reduced weekly rest not scheduled"),{weekStart:a,weekEnd:p,totalWorkHours:v,totalRestHours:L,requiredWeeklyRest:ye.FULL_WEEKLY_REST,actualRestHours:l,restCompliance:U,restType:C,compensationRequired:R,compensationDate:O,warnings:F,violations:n}},Hs=r=>{const{profile:a}=Re();return ls({queryKey:["weekly-rest-analysis",a==null?void 0:a.id,r.toISOString()],queryFn:async()=>{if(!(a!=null&&a.id))throw new Error("User profile is required");return bs(a.id,r)},enabled:!!(a!=null&&a.id)})},ws=()=>{const{profile:r}=Re(),a=cs(),p=Ks();return ds({mutationFn:async i=>{if(!(r!=null&&r.id))throw new Error("User profile is required");const N=await bs(r.id,i),_=pe(i,{weekStartsOn:1}),{data:q}=await ge.from("weekly_rest").select("id").eq("driver_id",r.id).gte("week_start_date",f(i,"yyyy-MM-dd")).lte("week_end_date",f(_,"yyyy-MM-dd")).limit(1);if(q==null?void 0:q[0])return{message:"Weekly rest already recorded for this week",analysis:N};let x="full_weekly_rest",g=!1;return N.totalWorkHours>60&&(x="reduced_weekly_rest",g=!0),await p.mutateAsync({week_start_date:f(i,"yyyy-MM-dd"),week_end_date:f(_,"yyyy-MM-dd"),total_rest_hours:N.actualRestHours||ye.FULL_WEEKLY_REST,rest_type:x,compensation_required:g,notes:"Automatically recorded weekly rest period"}),{message:"Weekly rest recorded successfully",analysis:N}},onSuccess:i=>{a.invalidateQueries({queryKey:["weekly-rest"]}),a.invalidateQueries({queryKey:["weekly-rest-analysis"]}),a.invalidateQueries({queryKey:["daily-rest"]}),i.message.includes("already recorded")?we.info(i.message):we.success(i.message)},onError:i=>{console.error("Error auto-recording weekly rest:",i),we.error("Failed to auto-record weekly rest: "+i.message)}})},_s=()=>{const r=Pe(new Date,{weekStartsOn:1});return Hs(r)};function Gs(){const[r,a]=K.useState(new Date),[p,i]=K.useState(!1),[N,_]=K.useState(!1),[q,A]=K.useState(""),[x,g]=K.useState({start_date:"",end_date:"",request_type:"annual_leave",reason:"",notes:""}),{data:y,isLoading:P}=os(),{data:v=[],isLoading:L}=xs(),{data:l=[]}=ms();hs();const{analysis:C,limits:U}=us(r||new Date);ks(r),_s(),ws();const R=js(),O=fs(),F=gs(),n=ys(),w=ps(),X=Ns(),M=()=>{if(!(y!=null&&y.clock_in_time)||y.status==="completed")return 0;const t=new Date,[W,Q,J]=y.clock_in_time.split(":").map(Number),Xe=new Date(t.getFullYear(),t.getMonth(),t.getDate(),W,Q,J),xe=new Date,qe=Fe(xe,Xe);if(y.break_start_time&&!y.break_end_time){const[c,$e,Z]=y.break_start_time.split(":").map(Number),s=new Date(t.getFullYear(),t.getMonth(),t.getDate(),c,$e,Z),m=Fe(xe,s);return Math.max(0,qe-m)}return qe},Ne=t=>{const W=Math.floor(t/60),Q=t%60;return`${W.toString().padStart(2,"0")}:${Q.toString().padStart(2,"0")}`},Y=async()=>{try{let t="Unknown";navigator.geolocation&&navigator.geolocation.getCurrentPosition(W=>{t=`${W.coords.latitude.toFixed(4)}, ${W.coords.longitude.toFixed(4)}`},()=>{}),await R.mutateAsync(t)}catch(t){console.error("Clock in error:",t)}},H=async()=>{try{let t="Unknown";navigator.geolocation&&navigator.geolocation.getCurrentPosition(J=>{t=`${J.coords.latitude.toFixed(4)}, ${J.coords.longitude.toFixed(4)}`},()=>{}),await O.mutateAsync(t);const W=Pe(new Date,{weekStartsOn:1}),Q=pe(new Date,{weekStartsOn:1});try{await X.mutateAsync({startDate:W,endDate:Q})}catch(J){console.error("Error auto-recording rest days:",J)}_(!1),A("")}catch(t){console.error("Clock out error:",t)}},ie=async()=>{try{await F.mutateAsync()}catch(t){console.error("Start break error:",t)}},le=async()=>{try{await n.mutateAsync()}catch(t){console.error("End break error:",t)}},oe=async()=>{try{await w.mutateAsync(x),g({start_date:"",end_date:"",request_type:"annual_leave",reason:"",notes:""}),i(!1)}catch(t){console.error("Create time off error:",t)}};if(P||L)return e.jsx(Le,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading time management..."})]})})});if(!(v.length>0||l.length>0))return e.jsx(Le,{children:e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Time Management"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Track your work hours and breaks"})]})}),e.jsx(d,{className:"mb-4",children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Time Data"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Your time management is currently empty. This could be because:"}),e.jsxs("div",{className:"text-left space-y-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{children:"You haven't clocked in yet today"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{children:"No time entries have been recorded"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsx("span",{children:"No time off requests submitted"})]})]})]})})}),e.jsxs(d,{className:"mb-4",children:[e.jsx(h,{className:"pb-3",children:e.jsx(u,{className:"text-lg",children:"Get Started"})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs(j,{onClick:Y,disabled:R.isPending,className:"w-full h-12",children:[R.isPending?e.jsx(de,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(je,{className:"w-4 h-4 mr-2"}),R.isPending?"Clocking In...":"Clock In to Start"]}),e.jsxs(j,{onClick:()=>i(!0),variant:"outline",className:"w-full h-12",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Request Time Off"]})]})})]}),e.jsxs(d,{children:[e.jsx(h,{className:"pb-3",children:e.jsxs(u,{className:"flex items-center space-x-2 text-lg",children:[e.jsx(Es,{className:"w-5 h-5"}),e.jsx("span",{children:"About Time Management"})]})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(z,{className:"w-4 h-4 mt-0.5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Clock In/Out"}),e.jsx("p",{children:"Track your work hours with GPS location"})]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(ne,{className:"w-4 h-4 mt-0.5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Break Management"}),e.jsx("p",{children:"Record breaks to comply with WTD regulations"})]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(_e,{className:"w-4 h-4 mt-0.5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"WTD Compliance"}),e.jsx("p",{children:"Monitor your working time directive compliance"})]})]})]})})]}),e.jsx(Ce,{open:p,onOpenChange:i,children:e.jsxs(Te,{children:[e.jsxs(Me,{children:[e.jsx(De,{children:"Request Time Off"}),e.jsx(Ie,{children:"Submit a request for time off."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(T,{htmlFor:"startDate",children:"Start Date"}),e.jsx(ue,{id:"startDate",type:"date",value:x.start_date,onChange:t=>g({...x,start_date:t.target.value})})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"endDate",children:"End Date"}),e.jsx(ue,{id:"endDate",type:"date",value:x.end_date,onChange:t=>g({...x,end_date:t.target.value})})]})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"requestType",children:"Request Type"}),e.jsxs(Ke,{value:x.request_type,onValueChange:t=>g({...x,request_type:t}),children:[e.jsx(He,{children:e.jsx(Ge,{})}),e.jsxs(Ve,{children:[e.jsx(I,{value:"annual_leave",children:"Annual Leave"}),e.jsx(I,{value:"sick_leave",children:"Sick Leave"}),e.jsx(I,{value:"personal_leave",children:"Personal Leave"}),e.jsx(I,{value:"bereavement",children:"Bereavement"}),e.jsx(I,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"reason",children:"Reason"}),e.jsx(ae,{id:"reason",value:x.reason,onChange:t=>g({...x,reason:t.target.value}),placeholder:"Enter reason for time off request..."})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"notes",children:"Notes"}),e.jsx(ae,{id:"notes",value:x.notes,onChange:t=>g({...x,notes:t.target.value}),placeholder:"Additional notes..."})]})]}),e.jsxs(Ae,{children:[e.jsx(j,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsx(j,{onClick:oe,disabled:w.isPending,children:w.isPending?"Submitting...":"Submit Request"})]})]})})]})});const ve=M(),E=(y==null?void 0:y.clock_in_time)&&y.status!=="completed",$=(y==null?void 0:y.break_start_time)&&!(y!=null&&y.break_end_time);return e.jsx(Le,{children:e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Time Management"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Track your work hours and breaks"})]})}),e.jsxs(d,{className:"mb-4",children:[e.jsx(h,{className:"pb-3",children:e.jsxs(u,{className:"flex items-center space-x-2 text-lg",children:[e.jsx(z,{className:"w-5 h-5"}),e.jsx("span",{children:"Current Status"})]})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:Se("w-4 h-4 rounded-full",E?"bg-green-500":"bg-gray-400")}),e.jsx("span",{className:"font-medium",children:E?"Clocked In":"Not Clocked In"})]}),E&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:Ne(ve)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Current Session"})]}),$&&e.jsxs("div",{className:"flex items-center space-x-2 p-3 bg-blue-50 rounded-lg",children:[e.jsx(ne,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-blue-800 font-medium",children:"On Break"})]})]})})]}),e.jsxs(d,{className:"mb-4",children:[e.jsx(h,{className:"pb-3",children:e.jsx(u,{className:"text-lg",children:"Quick Actions"})}),e.jsx(o,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(j,{onClick:E?()=>_(!0):Y,disabled:R.isPending||O.isPending,variant:E?"destructive":"default",className:"h-12",children:[R.isPending||O.isPending?e.jsx(de,{className:"w-4 h-4 animate-spin"}):E?e.jsx(ce,{className:"w-4 h-4"}):e.jsx(je,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:E?"Clock Out":"Clock In"})]}),e.jsxs(j,{onClick:$?le:ie,disabled:!E||F.isPending||n.isPending,variant:"outline",className:"h-12",children:[F.isPending||n.isPending?e.jsx(de,{className:"w-4 h-4 animate-spin"}):$?e.jsx(vs,{className:"w-4 h-4"}):e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:$?"End Break":"Start Break"})]})]})})]}),C&&e.jsxs(d,{className:"mb-4",children:[e.jsx(h,{className:"pb-3",children:e.jsxs(u,{className:"flex items-center space-x-2 text-lg",children:[e.jsx(_e,{className:"w-5 h-5"}),e.jsx("span",{children:"WTD Compliance"})]})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Daily Working Time"}),e.jsxs("span",{children:[C.dailyWorkingTime.toFixed(1),"h / ",re.MAX_DAILY_WORKING_TIME,"h"]})]}),e.jsx(te,{value:C.dailyWorkingTime/re.MAX_DAILY_WORKING_TIME*100,className:"h-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Weekly Working Time"}),e.jsxs("span",{children:[C.weeklyWorkingTime.toFixed(1),"h / ",re.MAX_WEEKLY_WORKING_TIME,"h"]})]}),e.jsx(te,{value:C.weeklyWorkingTime/re.MAX_WEEKLY_WORKING_TIME*100,className:"h-2"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[C.overallCompliance?e.jsx(me,{className:"w-4 h-4 text-green-600"}):e.jsx(he,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:Se("text-sm font-medium",C.overallCompliance?"text-green-600":"text-red-600"),children:C.overallCompliance?"Compliant":"Non-Compliant"})]})]})})]}),e.jsxs(d,{className:"mb-4",children:[e.jsx(h,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{className:"text-lg",children:"Time Off Requests"}),e.jsxs(j,{onClick:()=>i(!0),size:"sm",variant:"outline",children:[e.jsx(ze,{className:"w-4 h-4 mr-1"}),"Request"]})]})}),e.jsx(o,{children:l.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(fe,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"No time off requests"})]}):e.jsx("div",{className:"space-y-2",children:l.slice(0,3).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:t.request_type.replace("_"," ")}),e.jsxs("p",{className:"text-xs text-gray-600",children:[f(S(t.start_date),"MMM dd")," - ",f(S(t.end_date),"MMM dd")]})]}),e.jsx(D,{variant:t.status==="approved"?"default":t.status==="pending"?"secondary":"destructive",children:t.status})]},t.id))})})]}),e.jsxs(d,{children:[e.jsx(h,{className:"pb-3",children:e.jsx(u,{className:"text-lg",children:"Recent Entries"})}),e.jsx(o,{children:v.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(z,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"No time entries"})]}):e.jsx("div",{className:"space-y-2",children:v.slice(0,5).map(t=>{var W;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:f(S(t.entry_date),"MMM dd, yyyy")}),e.jsxs("p",{className:"text-xs text-gray-600",children:[t.clock_in_time," - ",t.clock_out_time||"Active"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium text-sm",children:[((W=t.total_hours)==null?void 0:W.toFixed(1))||"0.0","h"]}),e.jsx(D,{variant:"outline",className:"text-xs",children:t.status})]})]},t.id)})})})]}),e.jsx(Ce,{open:N,onOpenChange:_,children:e.jsxs(Te,{children:[e.jsxs(Me,{children:[e.jsx(De,{children:"Sign Off"}),e.jsx(Ie,{children:"Please provide a reason for signing off early."})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(T,{htmlFor:"signOffReason",children:"Reason"}),e.jsx(ae,{id:"signOffReason",value:q,onChange:t=>A(t.target.value),placeholder:"Enter reason for early sign off..."})]})}),e.jsxs(Ae,{children:[e.jsx(j,{variant:"outline",onClick:()=>_(!1),children:"Cancel"}),e.jsx(j,{onClick:H,disabled:O.isPending,children:O.isPending?"Signing Off...":"Sign Off"})]})]})}),e.jsx(Ce,{open:p,onOpenChange:i,children:e.jsxs(Te,{children:[e.jsxs(Me,{children:[e.jsx(De,{children:"Request Time Off"}),e.jsx(Ie,{children:"Submit a request for time off."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(T,{htmlFor:"startDate",children:"Start Date"}),e.jsx(ue,{id:"startDate",type:"date",value:x.start_date,onChange:t=>g({...x,start_date:t.target.value})})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"endDate",children:"End Date"}),e.jsx(ue,{id:"endDate",type:"date",value:x.end_date,onChange:t=>g({...x,end_date:t.target.value})})]})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"requestType",children:"Request Type"}),e.jsxs(Ke,{value:x.request_type,onValueChange:t=>g({...x,request_type:t}),children:[e.jsx(He,{children:e.jsx(Ge,{})}),e.jsxs(Ve,{children:[e.jsx(I,{value:"annual_leave",children:"Annual Leave"}),e.jsx(I,{value:"sick_leave",children:"Sick Leave"}),e.jsx(I,{value:"personal_leave",children:"Personal Leave"}),e.jsx(I,{value:"bereavement",children:"Bereavement"}),e.jsx(I,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"reason",children:"Reason"}),e.jsx(ae,{id:"reason",value:x.reason,onChange:t=>g({...x,reason:t.target.value}),placeholder:"Enter reason for time off request..."})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"notes",children:"Notes"}),e.jsx(ae,{id:"notes",value:x.notes,onChange:t=>g({...x,notes:t.target.value}),placeholder:"Additional notes..."})]})]}),e.jsxs(Ae,{children:[e.jsx(j,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsx(j,{onClick:oe,disabled:w.isPending,children:w.isPending?"Submitting...":"Submit Request"})]})]})})]})})}function st(){const{user:r,profile:a,loading:p}=Re(),i=Ws(),[N,_]=K.useState(new Date),[q,A]=K.useState(!1),[x,g]=K.useState(!1),[y,P]=K.useState(""),[v,L]=K.useState({start_date:"",end_date:"",request_type:"annual_leave",reason:"",notes:""}),{data:l,isLoading:C}=os(),{data:U=[],isLoading:R}=xs(),{data:O=[]}=ms(),F=hs(),{analysis:n,limits:w}=us(N||new Date),{data:X=[]}=ks(N),{data:M}=_s(),Ne=ws(),Y=js(),H=fs(),ie=gs(),le=ys(),oe=ps(),Ue=Ns();if(p||C||R)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading time management..."})]})});if(!r||!a)return e.jsx(es,{to:"/auth",replace:!0});if(a.role!=="driver")return e.jsx(es,{to:"/dashboard",replace:!0});if(i)return e.jsx(Gs,{});const ve=()=>{if(!(l!=null&&l.clock_in_time)||l.status==="completed")return 0;const s=new Date,[m,B,ee]=l.clock_in_time.split(":").map(Number),Cs=new Date(s.getFullYear(),s.getMonth(),s.getDate(),m,B,ee),Qe=new Date,Je=Fe(Qe,Cs);if(l.break_start_time&&!l.break_end_time){const[Ts,Ms,Ds]=l.break_start_time.split(":").map(Number),Ss=new Date(s.getFullYear(),s.getMonth(),s.getDate(),Ts,Ms,Ds),Rs=Fe(Qe,Ss);return Math.max(0,Je-Rs)}return Je},E=s=>{const m=Math.floor(s/60),B=s%60;return`${m.toString().padStart(2,"0")}:${B.toString().padStart(2,"0")}`},$=async()=>{try{let s="Unknown";navigator.geolocation&&navigator.geolocation.getCurrentPosition(m=>{s=`${m.coords.latitude.toFixed(4)}, ${m.coords.longitude.toFixed(4)}`},()=>{}),await Y.mutateAsync(s)}catch(s){console.error("Clock in error:",s)}},t=async()=>{try{let s="Unknown";navigator.geolocation&&navigator.geolocation.getCurrentPosition(ee=>{s=`${ee.coords.latitude.toFixed(4)}, ${ee.coords.longitude.toFixed(4)}`},()=>{}),await H.mutateAsync(s);const m=Pe(new Date,{weekStartsOn:1}),B=pe(new Date,{weekStartsOn:1});try{await Ue.mutateAsync({startDate:m,endDate:B})}catch(ee){console.error("Error auto-recording rest days:",ee)}g(!1),P("")}catch(s){console.error("Clock out error:",s)}},W=async()=>{try{await ie.mutateAsync()}catch(s){console.error("Start break error:",s)}},Q=async()=>{try{await le.mutateAsync()}catch(s){console.error("End break error:",s)}},J=async()=>{try{await oe.mutateAsync(v),A(!1),L({start_date:"",end_date:"",request_type:"annual_leave",reason:"",notes:""})}catch(s){console.error("Time off request error:",s)}},xe=n.criticalViolations.length>0?{status:"critical",color:"text-red-600",bgColor:"bg-red-100"}:n.warnings.length>0?{status:"warning",color:"text-yellow-600",bgColor:"bg-yellow-100"}:{status:"compliant",color:"text-green-600",bgColor:"bg-green-100"},c=l?l.status==="completed"?"signed_off":l.break_start_time&&!l.break_end_time?"on_break":"on_duty":"off_duty",Z=(()=>{const s=new Date;return O.filter(m=>{const B=S(m.start_date),ee=S(m.end_date);return B<=s&&ee>=s})})();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Time Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Track your working hours, manage breaks, and submit time off requests"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>window.location.reload(),children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Refresh"]})})]}),e.jsxs(ss,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(ts,{className:"grid w-full grid-cols-4",children:[e.jsx(G,{value:"overview",children:"Overview"}),e.jsx(G,{value:"time-tracking",children:"Time Tracking"}),e.jsx(G,{value:"compliance",children:"WTD Compliance"}),e.jsx(G,{value:"time-off",children:"Time Off"})]}),e.jsxs(V,{value:"overview",className:"space-y-6",children:[e.jsx(d,{className:Se("border-2",c==="on_duty"&&"border-green-200 bg-green-50",c==="on_break"&&"border-yellow-200 bg-yellow-50",c==="signed_off"&&"border-blue-200 bg-blue-50",c==="off_duty"&&"border-gray-200 bg-gray-50"),children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:Se("p-3 rounded-full",c==="on_duty"&&"bg-green-100",c==="on_break"&&"bg-yellow-100",c==="signed_off"&&"bg-blue-100",c==="off_duty"&&"bg-gray-100"),children:[c==="on_duty"&&e.jsx(Is,{className:"w-6 h-6 text-green-600"}),c==="on_break"&&e.jsx(ne,{className:"w-6 h-6 text-yellow-600"}),c==="signed_off"&&e.jsx(ce,{className:"w-6 h-6 text-blue-600"}),c==="off_duty"&&e.jsx(as,{className:"w-6 h-6 text-gray-600"})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold",children:[c==="on_duty"&&"Currently On Duty",c==="on_break"&&"Currently On Break",c==="signed_off"&&"Signed Off for the Day",c==="off_duty"&&"Off Duty"]}),e.jsxs("p",{className:"text-muted-foreground",children:[c==="on_duty"&&"You are currently working. Remember to take breaks and monitor your WTD compliance.",c==="on_break"&&"You are currently on break. Take your time to rest properly.",c==="signed_off"&&"You have successfully signed off for the day. Have a good rest!",c==="off_duty"&&'You are not currently on duty. Click "Clock In" to start your work day.']})]})]}),e.jsxs("div",{className:"text-right",children:[c==="on_duty"&&e.jsxs(j,{onClick:()=>g(!0),className:"bg-red-600 hover:bg-red-700",size:"lg",children:[e.jsx(ce,{className:"w-5 h-5 mr-2"}),"Sign Off Work"]}),c==="off_duty"&&e.jsxs(j,{onClick:$,disabled:Y.isPending,className:"bg-green-600 hover:bg-green-700",size:"lg",children:[e.jsx(je,{className:"w-5 h-5 mr-2"}),Y.isPending?"Clocking In...":"Clock In"]})]})]})})}),Z.length>0&&e.jsxs(ke,{className:"border-blue-200 bg-blue-50",children:[e.jsx(As,{className:"h-4 w-4 text-blue-600"}),e.jsxs(be,{className:"text-blue-800",children:[e.jsx("strong",{children:"You are currently on approved time off:"})," ",Z[0].request_type.replace("_"," "),"from ",f(S(Z[0].start_date),"MMM dd")," to ",f(S(Z[0].end_date),"MMM dd")]})]}),n.criticalViolations.length>0&&e.jsx(d,{className:"border-red-200 bg-red-50",children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(he,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-red-900",children:"Working Time Directive Violations"}),e.jsx("ul",{className:"mt-1 text-sm text-red-700",children:n.criticalViolations.map((s,m)=>e.jsxs("li",{children:["• ",s]},m))})]})]})})}),n.warnings.length>0&&n.criticalViolations.length===0&&e.jsx(d,{className:"border-yellow-200 bg-yellow-50",children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ye,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-yellow-900",children:"Working Time Directive Warnings"}),e.jsx("ul",{className:"mt-1 text-sm text-yellow-700",children:n.warnings.map((s,m)=>e.jsxs("li",{children:["• ",s]},m))})]})]})})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(d,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Daily Working Time"}),e.jsx(_e,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[n.dailyWorkingTime.toFixed(1),"h"]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(te,{value:n.dailyWorkingTime/w.MAX_DAILY_WORKING_TIME*100,className:"flex-1"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[w.MAX_DAILY_WORKING_TIME,"h limit"]})]}),n.dailyWorkingTime>w.MAX_DAILY_WORKING_TIME&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Exceeds limit"})]})]}),e.jsxs(d,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Daily Driving Time"}),e.jsx(Fs,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[n.dailyDrivingTime.toFixed(1),"h"]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(te,{value:n.dailyDrivingTime/w.MAX_DAILY_DRIVING_TIME*100,className:"flex-1"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[w.MAX_DAILY_DRIVING_TIME,"h limit"]})]}),n.dailyDrivingTime>w.MAX_DAILY_DRIVING_TIME&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Exceeds limit"})]})]}),e.jsxs(d,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Weekly Working Time"}),e.jsx(fe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[n.weeklyWorkingTime.toFixed(1),"h"]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(te,{value:n.weeklyWorkingTime/w.MAX_WEEKLY_WORKING_TIME*100,className:"flex-1"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[w.MAX_WEEKLY_WORKING_TIME,"h limit"]})]}),n.weeklyWorkingTime>w.MAX_WEEKLY_WORKING_TIME&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Exceeds limit"})]})]}),e.jsxs(d,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Compliance Score"}),e.jsx(me,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[n.complianceScore,"%"]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(te,{value:n.complianceScore,className:"flex-1"}),e.jsx(D,{variant:n.overallCompliance?"default":"destructive",children:n.overallCompliance?"Compliant":"Non-Compliant"})]})]})]})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(ne,{className:"w-5 h-5"}),e.jsx("span",{children:"Break Compliance"})]})}),e.jsxs(o,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[n.takenBreaks.toFixed(1),"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Breaks Taken"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[n.requiredBreaks.toFixed(1),"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Breaks Required"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:n.breakCompliance?e.jsx(me,{className:"w-8 h-8 text-green-600 mx-auto"}):e.jsx(Ps,{className:"w-8 h-8 text-red-600 mx-auto"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Compliance Status"})]})]}),n.breakWarnings.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"Break Warnings:"}),e.jsx("ul",{className:"text-sm text-yellow-700",children:n.breakWarnings.map((s,m)=>e.jsxs("li",{children:["• ",s]},m))})]})]})]}),e.jsxs(ss,{defaultValue:"today",className:"space-y-4",children:[e.jsxs(ts,{className:"grid w-full grid-cols-5",children:[e.jsx(G,{value:"today",children:"Today's Work"}),e.jsx(G,{value:"history",children:"History"}),e.jsx(G,{value:"time-off",children:"Time Off"}),e.jsx(G,{value:"weekly-rest",children:"Weekly Rest"}),e.jsx(G,{value:"statistics",children:"Statistics"})]}),e.jsx(V,{value:"today",className:"space-y-4",children:e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-5 h-5"}),e.jsx("span",{children:"Current Session"})]})}),e.jsx(o,{children:C?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{children:"Loading current session..."})]}):l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:E(ve())}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Current Session"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:l.total_hours?E(l.total_hours*60):"00:00"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Today"})]})]}),e.jsx("div",{className:"flex justify-center space-x-4",children:l.status==="active"?e.jsxs(e.Fragment,{children:[e.jsxs(j,{onClick:()=>g(!0),disabled:H.isPending,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),H.isPending?"Signing Off...":"Sign Off Work"]}),l.break_start_time&&!l.break_end_time?e.jsxs(j,{onClick:Q,disabled:le.isPending,variant:"outline",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),le.isPending?"Ending Break...":"End Break"]}):e.jsxs(j,{onClick:W,disabled:ie.isPending,variant:"outline",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),ie.isPending?"Starting Break...":"Start Break"]})]}):e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-4",children:[e.jsx(me,{className:"w-6 h-6 text-green-600"}),e.jsx("span",{className:"text-lg font-medium text-green-600",children:"Successfully Signed Off"})]}),e.jsx("p",{className:"text-muted-foreground",children:"You have completed your work day. Have a good rest!"})]})}),l.status==="active"&&e.jsx("div",{className:"text-center",children:e.jsx(D,{variant:l.break_start_time&&!l.break_end_time?"secondary":"default",children:l.break_start_time&&!l.break_end_time?"On Break":"Working"})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(as,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"You are off duty"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:'Click "Clock In" to start your work day'}),e.jsxs(j,{onClick:$,disabled:Y.isPending,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),Y.isPending?"Clocking In...":"Clock In"]})]})})]})}),e.jsx(V,{value:"history",className:"space-y-4",children:e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(u,{children:"Time Entry History"})}),e.jsx(o,{children:R?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{children:"Loading time entries..."})]}):e.jsxs(Oe,{children:[e.jsx(Ee,{children:e.jsxs(se,{children:[e.jsx(k,{children:"Date"}),e.jsx(k,{children:"Clock In"}),e.jsx(k,{children:"Clock Out"}),e.jsx(k,{children:"Total Hours"}),e.jsx(k,{children:"Break Time"}),e.jsx(k,{children:"Status"})]})}),e.jsx(We,{children:U.map(s=>{var m,B;return e.jsxs(se,{children:[e.jsx(b,{children:s.entry_date?f(S(s.entry_date),"MMM dd, yyyy"):"N/A"}),e.jsx(b,{children:s.clock_in_time?s.clock_in_time:"-"}),e.jsx(b,{children:s.clock_out_time?s.clock_out_time:"-"}),e.jsxs(b,{children:[((m=s.total_hours)==null?void 0:m.toFixed(2))||"0.00","h"]}),e.jsxs(b,{children:[((B=s.break_hours)==null?void 0:B.toFixed(2))||"0.00","h"]}),e.jsx(b,{children:e.jsx(D,{variant:s.status==="completed"?"default":"secondary",children:s.status==="completed"?"Signed Off":s.status})})]},s.id)})})]})})]})}),e.jsx(V,{value:"time-off",className:"space-y-4",children:e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{children:"Time Off Requests"}),e.jsxs(j,{onClick:()=>A(!0),children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),"Request Time Off"]})]})}),e.jsx(o,{children:e.jsxs(Oe,{children:[e.jsx(Ee,{children:e.jsxs(se,{children:[e.jsx(k,{children:"Type"}),e.jsx(k,{children:"Start Date"}),e.jsx(k,{children:"End Date"}),e.jsx(k,{children:"Status"}),e.jsx(k,{children:"Reason"})]})}),e.jsx(We,{children:O.map(s=>e.jsxs(se,{children:[e.jsx(b,{className:"capitalize",children:s.request_type.replace("_"," ")}),e.jsx(b,{children:f(S(s.start_date),"MMM dd, yyyy")}),e.jsx(b,{children:f(S(s.end_date),"MMM dd, yyyy")}),e.jsx(b,{children:e.jsx(D,{variant:s.status==="approved"?"default":s.status==="rejected"?"destructive":"secondary",children:s.status})}),e.jsx(b,{className:"max-w-xs truncate",children:s.reason})]},s.id))})]})})]})}),e.jsx(V,{value:"statistics",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(d,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Total Hours"}),e.jsx(z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[F.totalHours.toFixed(1),"h"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This period"})]})]}),e.jsxs(d,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Overtime"}),e.jsx(qs,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[F.totalOvertime.toFixed(1),"h"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Extra hours worked"})]})]}),e.jsxs(d,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Break Time"}),e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[F.totalBreaks.toFixed(1),"h"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total breaks taken"})]})]}),e.jsxs(d,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Average/Day"}),e.jsx(Ls,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[F.averageHoursPerDay.toFixed(1),"h"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Daily average"})]})]})]})}),e.jsxs(V,{value:"weekly-rest",className:"space-y-4",children:[M&&e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(Be,{className:"w-5 h-5"}),e.jsx("span",{children:"Weekly Rest Compliance"}),e.jsx(D,{variant:M.restCompliance?"default":"destructive",children:M.restCompliance?"Compliant":"Non-Compliant"})]})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[M.actualRestHours.toFixed(1),"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Actual Rest"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[M.requiredWeeklyRest,"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Required Rest"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[M.totalWorkHours.toFixed(1),"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Work Hours"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Rest Type:"}),e.jsx(D,{variant:"outline",className:"capitalize",children:M.restType.replace("_"," ")})]}),M.compensationRequired&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Compensation Required:"}),e.jsx(D,{variant:"destructive",children:"Yes"})]}),M.compensationDate&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Compensation Date:"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:f(M.compensationDate,"MMM dd, yyyy")})]})]}),M.violations.length>0&&e.jsxs(ke,{className:"border-red-200 bg-red-50",children:[e.jsx(he,{className:"h-4 w-4 text-red-600"}),e.jsxs(be,{className:"text-red-800",children:[e.jsx("strong",{children:"Violations:"})," ",M.violations.join(", ")]})]}),M.warnings.length>0&&e.jsxs(ke,{className:"border-yellow-200 bg-yellow-50",children:[e.jsx(Ye,{className:"h-4 w-4 text-yellow-600"}),e.jsxs(be,{className:"text-yellow-800",children:[e.jsx("strong",{children:"Warnings:"})," ",M.warnings.join(", ")]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(j,{onClick:()=>Ne.mutate(N||new Date),disabled:Ne.isPending,className:"flex-1",children:Ne.isPending?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-4 h-4 mr-2 animate-spin"}),"Recording..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Record Weekly Rest"]})})})]})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(fe,{className:"w-5 h-5"}),e.jsx("span",{children:"Weekly Rest History"})]})}),e.jsx(o,{children:X.length>0?e.jsx("div",{className:"space-y-4",children:X.map(s=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"font-medium",children:["Week of ",f(new Date(s.week_start_date),"MMM dd, yyyy")]}),e.jsx(D,{variant:"outline",className:"capitalize",children:s.rest_type.replace("_"," ")})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.total_rest_hours,"h rest"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Period:"}),e.jsxs("div",{children:[f(new Date(s.week_start_date),"MMM dd")," - ",f(new Date(s.week_end_date),"MMM dd, yyyy")]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Compensation:"}),e.jsx("div",{children:s.compensation_required?e.jsx(D,{variant:"destructive",className:"text-xs",children:"Required"}):e.jsx(D,{variant:"default",className:"text-xs",children:"Not Required"})})]})]}),s.notes&&e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",s.notes]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Be,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No weekly rest records found"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:'Click "Record Weekly Rest" to create your first rest record'})]})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(_e,{className:"w-5 h-5"}),e.jsx("span",{children:"WTD Weekly Rest Requirements"})]})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Full Weekly Rest"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[ye.FULL_WEEKLY_REST,"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Minimum uninterrupted rest"})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Reduced Weekly Rest"}),e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[ye.REDUCED_WEEKLY_REST,"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Once per week maximum"})]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Important Information"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"• Weekly rest must be taken every 6 x 24-hour periods"}),e.jsx("li",{children:"• Reduced rest requires compensation within 3 weeks"}),e.jsx("li",{children:"• Rest periods must be uninterrupted"}),e.jsx("li",{children:"• Compliance is monitored automatically"})]})]})]})})]})]})]}),e.jsx(Ce,{open:x,onOpenChange:g,children:e.jsxs(Te,{children:[e.jsxs(Me,{children:[e.jsxs(De,{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{children:"Sign Off Work"})]}),e.jsx(Ie,{children:"You are about to sign off work for the day. This action will record your end time and complete your work session."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(rs,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900",children:"Session Summary"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Current Session:"}),e.jsx("div",{className:"font-semibold text-blue-900",children:E(ve())})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Total Today:"}),e.jsx("div",{className:"font-semibold text-blue-900",children:l!=null&&l.total_hours?E(l.total_hours*60):"00:00"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"sign-off-reason",children:"End of Day Notes (Optional)"}),e.jsx(ae,{id:"sign-off-reason",placeholder:"Any notes about your work day, issues encountered, or important information...",value:y,onChange:s=>P(s.target.value),rows:3})]})]}),e.jsxs(Ae,{children:[e.jsx(j,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsxs(j,{onClick:t,disabled:H.isPending,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),H.isPending?"Signing Off...":"Confirm Sign Off"]})]})]})}),e.jsx(Ce,{open:q,onOpenChange:A,children:e.jsxs(Te,{children:[e.jsx(Me,{children:e.jsx(De,{children:"Request Time Off"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"start-date",children:"Start Date"}),e.jsx(ue,{id:"start-date",type:"date",value:v.start_date,onChange:s=>L({...v,start_date:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"end-date",children:"End Date"}),e.jsx(ue,{id:"end-date",type:"date",value:v.end_date,onChange:s=>L({...v,end_date:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"request-type",children:"Request Type"}),e.jsxs(Ke,{value:v.request_type,onValueChange:s=>L({...v,request_type:s}),children:[e.jsx(He,{children:e.jsx(Ge,{})}),e.jsxs(Ve,{children:[e.jsx(I,{value:"annual_leave",children:"Annual Leave"}),e.jsx(I,{value:"sick_leave",children:"Sick Leave"}),e.jsx(I,{value:"personal_leave",children:"Personal Leave"}),e.jsx(I,{value:"bereavement",children:"Bereavement"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"reason",children:"Reason"}),e.jsx(ae,{id:"reason",placeholder:"Please provide a reason for your time off request...",value:v.reason,onChange:s=>L({...v,reason:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"notes",children:"Additional Notes"}),e.jsx(ae,{id:"notes",placeholder:"Any additional information...",value:v.notes,onChange:s=>L({...v,notes:s.target.value})})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(j,{variant:"outline",onClick:()=>A(!1),children:"Cancel"}),e.jsx(j,{onClick:J,disabled:oe.isPending,children:oe.isPending?"Submitting...":"Submit Request"})]})]})]})})]}),e.jsxs(V,{value:"time-tracking",className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-5 h-5"}),e.jsx("span",{children:"Quick Actions"})]})}),e.jsx(o,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(j,{onClick:c==="on_duty"?()=>g(!0):$,disabled:Y.isPending||H.isPending,variant:c==="on_duty"?"destructive":"default",className:"h-12",children:[Y.isPending||H.isPending?e.jsx(de,{className:"w-4 h-4 animate-spin"}):c==="on_duty"?e.jsx(ce,{className:"w-4 h-4"}):e.jsx(je,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:c==="on_duty"?"Clock Out":"Clock In"})]}),e.jsxs(j,{onClick:c==="on_break"?Q:W,disabled:c!=="on_duty"||ie.isPending||le.isPending,variant:"outline",className:"h-12",children:[ie.isPending||le.isPending?e.jsx(de,{className:"w-4 h-4 animate-spin"}):c==="on_break"?e.jsx(vs,{className:"w-4 h-4"}):e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:c==="on_break"?"End Break":"Start Break"})]})]})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(rs,{className:"w-5 h-5"}),e.jsx("span",{children:"Current Session"})]})}),e.jsxs(o,{children:[c==="on_duty"&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:E(ve())}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Current Session Time"})]}),c!=="on_duty"&&e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(z,{className:"w-8 h-8 mx-auto mb-2"}),e.jsx("p",{children:"Not currently working"})]})]})]})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(ns,{className:"w-5 h-5"}),e.jsx("span",{children:"Recent Time Entries"})]})}),e.jsx(o,{children:U.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(z,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No time entries found"})]}):e.jsxs(Oe,{children:[e.jsx(Ee,{children:e.jsxs(se,{children:[e.jsx(k,{children:"Date"}),e.jsx(k,{children:"Clock In"}),e.jsx(k,{children:"Clock Out"}),e.jsx(k,{children:"Total Hours"}),e.jsx(k,{children:"Status"})]})}),e.jsx(We,{children:U.slice(0,10).map(s=>{var m;return e.jsxs(se,{children:[e.jsx(b,{children:f(S(s.entry_date),"MMM dd, yyyy")}),e.jsx(b,{children:s.clock_in_time}),e.jsx(b,{children:s.clock_out_time||"Active"}),e.jsxs(b,{children:[((m=s.total_hours)==null?void 0:m.toFixed(1))||"0.0","h"]}),e.jsx(b,{children:e.jsx(D,{variant:s.status==="completed"?"default":"secondary",children:s.status})})]},s.id)})})]})})]})]}),e.jsx(V,{value:"compliance",className:"space-y-6",children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(_e,{className:"w-5 h-5"}),e.jsx("span",{children:"WTD Compliance Status"})]})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[xe.status==="compliant"?e.jsx(me,{className:"w-5 h-5 text-green-600"}):e.jsx(he,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:Se("font-medium",xe.color),children:xe.status==="compliant"?"Compliant":"Non-Compliant"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Daily Working Time"}),e.jsxs("span",{children:[n.dailyWorkingTime.toFixed(1),"h / ",re.MAX_DAILY_WORKING_TIME,"h"]})]}),e.jsx(te,{value:n.dailyWorkingTime/re.MAX_DAILY_WORKING_TIME*100,className:"h-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Weekly Working Time"}),e.jsxs("span",{children:[n.weeklyWorkingTime.toFixed(1),"h / ",re.MAX_WEEKLY_WORKING_TIME,"h"]})]}),e.jsx(te,{value:n.weeklyWorkingTime/re.MAX_WEEKLY_WORKING_TIME*100,className:"h-2"})]})]})]})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(he,{className:"w-5 h-5"}),e.jsx("span",{children:"Warnings & Violations"})]})}),e.jsx(o,{children:n.criticalViolations.length===0&&n.warnings.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(me,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),e.jsx("p",{className:"text-green-600 font-medium",children:"No violations or warnings"})]}):e.jsxs("div",{className:"space-y-3",children:[n.criticalViolations.map((s,m)=>e.jsxs(ke,{variant:"destructive",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx(be,{children:s})]},m)),n.warnings.map((s,m)=>e.jsxs(ke,{children:[e.jsx(Ye,{className:"w-4 h-4"}),e.jsx(be,{children:s})]},m))]})})]})]})}),e.jsxs(V,{value:"time-off",className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Time Off Management"}),e.jsxs(j,{onClick:()=>A(!0),children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),"Request Time Off"]})]}),Z.length>0&&e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(fe,{className:"w-5 h-5"}),e.jsx("span",{children:"Current Time Off"})]})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-3",children:Z.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.request_type.replace("_"," ")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[f(S(s.start_date),"MMM dd")," - ",f(S(s.end_date),"MMM dd")]})]}),e.jsx(D,{variant:"default",children:"Active"})]},s.id))})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(ns,{className:"w-5 h-5"}),e.jsx("span",{children:"Time Off Requests"})]})}),e.jsx(o,{children:O.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fe,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No time off requests found"})]}):e.jsxs(Oe,{children:[e.jsx(Ee,{children:e.jsxs(se,{children:[e.jsx(k,{children:"Type"}),e.jsx(k,{children:"Start Date"}),e.jsx(k,{children:"End Date"}),e.jsx(k,{children:"Status"}),e.jsx(k,{children:"Actions"})]})}),e.jsx(We,{children:O.map(s=>e.jsxs(se,{children:[e.jsx(b,{className:"capitalize",children:s.request_type.replace("_"," ")}),e.jsx(b,{children:f(S(s.start_date),"MMM dd, yyyy")}),e.jsx(b,{children:f(S(s.end_date),"MMM dd, yyyy")}),e.jsx(b,{children:e.jsx(D,{variant:s.status==="approved"?"default":s.status==="pending"?"secondary":"destructive",children:s.status})}),e.jsx(b,{children:e.jsx(j,{variant:"outline",size:"sm",children:"View Details"})})]},s.id))})]})})]})]})]})]})}export{st as default};
