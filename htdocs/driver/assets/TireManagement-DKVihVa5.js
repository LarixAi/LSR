import{m as q,H as K,J as _,r as C,j as e,N as A,bD as E,a4 as Y,as as Z,B as b,am as $,a5 as ee,a6 as se,a7 as re,q as u,I as g,ab as D,ac as I,ad as z,ae as L,af as d,e as j,k as m,bP as B,E as ae,d as O,b as te,O as ne,Q as ie,V as R,Y as F,g as M,h as P,au as le,b9 as ce,C as de,n as o}from"./main-DVuL102c.js";import{T as H,a as Q,b as f,c as t,d as G,e as n}from"./table-Jjtal2IW.js";const U=()=>{const{user:h,profile:a}=q();return K({queryKey:["tire_inventory",a==null?void 0:a.organization_id],queryFn:async()=>{if(!(a!=null&&a.organization_id))throw new Error("Organization ID is required");console.log("Fetching tire inventory from database...");try{const{data:i,error:s}=await _.from("tire_inventory").select("*").eq("organization_id",a.organization_id).order("created_at",{ascending:!1});if(s){if(console.error("Error fetching tire inventory:",s),s.code==="42P01"||s.code==="PGRST205")return console.warn("tire_inventory table not found, returning empty data"),[];throw s}return console.log("Fetched tire inventory:",i),i||[]}catch(i){return console.error("Error in useTireInventory:",i),[]}},enabled:!!(a!=null&&a.organization_id)})},W=()=>{const{user:h,profile:a}=q();return K({queryKey:["vehicle_tires",a==null?void 0:a.organization_id],queryFn:async()=>{if(!(a!=null&&a.organization_id))throw new Error("Organization ID is required");console.log("Fetching vehicle tires from database...");try{const{data:i,error:s}=await _.from("vehicle_tires").select("*").eq("organization_id",a.organization_id).order("created_at",{ascending:!1});if(s){if(console.error("Error fetching vehicle tires:",s),s.code==="42P01"||s.code==="PGRST205")return console.warn("vehicle_tires table not found, returning empty data"),[];throw s}if(!i||i.length===0)return[];const l=i.filter(c=>c.vehicle_id).map(c=>c.vehicle_id),v=i.filter(c=>c.tire_inventory_id).map(c=>c.tire_inventory_id),[T,w]=await Promise.all([l.length>0?_.from("vehicles").select("id, vehicle_number, make, model").in("id",l):Promise.resolve({data:[],error:null}),v.length>0?_.from("tire_inventory").select("*").in("id",v):Promise.resolve({data:[],error:null})]),p=i.map(c=>{var N,x;const S=(N=T.data)==null?void 0:N.find(y=>y.id===c.vehicle_id),k=(x=w.data)==null?void 0:x.find(y=>y.id===c.tire_inventory_id);return{...c,vehicle:S||null,tire_inventory:k||null}});return console.log("Fetched vehicle tires with relations:",p),p||[]}catch(i){return console.error("Error in useVehicleTires:",i),[]}},enabled:!!(a!=null&&a.organization_id)})},oe=()=>{const{data:h=[]}=U(),{data:a=[]}=W();return{total_inventory:h.length,low_stock_items:h.filter(s=>s.stock_quantity<=s.minimum_stock).length,total_stock_value:h.reduce((s,l)=>s+(l.cost_per_tire||0)*l.stock_quantity,0),total_installed_tires:a.length,tires_due_inspection:a.filter(s=>s.next_inspection_due?new Date(s.next_inspection_due)<=new Date:!1).length,worn_tires:a.filter(s=>s.status==="worn").length,damaged_tires:a.filter(s=>s.status==="damaged").length,by_position:a.reduce((s,l)=>(s[l.position]=(s[l.position]||0)+1,s),{}),by_status:a.reduce((s,l)=>(s[l.status]=(s[l.status]||0)+1,s),{})}},je=()=>{const{user:h,profile:a,loading:i}=q(),[s,l]=C.useState(""),[v,T]=C.useState(""),[w,p]=C.useState(!1),{data:c=[],isLoading:S}=U(),{data:k=[],isLoading:N}=W(),x=oe();if(i||S||N)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading tire management..."})]})});if(!h||!a)return e.jsx(A,{to:"/auth",replace:!0});if(!["admin","council"].includes(a.role))return e.jsx(A,{to:"/unauthorized",replace:!0});const y=(r,V)=>r<=V?"critical":r<=V*1.5?"low":"good",J=r=>{switch(r){case"good":return e.jsx(o,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"Good"});case"worn":return e.jsx(o,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"Worn"});case"critical":return e.jsx(o,{className:"bg-red-100 text-red-800 hover:bg-red-100",children:"Replace"});default:return e.jsx(o,{variant:"secondary",children:r})}},X=r=>{switch(r){case"good":return e.jsx(o,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"In Stock"});case"low":return e.jsx(o,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"Low Stock"});case"critical":return e.jsx(o,{className:"bg-red-100 text-red-800 hover:bg-red-100",children:"Critical"});default:return e.jsx(o,{variant:"secondary",children:r})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(E,{className:"w-8 h-8 text-red-600"}),"Tire Management"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage tire inventory and vehicle tire tracking"})]}),e.jsxs(Y,{open:w,onOpenChange:p,children:[e.jsx(Z,{asChild:!0,children:e.jsxs(b,{className:"bg-red-600 hover:bg-red-700",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Add Tire Stock"]})}),e.jsxs(ee,{className:"max-w-md",children:[e.jsx(se,{children:e.jsx(re,{children:"Add Tire Stock"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"brand",children:"Brand"}),e.jsx(g,{id:"brand",placeholder:"e.g., Michelin"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"model",children:"Model"}),e.jsx(g,{id:"model",placeholder:"e.g., XZE"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"size",children:"Size"}),e.jsx(g,{id:"size",placeholder:"e.g., 295/80R22.5"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"type",children:"Type"}),e.jsxs(D,{children:[e.jsx(I,{children:e.jsx(z,{placeholder:"Select tire type"})}),e.jsxs(L,{children:[e.jsx(d,{value:"steer",children:"Steer"}),e.jsx(d,{value:"drive",children:"Drive"}),e.jsx(d,{value:"trailer",children:"Trailer"}),e.jsx(d,{value:"all_position",children:"All Position"})]})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"quantity",children:"Quantity"}),e.jsx(g,{id:"quantity",type:"number",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"cost",children:"Cost Per Tire"}),e.jsx(g,{id:"cost",type:"number",step:"0.01",placeholder:"0.00"})]}),e.jsx(b,{className:"w-full bg-red-600 hover:bg-red-700",children:"Add to Inventory"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(j,{children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Stock"}),e.jsx("p",{className:"text-2xl font-bold",children:x.total_inventory})]})]})})}),e.jsx(j,{children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ae,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Low Stock Items"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:x.low_stock_items})]})]})})}),e.jsx(j,{children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{className:"w-8 h-8 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Due for Replacement"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:x.tires_due_inspection})]})]})})}),e.jsx(j,{children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Monthly Cost"}),e.jsxs("p",{className:"text-2xl font-bold",children:["£",x.total_stock_value.toLocaleString()]})]})]})})})]}),e.jsxs(ne,{defaultValue:"inventory",className:"space-y-6",children:[e.jsxs(ie,{className:"grid w-full grid-cols-3",children:[e.jsx(R,{value:"inventory",children:"Inventory Management"}),e.jsx(R,{value:"vehicle-tires",children:"Vehicle Tires"}),e.jsx(R,{value:"maintenance",children:"Tire Maintenance"})]}),e.jsx(F,{value:"inventory",className:"space-y-4",children:e.jsxs(j,{children:[e.jsxs(M,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),"Tire Inventory"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(g,{placeholder:"Search tires...",value:s,onChange:r=>l(r.target.value),className:"pl-10"})]}),e.jsxs(D,{children:[e.jsx(I,{className:"w-48",children:e.jsx(z,{placeholder:"Filter by type"})}),e.jsxs(L,{children:[e.jsx(d,{value:"all",children:"All Types"}),e.jsx(d,{value:"steer",children:"Steer Tires"}),e.jsx(d,{value:"drive",children:"Drive Tires"}),e.jsx(d,{value:"trailer",children:"Trailer Tires"})]})]})]})]}),e.jsx(m,{children:e.jsxs(H,{children:[e.jsx(Q,{children:e.jsxs(f,{children:[e.jsx(t,{children:"Brand & Model"}),e.jsx(t,{children:"Size"}),e.jsx(t,{children:"Type"}),e.jsx(t,{children:"Stock"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Cost/Unit"}),e.jsx(t,{children:"Supplier"}),e.jsx(t,{children:"Location"})]})}),e.jsx(G,{children:c.map(r=>e.jsxs(f,{children:[e.jsxs(n,{className:"font-medium",children:[r.brand," ",r.model]}),e.jsx(n,{children:r.size}),e.jsx(n,{className:"capitalize",children:r.type}),e.jsxs(n,{children:[r.stockQuantity," / ",r.minimumStock," min"]}),e.jsx(n,{children:X(y(r.stockQuantity,r.minimumStock))}),e.jsxs(n,{children:["£",r.costPerTire.toFixed(2)]}),e.jsx(n,{children:r.supplier}),e.jsx(n,{children:r.location})]},r.id))})]})})]})}),e.jsx(F,{value:"vehicle-tires",className:"space-y-4",children:e.jsxs(j,{children:[e.jsxs(M,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"Vehicle Tire Tracking"]}),e.jsx("div",{className:"flex gap-4",children:e.jsxs(D,{value:v,onValueChange:T,children:[e.jsx(I,{className:"w-48",children:e.jsx(z,{placeholder:"Filter by vehicle"})}),e.jsxs(L,{children:[e.jsx(d,{value:"all",children:"All Vehicles"}),e.jsx(d,{value:"LSR-001",children:"LSR-001"}),e.jsx(d,{value:"LSR-002",children:"LSR-002"}),e.jsx(d,{value:"LSR-003",children:"LSR-003"})]})]})})]}),e.jsx(m,{children:e.jsxs(H,{children:[e.jsx(Q,{children:e.jsxs(f,{children:[e.jsx(t,{children:"Vehicle"}),e.jsx(t,{children:"Position"}),e.jsx(t,{children:"Tire Model"}),e.jsx(t,{children:"Installation Date"}),e.jsx(t,{children:"Tread Depth (mm)"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Next Inspection"}),e.jsx(t,{children:"Actions"})]})}),e.jsx(G,{children:k.map(r=>e.jsxs(f,{children:[e.jsx(n,{className:"font-medium",children:r.vehicleNumber}),e.jsx(n,{children:r.position}),e.jsx(n,{children:r.tireModel}),e.jsx(n,{children:r.installationDate}),e.jsx(n,{children:r.currentTread}),e.jsx(n,{children:J(r.status)}),e.jsx(n,{children:r.nextInspection}),e.jsx(n,{children:e.jsxs(b,{variant:"outline",size:"sm",children:[e.jsx(ce,{className:"w-4 h-4 mr-1"}),"Replace"]})})]},r.id))})]})})]})}),e.jsx(F,{value:"maintenance",className:"space-y-4",children:e.jsxs(j,{children:[e.jsx(M,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5"}),"Tire Maintenance Schedule"]})}),e.jsx(m,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(O,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Maintenance Tracking"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Set up automatic reminders for tire rotations, inspections, and replacements."}),e.jsx(b,{className:"bg-red-600 hover:bg-red-700",children:"Configure Maintenance Schedule"})]})})]})})]})]})};export{je as default};
