import{m as b,H as P,J as w,G as L,a2 as S,a1 as te,r as u,j as e,B as m,am as K,e as _,g as y,h as N,k as v,n as C,ak as re,an as R,a4 as Q,a5 as F,a6 as z,a7 as D,q as o,I as k,ab as V,ac as I,ad as O,ae as A,af as h,s as B}from"./main-DVuL102c.js";import{S as g}from"./switch-Ct9qaOvk.js";import{u as ae}from"./useVehicleCheckQuestions-DSkqzrYy.js";import{T as U}from"./trash-2-uDLx8yM9.js";const ce=(s,c,n)=>{const{profile:i}=b();return P({queryKey:["vehicle-check-templates",s,c,n],queryFn:async()=>{if(!(i!=null&&i.organization_id))return[];try{let r=w.from("vehicle_check_templates").select(`
            *,
            created_by_profile:profiles!vehicle_check_templates_created_by_fkey(
              id,
              first_name,
              last_name
            )
          `).eq("organization_id",i.organization_id).order("created_at",{ascending:!1});const{data:l,error:t}=await r;if(t)throw console.error("Error fetching vehicle check templates:",t),t;return l||[]}catch(r){throw console.error("Error in useVehicleCheckTemplates:",r),r}},enabled:!!(i!=null&&i.organization_id),staleTime:5*60*1e3,gcTime:10*60*1e3})},ne=()=>{const{profile:s}=b(),c=L();return S({mutationFn:async n=>{if(!(s!=null&&s.organization_id))throw new Error("Organization ID is required");try{const{data:i,error:r}=await w.from("vehicle_check_templates").insert({...n,organization_id:s.organization_id,created_by:s.id,version:n.version||"1.0",is_active:n.is_active??!0,is_default:n.is_default??!1,required_checks:n.required_checks||0,optional_checks:n.optional_checks||0,safety_critical:n.safety_critical??!1,compliance_required:n.compliance_required??!1,compliance_standards:n.compliance_standards||[]}).select().single();if(r)throw console.error("Error creating vehicle check template:",r),r;return i}catch(i){throw console.error("Error in useCreateVehicleCheckTemplate:",i),i}},onSuccess:()=>{c.invalidateQueries({queryKey:["vehicle-check-templates"]})}})},le=()=>{const{profile:s}=b(),c=L();return S({mutationFn:async({templateId:n,templateData:i})=>{if(!(s!=null&&s.organization_id))throw new Error("Organization ID is required");try{const{data:r,error:l}=await w.from("vehicle_check_templates").update({...i,updated_at:new Date().toISOString()}).eq("id",n).eq("organization_id",s.organization_id).select().single();if(l)throw console.error("Error updating vehicle check template:",l),l;return r}catch(r){throw console.error("Error in useUpdateVehicleCheckTemplate:",r),r}},onSuccess:(n,{templateId:i})=>{c.invalidateQueries({queryKey:["vehicle-check-templates"]}),c.invalidateQueries({queryKey:["vehicle-check-template",i]})}})},de=()=>{const{profile:s}=b(),c=L();return S({mutationFn:async n=>{if(!(s!=null&&s.organization_id))throw new Error("Organization ID is required");try{const{error:i}=await w.from("vehicle_check_templates").delete().eq("id",n).eq("organization_id",s.organization_id);if(i)throw console.error("Error deleting vehicle check template:",i),i;return{success:!0}}catch(i){throw console.error("Error in useDeleteVehicleCheckTemplate:",i),i}},onSuccess:()=>{c.invalidateQueries({queryKey:["vehicle-check-templates"]})}})},oe=s=>{const{profile:c}=b();return P({queryKey:["vehicle-check-template-stats",s],queryFn:async()=>{if(!(c!=null&&c.organization_id))return{total:0,active:0,inactive:0,byCategory:{},defaultTemplates:0};try{const{data:n,error:i}=await w.from("vehicle_check_templates").select("is_active, category, is_default").eq("organization_id",c.organization_id);if(i)throw console.error("Error fetching vehicle check template stats:",i),i;const r=n||[];return{total:r.length,active:r.filter(t=>t.is_active).length,inactive:r.filter(t=>!t.is_active).length,byCategory:r.reduce((t,d)=>(t[d.category]=(t[d.category]||0)+1,t),{}),defaultTemplates:r.filter(t=>t.is_default).length}}catch(n){throw console.error("Error in useVehicleCheckTemplateStats:",n),n}},enabled:!!(c!=null&&c.organization_id),staleTime:10*60*1e3,gcTime:15*60*1e3})};function ve(){const{toast:s}=te(),[c,n]=u.useState(null),[i,r]=u.useState(!1),[l,t]=u.useState(!1),[d,q]=u.useState(null),[T,E]=u.useState(null),{data:$=[],isLoading:H}=ce(),{data:G=[],isLoading:J}=ae(c==null?void 0:c.id),{data:p}=oe(),x=ne(),j=le(),f=de();u.useEffect(()=>{x.isSuccess&&(r(!1),E(null),s({title:"Template Created",description:"Vehicle check template has been created successfully."}))},[x.isSuccess,s]),u.useEffect(()=>{var a;x.isError&&s({title:"Error",description:`Failed to create template: ${(a=x.error)==null?void 0:a.message}`,variant:"destructive"})},[x.isError,x.error,s]),u.useEffect(()=>{j.isSuccess&&(r(!1),E(null),s({title:"Template Updated",description:"Vehicle check template has been updated successfully."}))},[j.isSuccess,s]),u.useEffect(()=>{var a;j.isError&&s({title:"Error",description:`Failed to update template: ${(a=j.error)==null?void 0:a.message}`,variant:"destructive"})},[j.isError,j.error,s]),u.useEffect(()=>{f.isSuccess&&s({title:"Template Deleted",description:"Vehicle check template has been deleted successfully."})},[f.isSuccess,s]),u.useEffect(()=>{var a;f.isError&&s({title:"Error",description:`Failed to delete template: ${(a=f.error)==null?void 0:a.message}`,variant:"destructive"})},[f.isError,f.error,s]);const M=S({mutationFn:async a=>{throw new Error("Vehicle check questions table not yet implemented")},onSuccess:()=>{t(!1),q(null),s({title:"Question Added",description:"Question has been added to the template."})},onError:a=>{s({title:"Error",description:`Failed to add question: ${a.message}`,variant:"destructive"})}}),W=()=>{E(null),r(!0)},Y=a=>{E(a),r(!0)},X=async a=>{confirm("Are you sure you want to delete this template? This action cannot be undone.")&&f.mutate(a)},Z=()=>{q(null),t(!0)},ee=a=>{q(a),t(!0)},se=a=>{s({title:"Question Deleted",description:"The question has been removed from the template."})},ie=a=>{T?j.mutate({templateId:T.id,templateData:a}):x.mutate(a)};return H?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading templates..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Vehicle Check Templates"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage vehicle inspection templates and questions"})]}),e.jsxs(m,{onClick:W,children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"New Template"]})]}),p&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(_,{children:[e.jsx(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(N,{className:"text-sm font-medium",children:"Total Templates"})}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold",children:p.total})})]}),e.jsxs(_,{children:[e.jsx(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(N,{className:"text-sm font-medium",children:"Active Templates"})}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold",children:p.active})})]}),e.jsxs(_,{children:[e.jsx(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(N,{className:"text-sm font-medium",children:"Default Templates"})}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold",children:p.defaultTemplates})})]}),e.jsxs(_,{children:[e.jsx(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(N,{className:"text-sm font-medium",children:"Categories"})}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold",children:Object.keys(p.byCategory).length})})]})]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:$.map(a=>e.jsxs(_,{className:"hover:shadow-md transition-shadow",children:[e.jsxs(y,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{className:"text-lg",children:a.name}),e.jsx(C,{variant:a.is_active?"default":"secondary",children:a.is_active?"Active":"Inactive"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.description}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(C,{variant:"outline",children:a.category}),a.is_default&&e.jsx(C,{variant:"secondary",children:"Default"})]})]}),e.jsxs(v,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Version:"}),e.jsx("span",{className:"font-medium",children:a.version})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Required Checks:"}),e.jsx("span",{className:"font-medium",children:a.required_checks})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Optional Checks:"}),e.jsx("span",{className:"font-medium",children:a.optional_checks})]}),a.estimated_completion_time_minutes&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Est. Time:"}),e.jsxs("span",{className:"font-medium",children:[a.estimated_completion_time_minutes," min"]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>n(a),children:[e.jsx(re,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>Y(a),children:[e.jsx(R,{className:"w-4 h-4 mr-1"}),"Edit"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>X(a.id),disabled:f.isPending,children:[e.jsx(U,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]})]},a.id))}),e.jsx(Q,{open:i,onOpenChange:r,children:e.jsxs(F,{className:"max-w-2xl",children:[e.jsx(z,{children:e.jsx(D,{children:T?"Edit Template":"Create New Template"})}),e.jsx(he,{template:T,onSubmit:ie,isLoading:x.isPending||j.isPending})]})}),c&&e.jsx(Q,{open:!!c,onOpenChange:()=>n(null),children:e.jsxs(F,{className:"max-w-4xl",children:[e.jsx(z,{children:e.jsxs(D,{children:["Template Questions: ",c.name]})}),e.jsx(ue,{template:c,questions:G,isLoading:J,onAddQuestion:Z,onEditQuestion:ee,onDeleteQuestion:se})]})}),e.jsx(Q,{open:l,onOpenChange:t,children:e.jsxs(F,{className:"max-w-2xl",children:[e.jsx(z,{children:e.jsx(D,{children:d?"Edit Question":"Add New Question"})}),e.jsx(me,{question:d,templateId:c==null?void 0:c.id,onSubmit:a=>M.mutate(a),isLoading:M.isPending})]})})]})}function he({template:s,onSubmit:c,isLoading:n}){const[i,r]=u.useState({name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",category:(s==null?void 0:s.category)||"pre_trip",vehicle_types:(s==null?void 0:s.vehicle_types)||[],is_active:(s==null?void 0:s.is_active)??!0,is_default:(s==null?void 0:s.is_default)??!1,safety_critical:(s==null?void 0:s.safety_critical)??!1,compliance_required:(s==null?void 0:s.compliance_required)??!1,required_checks:(s==null?void 0:s.required_checks)||0,optional_checks:(s==null?void 0:s.optional_checks)||0,estimated_completion_time_minutes:(s==null?void 0:s.estimated_completion_time_minutes)||0,compliance_standards:(s==null?void 0:s.compliance_standards)||[]}),l=t=>{t.preventDefault(),c(i)};return e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"name",children:"Template Name"}),e.jsx(k,{id:"name",value:i.name,onChange:t=>r({...i,name:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"category",children:"Category"}),e.jsxs(V,{value:i.category,onValueChange:t=>r({...i,category:t}),children:[e.jsx(I,{children:e.jsx(O,{})}),e.jsxs(A,{children:[e.jsx(h,{value:"pre_trip",children:"Pre-Trip"}),e.jsx(h,{value:"post_trip",children:"Post-Trip"}),e.jsx(h,{value:"weekly",children:"Weekly"}),e.jsx(h,{value:"monthly",children:"Monthly"}),e.jsx(h,{value:"custom",children:"Custom"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"description",children:"Description"}),e.jsx(B,{id:"description",value:i.description,onChange:t=>r({...i,description:t.target.value}),rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"required_checks",children:"Required Checks"}),e.jsx(k,{id:"required_checks",type:"number",value:i.required_checks,onChange:t=>r({...i,required_checks:parseInt(t.target.value)||0}),min:"0"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"optional_checks",children:"Optional Checks"}),e.jsx(k,{id:"optional_checks",type:"number",value:i.optional_checks,onChange:t=>r({...i,optional_checks:parseInt(t.target.value)||0}),min:"0"})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"estimated_time",children:"Estimated Completion Time (minutes)"}),e.jsx(k,{id:"estimated_time",type:"number",value:i.estimated_completion_time_minutes,onChange:t=>r({...i,estimated_completion_time_minutes:parseInt(t.target.value)||0}),min:"0"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{id:"is_active",checked:i.is_active,onCheckedChange:t=>r({...i,is_active:t})}),e.jsx(o,{htmlFor:"is_active",children:"Active"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{id:"is_default",checked:i.is_default,onCheckedChange:t=>r({...i,is_default:t})}),e.jsx(o,{htmlFor:"is_default",children:"Default Template"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{id:"safety_critical",checked:i.safety_critical,onCheckedChange:t=>r({...i,safety_critical:t})}),e.jsx(o,{htmlFor:"safety_critical",children:"Safety Critical"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{id:"compliance_required",checked:i.compliance_required,onCheckedChange:t=>r({...i,compliance_required:t})}),e.jsx(o,{htmlFor:"compliance_required",children:"Compliance Required"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{type:"button",variant:"outline",children:"Cancel"}),e.jsx(m,{type:"submit",disabled:n,children:n?"Saving...":s?"Update Template":"Create Template"})]})]})}function ue({template:s,questions:c,isLoading:n,onAddQuestion:i,onEditQuestion:r,onDeleteQuestion:l}){return n?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading questions..."})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Questions (",c.length,")"]}),e.jsxs(m,{onClick:i,size:"sm",children:[e.jsx(K,{className:"w-4 h-4 mr-1"}),"Add Question"]})]}),c.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No questions added to this template yet."}),e.jsx(m,{onClick:i,className:"mt-2",children:"Add First Question"})]}):e.jsx("div",{className:"space-y-2",children:c.map(t=>e.jsx(_,{children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium",children:t.question_text}),getQuestionTypeBadge(t.question_type),getCategoryBadge(t.category),t.is_required&&e.jsx(C,{variant:"destructive",children:"Required"}),t.is_critical&&e.jsx(C,{variant:"destructive",children:"Critical"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Order: ",t.order_index," | Type: ",t.question_type]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>r(t),children:e.jsx(R,{className:"w-4 h-4"})}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>l(t.id),children:e.jsx(U,{className:"w-4 h-4"})})]})]})})},t.id))})]})}function me({question:s,templateId:c,onSubmit:n,isLoading:i}){const[r,l]=u.useState({question_text:(s==null?void 0:s.question_text)||"",question_type:(s==null?void 0:s.question_type)||"yes_no",is_required:(s==null?void 0:s.is_required)??!1,is_critical:(s==null?void 0:s.is_critical)??!1,order_index:(s==null?void 0:s.order_index)||1,category:(s==null?void 0:s.category)||"safety",options:(s==null?void 0:s.options)||[]}),t=d=>{d.preventDefault(),c&&n({...r,template_id:c})};return e.jsxs("form",{onSubmit:t,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"question_text",children:"Question Text"}),e.jsx(B,{id:"question_text",value:r.question_text,onChange:d=>l({...r,question_text:d.target.value}),required:!0,rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"question_type",children:"Question Type"}),e.jsxs(V,{value:r.question_type,onValueChange:d=>l({...r,question_type:d}),children:[e.jsx(I,{children:e.jsx(O,{})}),e.jsxs(A,{children:[e.jsx(h,{value:"yes_no",children:"Yes/No"}),e.jsx(h,{value:"multiple_choice",children:"Multiple Choice"}),e.jsx(h,{value:"text",children:"Text"}),e.jsx(h,{value:"number",children:"Number"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"category",children:"Category"}),e.jsxs(V,{value:r.category,onValueChange:d=>l({...r,category:d}),children:[e.jsx(I,{children:e.jsx(O,{})}),e.jsxs(A,{children:[e.jsx(h,{value:"exterior",children:"Exterior"}),e.jsx(h,{value:"interior",children:"Interior"}),e.jsx(h,{value:"engine",children:"Engine"}),e.jsx(h,{value:"safety",children:"Safety"}),e.jsx(h,{value:"documentation",children:"Documentation"}),e.jsx(h,{value:"driver",children:"Driver"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"order_index",children:"Order Index"}),e.jsx(k,{id:"order_index",type:"number",value:r.order_index,onChange:d=>l({...r,order_index:parseInt(d.target.value)||1}),min:"1"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{id:"is_required",checked:r.is_required,onCheckedChange:d=>l({...r,is_required:d})}),e.jsx(o,{htmlFor:"is_required",children:"Required"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{id:"is_critical",checked:r.is_critical,onCheckedChange:d=>l({...r,is_critical:d})}),e.jsx(o,{htmlFor:"is_critical",children:"Critical"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{type:"button",variant:"outline",children:"Cancel"}),e.jsx(m,{type:"submit",disabled:i||!c,children:i?"Saving...":s?"Update Question":"Add Question"})]})]})}export{ve as default};
