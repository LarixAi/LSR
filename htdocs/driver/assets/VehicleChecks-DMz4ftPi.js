import{m as Q,a1 as W,u as Y,x as J,r as y,ax as h,j as e,B as n,aq as K,D as S,am as X,e as c,g as u,h as j,ag as b,k as x,C as Z,E as ee,d as se,O as ae,Q as te,V as T,Y as D,S as V,i as k,q as L,au as le,I as ne,ab as ie,ac as re,ad as ce,ae as de,af as g,n as t,ak as E,an as M}from"./main-DVuL102c.js";import{T as xe,a as me,b as v,c as m,d as oe,e as i}from"./table-Jjtal2IW.js";import{u as he}from"./useVehicleChecks-MvDiEMLI.js";import{u as ue}from"./useVehicles-DG5ys_xt.js";const ge=()=>{Q();const{toast:f}=W(),A=Y();J();const[P,w]=y.useState("new-check"),[o,F]=y.useState(""),[p,z]=y.useState("all"),{data:H=[],isLoading:l,refetch:I}=he(),{data:B=[],isLoading:C,refetch:R}=ue(),r=H.map(s=>{const a=B.find(O=>O.id===s.vehicle_id),d=s.driver_profile;return{id:s.id,vehicle_id:s.vehicle_id||"",vehicle_number:(a==null?void 0:a.vehicle_number)||"Unknown",license_plate:(a==null?void 0:a.license_plate)||"Unknown",check_date:s.created_at?h(new Date(s.created_at),"yyyy-MM-dd"):"",status:s.status||"pending",issues_found:Array.isArray(s.defects_found)?s.defects_found:Array.isArray(s.issues_found)?s.issues_found:[],notes:s.notes||"",created_at:s.created_at||"",driver_name:d?`${d.first_name} ${d.last_name}`:"Unknown Driver",check_type:s.check_type||"daily"}}),N=r.filter(s=>{const a=s.vehicle_number.toLowerCase().includes(o.toLowerCase())||s.license_plate.toLowerCase().includes(o.toLowerCase())||s.driver_name.toLowerCase().includes(o.toLowerCase()),d=p==="all"||s.status===p;return a&&d}),_=s=>{switch(s){case"completed":return e.jsx(t,{variant:"default",className:"bg-green-100 text-green-800",children:"Completed"});case"pending":return e.jsx(t,{variant:"secondary",children:"Pending"});case"failed":return e.jsx(t,{variant:"destructive",children:"Failed"});default:return e.jsx(t,{variant:"outline",children:s})}},q=s=>{switch(s){case"daily":return e.jsx(t,{variant:"outline",className:"text-blue-600",children:"Daily"});case"weekly":return e.jsx(t,{variant:"outline",className:"text-purple-600",children:"Weekly"});case"comprehensive":return e.jsx(t,{variant:"outline",className:"text-orange-600",children:"Comprehensive"});default:return e.jsx(t,{variant:"outline",children:s})}},U=()=>{w("new-check"),f({title:"New Vehicle Check",description:"Starting new vehicle inspection..."})},$=()=>{const s=N.map(a=>({"Vehicle Number":a.vehicle_number,"License Plate":a.license_plate,Date:a.check_date,Status:a.status,Type:a.check_type,Driver:a.driver_name,Issues:a.issues_found.join(", "),Notes:a.notes}));console.log("Exporting data:",s),f({title:"Export Successful",description:"Vehicle check data exported to CSV"})},G=async()=>{try{await Promise.all([I(),R()]),f({title:"Data Refreshed",description:"Vehicle checks and vehicles data updated"})}catch{f({title:"Refresh Failed",description:"Failed to refresh data. Please try again.",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsxs("div",{className:"flex flex-col space-y-3 sm:flex-row sm:items-center sm:justify-between sm:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight sm:text-3xl",children:"Vehicle Checks"}),e.jsx("p",{className:"text-sm text-muted-foreground sm:text-base",children:"Daily vehicle inspections and safety checks"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(n,{onClick:G,variant:"outline",size:"sm",className:"text-xs sm:text-sm",disabled:l||C,children:[e.jsx(K,{className:`w-4 h-4 mr-1 sm:mr-2 ${l||C?"animate-spin":""}`}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"}),e.jsx("span",{className:"sm:hidden",children:"Sync"})]}),e.jsxs(n,{onClick:$,variant:"outline",size:"sm",className:"text-xs sm:text-sm",children:[e.jsx(S,{className:"w-4 h-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Export"}),e.jsx("span",{className:"sm:hidden",children:"Save"})]}),e.jsxs(n,{onClick:U,className:"text-xs sm:text-sm",children:[e.jsx(X,{className:"w-4 h-4 mr-1 sm:mr-2"}),"New Check"]})]})]}),e.jsxs("div",{className:"grid gap-3 grid-cols-2 sm:gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(c,{className:"mobile-card",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-xs font-medium sm:text-sm",children:"Total Checks"}),e.jsx(b,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[l?e.jsx("div",{className:"text-2xl font-bold text-muted-foreground",children:"..."}):e.jsx("div",{className:"text-xl font-bold sm:text-2xl",children:r.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This month"})]})]}),e.jsxs(c,{className:"mobile-card",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-xs font-medium sm:text-sm",children:"Completed"}),e.jsx(Z,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(x,{children:[l?e.jsx("div",{className:"text-2xl font-bold text-muted-foreground",children:"..."}):e.jsx("div",{className:"text-xl font-bold text-green-600 sm:text-2xl",children:r.filter(s=>s.status==="completed").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Passed inspections"})]})]}),e.jsxs(c,{className:"mobile-card",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-xs font-medium sm:text-sm",children:"Issues Found"}),e.jsx(ee,{className:"h-4 w-4 text-orange-600"})]}),e.jsxs(x,{children:[l?e.jsx("div",{className:"text-2xl font-bold text-muted-foreground",children:"..."}):e.jsx("div",{className:"text-xl font-bold text-orange-600 sm:text-2xl",children:r.reduce((s,a)=>s+a.issues_found.length,0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total issues reported"})]})]}),e.jsxs(c,{className:"mobile-card",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-xs font-medium sm:text-sm",children:"Last Check"}),e.jsx(se,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[l?e.jsx("div",{className:"text-2xl font-bold text-muted-foreground",children:"..."}):e.jsx("div",{className:"text-xl font-bold sm:text-2xl",children:r.length>0?h(new Date(r[0].created_at),"MMM dd"):"N/A"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l?"":r.length>0?h(new Date(r[0].created_at),"HH:mm"):""})]})]})]}),e.jsxs(ae,{value:P,onValueChange:w,className:"space-y-4",children:[e.jsxs(te,{className:"grid w-full grid-cols-2",children:[e.jsx(T,{value:"new-check",className:"text-xs sm:text-sm",children:"New Check"}),e.jsx(T,{value:"history",className:"text-xs sm:text-sm",children:"History"})]}),e.jsx(D,{value:"new-check",className:"space-y-4",children:e.jsxs(c,{className:"mobile-card",children:[e.jsxs(u,{children:[e.jsxs(j,{className:"flex items-center space-x-2",children:[e.jsx(V,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-lg sm:text-xl",children:"Enhanced Vehicle Check"})]}),e.jsx(k,{className:"text-sm",children:"Complete vehicle inspection with GPS tracking, photo capture, and unique reference numbers"})]}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 sm:p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2 text-sm sm:text-base",children:"Enhanced Features"}),e.jsxs("ul",{className:"text-blue-700 space-y-1 text-xs sm:text-sm",children:[e.jsx("li",{children:"• GPS tracking during inspection"}),e.jsx("li",{children:"• Photo capture of registration plate"}),e.jsx("li",{children:"• Unique reference numbers for each check"}),e.jsx("li",{children:"• Digital signature capture"}),e.jsx("li",{children:"• Comprehensive reporting"}),e.jsx("li",{children:"• Admin-managed question templates"})]})]}),e.jsxs(n,{className:"w-full mobile-button",onClick:()=>A("/driver/enhanced-vehicle-check"),size:"lg",children:[e.jsx(V,{className:"w-5 h-5 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Start Enhanced Vehicle Check"}),e.jsx("span",{className:"sm:hidden",children:"Start Vehicle Check"})]})]})]})}),e.jsxs(D,{value:"history",className:"space-y-4",children:[e.jsxs(c,{className:"mobile-card",children:[e.jsxs(u,{children:[e.jsx(j,{className:"text-lg sm:text-xl",children:"Check History"}),e.jsx(k,{className:"text-sm",children:"View and manage your vehicle inspection history"})]}),e.jsx(x,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(L,{htmlFor:"search",className:"text-sm",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(ne,{id:"search",placeholder:"Search by vehicle number or license plate...",value:o,onChange:s=>F(s.target.value),className:"pl-8 text-sm"})]})]}),e.jsxs("div",{className:"w-full sm:w-48",children:[e.jsx(L,{htmlFor:"status",className:"text-sm",children:"Status"}),e.jsxs(ie,{value:p,onValueChange:z,children:[e.jsx(re,{className:"text-sm",children:e.jsx(ce,{})}),e.jsxs(de,{children:[e.jsx(g,{value:"all",children:"All Status"}),e.jsx(g,{value:"completed",children:"Completed"}),e.jsx(g,{value:"pending",children:"Pending"}),e.jsx(g,{value:"failed",children:"Failed"})]})]})]})]})})]}),e.jsx(c,{className:"mobile-card",children:e.jsxs(x,{className:"p-0",children:[e.jsx("div",{className:"hidden sm:block",children:e.jsxs(xe,{children:[e.jsx(me,{children:e.jsxs(v,{children:[e.jsx(m,{children:"Vehicle"}),e.jsx(m,{children:"Date"}),e.jsx(m,{children:"Type"}),e.jsx(m,{children:"Status"}),e.jsx(m,{children:"Issues"}),e.jsx(m,{children:"Notes"}),e.jsx(m,{className:"text-right",children:"Actions"})]})}),e.jsx(oe,{children:l?e.jsx(v,{children:e.jsx(i,{colSpan:7,className:"text-center py-8",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-muted-foreground",children:"Loading vehicle checks..."})]})})}):N.length===0?e.jsx(v,{children:e.jsx(i,{colSpan:7,className:"text-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(b,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"No vehicle checks found"}),e.jsx("p",{className:"text-muted-foreground",children:o||p!=="all"?"Try adjusting your search or filter criteria":"Start your first vehicle inspection to see it here"})]})})}):N.map(s=>e.jsxs(v,{children:[e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.vehicle_number}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.license_plate})]})}),e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:h(new Date(s.check_date),"MMM dd, yyyy")}),e.jsx("div",{className:"text-sm text-muted-foreground",children:h(new Date(s.created_at),"HH:mm")})]})}),e.jsx(i,{children:q(s.check_type)}),e.jsx(i,{children:_(s.status)}),e.jsx(i,{children:s.issues_found.length>0?e.jsxs("div",{className:"space-y-1",children:[s.issues_found.slice(0,2).map((a,d)=>e.jsx(t,{variant:"outline",className:"text-xs",children:a},d)),s.issues_found.length>2&&e.jsxs(t,{variant:"outline",className:"text-xs",children:["+",s.issues_found.length-2," more"]})]}):e.jsx("span",{className:"text-green-600 text-sm",children:"No issues"})}),e.jsx(i,{children:e.jsx("div",{className:"max-w-xs truncate",children:s.notes||"No notes"})}),e.jsx(i,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(n,{variant:"ghost",size:"sm",children:e.jsx(E,{className:"w-4 h-4"})}),e.jsx(n,{variant:"ghost",size:"sm",children:e.jsx(M,{className:"w-4 h-4"})}),e.jsx(n,{variant:"ghost",size:"sm",children:e.jsx(S,{className:"w-4 h-4"})})]})})]},s.id))})]})}),e.jsx("div",{className:"sm:hidden space-y-3 p-4",children:l?e.jsxs("div",{className:"flex items-center justify-center space-x-2 py-8",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-muted-foreground text-sm",children:"Loading vehicle checks..."})]}):N.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(b,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"No vehicle checks found"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:o||p!=="all"?"Try adjusting your search or filter criteria":"Start your first vehicle inspection to see it here"})]}):N.map(s=>e.jsxs(c,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:s.vehicle_number}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.license_plate})]}),_(s.status)]}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Date:"}),e.jsx("span",{children:h(new Date(s.check_date),"MMM dd, yyyy")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Type:"}),e.jsx("span",{className:"capitalize",children:s.check_type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Issues:"}),e.jsx("span",{children:s.issues_found.length})]}),s.notes&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx("span",{className:"text-muted-foreground",children:"Notes:"}),e.jsx("p",{className:"text-xs mt-1",children:s.notes})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-3 pt-3 border-t",children:[e.jsxs(n,{variant:"outline",size:"sm",className:"text-xs",children:[e.jsx(E,{className:"w-3 h-3 mr-1"}),"View"]}),e.jsxs(n,{variant:"outline",size:"sm",className:"text-xs",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Edit"]})]})]},s.id))})]})})]})]})]})};export{ge as default};
