import{c as Ee,m as xe,H as se,J as w,ao as Ie,G as We,r as g,a2 as Ge,ax as q,a3 as re,j as e,B as S,aP as Ke,e as m,k as x,E as te,g as u,h as j,C as oe,a0 as Se,d as me,M as ke,ag as Pe,aO as ze,F as ae,n as F,W as Ue,D as Ye,b4 as Je,bC as Xe,S as Ve,bD as Ze,bE as es,ap as Me,l as ss,am as ts,I as as,ab as ie,ac as ne,ad as ce,ae as de,af as v,O as ls,Q as rs,V as G,Y as is,f as ns,ak as De,bF as cs,a4 as Le,a5 as Fe,a6 as Ae,a7 as qe,a8 as Te,aA as ds}from"./main-DVuL102c.js";import{C as os}from"./camera-BolLeZZX.js";import{L as ms}from"./lightbulb-BaDmslCX.js";import{C as xs}from"./calendar-days-Bkcdzd58.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=Ee("OctagonAlert",[["path",{d:"M12 16h.01",key:"1drbdi"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M15.312 2a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586l-4.688-4.688A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2z",key:"1fd625"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=Ee("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]),js=(l,k)=>{const{profile:n}=xe(),{data:$=[],isLoading:T,error:b}=se({queryKey:["enhanced-vehicle-inspections",l,k],queryFn:async()=>{if(!l)return[];try{let t=w.from("vehicle_inspections").select("*").order("created_at",{ascending:!1});k&&(t=t.eq("driver_id",k));const{data:o,error:c}=await t;if(c)return console.error("Error fetching vehicle inspections:",c),[];if(!o||o.length===0)return[];const a=[...new Set(o.map(r=>r.vehicle_id).filter(Boolean))],f=[...new Set(o.map(r=>r.driver_id).filter(Boolean))],p=[...new Set(o.map(r=>r.schedule_id).filter(Boolean))],[N,O,M]=await Promise.all([a.length>0?w.from("vehicles").select("id, vehicle_number, make, model, license_plate").in("id",a).eq("organization_id",l):{data:[]},f.length>0?w.from("profiles").select("id, first_name, last_name").in("id",f).eq("organization_id",l):{data:[]},p.length>0?w.from("inspection_schedules").select("id, scheduled_date, status").in("id",p):{data:[]}]),I=new Map((N.data||[]).map(r=>[r.id,r])),H=new Map((O.data||[]).map(r=>[r.id,r])),P=new Map((M.data||[]).map(r=>[r.id,r]));return o.map(r=>({...r,vehicle:I.get(r.vehicle_id),driver:H.get(r.driver_id),schedule:P.get(r.schedule_id)}))}catch(t){return console.error("Error in vehicle inspections query:",t),[]}},enabled:!!l&&!!(n!=null&&n.id)}),{data:B=[]}=se({queryKey:["inspection-schedules",l,k],queryFn:async()=>{if(!l)return[];try{let t=w.from("inspection_schedules").select("*").order("scheduled_date",{ascending:!0});k&&(t=t.eq("assigned_driver_id",k));const{data:o,error:c}=await t;if(c)return console.error("Error fetching inspection schedules:",c),[];if(!o||o.length===0)return[];const a=[...new Set(o.map(r=>r.vehicle_id).filter(Boolean))],f=[...new Set(o.map(r=>r.assigned_driver_id).filter(Boolean))],p=[...new Set(o.map(r=>r.template_id).filter(Boolean))],[N,O,M]=await Promise.all([a.length>0?w.from("vehicles").select("id, vehicle_number, make, model, license_plate").in("id",a).eq("organization_id",l):{data:[]},f.length>0?w.from("profiles").select("id, first_name, last_name").in("id",f).eq("organization_id",l):{data:[]},p.length>0?w.from("inspection_templates").select("id, name, description, inspection_type, frequency_days").in("id",p):{data:[]}]),I=new Map((N.data||[]).map(r=>[r.id,r])),H=new Map((O.data||[]).map(r=>[r.id,r])),P=new Map((M.data||[]).map(r=>[r.id,r]));return o.map(r=>({...r,vehicle:I.get(r.vehicle_id),driver:H.get(r.assigned_driver_id),template:P.get(r.template_id)}))}catch(t){return console.error("Error in inspection schedules query:",t),[]}},enabled:!!l&&!!(n!=null&&n.id)}),{data:y=[]}=se({queryKey:["inspection-templates",l],queryFn:async()=>{if(!l)return[];try{const{data:t,error:o}=await w.from("inspection_templates").select("*").eq("organization_id",l).eq("is_active",!0).order("frequency_days",{ascending:!0});return o?(console.error("Error fetching inspection templates:",o),[]):t||[]}catch(t){return console.error("Error in inspection templates query:",t),[]}},enabled:!!l&&!!(n!=null&&n.id)}),{data:E}=se({queryKey:["enhanced-inspection-stats",l,k],queryFn:async()=>{if(!l)return null;try{const[t,o]=await Promise.all([w.from("vehicle_inspections").select("overall_status, inspection_category, inspection_type, defects_found, created_at").eq("organization_id",l).then(a=>a.data||[]),w.from("inspection_schedules").select("scheduled_date, status").eq("organization_id",l).then(a=>a.data||[])]);return{total:t.length,byStatus:{pending:t.filter(a=>a.overall_status==="pending").length,passed:t.filter(a=>a.overall_status==="passed").length,flagged:t.filter(a=>a.overall_status==="flagged").length,failed:t.filter(a=>a.overall_status==="failed").length},byCategory:{daily:t.filter(a=>a.inspection_category==="daily").length,weekly:t.filter(a=>a.inspection_category==="weekly").length,"4_weekly":t.filter(a=>a.inspection_category==="4_weekly").length,"6_weekly":t.filter(a=>a.inspection_category==="6_weekly").length,pre_trip:t.filter(a=>a.inspection_category==="pre_trip").length,post_trip:t.filter(a=>a.inspection_category==="post_trip").length,breakdown:t.filter(a=>a.inspection_category==="breakdown").length},byType:{daily_check:t.filter(a=>a.inspection_type==="daily_check").length,weekly:t.filter(a=>a.inspection_type==="weekly").length,"4_weekly":t.filter(a=>a.inspection_type==="4_weekly").length,"6_weekly":t.filter(a=>a.inspection_type==="6_weekly").length,pre_trip:t.filter(a=>a.inspection_type==="pre_trip").length,post_trip:t.filter(a=>a.inspection_type==="post_trip").length,breakdown:t.filter(a=>a.inspection_type==="breakdown").length},defectsFound:t.filter(a=>a.defects_found).length,recentInspections:t.filter(a=>{const f=new Date(a.created_at),p=new Date;return p.setDate(p.getDate()-7),f>=p}).length,upcomingSchedules:o.filter(a=>{const f=new Date(a.scheduled_date),p=new Date,N=new Date;return N.setDate(N.getDate()+7),f>=p&&f<=N&&a.status==="scheduled"}).length,overdueSchedules:o.filter(a=>new Date(a.scheduled_date)<new Date&&a.status==="scheduled").length}}catch(t){return console.error("Error fetching enhanced inspection stats:",t),null}},enabled:!!l&&!!(n!=null&&n.id)});return{inspections:$,schedules:B,templates:y,inspectionStats:E,isLoading:T,error:b}},ps=({inspection:l,onClose:k})=>{var R,le;const{profile:n}=xe(),{selectedOrganizationId:$}=Ie(),T=We(),[b,B]=g.useState([]),[y,E]=g.useState(null),[t,o]=g.useState(null),[c,a]=g.useState(null),[f,p]=g.useState(!0),[N,O]=g.useState(!1);g.useEffect(()=>{(async()=>{try{if(l.walkaround_data){const d=l.walkaround_data;d.questions&&B(d.questions)}if(l.location_data){const d=l.location_data;E({latitude:d.latitude,longitude:d.longitude,accuracy:d.accuracy||0,timestamp:d.timestamp||l.start_time,address:d.address})}if(l.vehicle_id){const{data:d}=await w.from("vehicles").select("*").eq("id",l.vehicle_id).single();d&&o(d)}if(l.driver_id){const{data:d}=await w.from("profiles").select("*").eq("id",l.driver_id).single();d&&a(d)}}catch(d){console.error("Error fetching inspection details:",d),re.error("Failed to load inspection details")}finally{p(!1)}})()},[l]);const M=Ge({mutationFn:async()=>{if(!$)throw new Error("No organization selected");const i={title:"ðŸš¨ Failed Vehicle Inspection Alert",body:`Vehicle ${t==null?void 0:t.vehicle_number} (${t==null?void 0:t.license_plate}) failed inspection on ${q(new Date(l.inspection_date),"MMM dd, yyyy")}. Driver: ${c==null?void 0:c.first_name} ${c==null?void 0:c.last_name}. Inspection type: ${l.inspection_category.replace("_"," ")}.`,type:"error",priority:"high",category:"safety",channels:["in_app","email"],metadata:{inspection_id:l.id,vehicle_id:l.vehicle_id,driver_id:l.driver_id,failed_questions:b.filter(W=>W.answer==="fail").length,total_questions:b.length},organization_id:$,sender_id:n==null?void 0:n.id,sender_name:`${n==null?void 0:n.first_name} ${n==null?void 0:n.last_name}`,sender_role:(n==null?void 0:n.role)||"user",recipient_role:"admin"},{error:d}=await w.from("notification_messages").insert(i);if(d)throw d;return!0},onSuccess:()=>{re.success("Alert sent to admin and mechanics"),T.invalidateQueries({queryKey:["notifications"]})},onError:i=>{re.error(`Failed to send alert: ${i.message}`)}}),I=i=>{switch(i.toLowerCase()){case"engine":return e.jsx(es,{className:"w-4 h-4"});case"tires":return e.jsx(Ze,{className:"w-4 h-4"});case"lights":return e.jsx(ms,{className:"w-4 h-4"});case"brakes":return e.jsx(Ve,{className:"w-4 h-4"});case"fuel":return e.jsx(Xe,{className:"w-4 h-4"});case"temperature":return e.jsx(us,{className:"w-4 h-4"});case"navigation":return e.jsx(Je,{className:"w-4 h-4"});default:return e.jsx(ae,{className:"w-4 h-4"})}},H=i=>{switch(i){case"pass":return e.jsxs(F,{className:"bg-green-100 text-green-800 border-green-200",children:[e.jsx(oe,{className:"w-3 h-3 mr-1"}),"Pass"]});case"fail":return e.jsxs(F,{className:"bg-red-100 text-red-800 border-red-200",children:[e.jsx(Se,{className:"w-3 h-3 mr-1"}),"Fail"]});case"na":return e.jsx(F,{className:"bg-gray-100 text-gray-800 border-gray-200",children:"N/A"});default:return e.jsx(F,{variant:"secondary",children:i})}},P=i=>{switch(i.toLowerCase()){case"engine":return"text-orange-600 bg-orange-50";case"tires":return"text-blue-600 bg-blue-50";case"lights":return"text-yellow-600 bg-yellow-50";case"brakes":return"text-red-600 bg-red-50";case"fuel":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}},Q=b.filter(i=>i.answer==="fail"),r=b.filter(i=>i.answer==="pass");return b.filter(i=>i.answer==="na"),f?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading inspection details..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Inspection Details"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[t==null?void 0:t.vehicle_number," - ",t==null?void 0:t.make," ",t==null?void 0:t.model]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[l.overall_status==="failed"&&e.jsxs(S,{variant:"destructive",size:"sm",onClick:()=>M.mutate(),disabled:M.isPending,children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),M.isPending?"Sending...":"Alert Admin & Mechanics"]}),e.jsx(S,{variant:"outline",size:"sm",onClick:k,children:"Close"})]})]}),l.overall_status==="failed"&&e.jsx(m,{className:"border-red-200 bg-red-50",children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(te,{className:"h-6 w-6 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-red-900",children:"Failed Inspection Alert"}),e.jsxs("p",{className:"text-red-700 text-sm",children:["This vehicle failed ",Q.length," out of ",b.length," inspection checks. Immediate attention required by admin and mechanics."]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(m,{children:[e.jsx(u,{className:"pb-2",children:e.jsxs(j,{className:"text-sm font-medium flex items-center",children:[e.jsx(oe,{className:"w-4 h-4 text-green-600 mr-2"}),"Passed"]})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.length}),e.jsx("p",{className:"text-xs text-gray-600",children:"Checks passed"})]})]}),e.jsxs(m,{children:[e.jsx(u,{className:"pb-2",children:e.jsxs(j,{className:"text-sm font-medium flex items-center",children:[e.jsx(Se,{className:"w-4 h-4 text-red-600 mr-2"}),"Failed"]})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:Q.length}),e.jsx("p",{className:"text-xs text-gray-600",children:"Checks failed"})]})]}),e.jsxs(m,{children:[e.jsx(u,{className:"pb-2",children:e.jsxs(j,{className:"text-sm font-medium flex items-center",children:[e.jsx(me,{className:"w-4 h-4 text-gray-600 mr-2"}),"Duration"]})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l.start_time&&l.end_time?Math.round((new Date(l.end_time).getTime()-new Date(l.start_time).getTime())/6e4):"N/A"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Minutes"})]})]}),e.jsxs(m,{children:[e.jsx(u,{className:"pb-2",children:e.jsxs(j,{className:"text-sm font-medium flex items-center",children:[e.jsx(ke,{className:"w-4 h-4 text-blue-600 mr-2"}),"Location"]})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-sm font-medium",children:y?`${y.latitude.toFixed(4)}, ${y.longitude.toFixed(4)}`:"N/A"}),e.jsx("p",{className:"text-xs text-gray-600",children:"GPS Coordinates"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(m,{children:[e.jsx(u,{children:e.jsxs(j,{className:"flex items-center",children:[e.jsx(Pe,{className:"w-5 h-5 mr-2"}),"Vehicle Information"]})}),e.jsx(x,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Vehicle Number:"}),e.jsx("p",{className:"text-gray-600",children:t==null?void 0:t.vehicle_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"License Plate:"}),e.jsx("p",{className:"text-gray-600",children:t==null?void 0:t.license_plate})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Make/Model:"}),e.jsxs("p",{className:"text-gray-600",children:[t==null?void 0:t.make," ",t==null?void 0:t.model]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Year:"}),e.jsx("p",{className:"text-gray-600",children:(t==null?void 0:t.year)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"VIN:"}),e.jsx("p",{className:"text-gray-600",children:(t==null?void 0:t.vin)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Fuel Type:"}),e.jsx("p",{className:"text-gray-600",children:(t==null?void 0:t.fuel_type)||"N/A"})]})]})})]}),e.jsxs(m,{children:[e.jsx(u,{children:e.jsxs(j,{className:"flex items-center",children:[e.jsx(ze,{className:"w-5 h-5 mr-2"}),"Driver Information"]})}),e.jsx(x,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Name:"}),e.jsxs("p",{className:"text-gray-600",children:[c==null?void 0:c.first_name," ",c==null?void 0:c.last_name]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Email:"}),e.jsx("p",{className:"text-gray-600",children:c==null?void 0:c.email})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Phone:"}),e.jsx("p",{className:"text-gray-600",children:(c==null?void 0:c.phone)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"License:"}),e.jsx("p",{className:"text-gray-600",children:(c==null?void 0:c.license_number)||"N/A"})]})]})})]})]}),y&&e.jsxs(m,{children:[e.jsx(u,{children:e.jsxs(j,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ke,{className:"w-5 h-5 mr-2"}),"Inspection Location"]}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>O(!N),children:N?"Hide Map":"Show Map"})]})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Latitude:"}),e.jsx("p",{className:"text-gray-600",children:y.latitude.toFixed(6)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Longitude:"}),e.jsx("p",{className:"text-gray-600",children:y.longitude.toFixed(6)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Accuracy:"}),e.jsxs("p",{className:"text-gray-600",children:[y.accuracy,"m"]})]})]}),y.address&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Address:"}),e.jsx("p",{className:"text-gray-600",children:y.address})]}),N&&e.jsx("div",{className:"border rounded-lg p-4 bg-gray-50",children:e.jsx("iframe",{width:"100%",height:"300",frameBorder:"0",style:{border:0},src:`https://www.google.com/maps/embed/v1/view?key=YOUR_GOOGLE_MAPS_API_KEY&center=${y.latitude},${y.longitude}&zoom=15`,allowFullScreen:!0})})]})})]}),e.jsxs(m,{children:[e.jsx(u,{children:e.jsxs(j,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{className:"w-5 h-5 mr-2"}),"Inspection Questions & Results"]}),e.jsx(F,{variant:l.overall_status==="failed"?"destructive":"default",children:l.overall_status.toUpperCase()})]})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-4",children:b.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No detailed inspection questions available"}):b.map((i,d)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[I(i.category),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:i.question}),e.jsx(F,{className:`mt-1 ${P(i.category)}`,children:i.category})]})]}),H(i.answer)]}),i.notes&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded",children:e.jsx("p",{className:"text-sm text-gray-700",children:i.notes})}),i.photo_url&&e.jsx("div",{className:"mt-3",children:e.jsxs(S,{variant:"outline",size:"sm",children:[e.jsx(os,{className:"w-4 h-4 mr-2"}),"View Photo"]})}),e.jsxs("div",{className:"mt-3 text-xs text-gray-500",children:["Timestamp: ",q(new Date(i.timestamp),"MMM dd, yyyy HH:mm:ss")]})]},i.id||d))})})]}),l.defects_found&&e.jsxs(m,{className:"border-red-200 bg-red-50",children:[e.jsx(u,{children:e.jsxs(j,{className:"flex items-center text-red-900",children:[e.jsx(te,{className:"w-5 h-5 mr-2"}),"Defects Found"]})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-3",children:[((R=l.defects_details)==null?void 0:R.description)&&e.jsx("p",{className:"text-red-800",children:l.defects_details.description}),((le=l.defects_details)==null?void 0:le.items)&&e.jsx("ul",{className:"list-disc list-inside space-y-1 text-red-800",children:l.defects_details.items.map((i,d)=>e.jsx("li",{children:i},d))}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(S,{variant:"destructive",size:"sm",children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Create Work Order"]}),e.jsxs(S,{variant:"outline",size:"sm",children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),"Export Report"]})]})]})})]}),e.jsxs(m,{children:[e.jsx(u,{children:e.jsxs(j,{className:"flex items-center",children:[e.jsx(me,{className:"w-5 h-5 mr-2"}),"Inspection Metadata"]})}),e.jsx(x,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Inspection Date:"}),e.jsx("p",{className:"text-gray-600",children:q(new Date(l.inspection_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Start Time:"}),e.jsx("p",{className:"text-gray-600",children:q(new Date(l.start_time),"HH:mm:ss")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"End Time:"}),e.jsx("p",{className:"text-gray-600",children:l.end_time?q(new Date(l.end_time),"HH:mm:ss"):"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Inspection Type:"}),e.jsx("p",{className:"text-gray-600",children:l.inspection_category.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Created:"}),e.jsx("p",{className:"text-gray-600",children:q(new Date(l.created_at),"MMM dd, yyyy HH:mm:ss")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Last Updated:"}),e.jsx("p",{className:"text-gray-600",children:q(new Date(l.updated_at),"MMM dd, yyyy HH:mm:ss")})]})]})})]})]})},gs=()=>{var pe,ge,ye,fe,Ne,ve,we,_e,be;const{profile:l}=xe(),{selectedOrganizationId:k}=Ie(),[n,$]=g.useState(""),[T,b]=g.useState("all"),[B,y]=g.useState("all"),[E,t]=g.useState("all"),[o,c]=g.useState(null),[a,f]=g.useState(null),[p,N]=g.useState(!1),[O,M]=g.useState(!1),[I,H]=g.useState("all"),P=(l==null?void 0:l.role)==="driver",Q=P?l==null?void 0:l.id:void 0,{inspections:r,schedules:R,templates:le,inspectionStats:i,isLoading:d,error:W}=js(k,Q),Be=s=>{switch(s){case"passed":return e.jsx(oe,{className:"w-4 h-4 text-green-600"});case"failed":return e.jsx(Me,{className:"w-4 h-4 text-red-600"});case"flagged":return e.jsx(te,{className:"w-4 h-4 text-yellow-600"});default:return e.jsx(me,{className:"w-4 h-4 text-gray-600"})}},Oe=s=>{const h={passed:"bg-green-100 text-green-800 border-green-200",failed:"bg-red-100 text-red-800 border-red-200",flagged:"bg-yellow-100 text-yellow-800 border-yellow-200",pending:"bg-gray-100 text-gray-800 border-gray-200"};return h[s]||h.pending},He=s=>({daily:"bg-blue-100 text-blue-800 border-blue-200",weekly:"bg-purple-100 text-purple-800 border-purple-200","4_weekly":"bg-indigo-100 text-indigo-800 border-indigo-200","6_weekly":"bg-cyan-100 text-cyan-800 border-cyan-200",pre_trip:"bg-orange-100 text-orange-800 border-orange-200",post_trip:"bg-pink-100 text-pink-800 border-pink-200",breakdown:"bg-red-100 text-red-800 border-red-200"})[s]||"bg-gray-100 text-gray-800 border-gray-200",he=s=>{const h={scheduled:"bg-blue-100 text-blue-800 border-blue-200",in_progress:"bg-yellow-100 text-yellow-800 border-yellow-200",completed:"bg-green-100 text-green-800 border-green-200",overdue:"bg-red-100 text-red-800 border-red-200",cancelled:"bg-gray-100 text-gray-800 border-gray-200"};return h[s]||h.scheduled},ue=r.filter(s=>{var D,L,V,K,z,U,Y,J,X,Z,ee,Ce;const h=!n||((L=(D=s.vehicle)==null?void 0:D.vehicle_number)==null?void 0:L.toLowerCase().includes(n.toLowerCase()))||((K=(V=s.vehicle)==null?void 0:V.make)==null?void 0:K.toLowerCase().includes(n.toLowerCase()))||((U=(z=s.vehicle)==null?void 0:z.model)==null?void 0:U.toLowerCase().includes(n.toLowerCase()))||((J=(Y=s.vehicle)==null?void 0:Y.license_plate)==null?void 0:J.toLowerCase().includes(n.toLowerCase()))||((Z=(X=s.driver)==null?void 0:X.first_name)==null?void 0:Z.toLowerCase().includes(n.toLowerCase()))||((Ce=(ee=s.driver)==null?void 0:ee.last_name)==null?void 0:Ce.toLowerCase().includes(n.toLowerCase())),C=T==="all"||s.overall_status===T,_=B==="all"||s.inspection_category===B,A=E==="all"||s.driver_id===E;return h&&C&&_&&A}),je=R.filter(s=>{var A,D,L,V,K,z,U,Y,J,X,Z,ee;const h=!n||((D=(A=s.vehicle)==null?void 0:A.vehicle_number)==null?void 0:D.toLowerCase().includes(n.toLowerCase()))||((V=(L=s.vehicle)==null?void 0:L.make)==null?void 0:V.toLowerCase().includes(n.toLowerCase()))||((z=(K=s.vehicle)==null?void 0:K.model)==null?void 0:z.toLowerCase().includes(n.toLowerCase()))||((Y=(U=s.vehicle)==null?void 0:U.license_plate)==null?void 0:Y.toLowerCase().includes(n.toLowerCase()))||((X=(J=s.driver)==null?void 0:J.first_name)==null?void 0:X.toLowerCase().includes(n.toLowerCase()))||((ee=(Z=s.driver)==null?void 0:Z.last_name)==null?void 0:ee.toLowerCase().includes(n.toLowerCase())),C=T==="all"||s.status===T,_=E==="all"||s.assigned_driver_id===E;return h&&C&&_}),$e=Array.from(new Set([...r.map(s=>s.driver_id),...R.map(s=>s.assigned_driver_id)])).map(s=>{var h,C;return((h=r.find(_=>_.driver_id===s))==null?void 0:h.driver)||((C=R.find(_=>_.assigned_driver_id===s))==null?void 0:C.driver)}).filter(Boolean),Qe=s=>{c(s),N(!0)},Re=s=>{f(s),M(!0)};return W&&((pe=W.message)!=null&&pe.includes("inspection_schedules")||(ge=W.message)!=null&&ge.includes("inspection_templates"))?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ve,{className:"h-16 w-16 text-blue-600 mx-auto mb-6"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Enhanced Vehicle Inspections System"}),e.jsx("p",{className:"text-lg text-gray-600 mb-8",children:"The enhanced vehicle inspections system needs to be set up in your database."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 max-w-2xl mx-auto",children:[e.jsx("h2",{className:"text-xl font-semibold text-blue-900 mb-4",children:"Setup Required"}),e.jsxs("ol",{className:"text-left text-blue-800 space-y-2",children:[e.jsx("li",{children:"1. Go to your Supabase Dashboard"}),e.jsx("li",{children:"2. Open SQL Editor"}),e.jsxs("li",{children:["3. Run the script: ",e.jsx("code",{className:"bg-blue-100 px-2 py-1 rounded",children:"sql/fixes/enhanced_vehicle_inspections_system.sql"})]}),e.jsx("li",{children:"4. Refresh this page"})]}),e.jsx("div",{className:"mt-6",children:e.jsx(S,{onClick:()=>window.open("https://supabase.com/dashboard","_blank"),className:"bg-blue-600 hover:bg-blue-700",children:"Open Supabase Dashboard"})})]})]})}):d?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading inspections..."})]})}):W?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(Me,{className:"h-12 w-12 text-red-500 mx-auto"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Error Loading Inspections"}),e.jsx("p",{className:"text-gray-600",children:"Failed to load vehicle inspections. Please try again."})]})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Vehicle Inspections"}),e.jsx("p",{className:"text-gray-600 mt-2",children:P?"Your vehicle inspection history":"All vehicle inspections and schedules"})]}),!P&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(S,{variant:"outline",onClick:()=>window.location.href="/vehicle-management-settings",children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),"Inspection Settings"]}),e.jsxs(S,{children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Schedule Inspection"]})]})]}),i&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs(m,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium",children:"Total Inspections"}),e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:i.total}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[i.recentInspections," in last 7 days"]})]})]}),e.jsxs(m,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium",children:"Upcoming Schedules"}),e.jsx(xs,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:i.upcomingSchedules}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Next 7 days"})]})]}),e.jsxs(m,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium",children:"Overdue Schedules"}),e.jsx(hs,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:i.overdueSchedules}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Requires attention"})]})]}),e.jsxs(m,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium",children:"Defects Found"}),e.jsx(te,{className:"h-4 w-4 text-yellow-600"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:i.defectsFound}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total issues detected"})]})]})]}),i&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsxs(m,{children:[e.jsx(u,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium",children:"Daily Checks"})}),e.jsx(x,{children:e.jsx("div",{className:"text-xl font-bold",children:i.byCategory.daily})})]}),e.jsxs(m,{children:[e.jsx(u,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium",children:"4-Weekly"})}),e.jsx(x,{children:e.jsx("div",{className:"text-xl font-bold",children:i.byCategory["4_weekly"]})})]}),e.jsxs(m,{children:[e.jsx(u,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium",children:"6-Weekly"})}),e.jsx(x,{children:e.jsx("div",{className:"text-xl font-bold",children:i.byCategory["6_weekly"]})})]}),e.jsxs(m,{children:[e.jsx(u,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium",children:"Pre/Post Trip"})}),e.jsx(x,{children:e.jsx("div",{className:"text-xl font-bold",children:i.byCategory.pre_trip+i.byCategory.post_trip})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx(as,{placeholder:"Search vehicles, drivers, or license plates...",value:n,onChange:s=>$(s.target.value),className:"w-full"})}),e.jsxs(ie,{value:T,onValueChange:b,children:[e.jsx(ne,{className:"w-full sm:w-48",children:e.jsx(ce,{placeholder:"Filter by status"})}),e.jsxs(de,{children:[e.jsx(v,{value:"all",children:"All Statuses"}),e.jsx(v,{value:"pending",children:"Pending"}),e.jsx(v,{value:"passed",children:"Passed"}),e.jsx(v,{value:"flagged",children:"Flagged"}),e.jsx(v,{value:"failed",children:"Failed"})]})]}),e.jsxs(ie,{value:B,onValueChange:y,children:[e.jsx(ne,{className:"w-full sm:w-48",children:e.jsx(ce,{placeholder:"Filter by category"})}),e.jsxs(de,{children:[e.jsx(v,{value:"all",children:"All Categories"}),e.jsx(v,{value:"daily",children:"Daily"}),e.jsx(v,{value:"weekly",children:"Weekly"}),e.jsx(v,{value:"4_weekly",children:"4-Weekly"}),e.jsx(v,{value:"6_weekly",children:"6-Weekly"}),e.jsx(v,{value:"pre_trip",children:"Pre-Trip"}),e.jsx(v,{value:"post_trip",children:"Post-Trip"}),e.jsx(v,{value:"breakdown",children:"Breakdown"})]})]}),e.jsxs(ie,{value:E,onValueChange:t,children:[e.jsx(ne,{className:"w-full sm:w-48",children:e.jsx(ce,{placeholder:"Filter by driver"})}),e.jsxs(de,{children:[e.jsx(v,{value:"all",children:"All Drivers"}),$e.map(s=>e.jsxs(v,{value:(s==null?void 0:s.id)||"",children:[s==null?void 0:s.first_name," ",s==null?void 0:s.last_name]},s==null?void 0:s.id))]})]})]}),e.jsxs(ls,{value:I,onValueChange:H,className:"w-full",children:[e.jsxs(rs,{className:"grid w-full grid-cols-6",children:[e.jsx(G,{value:"all",children:"All"}),e.jsx(G,{value:"pending",children:"Pending"}),e.jsx(G,{value:"passed",children:"Passed"}),e.jsx(G,{value:"flagged",children:"Flagged"}),e.jsx(G,{value:"failed",children:"Failed"}),e.jsx(G,{value:"scheduled",children:"Scheduled"})]}),e.jsx(is,{value:I,className:"mt-6",children:I==="scheduled"?e.jsx("div",{className:"space-y-4",children:je.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ns,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Scheduled Inspections"}),e.jsx("p",{className:"text-gray-600",children:"No inspection schedules found for the selected filters."})]}):je.map(s=>{var h,C,_,A,D,L,V;return e.jsx(m,{className:"hover:shadow-md transition-shadow",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Pe,{className:"h-8 w-8 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold",children:[(h=s.vehicle)==null?void 0:h.vehicle_number," - ",(C=s.vehicle)==null?void 0:C.make," ",(_=s.vehicle)==null?void 0:_.model]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[(A=s.vehicle)==null?void 0:A.license_plate," â€¢ ",(D=s.template)==null?void 0:D.name]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Assigned to: ",(L=s.driver)==null?void 0:L.first_name," ",(V=s.driver)==null?void 0:V.last_name]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium",children:q(new Date(s.scheduled_date),"MMM dd, yyyy")}),e.jsx(F,{className:he(s.status),children:s.status.replace("_"," ")})]}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>Re(s),children:e.jsx(De,{className:"h-4 w-4"})})]})]})})},s.id)})}):e.jsx("div",{className:"space-y-4",children:ue.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ae,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Inspections Found"}),e.jsx("p",{className:"text-gray-600",children:"No inspections found for the selected filters."})]}):ue.map(s=>{var h,C,_,A,D,L;return e.jsx(m,{className:"hover:shadow-md transition-shadow",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(cs,{className:"h-8 w-8 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold",children:[(h=s.vehicle)==null?void 0:h.vehicle_number," - ",(C=s.vehicle)==null?void 0:C.make," ",(_=s.vehicle)==null?void 0:_.model]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsxs(F,{className:Oe(s.overall_status),children:[Be(s.overall_status),s.overall_status]}),s.inspection_category&&e.jsx(F,{className:He(s.inspection_category),children:s.inspection_category.replace("_"," ")})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[(A=s.vehicle)==null?void 0:A.license_plate," â€¢ ",(D=s.driver)==null?void 0:D.first_name," ",(L=s.driver)==null?void 0:L.last_name]}),e.jsx("p",{className:"text-sm text-gray-500",children:q(new Date(s.inspection_date),"MMM dd, yyyy")})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s.defects_found&&e.jsx(F,{variant:"destructive",className:"text-xs",children:"Defects Found"}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>Qe(s),children:e.jsx(De,{className:"h-4 w-4"})})]})]})})},s.id)})})})]}),e.jsx(Le,{open:p,onOpenChange:N,children:e.jsxs(Fe,{className:"max-w-6xl max-h-[90vh] overflow-y-auto","aria-describedby":"inspection-details-description",children:[e.jsxs(Ae,{children:[e.jsx(qe,{children:"Inspection Details"}),e.jsx(Te,{id:"inspection-details-description",children:"View comprehensive inspection information including GPS coordinates, detailed questions, and inspection results."})]}),o&&e.jsx(ps,{inspection:o,onClose:()=>N(!1)})]})}),e.jsx(Le,{open:O,onOpenChange:M,children:e.jsxs(Fe,{className:"max-w-2xl","aria-describedby":"schedule-details-description",children:[e.jsxs(Ae,{children:[e.jsx(qe,{children:"Scheduled Inspection Details"}),e.jsx(Te,{id:"schedule-details-description",children:"View details of scheduled vehicle inspections including vehicle, driver, and inspection type information."})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Vehicle"}),e.jsxs("p",{className:"text-sm",children:[(ye=a.vehicle)==null?void 0:ye.vehicle_number," - ",(fe=a.vehicle)==null?void 0:fe.make," ",(Ne=a.vehicle)==null?void 0:Ne.model]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"License Plate"}),e.jsx("p",{className:"text-sm",children:(ve=a.vehicle)==null?void 0:ve.license_plate})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Assigned Driver"}),e.jsxs("p",{className:"text-sm",children:[(we=a.driver)==null?void 0:we.first_name," ",(_e=a.driver)==null?void 0:_e.last_name]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Scheduled Date"}),e.jsx("p",{className:"text-sm",children:q(new Date(a.scheduled_date),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Inspection Type"}),e.jsx("p",{className:"text-sm",children:(be=a.template)==null?void 0:be.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Status"}),e.jsx(F,{className:he(a.status),children:a.status.replace("_"," ")})]})]}),a.notes&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Notes"}),e.jsx("p",{className:"text-sm mt-1",children:a.notes})]})]}),e.jsx(ds,{children:e.jsx(S,{variant:"outline",onClick:()=>M(!1),children:"Close"})})]})})]})},ws=()=>(console.log("VehicleInspections component is rendering"),e.jsx("div",{children:e.jsx(gs,{})}));export{ws as default};
