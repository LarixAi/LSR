import{H as p,J as c}from"./main-DVuL102c.js";const y=()=>p({queryKey:["compliance-stats"],queryFn:async()=>{let a=0;try{const{count:e}=await c.from("profiles").select("*",{count:"exact",head:!0}).eq("role","driver");a=e||0}catch(e){console.warn("Error fetching drivers for compliance stats:",e)}let i=0;try{const{count:e}=await c.from("vehicles").select("*",{count:"exact",head:!0});i=e||0}catch(e){console.warn("Error fetching vehicles for compliance stats:",e)}const n=0,s=0,o=a>0?95:0;return{totalDrivers:a,totalVehicles:i,activeViolations:n,criticalAlerts:s,overallScore:o,driversCompliant:a,vehiclesCompliant:i}}}),m=()=>p({queryKey:["upcoming-deadlines"],queryFn:async()=>{const a=new Date,i=new Date(a.getTime()+30*24*60*60*1e3),n=[];let s=[];try{const{data:e}=await c.from("driver_licenses").select("*").gte("expiry_date",a.toISOString().split("T")[0]).lte("expiry_date",i.toISOString().split("T")[0]).order("expiry_date",{ascending:!0});if(e&&e.length>0){const r=[...new Set(e.filter(t=>t.driver_id).map(t=>t.driver_id))];let d=[];if(r.length>0){const{data:t}=await c.from("profiles").select("id, first_name, last_name").in("id",r);d=t||[]}const l=new Map(d.map(t=>[t.id,t]));s=e.map(t=>({...t,profiles:t.driver_id&&l.has(t.driver_id)?l.get(t.driver_id):null}))}}catch(e){console.warn("driver_licenses table not found, skipping license deadlines:",e)}let o=[];try{const{data:e}=await c.from("compliance_alerts").select("*").not("due_date","is",null).gte("due_date",a.toISOString().split("T")[0]).lte("due_date",i.toISOString().split("T")[0]).eq("status","active").order("due_date",{ascending:!0});o=e||[]}catch(e){console.warn("compliance_alerts table not found, skipping alert deadlines:",e)}return s==null||s.forEach(e=>{if(e.profiles){const r=Math.ceil((new Date(e.expiry_date).getTime()-a.getTime())/864e5);n.push({type:"Driver License",entity:`${e.profiles.first_name} ${e.profiles.last_name}`,date:e.expiry_date,days:r,severity:r<=7?"critical":r<=14?"high":"medium"})}}),o==null||o.forEach(e=>{const r=Math.ceil((new Date(e.due_date).getTime()-a.getTime())/864e5);n.push({type:e.alert_type.replace("_"," ").replace(/\b\w/g,d=>d.toUpperCase()),entity:e.title,date:e.due_date,days:r,severity:e.severity||(r<=7?"critical":r<=14?"high":"medium")})}),n.sort((e,r)=>e.days-r.days)}});export{m as a,y as u};
