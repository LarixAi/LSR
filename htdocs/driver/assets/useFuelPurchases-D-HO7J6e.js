import{m as h,H as y,J as l,G as d,a2 as f,a3 as c}from"./main-DVuL102c.js";const p=()=>{const{user:r,profile:e}=h();return y({queryKey:["fuel-purchases",e==null?void 0:e.id],queryFn:async()=>{if(!(e!=null&&e.id))throw new Error("User profile is required");console.log("Fetching fuel purchases from database...");const{data:s,error:n}=await l.from("fuel_purchases").select("*").eq("driver_id",e.id).order("purchase_date",{ascending:!1}).order("created_at",{ascending:!1});if(n)throw console.error("Error fetching fuel purchases:",n),n;const o=(s||[]).map(i=>({...i,vehicle_number:i.vehicle_number||"Unknown",license_plate:i.license_plate||"Unknown",make:i.make||"Unknown",model:i.model||"Unknown",driver_name:`${e.first_name||""} ${e.last_name||""}`.trim()||"Unknown Driver"}));return console.log("Fetched fuel purchases:",o),o},enabled:!!(e!=null&&e.id)})},g=()=>{const{profile:r}=h(),e=d();return f({mutationFn:async s=>{if(!(r!=null&&r.id)||!(r!=null&&r.organization_id))throw new Error("User profile and organization information required");if(!s.vehicle_id)throw new Error("Vehicle ID is required for fuel purchase");const{data:n,error:o}=await l.from("fuel_purchases").insert({...s,driver_id:r.id,organization_id:r.organization_id}).select().single();if(o)throw o;return n},onSuccess:()=>{e.invalidateQueries({queryKey:["fuel-purchases"]}),c.success("Fuel purchase recorded successfully")},onError:s=>{console.error("Error creating fuel purchase:",s),c.error("Failed to record fuel purchase: "+s.message)}})},q=()=>{const r=d();return f({mutationFn:async({id:e,updates:s})=>{const{data:n,error:o}=await l.from("fuel_purchases").update(s).eq("id",e).select().single();if(o)throw o;return n},onSuccess:()=>{r.invalidateQueries({queryKey:["fuel-purchases"]}),c.success("Fuel purchase updated successfully")},onError:e=>{console.error("Error updating fuel purchase:",e),c.error("Failed to update fuel purchase: "+e.message)}})},w=()=>{const r=d();return f({mutationFn:async e=>{const{error:s}=await l.from("fuel_purchases").delete().eq("id",e);if(s)throw s;return e},onSuccess:()=>{r.invalidateQueries({queryKey:["fuel-purchases"]}),c.success("Fuel purchase deleted successfully")},onError:e=>{console.error("Error deleting fuel purchase:",e),c.error("Failed to delete fuel purchase: "+e.message)}})},F=()=>{const{data:r=[]}=p();return{statistics:(()=>{const s=r.reduce((t,u)=>t+Number(u.total_cost),0),n=r.reduce((t,u)=>t+Number(u.quantity),0),o=n>0?s/n:0,i=r.reduce((t,u)=>{const a=u.fuel_type;return t[a]||(t[a]={quantity:0,cost:0,count:0}),t[a].quantity+=Number(u.quantity),t[a].cost+=Number(u.total_cost),t[a].count+=1,t},{}),m=r.reduce((t,u)=>{const a=new Date(u.purchase_date).toISOString().slice(0,7);return t[a]||(t[a]={quantity:0,cost:0,count:0}),t[a].quantity+=Number(u.quantity),t[a].cost+=Number(u.total_cost),t[a].count+=1,t},{});return{totalSpent:s,totalQuantity:n,averagePrice:o,byFuelType:i,monthlyData:m,purchaseCount:r.length}})(),isLoading:!1}};export{g as a,q as b,w as c,F as d,p as u};
