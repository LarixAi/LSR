import{q as H,J as G,r as T,s as C,P as k,j as e,i,k as c,l as d,H as I,n as o,B as y,a0 as W,F,D as Z,d as $,e as ee,f as se,g as ae,Y as j,a6 as te,E as v,v as X,a1 as Y,aA as P,N as U,h as re,o as ne,U as le}from"./main-piTIAPSx.js";import{T as ie,a as ce,b as A,c as D}from"./tabs-N5TLptOb.js";import{u as L}from"./useQuery-Dbdyc74j.js";import{T as de}from"./textarea-mxcr8nPj.js";import{u as V}from"./useMutation-B8vlA97s.js";import{C as S}from"./circle-check-big-CD0jvDn0.js";import{C as K}from"./circle-x-CETn4HDx.js";import{T as J}from"./trending-down-D0rMbz6u.js";const oe=()=>{var M,B;const{user:p,profile:n}=H(),b=G(),[t,g]=T.useState(null),[l,r]=T.useState(!1),[a,h]=T.useState(""),{data:w=[],isLoading:_}=L({queryKey:["approval-requests"],queryFn:async()=>{const{data:s,error:x}=await C.from("parts_approval_requests").select(`
          *,
          requester:profiles!parts_approval_requests_requester_id_fkey(full_name, email),
          part:parts_inventory!parts_approval_requests_part_id_fkey(part_number, name, quantity, unit_price)
        `).eq("organization_id",n==null?void 0:n.organization_id).order("created_at",{ascending:!1});return x?(console.error("Error fetching approval requests:",x),[]):s||[]}}),N=V({mutationFn:async({requestId:s,notes:x})=>{const{data:u,error:q}=await C.from("parts_approval_requests").update({status:"approved",approved_by:p==null?void 0:p.id,approved_at:new Date().toISOString(),admin_notes:x}).eq("id",s).select().single();if(q)throw q;return u},onSuccess:()=>{b.invalidateQueries({queryKey:["approval-requests"]}),b.invalidateQueries({queryKey:["parts-inventory"]}),k({title:"Success",description:"Request approved successfully"}),r(!1),g(null),h("")},onError:s=>{k({title:"Error",description:"Failed to approve request",variant:"destructive"})}}),m=V({mutationFn:async({requestId:s,notes:x})=>{const{data:u,error:q}=await C.from("parts_approval_requests").update({status:"rejected",approved_by:p==null?void 0:p.id,approved_at:new Date().toISOString(),admin_notes:x}).eq("id",s).select().single();if(q)throw q;return u},onSuccess:()=>{b.invalidateQueries({queryKey:["approval-requests"]}),k({title:"Success",description:"Request rejected successfully"}),r(!1),g(null),h("")},onError:s=>{k({title:"Error",description:"Failed to reject request",variant:"destructive"})}}),f=()=>{t&&N.mutate({requestId:t.id,notes:a})},R=()=>{t&&m.mutate({requestId:t.id,notes:a})},O=s=>{switch(s){case"pending":return e.jsxs(v,{className:"bg-yellow-100 text-yellow-800",children:[e.jsx(X,{className:"w-3 h-3 mr-1"}),"Pending"]});case"approved":return e.jsxs(v,{className:"bg-green-100 text-green-800",children:[e.jsx(S,{className:"w-3 h-3 mr-1"}),"Approved"]});case"rejected":return e.jsxs(v,{className:"bg-red-100 text-red-800",children:[e.jsx(K,{className:"w-3 h-3 mr-1"}),"Rejected"]});case"cancelled":return e.jsx(v,{className:"bg-gray-100 text-gray-800",children:"Cancelled"});default:return e.jsx(v,{variant:"secondary",children:s})}},Q=s=>{switch(s){case"new_part":return e.jsx(P,{className:"w-4 h-4"});case"quantity_increase":return e.jsx(I,{className:"w-4 h-4"});case"price_change":return e.jsx(Y,{className:"w-4 h-4"});default:return e.jsx(F,{className:"w-4 h-4"})}},z=w.filter(s=>s.status==="pending"),E=w.filter(s=>s.status!=="pending");return _?e.jsx("div",{className:"flex items-center justify-center min-h-[200px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{children:"Loading approval requests..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(i,{children:[e.jsx(c,{children:e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-yellow-600"}),"Pending Approval Requests (",z.length,")"]})}),e.jsx(o,{children:z.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(S,{className:"w-12 h-12 mx-auto mb-4 text-green-500"}),e.jsx("p",{children:"No pending approval requests"})]}):e.jsx("div",{className:"space-y-4",children:z.map(s=>{var x,u;return e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[Q(s.request_type),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold capitalize",children:s.request_type.replace("_"," ")}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Requested by ",((x=s.requester)==null?void 0:x.full_name)||"Unknown"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[O(s.status),e.jsxs(y,{size:"sm",variant:"outline",onClick:()=>{g(s),r(!0)},children:[e.jsx(W,{className:"w-4 h-4 mr-1"}),"Review"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Part:"}),e.jsx("p",{className:"text-gray-600",children:((u=s.part)==null?void 0:u.name)||"New Part"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Quantity:"}),e.jsx("p",{className:"text-gray-600",children:s.quantity_requested||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Date:"}),e.jsx("p",{className:"text-gray-600",children:new Date(s.created_at).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Reason:"}),e.jsx("p",{className:"text-gray-600 truncate",children:s.reason})]})]})]},s.id)})})})]}),e.jsxs(i,{children:[e.jsx(c,{children:e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),"Processed Requests (",E.length,")"]})}),e.jsx(o,{children:E.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{children:"No processed requests yet"})}):e.jsx("div",{className:"space-y-3",children:E.slice(0,10).map(s=>{var x,u;return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[Q(s.request_type),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium capitalize",children:s.request_type.replace("_"," ")}),e.jsxs("p",{className:"text-sm text-gray-600",children:[((x=s.part)==null?void 0:x.name)||"New Part"," â€¢ ",(u=s.requester)==null?void 0:u.full_name]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[O(s.status),e.jsx("span",{className:"text-sm text-gray-500",children:new Date(s.created_at).toLocaleDateString()})]})]},s.id)})})})]}),e.jsx(Z,{open:l,onOpenChange:r,children:e.jsxs($,{className:"max-w-2xl",children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Review Approval Request"}),e.jsx(ae,{children:"Review the details and approve or reject this request"})]}),t&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(j,{className:"font-medium",children:"Request Type"}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:t.request_type.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx(j,{className:"font-medium",children:"Status"}),e.jsx("div",{className:"mt-1",children:O(t.status)})]}),e.jsxs("div",{children:[e.jsx(j,{className:"font-medium",children:"Requester"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[(M=t.requester)==null?void 0:M.full_name," (",(B=t.requester)==null?void 0:B.email,")"]})]}),e.jsxs("div",{children:[e.jsx(j,{className:"font-medium",children:"Date Requested"}),e.jsx("p",{className:"text-sm text-gray-600",children:new Date(t.created_at).toLocaleString()})]})]}),t.part&&e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Part Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Part Number:"}),e.jsx("p",{className:"text-gray-600",children:t.part.part_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Name:"}),e.jsx("p",{className:"text-gray-600",children:t.part.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Current Quantity:"}),e.jsx("p",{className:"text-gray-600",children:t.part.current_quantity})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Unit Price:"}),e.jsxs("p",{className:"text-gray-600",children:["Â£",t.part.unit_price]})]})]})]}),e.jsxs("div",{children:[e.jsx(j,{className:"font-medium",children:"Reason for Request"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.reason})]}),t.quantity_requested&&e.jsxs("div",{children:[e.jsx(j,{className:"font-medium",children:"Quantity Requested"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.quantity_requested})]}),t.current_value&&t.requested_value&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(j,{className:"font-medium",children:"Current Value"}),e.jsx("pre",{className:"text-sm text-gray-600 mt-1 bg-gray-50 p-2 rounded",children:JSON.stringify(JSON.parse(t.current_value),null,2)})]}),e.jsxs("div",{children:[e.jsx(j,{className:"font-medium",children:"Requested Value"}),e.jsx("pre",{className:"text-sm text-gray-600 mt-1 bg-blue-50 p-2 rounded",children:JSON.stringify(JSON.parse(t.requested_value),null,2)})]})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"admin-notes",children:"Admin Notes (Optional)"}),e.jsx(de,{id:"admin-notes",value:a,onChange:s=>h(s.target.value),placeholder:"Add notes about your decision...",className:"mt-1"})]})]}),e.jsxs(te,{children:[e.jsx(y,{variant:"outline",onClick:()=>r(!1),children:"Cancel"}),e.jsxs(y,{variant:"destructive",onClick:R,disabled:N.isPending||m.isPending,children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Reject"]}),e.jsxs(y,{onClick:f,disabled:N.isPending||m.isPending,children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Approve"]})]})]})})]})},fe=()=>{const{user:p,profile:n,loading:b}=H(),[t,g]=T.useState("overview");if(b)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading admin dashboard..."})]})});if(!p||!n)return e.jsx(U,{to:"/auth",replace:!0});if(!["admin","council"].includes(n.role))return e.jsx(U,{to:"/unauthorized",replace:!0});const{data:l}=L({queryKey:["inventory-stats"],queryFn:async()=>{const{data:a,error:h}=await C.from("parts_inventory").select("*").eq("organization_id",n==null?void 0:n.organization_id);if(h)return console.error("Error fetching parts:",h),null;const w=(a==null?void 0:a.length)||0,_=(a==null?void 0:a.filter(f=>f.status==="low_stock").length)||0,N=(a==null?void 0:a.filter(f=>f.status==="out_of_stock").length)||0,m=(a==null?void 0:a.reduce((f,R)=>f+R.quantity*R.unit_price,0))||0;return{totalParts:w,lowStock:_,outOfStock:N,totalValue:m}}}),{data:r}=L({queryKey:["approval-stats"],queryFn:async()=>{const{data:a,error:h}=await C.from("parts_approval_requests").select("status").eq("organization_id",n==null?void 0:n.organization_id);if(h)return console.error("Error fetching approval requests:",h),null;const w=(a==null?void 0:a.filter(m=>m.status==="pending").length)||0,_=(a==null?void 0:a.filter(m=>m.status==="approved").length)||0,N=(a==null?void 0:a.filter(m=>m.status==="rejected").length)||0;return{pending:w,approved:_,rejected:N}}});return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Inventory Management"}),e.jsx("p",{className:"text-gray-600",children:"Admin dashboard for inventory control and approvals"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"outline",children:n.role}),e.jsx("span",{className:"text-sm text-gray-500",children:n.full_name})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(i,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Total Parts"}),e.jsx(P,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(l==null?void 0:l.totalParts)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Parts in inventory"})]})]}),e.jsxs(i,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Low Stock"}),e.jsx(I,{className:"h-4 w-4 text-yellow-600"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:(l==null?void 0:l.lowStock)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Need reordering"})]})]}),e.jsxs(i,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Out of Stock"}),e.jsx(J,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:(l==null?void 0:l.outOfStock)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Urgent orders needed"})]})]}),e.jsxs(i,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Total Value"}),e.jsx(Y,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["Â£",((l==null?void 0:l.totalValue)||0).toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Inventory value"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(i,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Pending Approvals"}),e.jsx(X,{className:"h-4 w-4 text-yellow-600"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:(r==null?void 0:r.pending)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Awaiting review"})]})]}),e.jsxs(i,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Approved"}),e.jsx(S,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:(r==null?void 0:r.approved)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This month"})]})]}),e.jsxs(i,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Rejected"}),e.jsx(J,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:(r==null?void 0:r.rejected)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This month"})]})]})]}),e.jsxs(ie,{value:t,onValueChange:g,className:"space-y-6",children:[e.jsxs(ce,{className:"grid w-full grid-cols-4",children:[e.jsxs(A,{value:"overview",className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Overview"]}),e.jsxs(A,{value:"approvals",className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),"Approvals"]}),e.jsxs(A,{value:"inventory",className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),"Inventory"]}),e.jsxs(A,{value:"settings",className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),"Settings"]})]}),e.jsxs(D,{value:"overview",className:"space-y-6",children:[e.jsxs(i,{children:[e.jsx(c,{children:e.jsx(d,{children:"Quick Actions"})}),e.jsx(o,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs(y,{variant:"outline",className:"h-20 flex flex-col items-center justify-center gap-2",onClick:()=>g("approvals"),children:[e.jsx(F,{className:"w-6 h-6"}),e.jsx("span",{children:"Review Approvals"}),(r==null?void 0:r.pending)>0&&e.jsx(v,{className:"bg-red-500 text-white",children:r.pending})]}),e.jsxs(y,{variant:"outline",className:"h-20 flex flex-col items-center justify-center gap-2",onClick:()=>g("inventory"),children:[e.jsx(P,{className:"w-6 h-6"}),e.jsx("span",{children:"Manage Inventory"})]}),e.jsxs(y,{variant:"outline",className:"h-20 flex flex-col items-center justify-center gap-2",children:[e.jsx(le,{className:"w-6 h-6"}),e.jsx("span",{children:"User Management"})]})]})})]}),e.jsxs(i,{children:[e.jsx(c,{children:e.jsx(d,{children:"Recent Activity"})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"New part added"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Brake Pad Set (Front) - 2 minutes ago"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"Approval request submitted"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Quantity increase for Oil Filter - 15 minutes ago"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"Low stock alert"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Battery 12V 100Ah - 1 hour ago"})]})]})]})})]})]}),e.jsx(D,{value:"approvals",className:"space-y-6",children:e.jsx(oe,{})}),e.jsx(D,{value:"inventory",className:"space-y-6",children:e.jsxs(i,{children:[e.jsx(c,{children:e.jsx(d,{children:"Inventory Management"})}),e.jsx(o,{children:e.jsx("p",{className:"text-gray-600",children:"Full inventory management interface will be implemented here. This will include part management, stock movements, and reporting."})})]})}),e.jsx(D,{value:"settings",className:"space-y-6",children:e.jsxs(i,{children:[e.jsx(c,{children:e.jsx(d,{children:"Organization Settings"})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Approval Thresholds"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure automatic approval thresholds for different types of requests."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Notification Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage email and in-app notifications for inventory alerts."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"User Permissions"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure what different user roles can do in the inventory system."})]})]})})]})})]})]})};export{fe as default};
