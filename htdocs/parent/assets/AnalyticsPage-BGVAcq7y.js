import{c as I,q as W,s as S,r as B,j as e,N as X,a1 as V,M as Y,az as Z,K as L,h as O,B as C,ax as ee,i as u,n as g,k as M,l as z,O as K,U as ae,T as te,v as se,P as J,E as ne}from"./main-piTIAPSx.js";import{S as ie,a as re,b as ce,c as le,d as P}from"./select-Brm_N20Q.js";import{P as oe}from"./progress-nJfMQ3MC.js";import{T as de,a as me,b as F,c as _}from"./tabs-N5TLptOb.js";import{u as q}from"./useQuery-Dbdyc74j.js";import{T as G}from"./target-CwAJPPi1.js";import{C as he}from"./circle-check-big-CD0jvDn0.js";import{D as H}from"./download-C4W0Vf38.js";import{T as ue}from"./trending-down-D0rMbz6u.js";import{M as Q}from"./minus-a8kAC2EO.js";import"./index-Pp_niZQ8.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=I("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=I("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=I("ChartPie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]),pe=()=>{const{profile:t}=W(),{data:x=[]}=q({queryKey:["analytics-vehicles",t==null?void 0:t.organization_id],queryFn:async()=>{if(!(t!=null&&t.organization_id))return[];const{data:i,error:n}=await S.from("vehicles").select("*").eq("organization_id",t.organization_id);return n?(console.error("Error fetching vehicles for analytics:",n),[]):i||[]},enabled:!!(t!=null&&t.organization_id)}),{data:h=[]}=q({queryKey:["analytics-drivers",t==null?void 0:t.organization_id],queryFn:async()=>{if(!(t!=null&&t.organization_id))return[];const{data:i,error:n}=await S.from("profiles").select("*").eq("role","driver").eq("organization_id",t.organization_id);return n?(console.error("Error fetching drivers for analytics:",n),[]):i||[]},enabled:!!(t!=null&&t.organization_id)}),{data:v=[]}=q({queryKey:["analytics-jobs",t==null?void 0:t.organization_id],queryFn:async()=>{if(!(t!=null&&t.organization_id))return[];const{data:i,error:n}=await S.from("jobs").select("*").eq("organization_id",t.organization_id).order("created_at",{ascending:!1}).limit(1e3);return n?(console.error("Error fetching jobs for analytics:",n),[]):i||[]},enabled:!!(t!=null&&t.organization_id)}),{data:N=[]}=q({queryKey:["analytics-routes",t==null?void 0:t.organization_id],queryFn:async()=>{if(!(t!=null&&t.organization_id))return[];const{data:i,error:n}=await S.from("routes").select("*").eq("organization_id",t.organization_id);return n?(console.error("Error fetching routes for analytics:",n),[]):i||[]},enabled:!!(t!=null&&t.organization_id)}),j=(()=>{const n=v.filter(m=>m.status==="completed").length*150,p=v.length,r=v.filter(m=>{const U=new Date(m.created_at),D=new Date;return D.setMonth(D.getMonth()-1),U>=D}).length,l=x.filter(m=>m.status==="active"||m.is_active).length,o=x.length,T=o>0?l/o*100:0,y=h.filter(m=>m.is_active).length,A=l*50*30,a=x.filter(m=>m.status==="maintenance").length,d=o*200+a*1e3,f=h.length>0?y/h.length*100:100,E=o>0?l/o*100:100,R=(f+E)/2;return{revenue:{value:`£${n.toLocaleString()}`,change:r>0?8.5:-2.1,changeType:r>0?"increase":"decrease"},trips:{value:p.toString(),change:r>p*.7?12.3:-5.2,changeType:r>p*.7?"increase":"decrease"},efficiency:{value:`${T.toFixed(1)}%`,change:T>80?3.1:-1.8,changeType:T>80?"increase":"decrease"},drivers:{value:y.toString(),change:y>h.length*.8?6.2:-3.4,changeType:y>h.length*.8?"increase":"decrease"},routes:{value:N.length.toString(),change:N.length>10?4.7:-1.2,changeType:N.length>10?"increase":"decrease"},vehicles:{value:o.toString(),change:o>5?2.8:-.5,changeType:o>5?"increase":"decrease"},fuel:{value:`£${A.toLocaleString()}`,change:l>o*.8?-5.8:2.3,changeType:l>o*.8?"decrease":"increase"},maintenance:{value:`£${d.toLocaleString()}`,change:a>0?15.2:-8.1,changeType:a>0?"increase":"decrease"},compliance:{value:`${R.toFixed(1)}%`,change:R>90?1.5:-2.3,changeType:R>90?"increase":"decrease"}}})(),k=[{name:"This Month",value:parseInt(j.revenue.value.replace(/[£,]/g,"")),trend:j.revenue.changeType==="increase"?"up":"down"},{name:"Last Month",value:Math.round(parseInt(j.revenue.value.replace(/[£,]/g,""))*.92),trend:"up"},{name:"2 Months Ago",value:Math.round(parseInt(j.revenue.value.replace(/[£,]/g,""))*.85),trend:"stable"},{name:"3 Months Ago",value:Math.round(parseInt(j.revenue.value.replace(/[£,]/g,""))*.78),trend:"up"}],s=[{name:"School Runs",value:v.filter(i=>i.job_type==="school_run").length,color:"bg-blue-500"},{name:"Regular Routes",value:N.filter(i=>i.status==="active").length,color:"bg-green-500"},{name:"Special Events",value:v.filter(i=>i.job_type==="special_event").length,color:"bg-purple-500"},{name:"Maintenance",value:x.filter(i=>i.status==="maintenance").length,color:"bg-orange-500"}],$=(()=>{const i=h.filter(b=>b.is_active).length,n=x.length,p=x.filter(b=>b.status==="active"||b.is_active).length,r=x.filter(b=>b.status==="maintenance").length,l=v.filter(b=>b.status==="completed").length,o=i>0?4.2+i/h.length*.8:4,T=l>0?Math.min(95+l*.5,100):85,y=i>0?Math.min(88+i/h.length*10,100):75,A=p>0?Math.min(82+p/n*15,100):70,a=n>0?p/n*100:0,d=n>0?r/n*100:0,f=n>0?Math.min(90+p/n*10,100):85,E=n>0?(n-r)/n*100:100,R=l>0?4+l*.01:3.5,m=l>0?Math.min(88+l*.2,100):80,U=l>0?Math.min(95+l*.1,100):90,D=l>0?Math.min(80+l*.15,100):70;return{driverPerformance:{averageRating:`${Math.min(o,5).toFixed(1)}/5`,punctuality:`${T.toFixed(1)}%`,safetyScore:`${y.toFixed(1)}%`,fuelEfficiency:`${A.toFixed(1)}%`},vehicleUtilization:{averageUtilization:`${a.toFixed(1)}%`,downtime:`${d.toFixed(1)}%`,maintenanceSchedule:`${f.toFixed(1)}%`,availability:`${E.toFixed(1)}%`},customerSatisfaction:{overallRating:`${Math.min(R,5).toFixed(1)}/5`,onTimePerformance:`${m.toFixed(1)}%`,complaintResolution:`${U.toFixed(1)}%`,repeatCustomers:`${D.toFixed(1)}%`},quickStats:{activeDrivers:i,fleetVehicles:n,onTimeRate:`${m.toFixed(1)}%`,targetAchievement:`${Math.min(l/Math.max(v.length,1)*100,100).toFixed(1)}%`}}})();return{metrics:j,revenueData:k,serviceData:s,performanceMetrics:$,rawData:{vehicles:x,drivers:h,jobs:v,routes:N},isLoading:!1}},Ae=()=>{const{user:t,profile:x,loading:h}=W(),[v,N]=B.useState("30d");B.useState("revenue");const{metrics:c,revenueData:j,serviceData:k,performanceMetrics:s,rawData:w,isLoading:$}=pe(),i=()=>{confirm(`Are you sure you want to clear all analytics data?

This will permanently delete:
- All vehicle records
- All job records
- All route records
- All driver profiles

This action cannot be undone.`)&&n()},n=async()=>{try{if(w.vehicles.length>0)for(const a of w.vehicles)await S.from("vehicles").delete().eq("id",a.id);if(w.jobs.length>0)for(const a of w.jobs)await S.from("jobs").delete().eq("id",a.id);if(w.routes.length>0)for(const a of w.routes)await S.from("routes").delete().eq("id",a.id);J({title:"Analytics Data Cleared",description:"All analytics data has been cleared from the database."}),setTimeout(()=>{window.location.reload()},1e3)}catch(a){console.error("Error clearing analytics data:",a),J({title:"Error",description:"Failed to clear analytics data.",variant:"destructive"})}};if(h)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading analytics dashboard..."})]})});if(!t||!x)return e.jsx(X,{to:"/auth",replace:!0});if(h||$||!s)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading analytics data..."})]})});const p=[{id:"revenue",title:"Total Revenue",value:c.revenue.value,change:c.revenue.change,changeType:c.revenue.changeType,icon:V,color:"text-green-600",description:"Estimated revenue from completed jobs"},{id:"trips",title:"Total Trips",value:c.trips.value,change:c.trips.change,changeType:c.trips.changeType,icon:Y,color:"text-blue-600",description:"Jobs completed this period"},{id:"efficiency",title:"Fleet Efficiency",value:c.efficiency.value,change:c.efficiency.change,changeType:c.efficiency.changeType,icon:G,color:"text-orange-600",description:"Active vehicles / total vehicles"},{id:"fuel",title:"Fuel Costs",value:c.fuel.value,change:c.fuel.change,changeType:c.fuel.changeType,icon:Z,color:"text-purple-600",description:"Estimated monthly fuel expenditure"},{id:"maintenance",title:"Maintenance Costs",value:c.maintenance.value,change:c.maintenance.change,changeType:c.maintenance.changeType,icon:L,color:"text-red-600",description:"Vehicle maintenance expenses"},{id:"compliance",title:"Compliance Score",value:c.compliance.value,change:c.compliance.change,changeType:c.compliance.changeType,icon:he,color:"text-emerald-600",description:"Driver and vehicle compliance rating"}],r=(a,d)=>{const f=parseFloat(a.replace(/[%/]/g,""));switch(d){case"rating":return f>=4.5?"excellent":f>=4?"good":"warning";case"percentage":return f>=95?"excellent":f>=85?"good":"warning";case"downtime":return f<=5?"excellent":f<=15?"good":"warning";default:return"good"}},l=[{category:"Driver Performance",metrics:[{name:"Average Rating",value:s.driverPerformance.averageRating,status:r(s.driverPerformance.averageRating,"rating")},{name:"Punctuality",value:s.driverPerformance.punctuality,status:r(s.driverPerformance.punctuality,"percentage")},{name:"Safety Score",value:s.driverPerformance.safetyScore,status:r(s.driverPerformance.safetyScore,"percentage")},{name:"Fuel Efficiency",value:s.driverPerformance.fuelEfficiency,status:r(s.driverPerformance.fuelEfficiency,"percentage")}]},{category:"Vehicle Utilization",metrics:[{name:"Average Utilization",value:s.vehicleUtilization.averageUtilization,status:r(s.vehicleUtilization.averageUtilization,"percentage")},{name:"Downtime",value:s.vehicleUtilization.downtime,status:r(s.vehicleUtilization.downtime,"downtime")},{name:"Maintenance Schedule",value:s.vehicleUtilization.maintenanceSchedule,status:r(s.vehicleUtilization.maintenanceSchedule,"percentage")},{name:"Availability",value:s.vehicleUtilization.availability,status:r(s.vehicleUtilization.availability,"percentage")}]},{category:"Customer Satisfaction",metrics:[{name:"Overall Rating",value:s.customerSatisfaction.overallRating,status:r(s.customerSatisfaction.overallRating,"rating")},{name:"On-Time Performance",value:s.customerSatisfaction.onTimePerformance,status:r(s.customerSatisfaction.onTimePerformance,"percentage")},{name:"Complaint Resolution",value:s.customerSatisfaction.complaintResolution,status:r(s.customerSatisfaction.complaintResolution,"percentage")},{name:"Repeat Customers",value:s.customerSatisfaction.repeatCustomers,status:r(s.customerSatisfaction.repeatCustomers,"percentage")}]}],o=a=>{switch(a){case"increase":return e.jsx(xe,{className:"w-4 h-4 text-green-600"});case"decrease":return e.jsx(ge,{className:"w-4 h-4 text-red-600"});default:return e.jsx(Q,{className:"w-4 h-4 text-gray-600"})}},T=a=>{switch(a){case"increase":return"text-green-600";case"decrease":return"text-red-600";default:return"text-gray-600"}},y=a=>{switch(a){case"excellent":return"text-emerald-600";case"good":return"text-green-600";case"warning":return"text-yellow-600";case"critical":return"text-red-600";default:return"text-gray-600"}},A=a=>{const d={excellent:"bg-emerald-100 text-emerald-800",good:"bg-green-100 text-green-800",warning:"bg-yellow-100 text-yellow-800",critical:"bg-red-100 text-red-800"};return e.jsx(ne,{className:d[a]||"bg-gray-100 text-gray-800",children:a})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(O,{className:"w-8 h-8 text-blue-600"}),"Analytics Dashboard"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Comprehensive business intelligence and performance metrics"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(ie,{value:v,onValueChange:N,children:[e.jsx(re,{className:"w-32",children:e.jsx(ce,{})}),e.jsxs(le,{children:[e.jsx(P,{value:"7d",children:"Last 7 days"}),e.jsx(P,{value:"30d",children:"Last 30 days"}),e.jsx(P,{value:"90d",children:"Last 90 days"}),e.jsx(P,{value:"1y",children:"Last year"})]})]}),e.jsxs(C,{onClick:i,variant:"destructive",className:"inline-flex items-center",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Clear All Data"]}),e.jsxs(C,{className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Export Report"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.map(a=>e.jsx(u,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(g,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gray-100",children:e.jsx(a.icon,{className:`w-6 h-6 ${a.color}`})}),e.jsxs("div",{className:"flex items-center gap-2",children:[o(a.changeType),e.jsxs("span",{className:`text-sm font-medium ${T(a.changeType)}`,children:[Math.abs(a.change),"%"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a.title}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mb-1",children:a.value}),e.jsx("p",{className:"text-sm text-gray-600",children:a.description})]})]})},a.id))}),e.jsxs(de,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(me,{className:"grid w-full grid-cols-5",children:[e.jsx(F,{value:"overview",children:"Overview"}),e.jsx(F,{value:"financial",children:"Financial"}),e.jsx(F,{value:"operational",children:"Operational"}),e.jsx(F,{value:"performance",children:"Performance"}),e.jsx(F,{value:"reports",children:"Reports"})]}),e.jsxs(_,{value:"overview",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(u,{children:[e.jsx(M,{children:e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"Revenue Trend"]})}),e.jsx(g,{children:e.jsx("div",{className:"space-y-4",children:j.map((a,d)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:a.name}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm",children:["£",a.value.toLocaleString()]}),a.trend==="up"?e.jsx(K,{className:"w-4 h-4 text-green-600"}):a.trend==="down"?e.jsx(ue,{className:"w-4 h-4 text-red-600"}):e.jsx(Q,{className:"w-4 h-4 text-gray-600"})]})]},a.name))})})]}),e.jsxs(u,{children:[e.jsx(M,{children:e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5"}),"Service Distribution"]})}),e.jsx(g,{children:e.jsx("div",{className:"space-y-4",children:k.map(a=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:a.name}),e.jsxs("span",{className:"text-sm",children:[a.value,"%"]})]}),e.jsx(oe,{value:a.value,className:"h-2"})]},a.name))})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(u,{children:e.jsxs(g,{className:"p-6 text-center",children:[e.jsx(ae,{className:"w-8 h-8 text-blue-600 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Active Drivers"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:s.quickStats.activeDrivers}),e.jsx("p",{className:"text-sm text-gray-600",children:"Currently available"})]})}),e.jsx(u,{children:e.jsxs(g,{className:"p-6 text-center",children:[e.jsx(te,{className:"w-8 h-8 text-green-600 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Fleet Vehicles"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:s.quickStats.fleetVehicles}),e.jsx("p",{className:"text-sm text-gray-600",children:"Operational vehicles"})]})}),e.jsx(u,{children:e.jsxs(g,{className:"p-6 text-center",children:[e.jsx(se,{className:"w-8 h-8 text-purple-600 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"On-Time Rate"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:s.quickStats.onTimeRate}),e.jsx("p",{className:"text-sm text-gray-600",children:"This month"})]})}),e.jsx(u,{children:e.jsxs(g,{className:"p-6 text-center",children:[e.jsx(G,{className:"w-8 h-8 text-orange-600 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Target Achievement"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:s.quickStats.targetAchievement}),e.jsx("p",{className:"text-sm text-gray-600",children:"Monthly target"})]})})]})]}),e.jsx(_,{value:"financial",className:"space-y-4",children:e.jsxs(u,{children:[e.jsx(M,{children:e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Financial Analytics"]})}),e.jsx(g,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(V,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Financial Performance Analysis"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Detailed revenue analysis, cost breakdown, and profitability metrics."}),e.jsx(C,{className:"bg-blue-600 hover:bg-blue-700",children:"View Financial Dashboard"})]})})]})}),e.jsx(_,{value:"operational",className:"space-y-4",children:e.jsxs(u,{children:[e.jsx(M,{children:e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5"}),"Operational Metrics"]})}),e.jsx(g,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(L,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Operational Performance"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Fleet utilization, route optimization, and operational efficiency metrics."}),e.jsx(C,{className:"bg-blue-600 hover:bg-blue-700",children:"View Operational Dashboard"})]})})]})}),e.jsx(_,{value:"performance",className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:l.map(a=>e.jsxs(u,{children:[e.jsx(M,{children:e.jsx(z,{children:a.category})}),e.jsx(g,{children:e.jsx("div",{className:"space-y-4",children:a.metrics.map(d=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:d.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm font-medium ${y(d.status)}`,children:d.value}),A(d.status)]})]},d.name))})})]},a.category))})}),e.jsx(_,{value:"reports",className:"space-y-4",children:e.jsxs(u,{children:[e.jsx(M,{children:e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5"}),"Custom Reports"]})}),e.jsx(g,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(O,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Generate Custom Reports"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Create detailed analytical reports with custom date ranges and metrics."}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(C,{className:"bg-blue-600 hover:bg-blue-700",children:"Create Report"}),e.jsxs(C,{variant:"outline",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Export Data"]})]})]})})]})})]})]})};export{Ae as default};
