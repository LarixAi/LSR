import{q as ce,s as _,a as I,J as G,r as T,j as e,i as q,k as R,l as B,B as j,n as M,V,E as ee,w as le,M as oe,D as se,d as te,e as ae,f as ne,g as re,Y as i,I as x,bg as de,a2 as he,S as me}from"./main-piTIAPSx.js";import{T as v}from"./textarea-mxcr8nPj.js";import{u as $}from"./useQuery-Dbdyc74j.js";import{u as z}from"./useMutation-B8vlA97s.js";import{P as K}from"./phone-D7pMV1Uy.js";import{P as ie}from"./plus-CMGcTuiR.js";import{S as xe}from"./star-D5LO9sgD.js";import{S as pe}from"./square-pen-DnuZJKej.js";import{T as ge}from"./trash-2-CMjiaIVh.js";import{S as J,a as W,b as X,c as Z,d as E}from"./select-Brm_N20Q.js";import{C as y}from"./checkbox-DqvkB_ze.js";import{P as ue}from"./progress-nJfMQ3MC.js";import{C as A}from"./circle-check-big-CD0jvDn0.js";import{C as je}from"./chevron-left-BoLOTuB-.js";import{C as _e}from"./car-B9KPzxYH.js";import{H as fe}from"./heart-e8Bsk1RQ.js";const ye=c=>{const{user:h}=ce();return $({queryKey:["emergency-contacts",h==null?void 0:h.id,c],queryFn:async()=>{if(!(h!=null&&h.id))return[];console.log("Fetching emergency contacts for child:",c);try{let l=_.from("emergency_contacts").select(`
            *,
            child_profiles:child_profiles(
              id,
              first_name,
              last_name
            )
          `).eq("is_active",!0).order("is_primary",{ascending:!1}).order("contact_name");c?l=l.eq("child_id",c):l=l.in("child_id",_.from("child_profiles").select("id").eq("parent_id",h.id).eq("is_active",!0));const{data:o,error:u}=await l;if(u)throw console.error("Error fetching emergency contacts:",u),u;return console.log("Fetched emergency contacts:",o),o||[]}catch(l){return console.error("Error in useEmergencyContacts:",l),[]}},enabled:!!(h!=null&&h.id)})},ve=()=>{const{toast:c}=I(),h=G();return z({mutationFn:async l=>{const{data:o,error:u}=await _.from("emergency_contacts").insert(l).select().single();if(u)throw u;return o},onSuccess:l=>{h.invalidateQueries({queryKey:["emergency-contacts"]}),c({title:"Emergency Contact Added",description:"The emergency contact has been added successfully."})},onError:l=>{console.error("Error creating emergency contact:",l),c({title:"Error",description:"Failed to add emergency contact. Please try again.",variant:"destructive"})}})},Ce=()=>{const{toast:c}=I(),h=G();return z({mutationFn:async({id:l,...o})=>{const{data:u,error:b}=await _.from("emergency_contacts").update(o).eq("id",l).select().single();if(b)throw b;return u},onSuccess:l=>{h.invalidateQueries({queryKey:["emergency-contacts"]}),c({title:"Emergency Contact Updated",description:"The emergency contact has been updated successfully."})},onError:l=>{console.error("Error updating emergency contact:",l),c({title:"Error",description:"Failed to update emergency contact. Please try again.",variant:"destructive"})}})},Ne=()=>{const{toast:c}=I(),h=G();return z({mutationFn:async l=>{const{error:o}=await _.from("emergency_contacts").delete().eq("id",l);if(o)throw o;return l},onSuccess:l=>{h.invalidateQueries({queryKey:["emergency-contacts"]}),c({title:"Emergency Contact Removed",description:"The emergency contact has been removed successfully."})},onError:l=>{console.error("Error deleting emergency contact:",l),c({title:"Error",description:"Failed to remove emergency contact. Please try again.",variant:"destructive"})}})},be=()=>{const{user:c}=ce(),{toast:h}=I(),l=G(),{data:o=[],isLoading:u,error:b,refetch:g}=$({queryKey:["parent-children",c==null?void 0:c.id],queryFn:async()=>{if(!(c!=null&&c.id))return[];const{data:r,error:m}=await _.from("child_profiles").select("*").eq("parent_id",c.id).eq("is_active",!0).order("first_name");if(m)throw m;return r||[]},enabled:!!(c!=null&&c.id)}),{data:w=[],isLoading:a,error:C,refetch:S}=$({queryKey:["parent-notifications",c==null?void 0:c.id],queryFn:async()=>{if(!(c!=null&&c.id))return[];const{data:r,error:m}=await _.from("parent_notifications").select("*").eq("parent_id",c.id).order("created_at",{ascending:!1}).limit(50);if(m)throw m;return r||[]},enabled:!!(c!=null&&c.id)}),{data:d=[],isLoading:p,error:L,refetch:F}=$({queryKey:["parent-tracking",c==null?void 0:c.id],queryFn:async()=>{if(!(c!=null&&c.id))return[];const r=new Date().toISOString().split("T")[0],{data:m,error:N}=await _.from("child_tracking").select(`
          *,
          child_profiles!inner(parent_id)
        `).eq("child_profiles.parent_id",c.id).gte("timestamp",`${r}T00:00:00`).lte("timestamp",`${r}T23:59:59`).order("timestamp",{ascending:!1});if(N)throw N;return m||[]},enabled:!!(c!=null&&c.id)}),P={totalChildren:o.length,childrenOnRoute:d.filter(r=>r.event_type==="pickup"||r.event_type==="boarding").length,unreadNotifications:w.filter(r=>!r.is_read).length,todaysPickups:o.filter(r=>r.pickup_time).length},D=z({mutationFn:async r=>{const{error:m}=await _.from("parent_notifications").update({is_read:!0}).eq("id",r);if(m)throw m},onSuccess:()=>{l.invalidateQueries({queryKey:["parent-notifications"]}),h({title:"Notification marked as read",description:"The notification has been updated."})},onError:r=>{h({title:"Error",description:"Failed to mark notification as read.",variant:"destructive"})}});return{children:o,notifications:w,trackingData:d,stats:P,childrenLoading:u,notificationsLoading:a,trackingLoading:p,isLoading:u||a||p,childrenError:b,notificationsError:C,trackingError:L,markNotificationRead:D,refreshAllData:async()=>{await Promise.all([g(),S(),F()]),h({title:"Data refreshed",description:"All information has been updated."})},getChildStatus:r=>{const m=d.filter(O=>O.child_id===r);if(m.length===0)return"pickup_scheduled";switch(m[0].event_type){case"pickup":case"boarding":return"on_route";case"dropoff":case"alighting":return"at_school";default:return"at_home"}},refetchChildren:g,refetchNotifications:S,refetchTracking:F}},$e=({className:c})=>{const{toast:h}=I(),{children:l}=be(),[o,u]=T.useState(null),[b,g]=T.useState(!1),[w,a]=T.useState(!1),[C,S]=T.useState(null),[d,p]=T.useState({contact_name:"",relationship:"",phone:"",email:"",address:"",is_primary:!1}),{data:L=[],isLoading:F}=ye(o),P=ve(),D=Ce(),U=Ne(),Q=async()=>{if(!o){h({title:"Error",description:"Please select a child first.",variant:"destructive"});return}try{await P.mutateAsync({child_id:o,...d}),g(!1),N()}catch(t){console.error("Failed to add emergency contact:",t)}},r=async()=>{if(C)try{await D.mutateAsync({id:C.id,...d}),a(!1),S(null),N()}catch(t){console.error("Failed to update emergency contact:",t)}},m=async t=>{if(confirm("Are you sure you want to delete this emergency contact?"))try{await U.mutateAsync(t)}catch(n){console.error("Failed to delete emergency contact:",n)}},N=()=>{p({contact_name:"",relationship:"",phone:"",email:"",address:"",is_primary:!1})},O=t=>{S(t),p({contact_name:t.contact_name,relationship:t.relationship,phone:t.phone,email:t.email||"",address:t.address||"",is_primary:t.is_primary}),a(!0)},H=()=>{N(),g(!0)},s=t=>{const n=l.find(f=>f.id===t);return n?`${n.first_name} ${n.last_name}`:"Unknown Child"};return e.jsxs("div",{className:`space-y-6 ${c}`,children:[e.jsx(q,{children:e.jsx(R,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(B,{className:"flex items-center space-x-2",children:[e.jsx(K,{className:"w-5 h-5"}),e.jsx("span",{children:"Emergency Contacts"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("select",{value:o||"",onChange:t=>u(t.target.value?Number(t.target.value):null),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Children"}),l.map(t=>e.jsxs("option",{value:t.id,children:[t.first_name," ",t.last_name]},t.id))]}),e.jsxs(j,{onClick:H,disabled:!o,children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Add Contact"]})]})]})})}),e.jsx(q,{children:e.jsx(M,{className:"p-6",children:F?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(V,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-2",children:"Loading emergency contacts..."})]}):L.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(K,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Emergency Contacts"}),e.jsx("p",{className:"text-gray-600 mb-4",children:o?"No emergency contacts found for this child.":"No emergency contacts found. Select a child to add contacts."}),o&&e.jsxs(j,{onClick:H,children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Add First Contact"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:L.map(t=>e.jsx(q,{className:"relative",children:e.jsxs(M,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:t.contact_name}),t.is_primary&&e.jsx(xe,{className:"w-4 h-4 text-yellow-500 fill-current"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>O(t),children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>m(t.id),className:"text-red-600 hover:text-red-700",children:e.jsx(ge,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ee,{variant:"outline",className:"text-xs",children:t.relationship}),!o&&e.jsx(ee,{variant:"secondary",className:"text-xs",children:s(t.child_id)})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:t.phone})]}),t.email&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(le,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:t.email})]}),t.address&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-xs",children:t.address})]})]})]})]})},t.id))})})}),e.jsx(se,{open:b,onOpenChange:g,children:e.jsxs(te,{children:[e.jsxs(ae,{children:[e.jsx(ne,{children:"Add Emergency Contact"}),e.jsxs(re,{children:["Add a new emergency contact for ",o?s(o):"your child","."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"contact_name",children:"Contact Name"}),e.jsx(x,{id:"contact_name",value:d.contact_name,onChange:t=>p(n=>({...n,contact_name:t.target.value})),placeholder:"Full name"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"relationship",children:"Relationship"}),e.jsx(x,{id:"relationship",value:d.relationship,onChange:t=>p(n=>({...n,relationship:t.target.value})),placeholder:"e.g., Mother, Father, Grandparent"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"phone",children:"Phone Number"}),e.jsx(x,{id:"phone",value:d.phone,onChange:t=>p(n=>({...n,phone:t.target.value})),placeholder:"Phone number"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"email",children:"Email (Optional)"}),e.jsx(x,{id:"email",type:"email",value:d.email,onChange:t=>p(n=>({...n,email:t.target.value})),placeholder:"Email address"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"address",children:"Address (Optional)"}),e.jsx(v,{id:"address",value:d.address,onChange:t=>p(n=>({...n,address:t.target.value})),placeholder:"Full address",rows:2})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"is_primary",checked:d.is_primary,onChange:t=>p(n=>({...n,is_primary:t.target.checked})),className:"rounded"}),e.jsx(i,{htmlFor:"is_primary",children:"Primary contact"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(j,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsxs(j,{onClick:Q,disabled:!d.contact_name||!d.relationship||!d.phone||P.isPending,children:[P.isPending&&e.jsx(V,{className:"w-4 h-4 mr-2 animate-spin"}),"Add Contact"]})]})]})]})}),e.jsx(se,{open:w,onOpenChange:a,children:e.jsxs(te,{children:[e.jsxs(ae,{children:[e.jsx(ne,{children:"Edit Emergency Contact"}),e.jsx(re,{children:"Update the emergency contact information."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"edit_contact_name",children:"Contact Name"}),e.jsx(x,{id:"edit_contact_name",value:d.contact_name,onChange:t=>p(n=>({...n,contact_name:t.target.value})),placeholder:"Full name"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"edit_relationship",children:"Relationship"}),e.jsx(x,{id:"edit_relationship",value:d.relationship,onChange:t=>p(n=>({...n,relationship:t.target.value})),placeholder:"e.g., Mother, Father, Grandparent"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"edit_phone",children:"Phone Number"}),e.jsx(x,{id:"edit_phone",value:d.phone,onChange:t=>p(n=>({...n,phone:t.target.value})),placeholder:"Phone number"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"edit_email",children:"Email (Optional)"}),e.jsx(x,{id:"edit_email",type:"email",value:d.email,onChange:t=>p(n=>({...n,email:t.target.value})),placeholder:"Email address"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"edit_address",children:"Address (Optional)"}),e.jsx(v,{id:"edit_address",value:d.address,onChange:t=>p(n=>({...n,address:t.target.value})),placeholder:"Full address",rows:2})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"edit_is_primary",checked:d.is_primary,onChange:t=>p(n=>({...n,is_primary:t.target.checked})),className:"rounded"}),e.jsx(i,{htmlFor:"edit_is_primary",children:"Primary contact"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(j,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsxs(j,{onClick:r,disabled:!d.contact_name||!d.relationship||!d.phone||D.isPending,children:[D.isPending&&e.jsx(V,{className:"w-4 h-4 mr-2 animate-spin"}),"Update Contact"]})]})]})]})})]})},Ke=({open:c,onOpenChange:h,onChildAdded:l})=>{const{user:o}=ce(),{toast:u}=I(),b=G(),[g,w]=T.useState(1),[a,C]=T.useState({first_name:"",last_name:"",date_of_birth:"",gender:"",nationality:"British",student_id:"",school_name:"",school_address:"",grade_level:"",class_name:"",school_start_date:"",pickup_location:"",dropoff_location:"",alternative_pickup_locations:[],transport_days:["monday","tuesday","wednesday","thursday","friday"],transport_type:"both",morning_pickup_time:"",afternoon_dropoff_time:"",special_schedule_notes:"",holiday_transport_needed:!1,allergies:[],medical_conditions:[],medications:[],emergency_procedures:"",medical_alert_info:"",mobility_requirements:"",communication_needs:"",behavioral_considerations:"",required_equipment:[],transport_consent:!1,medical_consent:!1,photo_consent:!1,data_protection_consent:!1,emergency_contacts:[],payment_method:"",billing_address:"",discount_eligible:!1,payment_schedule:"",notification_preferences:{sms:!0,email:!0,app:!0,emergency_alerts:!0},language_preference:"english"}),{data:S=[]}=$({queryKey:["schools"],queryFn:async()=>{const{data:s,error:t}=await _.from("schools").select("*").eq("is_active",!0).order("name");if(t)throw t;return s||[]}}),d=6,p=g/d*100,L=[{id:1,name:"Basic Information",icon:he},{id:2,name:"Transport Details",icon:_e},{id:3,name:"Medical Information",icon:fe},{id:4,name:"Emergency Contacts",icon:K},{id:5,name:"Legal & Consent",icon:me},{id:6,name:"Review & Submit",icon:A}],F=z({mutationFn:async s=>{if(!(o!=null&&o.id))throw new Error("User not authenticated");const{data:t,error:n}=await _.from("child_profiles").insert({parent_id:o.id,...s,emergency_contacts:void 0}).select().single();if(n)throw n;if(s.emergency_contacts.length>0){const f=s.emergency_contacts.map(Y=>({child_id:t.id,...Y})),{error:k}=await _.from("emergency_contacts").insert(f);if(k)throw k}return t},onSuccess:()=>{b.invalidateQueries({queryKey:["parent-children"]}),u({title:"Child Registration Successful",description:"Your child has been registered for transport services."}),h(!1),l==null||l(),P()},onError:s=>{console.error("Error creating child:",s),u({title:"Registration Failed",description:"There was an error registering your child. Please try again.",variant:"destructive"})}}),P=()=>{C({first_name:"",last_name:"",date_of_birth:"",gender:"",nationality:"British",student_id:"",school_name:"",school_address:"",grade_level:"",class_name:"",school_start_date:"",pickup_location:"",dropoff_location:"",alternative_pickup_locations:[],transport_days:["monday","tuesday","wednesday","thursday","friday"],transport_type:"both",morning_pickup_time:"",afternoon_dropoff_time:"",special_schedule_notes:"",holiday_transport_needed:!1,allergies:[],medical_conditions:[],medications:[],emergency_procedures:"",medical_alert_info:"",mobility_requirements:"",communication_needs:"",behavioral_considerations:"",required_equipment:[],transport_consent:!1,medical_consent:!1,photo_consent:!1,data_protection_consent:!1,emergency_contacts:[],payment_method:"",billing_address:"",discount_eligible:!1,payment_schedule:"",notification_preferences:{sms:!0,email:!0,app:!0,emergency_alerts:!0},language_preference:"english"}),w(1)},D=()=>{g<d&&w(g+1)},U=()=>{g>1&&w(g-1)},Q=()=>{F.mutate(a)},r=(s,t)=>{C(n=>({...n,[s]:t}))},m=(s,t,n)=>{C(f=>({...f,emergency_contacts:f.emergency_contacts.map((k,Y)=>Y===s?{...k,[t]:n}:k)}))},N=()=>{C(s=>({...s,emergency_contacts:[...s.emergency_contacts,{contact_name:"",relationship:"",phone:"",email:"",address:"",contact_type:"general",is_primary:!1,can_authorize_treatment:!1}]}))},O=s=>{C(t=>({...t,emergency_contacts:t.emergency_contacts.filter((n,f)=>f!==s)}))},H=()=>{switch(g){case 1:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"first_name",children:"First Name *"}),e.jsx(x,{id:"first_name",value:a.first_name,onChange:s=>r("first_name",s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"last_name",children:"Last Name *"}),e.jsx(x,{id:"last_name",value:a.last_name,onChange:s=>r("last_name",s.target.value),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"date_of_birth",children:"Date of Birth *"}),e.jsx(x,{id:"date_of_birth",type:"date",value:a.date_of_birth,onChange:s=>r("date_of_birth",s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"gender",children:"Gender"}),e.jsxs(J,{value:a.gender,onValueChange:s=>r("gender",s),children:[e.jsx(W,{children:e.jsx(X,{placeholder:"Select gender"})}),e.jsxs(Z,{children:[e.jsx(E,{value:"male",children:"Male"}),e.jsx(E,{value:"female",children:"Female"}),e.jsx(E,{value:"other",children:"Other"}),e.jsx(E,{value:"prefer_not_to_say",children:"Prefer not to say"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"nationality",children:"Nationality"}),e.jsx(x,{id:"nationality",value:a.nationality,onChange:s=>r("nationality",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"student_id",children:"Student ID"}),e.jsx(x,{id:"student_id",value:a.student_id,onChange:s=>r("student_id",s.target.value),placeholder:"School student ID"})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"school_name",children:"School *"}),e.jsxs(J,{value:a.school_name,onValueChange:s=>r("school_name",s),children:[e.jsx(W,{children:e.jsx(X,{placeholder:"Select school"})}),e.jsx(Z,{children:S.map(s=>e.jsx(E,{value:s.name,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"grade_level",children:"Grade/Year Level *"}),e.jsx(x,{id:"grade_level",value:a.grade_level,onChange:s=>r("grade_level",s.target.value),placeholder:"e.g., Year 3, Grade 5",required:!0})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"class_name",children:"Class"}),e.jsx(x,{id:"class_name",value:a.class_name,onChange:s=>r("class_name",s.target.value),placeholder:"e.g., Class 3A"})]})]})]});case 2:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"pickup_location",children:"Pickup Location *"}),e.jsx(x,{id:"pickup_location",value:a.pickup_location,onChange:s=>r("pickup_location",s.target.value),placeholder:"Full address",required:!0})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"dropoff_location",children:"Dropoff Location *"}),e.jsx(x,{id:"dropoff_location",value:a.dropoff_location,onChange:s=>r("dropoff_location",s.target.value),placeholder:"School address",required:!0})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"transport_type",children:"Transport Type *"}),e.jsxs(J,{value:a.transport_type,onValueChange:s=>r("transport_type",s),children:[e.jsx(W,{children:e.jsx(X,{placeholder:"Select transport type"})}),e.jsxs(Z,{children:[e.jsx(E,{value:"morning_only",children:"Morning Only"}),e.jsx(E,{value:"afternoon_only",children:"Afternoon Only"}),e.jsx(E,{value:"both",children:"Both Morning & Afternoon"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"morning_pickup_time",children:"Morning Pickup Time"}),e.jsx(x,{id:"morning_pickup_time",type:"time",value:a.morning_pickup_time,onChange:s=>r("morning_pickup_time",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"afternoon_dropoff_time",children:"Afternoon Dropoff Time"}),e.jsx(x,{id:"afternoon_dropoff_time",type:"time",value:a.afternoon_dropoff_time,onChange:s=>r("afternoon_dropoff_time",s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"special_schedule_notes",children:"Special Schedule Notes"}),e.jsx(v,{id:"special_schedule_notes",value:a.special_schedule_notes,onChange:s=>r("special_schedule_notes",s.target.value),placeholder:"Any special scheduling requirements"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{id:"holiday_transport",checked:a.holiday_transport_needed,onCheckedChange:s=>r("holiday_transport_needed",s)}),e.jsx(i,{htmlFor:"holiday_transport",children:"Holiday transport needed"})]})]});case 3:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"allergies",children:"Allergies"}),e.jsx(v,{id:"allergies",value:a.allergies.join(", "),onChange:s=>r("allergies",s.target.value.split(",").map(t=>t.trim()).filter(Boolean)),placeholder:"List any allergies (separate with commas)"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"medical_conditions",children:"Medical Conditions"}),e.jsx(v,{id:"medical_conditions",value:a.medical_conditions.join(", "),onChange:s=>r("medical_conditions",s.target.value.split(",").map(t=>t.trim()).filter(Boolean)),placeholder:"List any medical conditions (separate with commas)"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"medications",children:"Medications"}),e.jsx(v,{id:"medications",value:a.medications.join(", "),onChange:s=>r("medications",s.target.value.split(",").map(t=>t.trim()).filter(Boolean)),placeholder:"List any medications (separate with commas)"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"emergency_procedures",children:"Emergency Procedures"}),e.jsx(v,{id:"emergency_procedures",value:a.emergency_procedures,onChange:s=>r("emergency_procedures",s.target.value),placeholder:"Emergency procedures for medical conditions"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"medical_alert_info",children:"Medical Alert Information"}),e.jsx(v,{id:"medical_alert_info",value:a.medical_alert_info,onChange:s=>r("medical_alert_info",s.target.value),placeholder:"Any medical alert information"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"mobility_requirements",children:"Mobility Requirements"}),e.jsx(v,{id:"mobility_requirements",value:a.mobility_requirements,onChange:s=>r("mobility_requirements",s.target.value),placeholder:"Any mobility requirements or assistance needed"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"communication_needs",children:"Communication Needs"}),e.jsx(v,{id:"communication_needs",value:a.communication_needs,onChange:s=>r("communication_needs",s.target.value),placeholder:"Any communication needs or preferences"})]})]});case 4:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Emergency Contacts"}),e.jsxs(j,{type:"button",variant:"outline",size:"sm",onClick:N,children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Add Contact"]})]}),a.emergency_contacts.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-4"}),e.jsx("p",{children:"No emergency contacts added yet."}),e.jsx("p",{className:"text-sm",children:'Click "Add Contact" to add emergency contacts.'})]}):e.jsx("div",{className:"space-y-4",children:a.emergency_contacts.map((s,t)=>e.jsxs(q,{children:[e.jsx(R,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(B,{className:"text-base",children:["Contact ",t+1]}),e.jsx(j,{type:"button",variant:"ghost",size:"sm",onClick:()=>O(t),children:"Remove"})]})}),e.jsxs(M,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Contact Name *"}),e.jsx(x,{value:s.contact_name,onChange:n=>m(t,"contact_name",n.target.value),placeholder:"Full name"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Relationship *"}),e.jsx(x,{value:s.relationship,onChange:n=>m(t,"relationship",n.target.value),placeholder:"e.g., Mother, Father, Grandparent"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Phone Number *"}),e.jsx(x,{value:s.phone,onChange:n=>m(t,"phone",n.target.value),placeholder:"Phone number"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Email"}),e.jsx(x,{type:"email",value:s.email,onChange:n=>m(t,"email",n.target.value),placeholder:"Email address"})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Address"}),e.jsx(v,{value:s.address,onChange:n=>m(t,"address",n.target.value),placeholder:"Full address",rows:2})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{checked:s.is_primary,onCheckedChange:n=>m(t,"is_primary",n)}),e.jsx(i,{children:"Primary Contact"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{checked:s.can_authorize_treatment,onCheckedChange:n=>m(t,"can_authorize_treatment",n)}),e.jsx(i,{children:"Can Authorize Medical Treatment"})]})]})]})]},t))})]});case 5:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Consent Forms"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{id:"transport_consent",checked:a.transport_consent,onCheckedChange:s=>r("transport_consent",s)}),e.jsx(i,{htmlFor:"transport_consent",children:"I consent to my child using the transport service"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{id:"medical_consent",checked:a.medical_consent,onCheckedChange:s=>r("medical_consent",s)}),e.jsx(i,{htmlFor:"medical_consent",children:"I consent to emergency medical treatment if required"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{id:"photo_consent",checked:a.photo_consent,onCheckedChange:s=>r("photo_consent",s)}),e.jsx(i,{htmlFor:"photo_consent",children:"I consent to photos/videos being taken for safety purposes"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{id:"data_protection_consent",checked:a.data_protection_consent,onCheckedChange:s=>r("data_protection_consent",s)}),e.jsx(i,{htmlFor:"data_protection_consent",children:"I consent to my data being processed in accordance with GDPR"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Communication Preferences"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{id:"sms_notifications",checked:a.notification_preferences.sms,onCheckedChange:s=>r("notification_preferences",{...a.notification_preferences,sms:s})}),e.jsx(i,{htmlFor:"sms_notifications",children:"SMS Notifications"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{id:"email_notifications",checked:a.notification_preferences.email,onCheckedChange:s=>r("notification_preferences",{...a.notification_preferences,email:s})}),e.jsx(i,{htmlFor:"email_notifications",children:"Email Notifications"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{id:"app_notifications",checked:a.notification_preferences.app,onCheckedChange:s=>r("notification_preferences",{...a.notification_preferences,app:s})}),e.jsx(i,{htmlFor:"app_notifications",children:"App Notifications"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{id:"emergency_alerts",checked:a.notification_preferences.emergency_alerts,onCheckedChange:s=>r("notification_preferences",{...a.notification_preferences,emergency_alerts:s})}),e.jsx(i,{htmlFor:"emergency_alerts",children:"Emergency Alerts"})]})]})]})]});case 6:return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Review Registration Details"}),e.jsxs(q,{children:[e.jsx(R,{children:e.jsx(B,{className:"text-base",children:"Basic Information"})}),e.jsx(M,{className:"space-y-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Name:"})," ",a.first_name," ",a.last_name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date of Birth:"})," ",a.date_of_birth]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Gender:"})," ",a.gender]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Nationality:"})," ",a.nationality]}),e.jsxs("div",{children:[e.jsx("strong",{children:"School:"})," ",a.school_name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Grade:"})," ",a.grade_level]})]})})]}),e.jsxs(q,{children:[e.jsx(R,{children:e.jsx(B,{className:"text-base",children:"Transport Details"})}),e.jsx(M,{className:"space-y-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Pickup:"})," ",a.pickup_location]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Dropoff:"})," ",a.dropoff_location]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Type:"})," ",a.transport_type]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Morning Time:"})," ",a.morning_pickup_time]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Afternoon Time:"})," ",a.afternoon_dropoff_time]})]})})]}),e.jsxs(q,{children:[e.jsx(R,{children:e.jsx(B,{className:"text-base",children:"Emergency Contacts"})}),e.jsx(M,{children:a.emergency_contacts.length===0?e.jsx("p",{className:"text-gray-500",children:"No emergency contacts added"}):e.jsx("div",{className:"space-y-2",children:a.emergency_contacts.map((s,t)=>e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:s.contact_name})," (",s.relationship,") - ",s.phone,s.is_primary&&e.jsx(ee,{className:"ml-2",children:"Primary"})]},t))})})]}),e.jsxs(q,{children:[e.jsx(R,{children:e.jsx(B,{className:"text-base",children:"Consent Status"})}),e.jsx(M,{children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{className:`w-4 h-4 ${a.transport_consent?"text-green-500":"text-gray-300"}`}),e.jsx("span",{children:"Transport Consent"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{className:`w-4 h-4 ${a.medical_consent?"text-green-500":"text-gray-300"}`}),e.jsx("span",{children:"Medical Consent"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{className:`w-4 h-4 ${a.photo_consent?"text-green-500":"text-gray-300"}`}),e.jsx("span",{children:"Photo Consent"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{className:`w-4 h-4 ${a.data_protection_consent?"text-green-500":"text-gray-300"}`}),e.jsx("span",{children:"Data Protection Consent"})]})]})})]})]})});default:return null}};return e.jsx(se,{open:c,onOpenChange:h,children:e.jsxs(te,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ae,{children:[e.jsx(ne,{children:"Register Child for Transport"}),e.jsx(re,{children:"Complete the registration process for your child's transport service."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{children:["Step ",g," of ",d]}),e.jsxs("span",{children:[Math.round(p),"% Complete"]})]}),e.jsx(ue,{value:p,className:"w-full"}),e.jsx("div",{className:"flex items-center justify-between",children:L.map((s,t)=>{const n=s.icon,f=g===s.id,k=g>s.id;return e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${k?"bg-green-500 text-white":f?"bg-blue-500 text-white":"bg-gray-200 text-gray-500"}`,children:k?e.jsx(A,{className:"w-4 h-4"}):e.jsx(n,{className:"w-4 h-4"})}),e.jsx("span",{className:`text-xs text-center ${f?"text-blue-600 font-medium":"text-gray-500"}`,children:s.name})]},s.id)})})]}),e.jsx("div",{className:"py-6",children:H()}),e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t",children:[e.jsxs(j,{type:"button",variant:"outline",onClick:U,disabled:g===1,children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Previous"]}),e.jsx("div",{className:"flex items-center space-x-2",children:g<d?e.jsxs(j,{onClick:D,children:["Next",e.jsx(de,{className:"w-4 h-4 ml-2"})]}):e.jsx(j,{onClick:Q,disabled:F.isPending,children:F.isPending?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 mr-2 animate-spin"}),"Registering..."]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Complete Registration"]})})})]})]})})};export{Ke as C,$e as E,be as u};
