import{q as _e,J as Ce,s as D,P as $,j as e,H as T,B as c,X as De,i as j,k as y,l as N,n as g,W as q,m as ee,E as v,ay as Te,r as h,N as ge,S as pe,F as fe,I as X,a0 as Re,D as se,d as te,e as re,f as ae,g as ie,Y as d,a6 as ve,v as Fe}from"./main-piTIAPSx.js";import{T as Oe}from"./textarea-mxcr8nPj.js";import{S as I,a as V,b as M,c as K,d as a}from"./select-Brm_N20Q.js";import{T as We,a as Le,b as B,c as qe}from"./tabs-N5TLptOb.js";import{u as G}from"./useQuery-Dbdyc74j.js";import{O as ze}from"./OrganizationSelector-DtT31ciB.js";import{u as le}from"./useMutation-B8vlA97s.js";import{P as Ee}from"./progress-nJfMQ3MC.js";import{P as ye}from"./play-CKKdwP8m.js";import{C as ce}from"./circle-check-big-CD0jvDn0.js";import{R as Ne}from"./refresh-cw-BS9rbMP7.js";import{P as we}from"./plus-CMGcTuiR.js";import{S as be}from"./search-HDsNrIL9.js";import{S as Pe}from"./square-pen-DnuZJKej.js";import{C as Ae}from"./car-B9KPzxYH.js";import{Z as Ie}from"./zap-C72QVc6f.js";import"./index-Pp_niZQ8.js";const Ve=({defectId:n,onClose:i})=>{const{profile:x}=_e(),p=Ce(),{data:o,isLoading:z}=G({queryKey:["defect",n],queryFn:async()=>{console.log("🔍 Fetching defect:",n);const{data:t,error:l}=await D.from("combined_defects").select(`
          id,
          defect_number,
          title,
          description,
          defect_type,
          severity,
          status,
          organization_id,
          source_type
        `).eq("id",n).single();if(l)throw console.error("❌ Error fetching defect:",l),l;return console.log("✅ Defect fetched:",t),t}}),{data:_=[],isLoading:R}=G({queryKey:["work-order-stages",n],queryFn:async()=>{console.log("🔍 Fetching work order stages for defect:",n);const{data:t,error:l}=await D.from("work_order_stages").select("*").eq("defect_id",n).order("stage_order");if(l)throw console.error("❌ Error fetching stages:",l),l;return console.log("✅ Stages fetched:",t),t||[]},enabled:!!n}),C=le({mutationFn:async()=>{console.log("🔧 Starting work order for defect:",n),console.log("🔧 Using mechanic ID:",x==null?void 0:x.id),console.log("🔧 Defect type:",o==null?void 0:o.defect_type);const{data:t,error:l}=await D.rpc("start_work_order",{p_defect_id:n,p_mechanic_id:x==null?void 0:x.id});if(l)throw console.error("❌ Error starting work order:",l),l;return console.log("✅ Work order started:",t),t},onSuccess:()=>{p.invalidateQueries({queryKey:["work-order-stages",n]}),p.invalidateQueries({queryKey:["defect",n]}),$({title:"Work Order Started",description:"Work order has been initiated successfully."})},onError:t=>{console.error("❌ Start work order failed:",t),$({title:"Error",description:"Failed to start work order. Please try again.",variant:"destructive"})}}),F=le({mutationFn:async({stageId:t,status:l})=>{const{data:H,error:U}=await D.from("work_order_stages").update({status:l,started_at:l==="in_progress"?new Date().toISOString():void 0,completed_at:l==="completed"?new Date().toISOString():void 0,mechanic_id:x==null?void 0:x.id,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(U)throw U;return H},onSuccess:()=>{p.invalidateQueries({queryKey:["work-order-stages",n]})}}),Q=le({mutationFn:async()=>{const{data:t,error:l}=await D.rpc("complete_work_order",{p_defect_id:n,p_mechanic_id:x==null?void 0:x.id});if(l)throw l;return t},onSuccess:()=>{p.invalidateQueries({queryKey:["work-order-stages",n]}),p.invalidateQueries({queryKey:["defect",n]}),$({title:"Work Order Completed",description:"Work order has been completed successfully."})}});if(z)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading workflow..."})]})});if(!o)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx(T,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("p",{className:"text-red-500 mb-4",children:"Defect not found"}),e.jsx(c,{onClick:i,variant:"outline",children:"Close"})]});const w=_.filter(t=>t.status==="completed").length,b=_.length,E=b>0?w/b*100:0,O=o.status==="repairing",W=o.status==="reported"||o.status==="investigating";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Defect Workflow"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[o.defect_number," - ",o.title]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Type: ",o.defect_type," | Source: ",o.source_type]})]}),e.jsx(c,{onClick:i,variant:"outline",children:e.jsx(De,{className:"w-4 h-4"})})]}),e.jsxs(j,{className:"border-yellow-200 bg-yellow-50",children:[e.jsx(y,{children:e.jsx(N,{className:"text-yellow-800",children:"Debug Information"})}),e.jsx(g,{children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Defect ID:"})," ",n]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Defect Type:"})," ",o.defect_type]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",o.status]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Work Order Number:"})," Not Available"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Stages:"})," ",b]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Completed Stages:"})," ",w]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Can Start Work Order:"})," ",W?"Yes":"No"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Is Work Order Started:"})," ",O?"Yes":"No"]})]})})]}),e.jsxs(j,{children:[e.jsxs(y,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),"Work Order Status"]}),e.jsx(ee,{children:"Work Order Status"})]}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Progress"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[w," of ",b," stages completed"]})]}),e.jsx(v,{variant:o.status==="resolved"?"default":"secondary",children:o.status})]}),e.jsx(Ee,{value:E,className:"w-full"}),W&&e.jsxs(c,{onClick:()=>C.mutate(),disabled:C.isPending,className:"w-full",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),C.isPending?"Starting...":"Start Work Order"]})]})})]}),O&&_.length>0&&e.jsxs(j,{children:[e.jsxs(y,{children:[e.jsx(N,{children:"Workflow Stages"}),e.jsx(ee,{children:"Follow the workflow to complete the repair"})]}),e.jsx(g,{children:e.jsx("div",{className:"space-y-4",children:_.map(t=>e.jsxs("div",{className:`p-4 border rounded-lg ${t.status==="completed"?"border-green-500 bg-green-50":t.status==="in_progress"?"border-yellow-500 bg-yellow-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:t.stage_name}),e.jsx(v,{variant:t.status==="completed"?"default":t.status==="in_progress"?"secondary":"outline",children:t.status})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.status==="pending"&&e.jsx(c,{onClick:()=>F.mutate({stageId:t.id,status:"in_progress"}),size:"sm",children:"Start"}),t.status==="in_progress"&&e.jsx(c,{onClick:()=>F.mutate({stageId:t.id,status:"completed"}),size:"sm",variant:"outline",children:"Complete"})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:t.notes})]},t.id))})})]}),O&&_.length===0&&e.jsxs(j,{className:"border-red-200 bg-red-50",children:[e.jsx(y,{children:e.jsxs(N,{className:"text-red-800 flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"No Workflow Stages Found"]})}),e.jsxs(g,{children:[e.jsx("p",{className:"text-red-700 mb-4",children:"The work order was started but no workflow stages were created. This might be due to:"}),e.jsxs("ul",{className:"text-red-700 text-sm space-y-1 mb-4",children:[e.jsxs("li",{children:["• No workflow template found for defect type: ",e.jsx("strong",{children:o.defect_type})]}),e.jsx("li",{children:"• The start_work_order function failed to create stages"}),e.jsx("li",{children:"• Database permissions issue"})]}),e.jsxs(c,{onClick:()=>C.mutate(),disabled:C.isPending,variant:"outline",className:"border-red-300 text-red-700 hover:bg-red-100",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Retry Starting Work Order"]})]})]}),O&&w===b&&b>0&&e.jsxs(j,{className:"border-green-500 bg-green-50",children:[e.jsxs(y,{children:[e.jsxs(N,{className:"flex items-center gap-2 text-green-800",children:[e.jsx(ce,{className:"w-5 h-5"}),"Ready to Complete"]}),e.jsx(ee,{className:"text-green-700",children:"All stages are completed. Ready to finalize the work order."})]}),e.jsx(g,{children:e.jsxs(c,{onClick:()=>Q.mutate(),disabled:Q.isPending,className:"w-full bg-green-600 hover:bg-green-700",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Complete Work Order"]})})]})]})},cs=()=>{var he,ue;const{user:n,profile:i,loading:x}=_e(),{selectedOrganizationId:p,setSelectedOrganizationId:o}=Te();Ce();const[z,_]=h.useState("all"),[R,C]=h.useState(""),[F,Q]=h.useState("all"),[w,b]=h.useState("all"),[E,O]=h.useState("all"),[W,t]=h.useState(!1),[l,H]=h.useState(!1),[U,Y]=h.useState(!1),[Se,Z]=h.useState(!1),[r,J]=h.useState(null),[m,S]=h.useState({title:"",description:"",defect_type:"mechanical",severity:"medium",location:"",estimated_cost:0,vehicle_id:"",additional_notes:""}),f=(i==null?void 0:i.role)==="mechanic"?p:i==null?void 0:i.organization_id,{data:L=[],isLoading:ke,error:Me}=G({queryKey:["combined-defects",f,i==null?void 0:i.role],queryFn:async()=>{if(!f)return[];try{let s=D.from("combined_defects").select(`
            id,
            defect_number,
            vehicle_id,
            reported_by,
            title,
            description,
            defect_type,
            severity,
            status,
            location,
            defect_date,
            estimated_cost,
            actual_cost,
            created_at,
            updated_at,
            organization_id,
            source_type
          `).order("created_at",{ascending:!1});s=s.eq("organization_id",f);const{data:u,error:k}=await s;return k?(console.error("Error fetching defect reports:",k),[]):(u||[]).map(A=>({...A,defect_date:A.defect_date,source_type:A.source_type||"defect_report"}))}catch(s){return console.error("Error in defect fetching:",s),[]}},enabled:!!f,staleTime:0,gcTime:0,refetchOnWindowFocus:!0,refetchOnMount:!0,refetchInterval:5e3,refetchIntervalInBackground:!0});if(G({queryKey:["vehicles",f],queryFn:async()=>{if(!f)return[];const{data:s,error:u}=await D.from("vehicles").select("id, make, model").eq("organization_id",f).order("make");return u?(console.error("Error fetching vehicles:",u),[]):s||[]},enabled:!!f,staleTime:0,gcTime:0}),h.useEffect(()=>{W&&S({title:"",description:"",defect_type:"mechanical",severity:"medium",location:"",estimated_cost:0,vehicle_id:"",additional_notes:""})},[W]),x)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading defect reports..."})]})});if(!n)return e.jsx(ge,{to:"/auth",replace:!0});if((i==null?void 0:i.role)==="mechanic"&&!p)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Select Organization"}),e.jsx(ze,{onOrganizationSelect:o,selectedOrganizationId:p||void 0})]})});if(!i)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(T,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-red-900 mb-2",children:"Profile Loading Issue"}),e.jsx("p",{className:"text-red-500 mb-4",children:"Unable to load user profile. Please refresh the page."}),e.jsxs(c,{onClick:()=>window.location.reload(),variant:"outline",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Refresh Page"]})]})});if(i.role!=="mechanic"&&i.role!=="admin"&&i.role!=="council")return e.jsx(ge,{to:"/dashboard",replace:!0});const P=L.filter(s=>{const u=R===""||s.title.toLowerCase().includes(R.toLowerCase())||s.description.toLowerCase().includes(R.toLowerCase())||s.defect_number.toLowerCase().includes(R.toLowerCase()),k=F==="all"||s.severity===F,je=w==="all"||s.status===w,A=E==="all"||s.defect_type===E;return u&&k&&je&&A}),ne=(()=>{switch(z){case"reported":return P.filter(s=>s.status==="reported");case"investigating":return P.filter(s=>s.status==="investigating");case"repairing":return P.filter(s=>s.status==="repairing");case"resolved":return P.filter(s=>s.status==="resolved");default:return P}})(),oe=s=>{switch(s){case"critical":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},de=s=>{switch(s){case"reported":return"bg-blue-100 text-blue-800";case"investigating":return"bg-yellow-100 text-yellow-800";case"repairing":return"bg-orange-100 text-orange-800";case"resolved":return"bg-green-100 text-green-800";case"closed":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},xe=s=>{switch(s){case"reported":return e.jsx(T,{className:"w-4 h-4"});case"investigating":return e.jsx(be,{className:"w-4 h-4"});case"repairing":return e.jsx(q,{className:"w-4 h-4"});case"resolved":return e.jsx(ce,{className:"w-4 h-4"});case"closed":return e.jsx(fe,{className:"w-4 h-4"});default:return e.jsx(Fe,{className:"w-4 h-4"})}},me=s=>{switch(s){case"safety":return e.jsx(pe,{className:"w-4 h-4"});case"mechanical":return e.jsx(q,{className:"w-4 h-4"});case"electrical":return e.jsx(Ie,{className:"w-4 h-4"});case"cosmetic":return e.jsx(Ae,{className:"w-4 h-4"});default:return e.jsx(T,{className:"w-4 h-4"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Defect Reports"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage and track vehicle defects and issues"})]}),e.jsxs(c,{onClick:()=>t(!0),children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Create Defect Report"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(j,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Total Defects"}),e.jsx(T,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold",children:L.length}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[L.filter(s=>s.status==="resolved").length," resolved"]})]})]}),e.jsxs(j,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Critical Issues"}),e.jsx(pe,{className:"h-4 w-4 text-red-500"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:L.filter(s=>s.severity==="critical").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Require immediate attention"})]})]}),e.jsxs(j,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"In Progress"}),e.jsx(q,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:L.filter(s=>s.status==="investigating"||s.status==="repairing").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Being investigated or repaired"})]})]}),e.jsxs(j,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Total Cost"}),e.jsx(fe,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(g,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["£",L.reduce((s,u)=>s+(u.actual_cost||0),0).toLocaleString()]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total repair costs"})]})]})]}),e.jsx(j,{children:e.jsx(g,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(be,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(X,{placeholder:"Search defect...",value:R,onChange:s=>C(s.target.value),className:"pl-10"})]})}),e.jsxs(I,{value:F,onValueChange:Q,children:[e.jsx(V,{className:"w-[180px]",children:e.jsx(M,{placeholder:"All Severity"})}),e.jsxs(K,{children:[e.jsx(a,{value:"all",children:"All Severity"}),e.jsx(a,{value:"critical",children:"Critical"}),e.jsx(a,{value:"high",children:"High"}),e.jsx(a,{value:"medium",children:"Medium"}),e.jsx(a,{value:"low",children:"Low"})]})]}),e.jsxs(I,{value:w,onValueChange:b,children:[e.jsx(V,{className:"w-[180px]",children:e.jsx(M,{placeholder:"All Status"})}),e.jsxs(K,{children:[e.jsx(a,{value:"all",children:"All Status"}),e.jsx(a,{value:"reported",children:"Reported"}),e.jsx(a,{value:"investigating",children:"Investigating"}),e.jsx(a,{value:"repairing",children:"Repairing"}),e.jsx(a,{value:"resolved",children:"Resolved"}),e.jsx(a,{value:"closed",children:"Closed"})]})]}),e.jsxs(I,{value:E,onValueChange:O,children:[e.jsx(V,{className:"w-[180px]",children:e.jsx(M,{placeholder:"All Types"})}),e.jsxs(K,{children:[e.jsx(a,{value:"all",children:"All Types"}),e.jsx(a,{value:"safety",children:"Safety"}),e.jsx(a,{value:"mechanical",children:"Mechanical"}),e.jsx(a,{value:"electrical",children:"Electrical"}),e.jsx(a,{value:"cosmetic",children:"Cosmetic"}),e.jsx(a,{value:"other",children:"Other"})]})]})]})})}),e.jsxs(We,{value:z,onValueChange:_,className:"space-y-4",children:[e.jsxs(Le,{children:[e.jsx(B,{value:"all",children:"All Reports"}),e.jsx(B,{value:"reported",children:"Reported"}),e.jsx(B,{value:"investigating",children:"Investigating"}),e.jsx(B,{value:"repairing",children:"Repairing"}),e.jsx(B,{value:"resolved",children:"Resolved"})]}),e.jsx(qe,{value:z,className:"space-y-4",children:ke?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})}):ne.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(T,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No defect reports found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"No defect reports found for the selected organization."}),f?e.jsxs(c,{onClick:()=>t(!0),children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Create Defect Report"]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-red-500 text-sm",children:"Organization ID is not set. This may prevent data from loading."}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(c,{onClick:()=>window.location.reload(),variant:"outline",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Refresh Page"]})})]})]}):e.jsx("div",{className:"space-y-4",children:ne.map(s=>{var u,k;return e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-semibold",children:s.defect_number}),e.jsx(v,{className:oe(s.severity),children:s.severity}),e.jsxs(v,{className:de(s.status),children:[xe(s.status),s.status]}),e.jsxs(v,{variant:"outline",className:"flex items-center gap-1",children:[me(s.defect_type),s.defect_type]}),e.jsx(v,{variant:"secondary",className:"text-xs",children:s.source_type==="vehicle_check"?"Vehicle Check":"Manual Report"})]}),e.jsx("h5",{className:"font-medium text-lg mb-1",children:s.title}),e.jsx("p",{className:"text-gray-600 text-sm mb-2",children:s.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Vehicle:"}),e.jsxs("p",{className:"font-medium",children:[(u=s.vehicle)==null?void 0:u.make," ",(k=s.vehicle)==null?void 0:k.model]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Location:"}),e.jsx("p",{className:"font-medium",children:s.location})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Reported:"}),e.jsx("p",{className:"font-medium",children:new Date(s.defect_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Cost:"}),e.jsxs("p",{className:"font-medium",children:["£",s.actual_cost||s.estimated_cost]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:()=>{J(s),Y(!0)},children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>{J(s),H(!0)},children:e.jsx(Pe,{className:"w-4 h-4"})}),s.status==="reported"||s.status==="investigating"?e.jsxs(c,{variant:"default",size:"sm",onClick:()=>{J(s),Z(!0)},children:[e.jsx(q,{className:"w-4 h-4"}),"Start Work"]}):s.status==="repairing"?e.jsxs(c,{variant:"secondary",size:"sm",onClick:()=>{J(s),Z(!0)},children:[e.jsx(q,{className:"w-4 h-4"}),"Continue Work"]}):null]})]})},s.id)})})})]}),e.jsx(se,{open:W,onOpenChange:t,children:e.jsxs(te,{className:"max-w-2xl",children:[e.jsxs(re,{children:[e.jsx(ae,{children:"Create Defect Report"}),e.jsx(ie,{children:"Report a new vehicle defect or issue"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"title",children:"Title"}),e.jsx(X,{id:"title",value:m.title,onChange:s=>S({...m,title:s.target.value}),placeholder:"Brief description of the defect"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"description",children:"Description"}),e.jsx(Oe,{id:"description",value:m.description,onChange:s=>S({...m,description:s.target.value}),placeholder:"Detailed description of the defect",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"defect_type",children:"Type"}),e.jsxs(I,{value:m.defect_type,onValueChange:s=>S({...m,defect_type:s}),children:[e.jsx(V,{children:e.jsx(M,{})}),e.jsxs(K,{children:[e.jsx(a,{value:"safety",children:"Safety"}),e.jsx(a,{value:"mechanical",children:"Mechanical"}),e.jsx(a,{value:"electrical",children:"Electrical"}),e.jsx(a,{value:"cosmetic",children:"Cosmetic"}),e.jsx(a,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"severity",children:"Severity"}),e.jsxs(I,{value:m.severity,onValueChange:s=>S({...m,severity:s}),children:[e.jsx(V,{children:e.jsx(M,{})}),e.jsxs(K,{children:[e.jsx(a,{value:"low",children:"Low"}),e.jsx(a,{value:"medium",children:"Medium"}),e.jsx(a,{value:"high",children:"High"}),e.jsx(a,{value:"critical",children:"Critical"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"location",children:"Location"}),e.jsx(X,{id:"location",value:m.location,onChange:s=>S({...m,location:s.target.value}),placeholder:"Where the defect is located"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"estimated_cost",children:"Estimated Cost"}),e.jsx(X,{id:"estimated_cost",type:"number",value:m.estimated_cost,onChange:s=>S({...m,estimated_cost:parseFloat(s.target.value)||0}),placeholder:"0.00"})]})]}),e.jsxs(ve,{children:[e.jsx(c,{variant:"outline",onClick:()=>t(!1),children:"Cancel"}),e.jsx(c,{onClick:()=>{t(!1),$({title:"Defect Report Created",description:"The defect report has been created successfully."})},children:"Create Report"})]})]})}),e.jsx(se,{open:U,onOpenChange:Y,children:e.jsxs(te,{className:"max-w-2xl",children:[e.jsxs(re,{children:[e.jsx(ae,{children:"Defect Report Details"}),e.jsx(ie,{children:r==null?void 0:r.defect_number})]}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium text-gray-500",children:"Title"}),e.jsx("p",{className:"text-lg font-medium",children:r.title})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium text-gray-500",children:"Status"}),e.jsxs(v,{className:de(r.status),children:[xe(r.status),r.status]})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium text-gray-500",children:"Description"}),e.jsx("p",{className:"text-gray-700",children:r.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium text-gray-500",children:"Vehicle"}),e.jsxs("p",{className:"font-medium",children:[(he=r.vehicle)==null?void 0:he.make," ",(ue=r.vehicle)==null?void 0:ue.model]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium text-gray-500",children:"Location"}),e.jsx("p",{className:"font-medium",children:r.location})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium text-gray-500",children:"Severity"}),e.jsx(v,{className:oe(r.severity),children:r.severity})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium text-gray-500",children:"Type"}),e.jsxs(v,{variant:"outline",className:"flex items-center gap-1",children:[me(r.defect_type),r.defect_type]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium text-gray-500",children:"Estimated Cost"}),e.jsxs("p",{className:"font-medium",children:["£",r.estimated_cost]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium text-gray-500",children:"Actual Cost"}),e.jsxs("p",{className:"font-medium",children:["£",r.actual_cost||0]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium text-gray-500",children:"Reported"}),e.jsx("p",{className:"font-medium",children:new Date(r.defect_date).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium text-gray-500",children:"Last Updated"}),e.jsx("p",{className:"font-medium",children:new Date(r.updated_at).toLocaleString()})]})]})]}),e.jsxs(ve,{children:[e.jsx(c,{variant:"outline",onClick:()=>Y(!1),children:"Close"}),r&&e.jsx(c,{onClick:()=>{Y(!1),H(!0)},children:"Edit Defect Report"})]})]})}),e.jsx(se,{open:Se,onOpenChange:Z,children:e.jsxs(te,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(re,{children:[e.jsx(ae,{children:"Defect Workflow"}),e.jsxs(ie,{children:[r==null?void 0:r.defect_number," - ",r==null?void 0:r.title]})]}),r&&e.jsx(Ve,{defectId:r.id,onClose:()=>Z(!1)})]})})]})};export{cs as default};
