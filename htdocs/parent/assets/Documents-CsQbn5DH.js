import{c as w,q as E,s as b,J as _,$ as g,a as Ne,r as N,j as e,N as fe,H as ve,B as n,D as H,b as we,d as R,e as K,f as P,Y as S,I as Q,i as x,n as h,F as p,v as be,ab as G,k as J,l as $,a0 as De,E as W}from"./main-piTIAPSx.js";import{S as Y,a as Z,b as X,c as ee,d as F}from"./select-Brm_N20Q.js";import{T as Ce,a as Se,b as T,c as u,d as Fe,e as o}from"./table-CV1HM_JF.js";import{T as Te,a as ze,b as z,c as k}from"./tabs-N5TLptOb.js";import{u as ke}from"./useQuery-Dbdyc74j.js";import{u as B}from"./useMutation-B8vlA97s.js";import{R as se}from"./refresh-cw-BS9rbMP7.js";import{P as ae}from"./plus-CMGcTuiR.js";import{U as qe}from"./upload-CgVQC7ku.js";import{C as Ee}from"./circle-check-big-CD0jvDn0.js";import{S as _e}from"./search-HDsNrIL9.js";import{D as q}from"./download-C4W0Vf38.js";import{T as te}from"./trash-2-CMjiaIVh.js";import{S as Be}from"./square-pen-DnuZJKej.js";import{f as ne}from"./format-VbeFDANp.js";import"./index-Pp_niZQ8.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=w("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=w("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=w("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=w("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),Me=()=>{const{user:l,profile:a}=E();return ke({queryKey:["documents",a==null?void 0:a.organization_id],queryFn:async()=>{if(!(a!=null&&a.organization_id))throw new Error("Organization ID is required");console.log("Fetching documents from database...");const{data:c,error:i}=await b.from("documents").select("*").eq("organization_id",a.organization_id).order("created_at",{ascending:!1});if(i)throw console.error("Error fetching documents:",i),i;return console.log("Fetched documents:",c),c||[]},enabled:!!(a!=null&&a.organization_id)})},Ue=()=>{const{profile:l}=E(),a=_();return B({mutationFn:async c=>{if(!(l!=null&&l.organization_id)||!(l!=null&&l.id))throw new Error("Organization and user information required");const{data:i,error:d}=await b.from("documents").insert({...c,organization_id:l.organization_id,uploaded_by:l.id}).select().single();if(d)throw d;return i},onSuccess:()=>{a.invalidateQueries({queryKey:["documents"]}),g.success("Document created successfully")},onError:c=>{console.error("Error creating document:",c),g.error("Failed to create document: "+c.message)}})},Ae=()=>{const l=_();return B({mutationFn:async({id:a,updates:c})=>{const{data:i,error:d}=await b.from("documents").update(c).eq("id",a).select().single();if(d)throw d;return i},onSuccess:()=>{l.invalidateQueries({queryKey:["documents"]}),g.success("Document updated successfully")},onError:a=>{console.error("Error updating document:",a),g.error("Failed to update document: "+a.message)}})},Oe=()=>{const l=_();return B({mutationFn:async a=>{const{error:c}=await b.from("documents").delete().eq("id",a);if(c)throw c},onSuccess:()=>{l.invalidateQueries({queryKey:["documents"]}),g.success("Document deleted successfully")},onError:a=>{console.error("Error deleting document:",a),g.error("Failed to delete document: "+a.message)}})},as=()=>{const{user:l,profile:a,loading:c}=E(),{toast:i}=Ne(),[d,ie]=N.useState(""),[D,de]=N.useState("all"),[oe,me]=N.useState(!1),[r,xe]=N.useState(null),[he,L]=N.useState(!1),{data:ue=[],isLoading:C,error:M,refetch:U}=Me();Ue(),Ae();const je=Oe();if(c||C)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading document management..."})]})});if(!l||!a)return e.jsx(fe,{to:"/auth",replace:!0});if(M)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ve,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-red-900 mb-2",children:"Error Loading Documents"}),e.jsx("p",{className:"text-red-700 mb-4",children:M.message}),e.jsxs(n,{onClick:()=>U(),variant:"outline",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Try Again"]})]})});const j=ue.map(s=>{var t;return{id:s.id,name:s.name,type:((t=s.file_type)==null?void 0:t.toUpperCase())||"UNKNOWN",category:s.category||"other",size:ge(s.file_size),uploadedBy:s.uploaded_by||"Unknown",uploadedAt:s.created_at,status:s.status||"pending",expiryDate:s.expiry_date,tags:s.tags||[],isConfidential:!s.is_public,downloadCount:s.download_count||0}}),m=j.reduce((s,t)=>(s[t.category]=(s[t.category]||0)+1,s),{}),f=[{id:"compliance",name:"Compliance Documents",count:m.compliance||0},{id:"insurance",name:"Insurance & Certificates",count:m.insurance||0},{id:"vehicle",name:"Vehicle Documents",count:m.vehicle||0},{id:"driver",name:"Driver Documents",count:m.driver||0},{id:"operational",name:"Operational Documents",count:m.operational||0},{id:"financial",name:"Financial Documents",count:m.financial||0},{id:"other",name:"Other Documents",count:m.other||0}],A=s=>{const t={approved:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",rejected:"bg-red-100 text-red-800",expired:"bg-gray-100 text-gray-800",active:"bg-blue-100 text-blue-800"};return e.jsx(W,{className:t[s]||"bg-gray-100 text-gray-800",children:s})},pe=s=>{switch(s.toLowerCase()){case"pdf":return e.jsx(p,{className:"w-4 h-4 text-red-600"});case"xlsx":case"xls":return e.jsx(le,{className:"w-4 h-4 text-green-600"});case"jpg":case"jpeg":case"png":return e.jsx(Le,{className:"w-4 h-4 text-purple-600"});default:return e.jsx(le,{className:"w-4 h-4 text-gray-600"})}},ge=s=>{if(s===0)return"0 Bytes";const t=1024,y=["Bytes","KB","MB","GB"],V=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,V)).toFixed(2))+" "+y[V]},O=j.filter(s=>{const t=s.name.toLowerCase().includes(d.toLowerCase()),y=D==="all"||s.category===D;return t&&y}),v={totalDocuments:j.length,approvedDocuments:j.filter(s=>s.status==="approved"||s.status==="active").length,pendingDocuments:j.filter(s=>s.status==="pending").length,confidentialDocs:j.filter(s=>s.isConfidential).length},ye=s=>{xe(s),L(!0)},I=async s=>{if(confirm("Are you sure you want to delete this document?"))try{await je.mutateAsync(s),i({title:"Document Deleted",description:"Document has been successfully deleted."})}catch{i({title:"Delete Failed",description:"Failed to delete document. Please try again.",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(re,{className:"w-8 h-8 text-blue-600"}),"Document Management"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Organize, manage, and track all company documents"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(n,{onClick:()=>U(),variant:"outline",disabled:C,children:[e.jsx(se,{className:`w-4 h-4 mr-2 ${C?"animate-spin":""}`}),"Refresh"]}),e.jsxs(H,{open:oe,onOpenChange:me,children:[e.jsx(we,{asChild:!0,children:e.jsxs(n,{className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Upload Document"]})}),e.jsxs(R,{className:"max-w-2xl",children:[e.jsx(K,{children:e.jsx(P,{children:"Upload New Document"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"document-name",children:"Document Name"}),e.jsx(Q,{id:"document-name",placeholder:"Enter document name"})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"category",children:"Category"}),e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsx(X,{placeholder:"Select category"})}),e.jsx(ee,{children:f.map(s=>e.jsx(F,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"file-upload",children:"Select Files"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(qe,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Drag and drop files here, or click to browse"}),e.jsx(n,{variant:"outline",size:"sm",children:"Select Files"})]})]}),e.jsx(n,{className:"w-full bg-blue-600 hover:bg-blue-700",children:"Upload Document"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(x,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(p,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Documents"}),e.jsx("p",{className:"text-2xl font-bold",children:v.totalDocuments})]})]})})}),e.jsx(x,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ee,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Approved"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:v.approvedDocuments})]})]})})}),e.jsx(x,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(be,{className:"w-8 h-8 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:v.pendingDocuments})]})]})})}),e.jsx(x,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(G,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Confidential"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:v.confidentialDocs})]})]})})})]}),e.jsxs(Te,{defaultValue:"documents",className:"space-y-6",children:[e.jsxs(ze,{className:"grid w-full grid-cols-3",children:[e.jsx(z,{value:"documents",children:"All Documents"}),e.jsx(z,{value:"categories",children:"Categories"}),e.jsx(z,{value:"reports",children:"Reports"})]}),e.jsx(k,{value:"documents",className:"space-y-4",children:e.jsxs(x,{children:[e.jsxs(J,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-5 h-5"}),"Document Library"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Q,{placeholder:"Search documents...",value:d,onChange:s=>ie(s.target.value),className:"pl-10"})]}),e.jsxs(Y,{value:D,onValueChange:de,children:[e.jsx(Z,{className:"w-48",children:e.jsx(X,{})}),e.jsxs(ee,{children:[e.jsx(F,{value:"all",children:"All Categories"}),f.map(s=>e.jsx(F,{value:s.id,children:s.name},s.id))]})]})]})]}),e.jsx(h,{children:e.jsxs(Ce,{children:[e.jsx(Se,{children:e.jsxs(T,{children:[e.jsx(u,{children:"Document"}),e.jsx(u,{children:"Category"}),e.jsx(u,{children:"Uploaded By"}),e.jsx(u,{children:"Upload Date"}),e.jsx(u,{children:"Status"}),e.jsx(u,{children:"Downloads"}),e.jsx(u,{children:"Actions"})]})}),e.jsx(Fe,{children:O.length===0?e.jsx(T,{children:e.jsx(o,{colSpan:7,className:"text-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(p,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No documents found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Try adjusting your search or filters"})]})})}):O.map(s=>{var t;return e.jsxs(T,{children:[e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[pe(s.type),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:s.type}),e.jsx("span",{children:"•"}),e.jsx("span",{children:s.size}),s.isConfidential&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx(G,{className:"w-3 h-3"})]})]})]})]})}),e.jsx(o,{className:"capitalize",children:((t=f.find(y=>y.id===s.category))==null?void 0:t.name)||s.category}),e.jsx(o,{children:s.uploadedBy}),e.jsx(o,{children:new Date(s.uploadedAt).toLocaleDateString()}),e.jsx(o,{children:A(s.status)}),e.jsx(o,{children:s.downloadCount}),e.jsx(o,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"outline",size:"sm",onClick:()=>ye(s),children:e.jsx(De,{className:"w-4 h-4"})}),e.jsx(n,{variant:"outline",size:"sm",children:e.jsx(q,{className:"w-4 h-4"})}),e.jsx(n,{variant:"outline",size:"sm",children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>I(s.id),children:e.jsx(te,{className:"w-4 h-4 text-red-500"})})]})})]},s.id)})})]})})]})}),e.jsx(k,{value:"categories",className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:f.map(s=>e.jsx(x,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-gray-100",children:e.jsx(re,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.count," documents"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"outline",size:"sm",className:"flex-1",children:"View Documents"}),e.jsx(n,{size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:e.jsx(ae,{className:"w-4 h-4"})})]})]})},s.id))})}),e.jsx(k,{value:"reports",className:"space-y-4",children:e.jsxs(x,{children:[e.jsx(J,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-5 h-5"}),"Document Reports"]})}),e.jsx(h,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(p,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Generate Document Reports"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Create comprehensive reports on document compliance and usage analytics."}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(n,{className:"bg-blue-600 hover:bg-blue-700",children:"Generate Report"}),e.jsxs(n,{variant:"outline",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Export Data"]})]})]})})]})})]}),e.jsx(H,{open:he,onOpenChange:L,children:e.jsxs(R,{className:"max-w-4xl",children:[e.jsx(K,{children:e.jsx(P,{children:"Document Details"})}),r&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Document Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Name:"}),e.jsx("span",{className:"font-medium",children:r.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Type:"}),e.jsx("span",{children:r.type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Size:"}),e.jsx("span",{children:r.size})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsx("span",{className:"capitalize",children:r.category})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{children:A(r.status)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Uploaded By:"}),e.jsx("span",{children:r.uploadedBy})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Upload Date:"}),e.jsx("span",{children:ne(new Date(r.uploadedAt),"MMM dd, yyyy")})]}),r.expiryDate&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Expiry Date:"}),e.jsx("span",{children:ne(new Date(r.expiryDate),"MMM dd, yyyy")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Downloads:"}),e.jsx("span",{children:r.downloadCount})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Actions"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{className:"w-full",variant:"outline",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Download Document"]}),e.jsxs(n,{className:"w-full",variant:"outline",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Share Document"]}),e.jsxs(n,{className:"w-full",variant:"outline",children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Edit Details"]}),e.jsxs(n,{className:"w-full",variant:"outline",onClick:()=>I(r.id),children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Delete Document"]})]})]})]}),r.tags&&r.tags.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.tags.map((s,t)=>e.jsx(W,{variant:"outline",children:s},t))})]})]})]})})]})};export{as as default};
