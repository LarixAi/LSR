import{c as Ve,q as Ye,a as Ue,J as Oe,r as y,s as ee,j as e,V as w,N as je,H as ge,B as m,M as S,i as c,n as d,v as se,k as x,l as h,I as te,D as pe,b as ze,a0 as Be,d as Ne,e as ve,f as be,U as fe,C as ye,a1 as B,O as we,E as u,F as Q,R as Qe}from"./main-piTIAPSx.js";import{S as _e,a as Ce,b as Se,c as Ie,d as _}from"./select-Brm_N20Q.js";import{T as Ke,a as We,b as k,c as D}from"./tabs-N5TLptOb.js";import{u as $e}from"./useQuery-Dbdyc74j.js";import{u as ke}from"./useMutation-B8vlA97s.js";import{i as Ge,c as Xe,a as ae}from"./isToday-DoQ2uobv.js";import{C as E}from"./circle-check-big-CD0jvDn0.js";import{N as L}from"./navigation-D0f2KySn.js";import{S as Ze}from"./search-HDsNrIL9.js";import{P as De}from"./phone-D7pMV1Uy.js";import{S as H}from"./send-CbMnoHMq.js";import{R as K}from"./receipt-BrJ1A-bt.js";import{a as es}from"./addDays-BrXT1AzW.js";import{i as ss}from"./isYesterday-CmLfbEy4.js";import{p as le}from"./parseISO-JZi9Nyn6.js";import{f as ts}from"./format-VbeFDANp.js";import"./index-Pp_niZQ8.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=Ve("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);function ls(M){return Ge(M,es(Xe(M),1))}const ys=()=>{const{user:M,profile:n,loading:Pe}=Ye(),{toast:P}=Ue(),W=Oe(),[J,Je]=y.useState(""),[$,Te]=y.useState("all"),[l,Fe]=y.useState(null),[Ae,G]=y.useState(!1),[r,T]=y.useState([]),[ne,re]=y.useState(""),[v,F]=y.useState("select"),[i,A]=y.useState({invoiceNumber:"",totalAmount:0,jobsIncluded:[],notes:"",dueDate:"",specialRequests:"",paymentTerms:"30 days",contactInfo:""}),{data:I=[],isLoading:Re,error:Ee}=$e({queryKey:["driver-jobs",n==null?void 0:n.id],queryFn:async()=>{if(!(n!=null&&n.id))throw new Error("No driver ID found");const{data:s,error:t}=await ee.from("jobs").select("*").eq("assigned_driver_id",n.id).order("created_at",{ascending:!1});if(t)throw console.error("Error fetching jobs:",t),t;return s||[]},enabled:!!(n!=null&&n.id)}),Le=()=>{const s=I.filter(o=>o.status==="completed"),t=20,a=s.map(o=>{const p=o.actual_duration?o.actual_duration/60:8,z=p*t;return{job_id:o.id,job_title:o.title,hours_worked:p,hourly_rate:t,total_payment:z,status:"pending",job_date:o.start_date||o.created_at}}),g=a.reduce((o,p)=>o+p.hours_worked,0),C=a.reduce((o,p)=>o+p.total_payment,0),U=a.filter(o=>{const p=new Date(o.job_date),z=new Date;return p.getMonth()===z.getMonth()&&p.getFullYear()===z.getFullYear()}).reduce((o,p)=>o+p.total_payment,0),O={total_hours:g,total_earnings:C,jobs_count:a.length,average_hourly_rate:t,monthly_earnings:U,pending_payments:a.filter(o=>o.status==="pending").length};return{payments:a,summary:O}},{payments:j,summary:b}=Le(),R=ke({mutationFn:async s=>{if(!(n!=null&&n.id))throw new Error("No driver ID found");const{data:t,error:a}=await ee.from("driver_invoices").insert({...s,driver_id:n.id,organization_id:n.organization_id,status:"sent",created_at:new Date().toISOString(),due_date:new Date(Date.now()+30*24*60*60*1e3).toISOString()}).select().single();if(a)throw a;return t},onSuccess:()=>{W.invalidateQueries({queryKey:["driver-invoices"]}),P({title:"Invoice Sent Successfully!",description:"Your invoice has been sent to management for review. You will be notified when payment is processed."}),Me()},onError:s=>{console.error("Error creating invoice:",s),P({title:"Error",description:"Failed to send invoice. Please try again.",variant:"destructive"})}}),He=()=>{var a;const s=Date.now(),t=((a=n==null?void 0:n.id)==null?void 0:a.slice(0,8))||"DRIVER";return`INV-${s}-${t}`},ie=()=>{if(v==="select"){if(r.length===0){P({title:"No Jobs Selected",description:"Please select at least one job to include in the invoice.",variant:"destructive"});return}const t=j.filter(a=>r.includes(a.job_id)).reduce((a,g)=>a+g.total_payment,0);A({...i,invoiceNumber:He(),totalAmount:t,jobsIncluded:r,notes:ne,dueDate:new Date(Date.now()+30*24*60*60*1e3).toISOString().split("T")[0]}),F("review")}else v==="review"&&F("confirm")},ce=()=>{v==="review"?F("select"):v==="confirm"&&F("review")},de=()=>{R.mutate({invoice_number:i.invoiceNumber,total_amount:i.totalAmount,jobs_included:i.jobsIncluded,notes:i.notes,due_date:i.dueDate})},Me=()=>{F("select"),T([]),re(""),A({invoiceNumber:"",totalAmount:0,jobsIncluded:[],notes:"",dueDate:"",specialRequests:"",paymentTerms:"30 days",contactInfo:""})},N=ke({mutationFn:async({jobId:s,status:t})=>{const{data:a,error:g}=await ee.from("jobs").update({status:t}).eq("id",s).select().single();if(g)throw g;return a},onSuccess:()=>{W.invalidateQueries({queryKey:["driver-jobs"]}),P({title:"Job Updated",description:"Job status updated successfully"})},onError:s=>{console.error("Error updating job:",s),P({title:"Error",description:"Failed to update job status",variant:"destructive"})}});if(Pe)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(w,{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading jobs..."})]})});if(!M||!n)return e.jsx(je,{to:"/auth",replace:!0});if(n.role!=="driver")return e.jsx(je,{to:"/dashboard",replace:!0});const q=s=>{switch(s){case"completed":return e.jsx(u,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"Completed"});case"in_progress":return e.jsx(u,{className:"bg-blue-100 text-blue-800 hover:bg-blue-100",children:"In Progress"});case"assigned":return e.jsx(u,{className:"bg-purple-100 text-purple-800 hover:bg-purple-100",children:"Assigned"});case"pending":return e.jsx(u,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"Pending"});case"cancelled":return e.jsx(u,{className:"bg-red-100 text-red-800 hover:bg-red-100",children:"Cancelled"});default:return e.jsx(u,{variant:"secondary",children:s})}},V=s=>{switch(s){case"urgent":return e.jsx(u,{className:"bg-red-100 text-red-800 hover:bg-red-100",children:"Urgent"});case"high":return e.jsx(u,{className:"bg-orange-100 text-orange-800 hover:bg-orange-100",children:"High"});case"medium":return e.jsx(u,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"Medium"});case"low":return e.jsx(u,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"Low"});default:return e.jsx(u,{variant:"secondary",children:s})}},qe=s=>{var g,C;const t=((g=s.title)==null?void 0:g.toLowerCase())||"",a=((C=s.description)==null?void 0:C.toLowerCase())||"";return t.includes("school")||a.includes("school")?e.jsx(fe,{className:"w-4 h-4"}):t.includes("medical")||a.includes("medical")?e.jsx(ge,{className:"w-4 h-4"}):t.includes("charter")||a.includes("charter")?e.jsx(Qe,{className:"w-4 h-4"}):e.jsx(S,{className:"w-4 h-4"})},f=s=>{if(!s)return"No date set";const t=le(s);return ae(t)?"Today":ls(t)?"Tomorrow":ss(t)?"Yesterday":ts(t,"MMM dd, yyyy")},X=s=>s||"No time set",Z=I.filter(s=>{var g,C,U,O;const t=((g=s.title)==null?void 0:g.toLowerCase().includes(J.toLowerCase()))||((C=s.pickup_location)==null?void 0:C.toLowerCase().includes(J.toLowerCase()))||((U=s.delivery_location)==null?void 0:U.toLowerCase().includes(J.toLowerCase()))||((O=s.customer_name)==null?void 0:O.toLowerCase().includes(J.toLowerCase())),a=$==="all"||s.status===$;return t&&a}),oe=Z.filter(s=>s.status==="assigned"||s.status==="in_progress"),me=Z.filter(s=>s.status==="pending"),xe=Z.filter(s=>s.status==="completed"),Y={totalJobs:I.filter(s=>s.start_date&&ae(le(s.start_date))).length,completedJobs:I.filter(s=>s.status==="completed"&&s.start_date&&ae(le(s.start_date))).length,upcomingJobs:I.filter(s=>s.status==="pending"||s.status==="assigned").length,inProgressJobs:I.filter(s=>s.status==="in_progress").length},he=s=>{N.mutate({jobId:s,status:"in_progress"})},ue=s=>{N.mutate({jobId:s,status:"completed"})};return Re?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(w,{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading your jobs..."})]})}):Ee?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ge,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error Loading Jobs"}),e.jsx("p",{className:"text-gray-600",children:"Unable to load your jobs. Please try again later."}),e.jsx(m,{className:"mt-4",onClick:()=>W.invalidateQueries({queryKey:["driver-jobs"]}),children:"Retry"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(S,{className:"w-8 h-8 text-blue-600"}),"My Jobs"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"View and manage your assigned transport jobs"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(c,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(S,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Today's Jobs"}),e.jsx("p",{className:"text-2xl font-bold",children:Y.totalJobs})]})]})})}),e.jsx(c,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:Y.completedJobs})]})]})})}),e.jsx(c,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"w-8 h-8 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Upcoming"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:Y.upcomingJobs})]})]})})}),e.jsx(c,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"In Progress"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:Y.inProgressJobs})]})]})})})]}),e.jsxs(Ke,{defaultValue:"current",className:"space-y-6",children:[e.jsxs(We,{className:"grid w-full grid-cols-6",children:[e.jsx(k,{value:"current",children:"Current Jobs"}),e.jsx(k,{value:"upcoming",children:"Upcoming"}),e.jsx(k,{value:"completed",children:"Completed"}),e.jsx(k,{value:"payment",children:"Payment"}),e.jsx(k,{value:"invoice",children:"Invoice"}),e.jsx(k,{value:"history",children:"Job History"})]}),e.jsx(D,{value:"current",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5"}),"Active & Today's Jobs"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(te,{placeholder:"Search jobs...",value:J,onChange:s=>Je(s.target.value),className:"pl-10"})]}),e.jsxs(_e,{value:$,onValueChange:Te,children:[e.jsx(Ce,{className:"w-48",children:e.jsx(Se,{})}),e.jsxs(Ie,{children:[e.jsx(_,{value:"all",children:"All Status"}),e.jsx(_,{value:"assigned",children:"Assigned"}),e.jsx(_,{value:"in_progress",children:"In Progress"}),e.jsx(_,{value:"completed",children:"Completed"})]})]})]})]}),e.jsx(d,{children:oe.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(L,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Current Jobs"}),e.jsx("p",{className:"text-gray-600",children:"You don't have any active jobs at the moment."})]}):e.jsx("div",{className:"space-y-4",children:oe.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[qe(s),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.title}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.start_date&&f(s.start_date)," • ",s.start_time&&X(s.start_time)]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[q(s.status),V(s.priority),e.jsxs(pe,{children:[e.jsx(ze,{asChild:!0,children:e.jsx(m,{variant:"outline",size:"sm",onClick:()=>Fe(s),children:e.jsx(Be,{className:"w-4 h-4"})})}),e.jsxs(Ne,{className:"max-w-2xl",children:[e.jsx(ve,{children:e.jsx(be,{children:s.title})}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Job Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{children:q(l.status)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Priority:"}),e.jsx("span",{children:V(l.priority)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Date:"}),e.jsx("span",{children:f(l.start_date)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Time:"}),e.jsx("span",{children:X(l.start_time)})]}),l.estimated_duration&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Duration:"}),e.jsxs("span",{children:[l.estimated_duration," minutes"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Customer Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[l.customer_name&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Customer:"}),e.jsx("p",{children:l.customer_name})]}),l.customer_contact&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Contact:"}),e.jsx("p",{children:l.customer_contact})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Route Information"}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[l.pickup_location&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(S,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"font-medium",children:"Pickup:"}),e.jsx("span",{children:l.pickup_location})]}),l.delivery_location&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"font-medium",children:"Destination:"}),e.jsx("span",{children:l.delivery_location})]})]})]}),l.description&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Description"}),e.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded",children:l.description})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[l.status==="assigned"&&e.jsxs(m,{className:"bg-blue-600 hover:bg-blue-700",onClick:()=>he(l.id),disabled:N.isPending,children:[N.isPending?e.jsx(w,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(L,{className:"w-4 h-4 mr-2"}),"Start Job"]}),l.status==="in_progress"&&e.jsxs(m,{className:"bg-green-600 hover:bg-green-700",onClick:()=>ue(l.id),disabled:N.isPending,children:[N.isPending?e.jsx(w,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(E,{className:"w-4 h-4 mr-2"}),"Mark Complete"]}),l.customer_contact&&e.jsxs(m,{variant:"outline",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Contact Customer"]})]})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-3",children:[s.pickup_location&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(S,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{children:["From: ",s.pickup_location]})]}),s.delivery_location&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(S,{className:"w-4 h-4 text-red-600"}),e.jsxs("span",{children:["To: ",s.delivery_location]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[s.estimated_duration&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"w-4 h-4"}),s.estimated_duration," min"]}),s.customer_name&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"w-4 h-4"}),s.customer_name]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.status==="assigned"&&e.jsxs(m,{size:"sm",className:"bg-blue-600 hover:bg-blue-700",onClick:()=>he(s.id),disabled:N.isPending,children:[N.isPending?e.jsx(w,{className:"w-4 h-4 animate-spin"}):e.jsx(L,{className:"w-4 h-4 mr-1"}),"Start"]}),s.status==="in_progress"&&e.jsxs(m,{size:"sm",className:"bg-green-600 hover:bg-green-700",onClick:()=>ue(s.id),disabled:N.isPending,children:[N.isPending?e.jsx(w,{className:"w-4 h-4 animate-spin"}):e.jsx(E,{className:"w-4 h-4 mr-1"}),"Complete"]}),s.customer_contact&&e.jsx(m,{variant:"outline",size:"sm",children:e.jsx(De,{className:"w-4 h-4"})})]})]})]},s.id))})})]})}),e.jsx(D,{value:"upcoming",className:"space-y-4",children:e.jsxs(c,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"Upcoming Jobs"]})}),e.jsx(d,{children:me.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ye,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Upcoming Jobs"}),e.jsx("p",{className:"text-gray-600",children:"You don't have any upcoming jobs scheduled."})]}):e.jsx("div",{className:"space-y-4",children:me.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold",children:s.title}),e.jsxs("div",{className:"flex gap-2",children:[q(s.status),V(s.priority)]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:["Date: ",f(s.start_date)," • Time: ",X(s.start_time)]}),s.pickup_location&&e.jsxs("p",{children:["Pickup: ",s.pickup_location]}),s.delivery_location&&e.jsxs("p",{children:["Destination: ",s.delivery_location]})]})]},s.id))})})]})}),e.jsx(D,{value:"completed",className:"space-y-4",children:e.jsxs(c,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"Completed Jobs"]})}),e.jsx(d,{children:xe.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Completed Jobs"}),e.jsx("p",{className:"text-gray-600",children:"You haven't completed any jobs yet."})]}):e.jsx("div",{className:"space-y-4",children:xe.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 bg-green-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold",children:s.title}),e.jsxs("div",{className:"flex gap-2",children:[q(s.status),V(s.priority)]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:["Completed: ",f(s.updated_at)]}),s.actual_duration&&e.jsxs("p",{children:["Duration: ",s.actual_duration," minutes"]}),s.pickup_location&&e.jsxs("p",{children:["Pickup: ",s.pickup_location]}),s.delivery_location&&e.jsxs("p",{children:["Destination: ",s.delivery_location]})]})]},s.id))})})]})}),e.jsxs(D,{value:"payment",className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(c,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Total Hours"}),e.jsx(se,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[b.total_hours.toFixed(1),"h"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All completed jobs"})]})]}),e.jsxs(c,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Total Earnings"}),e.jsx(B,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["£",b.total_earnings.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Lifetime earnings"})]})]}),e.jsxs(c,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Monthly Earnings"}),e.jsx(we,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["£",b.monthly_earnings.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This month"})]})]}),e.jsxs(c,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Hourly Rate"}),e.jsx(as,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["£",b.average_hourly_rate,"/h"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Average rate"})]})]})]}),e.jsxs(c,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),"Payment Details"]})}),e.jsxs(d,{children:[j.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(B,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Payment Records"}),e.jsx("p",{className:"text-gray-600",children:"Complete some jobs to see your payment details."})]}):e.jsx("div",{className:"space-y-4",children:j.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("input",{type:"checkbox",checked:r.includes(s.job_id),onChange:t=>{t.target.checked?T([...r,s.job_id]):T(r.filter(a=>a!==s.job_id))},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Include in invoice"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.job_title}),e.jsxs("p",{className:"text-sm text-gray-600",children:[f(s.job_date)," • ",s.hours_worked.toFixed(1)," hours"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["£",s.total_payment.toFixed(2)]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["@ £",s.hourly_rate,"/hour"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{variant:"outline",children:[s.hours_worked.toFixed(1),"h worked"]}),e.jsx(u,{variant:s.status==="paid"?"default":s.status==="overdue"?"destructive":"secondary",children:s.status.charAt(0).toUpperCase()+s.status.slice(1)})]}),s.payment_date&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Paid: ",f(s.payment_date)]})]})]},s.job_id))}),j.length>0&&e.jsx("div",{className:"mt-6 pt-6 border-t",children:e.jsxs(m,{onClick:()=>G(!0),disabled:r.length===0,className:"w-full",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Send Invoice to Management",r.length>0&&e.jsxs(u,{variant:"secondary",className:"ml-2",children:[r.length," selected"]})]})})]})]}),e.jsxs(c,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5"}),"Payment Summary"]})}),e.jsxs(d,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:b.jobs_count}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Jobs Completed"})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["£",b.total_earnings.toFixed(2)]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Earnings"})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:b.pending_payments}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending Payments"})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Payment Information"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"• Payments are calculated based on actual hours worked"}),e.jsxs("li",{children:["• Hourly rate: £",b.average_hourly_rate,"/hour"]}),e.jsxs("li",{children:["• Monthly earnings: £",b.monthly_earnings.toFixed(2)]}),e.jsx("li",{children:"• Contact HR for payment status updates"})]})]})]})]})]}),e.jsxs(D,{value:"invoice",className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(c,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Pending Invoices"}),e.jsx(K,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:j.filter(s=>s.status==="pending").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Awaiting payment"})]})]}),e.jsxs(c,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Total Invoiced"}),e.jsx(B,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["£",j.reduce((s,t)=>s+t.total_payment,0).toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All completed jobs"})]})]}),e.jsxs(c,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Ready to Invoice"}),e.jsx(H,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:j.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Available jobs"})]})]})]}),e.jsxs(c,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"Create New Invoice",v!=="select"&&e.jsxs(u,{variant:"outline",className:"ml-2",children:["Step ",v==="review"?"2":"3"," of 3"]})]})}),e.jsx(d,{children:j.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(K,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Jobs Available for Invoice"}),e.jsx("p",{className:"text-gray-600",children:"Complete some jobs first to create invoices."})]}):e.jsxs("div",{className:"space-y-6",children:[v==="select"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Step 1: Select Jobs for Invoice"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Choose the completed jobs you want to include in your invoice. You can select multiple jobs to create a single invoice."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Available Jobs"}),e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:j.map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:r.includes(s.job_id),onChange:t=>{t.target.checked?T([...r,s.job_id]):T(r.filter(a=>a!==s.job_id))},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:s.job_title}),e.jsxs("span",{className:"font-bold text-green-600",children:["£",s.total_payment.toFixed(2)]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[f(s.job_date)," • ",s.hours_worked.toFixed(1)," hours @ £",s.hourly_rate,"/hour"]})]})]},s.job_id))})]}),r.length>0&&e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-900 mb-2",children:"Invoice Summary"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Selected Jobs:"}),e.jsx("span",{className:"font-medium",children:r.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Amount:"}),e.jsxs("span",{className:"font-bold text-lg text-green-600",children:["£",j.filter(s=>r.includes(s.job_id)).reduce((s,t)=>s+t.total_payment,0).toFixed(2)]})]})]})]}),e.jsxs(m,{onClick:ie,disabled:r.length===0,className:"w-full",size:"lg",children:["Next: Review Invoice",e.jsx(H,{className:"w-4 h-4 ml-2"})]})]}),v==="review"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"Step 2: Review Invoice Details"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"Review your invoice details and add any additional information before sending to management."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Invoice Number"}),e.jsx(te,{value:i.invoiceNumber,readOnly:!0,className:"bg-gray-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Due Date"}),e.jsx(te,{type:"date",value:i.dueDate,onChange:s=>A({...i,dueDate:s.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Additional Notes"}),e.jsx("textarea",{value:i.notes,onChange:s=>A({...i,notes:s.target.value}),placeholder:"Add any special requests, notes, or additional information...",className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Payment Terms"}),e.jsxs(_e,{value:i.paymentTerms,onValueChange:s=>A({...i,paymentTerms:s}),children:[e.jsx(Ce,{children:e.jsx(Se,{})}),e.jsxs(Ie,{children:[e.jsx(_,{value:"7 days",children:"7 days"}),e.jsx(_,{value:"14 days",children:"14 days"}),e.jsx(_,{value:"30 days",children:"30 days"}),e.jsx(_,{value:"60 days",children:"60 days"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Selected Jobs"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:j.filter(s=>r.includes(s.job_id)).map(s=>e.jsxs("div",{className:"p-3 border rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:s.job_title}),e.jsxs("span",{className:"font-bold text-green-600",children:["£",s.total_payment.toFixed(2)]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[f(s.job_date)," • ",s.hours_worked.toFixed(1)," hours"]})]},s.job_id))})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{onClick:ce,variant:"outline",className:"flex-1",children:"Back"}),e.jsx(m,{onClick:ie,className:"flex-1",children:"Next: Confirm & Send"})]})]}),v==="confirm"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-900 mb-2",children:"Step 3: Confirm & Send Invoice"}),e.jsx("p",{className:"text-sm text-green-800",children:"Review your final invoice details and send to management for processing."})]}),e.jsxs("div",{className:"p-4 border rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Invoice Summary"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Invoice Number:"}),e.jsx("span",{className:"font-medium",children:i.invoiceNumber})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Amount:"}),e.jsxs("span",{className:"font-bold text-lg text-green-600",children:["£",i.totalAmount.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Jobs Included:"}),e.jsx("span",{className:"font-medium",children:i.jobsIncluded.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Due Date:"}),e.jsx("span",{className:"font-medium",children:new Date(i.dueDate).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Payment Terms:"}),e.jsx("span",{className:"font-medium",children:i.paymentTerms})]})]})]}),i.notes&&e.jsxs("div",{className:"p-4 border rounded-lg bg-blue-50",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Additional Notes"}),e.jsx("p",{className:"text-sm text-gray-700",children:i.notes})]}),e.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"Important Information"}),e.jsxs("ul",{className:"text-sm text-yellow-800 space-y-1",children:[e.jsx("li",{children:"• Invoice will be sent to management for review"}),e.jsx("li",{children:"• Payment processing typically takes 3-5 business days"}),e.jsx("li",{children:"• You will be notified when payment is processed"}),e.jsx("li",{children:"• Contact HR for any payment inquiries"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{onClick:ce,variant:"outline",className:"flex-1",children:"Back to Review"}),e.jsx(m,{onClick:de,disabled:R.isPending,className:"flex-1",size:"lg",children:R.isPending?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending Invoice..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Send Invoice to Management"]})})]})]})]})})]}),e.jsxs(c,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Invoice History"]})}),e.jsx(d,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Q,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Invoice History"}),e.jsx("p",{className:"text-gray-600",children:"View your sent invoices and payment status."}),e.jsx(m,{className:"mt-4",variant:"outline",children:"View All Invoices"})]})})]})]}),e.jsx(D,{value:"history",className:"space-y-4",children:e.jsxs(c,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Job History"]})}),e.jsx(d,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Q,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Complete Job History"}),e.jsx("p",{className:"text-gray-600",children:"View your complete job history, ratings, and performance metrics."}),e.jsx(m,{className:"mt-4",variant:"outline",children:"View Full History"})]})})]})})]}),e.jsx(pe,{open:Ae,onOpenChange:G,children:e.jsxs(Ne,{className:"max-w-2xl",children:[e.jsx(ve,{children:e.jsxs(be,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"Send Invoice to Management"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Selected Payments"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:j.filter(s=>r.includes(s.job_id)).map(s=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:s.job_title}),e.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:[s.hours_worked.toFixed(1),"h @ £",s.hourly_rate,"/h"]})]}),e.jsxs("span",{className:"font-bold",children:["£",s.total_payment.toFixed(2)]})]},s.job_id))}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Total Invoice Amount:"}),e.jsxs("span",{className:"text-xl font-bold text-blue-600",children:["£",j.filter(s=>r.includes(s.job_id)).reduce((s,t)=>s+t.total_payment,0).toFixed(2)]})]})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"invoice-notes",className:"block text-sm font-medium mb-2",children:"Additional Notes (Optional)"}),e.jsx("textarea",{id:"invoice-notes",value:ne,onChange:s=>re(s.target.value),placeholder:"Add any additional notes or special requests...",className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3})]}),e.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded",children:[e.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"Invoice Information"}),e.jsxs("ul",{className:"text-sm text-yellow-800 space-y-1",children:[e.jsx("li",{children:"• Invoice will be sent to management for review"}),e.jsx("li",{children:"• Payment terms: 30 days from invoice date"}),e.jsx("li",{children:"• You will be notified when payment is processed"}),e.jsx("li",{children:"• Contact HR for any payment inquiries"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(m,{variant:"outline",onClick:()=>G(!1),className:"flex-1",children:"Cancel"}),e.jsx(m,{onClick:de,disabled:R.isPending||r.length===0,className:"flex-1",children:R.isPending?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Send Invoice"]})})]})]})})]})};export{ys as default};
