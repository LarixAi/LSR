import{c as ie,j as e,D as de,d as he,e as xe,f as me,B as E,W as fe,I as b,Y as H,M as z,U as ye,X as re,a0 as ve,ad as Ne,r as C,ae as be,i as P,k as M,l as U,n as D,s as J,a6 as we,_ as Z,C as Q,v as G,a as pe,m as Se,q as ue,J as Ie,N as Ce,A as ke,H as se,G as _e,E as le,F as Ee}from"./main-piTIAPSx.js";import{B as Le}from"./bus-Ciww0Rtk.js";import{H as Te}from"./heart-e8Bsk1RQ.js";import{F as u,a as j,b as g,c as f,d as y,o as Ae,s as N,e as ce,f as Pe,g as te,h as De,i as Fe}from"./zod-DNWQ31K7.js";import{T as O}from"./textarea-mxcr8nPj.js";import{S as B,a as V,b as K,c as q,d as v}from"./select-Brm_N20Q.js";import{P as Y}from"./plus-CMGcTuiR.js";import{U as Oe}from"./upload-CgVQC7ku.js";import{N as oe}from"./navigation-D0f2KySn.js";import{u as Re}from"./index.esm-DU9ozG4y.js";import{u as Me}from"./useQuery-Dbdyc74j.js";import{u as Ue}from"./useMutation-B8vlA97s.js";import{C as ze}from"./circle-x-CETn4HDx.js";import{C as Ge}from"./circle-check-big-CD0jvDn0.js";import"./index-Pp_niZQ8.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=ie("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=ie("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=ie("Plane",[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]]);var L=(t=>(t.transportation="transportation",t.school="school",t.wedding="wedding",t.airport="airport",t.privateJob="privateJob",t))(L||{});function je(t){switch(t){case L.transportation:return"Transportation";case L.school:return"School";case L.wedding:return"Wedding";case L.airport:return"Airport Run";case L.privateJob:return"Private Job";default:return"Unknown"}}function qe(t){switch(t){case L.transportation:return"directions_bus";case L.school:return"school";case L.wedding:return"favorite";case L.airport:return"flight_takeoff";case L.privateJob:return"build";default:return"help"}}const $e=({open:t,onOpenChange:r,onSelect:n})=>{const s=Object.values(L),i=a=>{const o={directions_bus:Le,school:Ve,favorite:Te,flight_takeoff:Ke,build:fe}[a]||Be;return e.jsx(o,{className:"w-8 h-8"})};return e.jsx(de,{open:t,onOpenChange:r,children:e.jsxs(he,{className:"max-w-md",children:[e.jsx(xe,{children:e.jsx(me,{children:"Select Incident Type"})}),e.jsx("div",{className:"grid grid-cols-2 gap-4 p-4",children:s.map(a=>e.jsxs(E,{variant:"outline",className:"h-24 flex flex-col items-center justify-center space-y-2",onClick:()=>{n(a),r(!1)},children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center text-blue-600",children:i(qe(a))}),e.jsx("span",{className:"text-sm font-medium text-center",children:je(a)})]},a))})]})})},We=({form:t})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(u,{control:t.control,name:"title",render:({field:r})=>e.jsxs(j,{children:[e.jsx(g,{children:"Incident Title"}),e.jsx(f,{children:e.jsx(b,{placeholder:"Brief description of the incident",...r})}),e.jsx(y,{})]})}),e.jsx(u,{control:t.control,name:"severity",render:({field:r})=>e.jsxs(j,{children:[e.jsx(g,{children:"Severity"}),e.jsxs(B,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(f,{children:e.jsx(V,{children:e.jsx(K,{placeholder:"Select severity"})})}),e.jsxs(q,{children:[e.jsx(v,{value:"low",children:"Low"}),e.jsx(v,{value:"medium",children:"Medium"}),e.jsx(v,{value:"high",children:"High"}),e.jsx(v,{value:"critical",children:"Critical"})]})]}),e.jsx(y,{})]})})]}),e.jsx(u,{control:t.control,name:"description",render:({field:r})=>e.jsxs(j,{children:[e.jsx(g,{children:"Detailed Description"}),e.jsx(f,{children:e.jsx(O,{placeholder:"Provide a detailed description of what happened...",className:"min-h-[100px]",...r})}),e.jsx(y,{})]})})]}),Je=({selectedLocation:t,onLocationPickerOpen:r})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs(H,{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{children:"Location"})]}),t?e.jsxs("div",{className:"p-4 border rounded-lg bg-gray-50",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Latitude: ",t.lat.toFixed(6),", Longitude: ",t.lng.toFixed(6)]}),e.jsx(E,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:r,children:"Change Location"})]}):e.jsxs(E,{type:"button",variant:"outline",onClick:r,children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Pick Location"]})]}),He=({peopleInvolved:t,setPeopleInvolved:r,witnesses:n,setWitnesses:s})=>{const i=()=>{r([...t,""])},a=d=>{r(t.filter((m,p)=>p!==d))},c=(d,m)=>{const p=[...t];p[d]=m,r(p)},o=()=>{s([...n,""])},x=d=>{s(n.filter((m,p)=>p!==d))},l=(d,m)=>{const p=[...n];p[d]=m,s(p)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs(H,{className:"flex items-center space-x-2",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{children:"People Involved"})]}),t.map((d,m)=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(b,{placeholder:"Name of person involved",value:d,onChange:p=>c(m,p.target.value)}),t.length>1&&e.jsx(E,{type:"button",variant:"outline",size:"icon",onClick:()=>a(m),children:e.jsx(re,{className:"w-4 h-4"})})]},m)),e.jsxs(E,{type:"button",variant:"outline",onClick:i,children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Add Person"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(H,{className:"flex items-center space-x-2",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsx("span",{children:"Witnesses"})]}),n.map((d,m)=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(b,{placeholder:"Name of witness",value:d,onChange:p=>l(m,p.target.value)}),n.length>1&&e.jsx(E,{type:"button",variant:"outline",size:"icon",onClick:()=>x(m),children:e.jsx(re,{className:"w-4 h-4"})})]},m)),e.jsxs(E,{type:"button",variant:"outline",onClick:o,children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Add Witness"]})]})]})},Ze=({attachments:t,setAttachments:r})=>{const n=i=>{const a=Array.from(i.target.files||[]);r([...t,...a])},s=i=>{r(t.filter((a,c)=>c!==i))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(H,{className:"flex items-center space-x-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Attachments"})]}),e.jsx(b,{type:"file",multiple:!0,accept:"image/*,application/pdf,.doc,.docx",onChange:n}),t.length>0&&e.jsx("div",{className:"space-y-2",children:t.map((i,a)=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsx("span",{className:"text-sm",children:i.name}),e.jsx(E,{type:"button",variant:"outline",size:"sm",onClick:()=>s(a),children:e.jsx(re,{className:"w-4 h-4"})})]},a))})]})};var ne={exports:{}};function Qe(t,r,n,s){function i(a){return a instanceof n?a:new n(function(c){c(a)})}return new(n||(n=Promise))(function(a,c){function o(d){try{l(s.next(d))}catch(m){c(m)}}function x(d){try{l(s.throw(d))}catch(m){c(m)}}function l(d){d.done?a(d.value):i(d.value).then(o,x)}l((s=s.apply(t,[])).next())})}function Xe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ye=function t(r,n){if(r===n)return!0;if(r&&n&&typeof r=="object"&&typeof n=="object"){if(r.constructor!==n.constructor)return!1;var s,i,a;if(Array.isArray(r)){if(s=r.length,s!=n.length)return!1;for(i=s;i--!==0;)if(!t(r[i],n[i]))return!1;return!0}if(r.constructor===RegExp)return r.source===n.source&&r.flags===n.flags;if(r.valueOf!==Object.prototype.valueOf)return r.valueOf()===n.valueOf();if(r.toString!==Object.prototype.toString)return r.toString()===n.toString();if(a=Object.keys(r),s=a.length,s!==Object.keys(n).length)return!1;for(i=s;i--!==0;)if(!Object.prototype.hasOwnProperty.call(n,a[i]))return!1;for(i=s;i--!==0;){var c=a[i];if(!t(r[c],n[c]))return!1}return!0}return r!==r&&n!==n},es=Xe(Ye);const ae="__googleMapsScriptId";var F;(function(t){t[t.INITIALIZED=0]="INITIALIZED",t[t.LOADING=1]="LOADING",t[t.SUCCESS=2]="SUCCESS",t[t.FAILURE=3]="FAILURE"})(F||(F={}));class A{constructor({apiKey:r,authReferrerPolicy:n,channel:s,client:i,id:a=ae,language:c,libraries:o=[],mapIds:x,nonce:l,region:d,retries:m=3,url:p="https://maps.googleapis.com/maps/api/js",version:S}){if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=r,this.authReferrerPolicy=n,this.channel=s,this.client=i,this.id=a||ae,this.language=c,this.libraries=o,this.mapIds=x,this.nonce=l,this.region=d,this.retries=m,this.url=p,this.version=S,A.instance){if(!es(this.options,A.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(A.instance.options)}`);return A.instance}A.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?F.FAILURE:this.done?F.SUCCESS:this.loading?F.LOADING:F.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let r=this.url;return r+="?callback=__googleMapsCallback&loading=async",this.apiKey&&(r+=`&key=${this.apiKey}`),this.channel&&(r+=`&channel=${this.channel}`),this.client&&(r+=`&client=${this.client}`),this.libraries.length>0&&(r+=`&libraries=${this.libraries.join(",")}`),this.language&&(r+=`&language=${this.language}`),this.region&&(r+=`&region=${this.region}`),this.version&&(r+=`&v=${this.version}`),this.mapIds&&(r+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(r+=`&auth_referrer_policy=${this.authReferrerPolicy}`),r}deleteScript(){const r=document.getElementById(this.id);r&&r.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((r,n)=>{this.loadCallback(s=>{s?n(s.error):r(window.google)})})}importLibrary(r){return this.execute(),google.maps.importLibrary(r)}loadCallback(r){this.callbacks.push(r),this.execute()}setScript(){var r,n;if(document.getElementById(this.id)){this.callback();return}const s={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(s).forEach(a=>!s[a]&&delete s[a]),!((n=(r=window==null?void 0:window.google)===null||r===void 0?void 0:r.maps)===null||n===void 0)&&n.importLibrary||(a=>{let c,o,x,l="The Google Maps JavaScript API",d="google",m="importLibrary",p="__ib__",S=document,I=window;I=I[d]||(I[d]={});const k=I.maps||(I.maps={}),h=new Set,_=new URLSearchParams,T=()=>c||(c=new Promise((R,$)=>Qe(this,void 0,void 0,function*(){var w;yield o=S.createElement("script"),o.id=this.id,_.set("libraries",[...h]+"");for(x in a)_.set(x.replace(/[A-Z]/g,W=>"_"+W[0].toLowerCase()),a[x]);_.set("callback",d+".maps."+p),o.src=this.url+"?"+_,k[p]=R,o.onerror=()=>c=$(Error(l+" could not load.")),o.nonce=this.nonce||((w=S.querySelector("script[nonce]"))===null||w===void 0?void 0:w.nonce)||"",S.head.append(o)})));k[m]?console.warn(l+" only loads once. Ignoring:",a):k[m]=(R,...$)=>h.add(R)&&T().then(()=>k[m](R,...$))})(s);const i=this.libraries.map(a=>this.importLibrary(a));i.length||i.push(this.importLibrary("core")),Promise.all(i).then(()=>this.callback(),a=>{const c=new ErrorEvent("error",{error:a});this.loadErrorCallback(c)})}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(r){if(this.errors.push(r),this.errors.length<=this.retries){const n=this.errors.length*Math.pow(2,this.errors.length);console.error(`Failed to load Google Maps script, retrying in ${n} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},n)}else this.onerrorEvent=r,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(r=>{r(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),!this.loading)if(this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version){console.warn("Google Maps already loaded outside @googlemaps/js-api-loader. This may result in undesirable behavior as options and script parameters may not match."),this.callback();return}this.loading=!0,this.setScript()}}}const ss=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_ID:ae,Loader:A,get LoaderStatus(){return F}},Symbol.toStringTag,{value:"Module"})),ts=Ne(ss);(function(t,r){(function(n,s){s(r,ts,C)})(be,function(n,s,i){function a(x){return x&&typeof x=="object"&&"default"in x?x:{default:x}}var c=a(i);n.Status=void 0,function(x){x.LOADING="LOADING",x.FAILURE="FAILURE",x.SUCCESS="SUCCESS"}(n.Status||(n.Status={}));const o=({children:x,render:l,callback:d,...m})=>{const[p,S]=i.useState(n.Status.LOADING);return i.useEffect(()=>{const I=new s.Loader(m),k=h=>{d&&d(h,I),S(h)};k(n.Status.LOADING),I.load().then(()=>k(n.Status.SUCCESS),()=>k(n.Status.FAILURE))},[]),p===n.Status.SUCCESS&&x?c.default.createElement(c.default.Fragment,null,x):l?l(p):c.default.createElement(c.default.Fragment,null)};n.Wrapper=o,Object.defineProperty(n,"__esModule",{value:!0})})})(ne,ne.exports);var X=ne.exports;const rs=({center:t,zoom:r,markers:n=[],routes:s=[]})=>{const i=C.useRef(null),[a,c]=C.useState();return C.useEffect(()=>{if(i.current&&!a){const o=new window.google.maps.Map(i.current,{center:t,zoom:r,mapTypeControl:!0,streetViewControl:!0,fullscreenControl:!0});c(o)}},[i,a,t,r]),C.useEffect(()=>{a&&(n.forEach(o=>{new google.maps.Marker({position:o.position,map:a,title:o.title,icon:o.type==="driver"?{url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(`
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="8" fill="#22c55e" stroke="white" stroke-width="2"/>
                <circle cx="12" cy="12" r="3" fill="white"/>
              </svg>
            `),scaledSize:new google.maps.Size(24,24)}:void 0})}),s.forEach(o=>{new google.maps.Polyline({path:o.path,geodesic:!0,strokeColor:o.color||"#3b82f6",strokeOpacity:1,strokeWeight:3,map:a})}))},[a,n,s]),e.jsx("div",{ref:i,className:"w-full h-full min-h-[400px] rounded-lg"})},ns=({status:t,center:r,zoom:n,markers:s,routes:i})=>{switch(t){case X.Status.LOADING:return e.jsxs("div",{className:"flex items-center justify-center h-[400px]",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2",children:"Loading map..."})]});case X.Status.FAILURE:return e.jsx("div",{className:"flex items-center justify-center h-[400px] bg-gray-100 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(z,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Failed to load map"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Please check your Google Maps API key"})]})});case X.Status.SUCCESS:return e.jsx(rs,{center:r,zoom:n,markers:s,routes:i});default:return null}},as=({apiKey:t="",center:r={lat:-25.7479,lng:28.2293},zoom:n=10,markers:s=[],routes:i=[],title:a="Map View",showApiKeyInput:c=!1})=>{const[o,x]=C.useState(t),[l,d]=C.useState(!0);C.useEffect(()=>{o?d(!1):(async()=>{try{const{data:S,error:I}=await J.functions.invoke("get-google-maps-key");if(S!=null&&S.apiKey)x(S.apiKey);else{console.log("No API key found in Supabase secrets, falling back to local storage");const k=localStorage.getItem("google_maps_api_key");k&&x(k)}}catch{console.log("Error fetching API key from Supabase, using local storage fallback");const I=localStorage.getItem("google_maps_api_key");I&&x(I)}finally{d(!1)}})()},[o]);const m=p=>{x(p),localStorage.setItem("google_maps_api_key",p)};return l?e.jsxs(P,{children:[e.jsx(M,{children:e.jsxs(U,{className:"flex items-center space-x-2",children:[e.jsx(oe,{className:"w-5 h-5"}),e.jsx("span",{children:a})]})}),e.jsx(D,{children:e.jsxs("div",{className:"flex items-center justify-center h-[400px]",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2",children:"Loading map configuration..."})]})})]}):c&&!o?e.jsxs(P,{children:[e.jsx(M,{children:e.jsxs(U,{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-5 h-5"}),e.jsx("span",{children:a})]})}),e.jsx(D,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(H,{htmlFor:"apiKey",children:"Google Maps API Key"}),e.jsx(b,{id:"apiKey",type:"password",placeholder:"Enter your Google Maps API key",value:o,onChange:p=>m(p.target.value)}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Get your API key from"," ",e.jsx("a",{href:"https://console.cloud.google.com/google/maps-apis",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Google Cloud Console"})]})]})})})]}):o?e.jsxs(P,{children:[e.jsx(M,{children:e.jsxs(U,{className:"flex items-center space-x-2",children:[e.jsx(oe,{className:"w-5 h-5"}),e.jsx("span",{children:a})]})}),e.jsx(D,{children:e.jsx(X.Wrapper,{apiKey:o,render:p=>e.jsx(ns,{status:p,center:r,zoom:n,markers:s,routes:i})})})]}):e.jsxs(P,{children:[e.jsx(M,{children:e.jsxs(U,{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-5 h-5"}),e.jsx("span",{children:a})]})}),e.jsx(D,{children:e.jsx("div",{className:"flex items-center justify-center h-[400px] bg-gray-100 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(z,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Google Maps API key required"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Configure your API key to view the map"})]})})})]})},is=({open:t,onOpenChange:r,onLocationSelect:n,initialLocation:s={lat:-25.7479,lng:28.2293}})=>{const[i,a]=C.useState(s),c=()=>{n(i),r(!1)};return e.jsx(de,{open:t,onOpenChange:r,children:e.jsxs(he,{className:"max-w-2xl",children:[e.jsx(xe,{children:e.jsx(me,{children:"Pick Location"})}),e.jsx("div",{className:"h-96",children:e.jsx(as,{center:i,zoom:13,markers:[{position:i,title:"Selected Location",type:"stop"}],showApiKeyInput:!0})}),e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:["Selected: ",i.lat.toFixed(6),", ",i.lng.toFixed(6)]}),e.jsxs(we,{children:[e.jsx(E,{variant:"outline",onClick:()=>r(!1),children:"Cancel"}),e.jsx(E,{onClick:c,children:"Confirm Location"})]})]})})},ls=({form:t,selectedDate:r,selectedTime:n})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Incident Details"}),e.jsx(Z,{className:"mb-4"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(u,{control:t.control,name:"incidentType",render:({field:s})=>e.jsxs(j,{children:[e.jsx(g,{children:"Incident Type"}),e.jsxs(B,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(f,{children:e.jsx(V,{children:e.jsx(K,{placeholder:"Select incident type"})})}),e.jsxs(q,{children:[e.jsx(v,{value:"Collision",children:"Collision"}),e.jsx(v,{value:"Breakdown",children:"Breakdown"}),e.jsx(v,{value:"Passenger Injury",children:"Passenger Injury"}),e.jsx(v,{value:"Other",children:"Other"})]})]}),e.jsx(y,{})]})}),e.jsx(u,{control:t.control,name:"vehicleRoute",render:({field:s})=>e.jsxs(j,{children:[e.jsx(g,{children:"Vehicle/Route"}),e.jsx(f,{children:e.jsx(b,{placeholder:"Enter vehicle or route details",...s})}),e.jsx(y,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(u,{control:t.control,name:"date",render:({field:s})=>e.jsxs(j,{children:[e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{children:"Date"})]}),e.jsx(f,{children:e.jsx(b,{type:"date",...s,value:r})}),e.jsx(y,{})]})}),e.jsx(u,{control:t.control,name:"time",render:({field:s})=>e.jsxs(j,{children:[e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:"Time"})]}),e.jsx(f,{children:e.jsx(b,{type:"time",...s,value:n})}),e.jsx(y,{})]})})]}),e.jsx(u,{control:t.control,name:"injuriesDamage",render:({field:s})=>e.jsxs(j,{className:"mt-4",children:[e.jsx(g,{children:"Injuries/Damage Details"}),e.jsx(f,{children:e.jsx(O,{placeholder:"Describe any injuries or damage...",className:"min-h-[80px]",...s})}),e.jsx(y,{})]})}),e.jsx(u,{control:t.control,name:"actionsTaken",render:({field:s})=>e.jsxs(j,{className:"mt-4",children:[e.jsx(g,{children:"Actions Taken"}),e.jsx(f,{children:e.jsx(O,{placeholder:"Describe actions taken...",className:"min-h-[80px]",...s})}),e.jsx(y,{})]})})]})}),cs=({form:t,selectedDate:r,selectedTime:n})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Incident Details"}),e.jsx(Z,{className:"mb-4"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(u,{control:t.control,name:"incidentType",render:({field:s})=>e.jsxs(j,{children:[e.jsx(g,{children:"Incident Type"}),e.jsxs(B,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(f,{children:e.jsx(V,{children:e.jsx(K,{placeholder:"Select incident type"})})}),e.jsxs(q,{children:[e.jsx(v,{value:"Student Injury",children:"Student Injury"}),e.jsx(v,{value:"Bullying",children:"Bullying"}),e.jsx(v,{value:"Property Damage",children:"Property Damage"}),e.jsx(v,{value:"Other",children:"Other"})]})]}),e.jsx(y,{})]})}),e.jsx(u,{control:t.control,name:"personName",render:({field:s})=>e.jsxs(j,{children:[e.jsx(g,{children:"Student/Staff Name"}),e.jsx(f,{children:e.jsx(b,{placeholder:"Enter name",...s})}),e.jsx(y,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(u,{control:t.control,name:"classRole",render:({field:s})=>e.jsxs(j,{children:[e.jsx(g,{children:"Class/Role"}),e.jsx(f,{children:e.jsx(b,{placeholder:"Enter class or role",...s})}),e.jsx(y,{})]})}),e.jsx(u,{control:t.control,name:"schoolLocation",render:({field:s})=>e.jsxs(j,{children:[e.jsx(g,{children:"School Location"}),e.jsx(f,{children:e.jsx(b,{placeholder:"Enter location within school",...s})}),e.jsx(y,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(u,{control:t.control,name:"date",render:({field:s})=>e.jsxs(j,{children:[e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{children:"Date"})]}),e.jsx(f,{children:e.jsx(b,{type:"date",...s,value:r})}),e.jsx(y,{})]})}),e.jsx(u,{control:t.control,name:"time",render:({field:s})=>e.jsxs(j,{children:[e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:"Time"})]}),e.jsx(f,{children:e.jsx(b,{type:"time",...s,value:n})}),e.jsx(y,{})]})})]}),e.jsx(u,{control:t.control,name:"actionsTaken",render:({field:s})=>e.jsxs(j,{className:"mt-4",children:[e.jsx(g,{children:"Actions Taken"}),e.jsx(f,{children:e.jsx(O,{placeholder:"Describe actions taken...",className:"min-h-[80px]",...s})}),e.jsx(y,{})]})})]})}),os=({form:t,selectedDate:r,selectedTime:n})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Incident Details"}),e.jsx(Z,{className:"mb-4"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(u,{control:t.control,name:"incidentType",render:({field:s})=>e.jsxs(j,{children:[e.jsx(g,{children:"Incident Type"}),e.jsxs(B,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(f,{children:e.jsx(V,{children:e.jsx(K,{placeholder:"Select incident type"})})}),e.jsxs(q,{children:[e.jsx(v,{value:"Injury",children:"Injury"}),e.jsx(v,{value:"Property Damage",children:"Property Damage"}),e.jsx(v,{value:"Vendor Issue",children:"Vendor Issue"}),e.jsx(v,{value:"Guest Behavior",children:"Guest Behavior"}),e.jsx(v,{value:"Other",children:"Other"})]})]}),e.jsx(y,{})]})}),e.jsx(u,{control:t.control,name:"personInvolved",render:({field:s})=>e.jsxs(j,{children:[e.jsx(g,{children:"Person(s) Involved"}),e.jsx(f,{children:e.jsx(b,{placeholder:"Enter names of people involved",...s})}),e.jsx(y,{})]})})]}),e.jsx(u,{control:t.control,name:"venueLocation",render:({field:s})=>e.jsxs(j,{className:"mt-4",children:[e.jsx(g,{children:"Location (venue/area)"}),e.jsx(f,{children:e.jsx(b,{placeholder:"Enter venue or area details",...s})}),e.jsx(y,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(u,{control:t.control,name:"date",render:({field:s})=>e.jsxs(j,{children:[e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{children:"Date"})]}),e.jsx(f,{children:e.jsx(b,{type:"date",...s,value:r})}),e.jsx(y,{})]})}),e.jsx(u,{control:t.control,name:"time",render:({field:s})=>e.jsxs(j,{children:[e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:"Time"})]}),e.jsx(f,{children:e.jsx(b,{type:"time",...s,value:n})}),e.jsx(y,{})]})})]}),e.jsx(u,{control:t.control,name:"actionsTaken",render:({field:s})=>e.jsxs(j,{className:"mt-4",children:[e.jsx(g,{children:"Actions Taken"}),e.jsx(f,{children:e.jsx(O,{placeholder:"Describe actions taken...",className:"min-h-[80px]",...s})}),e.jsx(y,{})]})})]})}),ds=({form:t,selectedDate:r,selectedTime:n})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Incident Details"}),e.jsx(Z,{className:"mb-4"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(u,{control:t.control,name:"incidentType",render:({field:s})=>e.jsxs(j,{children:[e.jsx(g,{children:"Incident Type"}),e.jsxs(B,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(f,{children:e.jsx(V,{children:e.jsx(K,{placeholder:"Select incident type"})})}),e.jsxs(q,{children:[e.jsx(v,{value:"Baggage",children:"Baggage"}),e.jsx(v,{value:"Security",children:"Security"}),e.jsx(v,{value:"Injury",children:"Injury"}),e.jsx(v,{value:"Equipment",children:"Equipment"}),e.jsx(v,{value:"Delay",children:"Delay"}),e.jsx(v,{value:"Other",children:"Other"})]})]}),e.jsx(y,{})]})}),e.jsx(u,{control:t.control,name:"flightVehicle",render:({field:s})=>e.jsxs(j,{children:[e.jsx(g,{children:"Flight/Vehicle Details"}),e.jsx(f,{children:e.jsx(b,{placeholder:"Enter flight or vehicle details",...s})}),e.jsx(y,{})]})})]}),e.jsx(u,{control:t.control,name:"airportLocation",render:({field:s})=>e.jsxs(j,{className:"mt-4",children:[e.jsx(g,{children:"Location (terminal/gate/runway)"}),e.jsx(f,{children:e.jsx(b,{placeholder:"Enter airport location details",...s})}),e.jsx(y,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(u,{control:t.control,name:"date",render:({field:s})=>e.jsxs(j,{children:[e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{children:"Date"})]}),e.jsx(f,{children:e.jsx(b,{type:"date",...s,value:r})}),e.jsx(y,{})]})}),e.jsx(u,{control:t.control,name:"time",render:({field:s})=>e.jsxs(j,{children:[e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:"Time"})]}),e.jsx(f,{children:e.jsx(b,{type:"time",...s,value:n})}),e.jsx(y,{})]})})]}),e.jsx(u,{control:t.control,name:"actionsTaken",render:({field:s})=>e.jsxs(j,{className:"mt-4",children:[e.jsx(g,{children:"Actions Taken"}),e.jsx(f,{children:e.jsx(O,{placeholder:"Describe actions taken...",className:"min-h-[80px]",...s})}),e.jsx(y,{})]})})]})}),hs=({form:t,selectedDate:r,selectedTime:n})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Incident Details"}),e.jsx(Z,{className:"mb-4"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(u,{control:t.control,name:"incidentType",render:({field:s})=>e.jsxs(j,{children:[e.jsx(g,{children:"Incident Type"}),e.jsxs(B,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(f,{children:e.jsx(V,{children:e.jsx(K,{placeholder:"Select incident type"})})}),e.jsxs(q,{children:[e.jsx(v,{value:"Injury",children:"Injury"}),e.jsx(v,{value:"Property",children:"Property"}),e.jsx(v,{value:"Theft",children:"Theft"}),e.jsx(v,{value:"Other",children:"Other"})]})]}),e.jsx(y,{})]})}),e.jsx(u,{control:t.control,name:"clientStaffThirdParty",render:({field:s})=>e.jsxs(j,{children:[e.jsx(g,{children:"People Involved (client/staff/third party)"}),e.jsx(f,{children:e.jsx(b,{placeholder:"Enter details of people involved",...s})}),e.jsx(y,{})]})})]}),e.jsx(u,{control:t.control,name:"jobLocation",render:({field:s})=>e.jsxs(j,{className:"mt-4",children:[e.jsx(g,{children:"Location"}),e.jsx(f,{children:e.jsx(b,{placeholder:"Enter job location",...s})}),e.jsx(y,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(u,{control:t.control,name:"date",render:({field:s})=>e.jsxs(j,{children:[e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{children:"Date"})]}),e.jsx(f,{children:e.jsx(b,{type:"date",...s,value:r})}),e.jsx(y,{})]})}),e.jsx(u,{control:t.control,name:"time",render:({field:s})=>e.jsxs(j,{children:[e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:"Time"})]}),e.jsx(f,{children:e.jsx(b,{type:"time",...s,value:n})}),e.jsx(y,{})]})})]}),e.jsx(u,{control:t.control,name:"actionsTaken",render:({field:s})=>e.jsxs(j,{className:"mt-4",children:[e.jsx(g,{children:"Actions Taken"}),e.jsx(f,{children:e.jsx(O,{placeholder:"Describe actions taken...",className:"min-h-[80px]",...s})}),e.jsx(y,{})]})})]})}),xs=Ae({title:N().min(2,{message:"Title must be at least 2 characters."}),description:N().min(10,{message:"Description must be at least 10 characters."}),severity:ce(["low","medium","high"]),status:ce(["open","closed"]).optional(),date:N().optional(),time:N().optional(),locationAddress:N().optional(),peopleInvolved:Pe(N()).optional(),vehicleInfo:N().optional(),weatherConditions:N().optional(),reportedBy:N().optional(),contactInfo:N().optional(),emergencyServices:te().optional(),policeReportNumber:N().optional(),insuranceClaim:te().optional(),estimatedDamages:N().optional(),followUpRequired:te().optional(),incidentType:N().optional(),vehicleRoute:N().optional(),injuriesDamage:N().optional(),actionsTaken:N().optional(),personName:N().optional(),classRole:N().optional(),schoolLocation:N().optional(),personInvolved:N().optional(),venueLocation:N().optional(),flightVehicle:N().optional(),airportLocation:N().optional(),clientStaffThirdParty:N().optional(),jobLocation:N().optional()}),ms=({incidentType:t,onSubmit:r,onCancel:n})=>{const{toast:s}=pe(),[i,a]=C.useState(!1),[c,o]=C.useState(null),[x,l]=C.useState(!1),[d,m]=C.useState([]),[p,S]=C.useState([""]),[I,k]=C.useState([""]),h=Re({resolver:De(xs),defaultValues:{title:"",description:"",severity:"low",status:"open",date:new Date().toISOString().split("T")[0],time:new Date().toTimeString().slice(0,5),locationAddress:"",peopleInvolved:[],vehicleInfo:"",weatherConditions:"",reportedBy:"",contactInfo:"",emergencyServices:!1,policeReportNumber:"",insuranceClaim:!1,estimatedDamages:"",followUpRequired:!1}}),_=h.watch("date")||"",T=h.watch("time")||"",R=async w=>{a(!0);try{const W={type:t,title:w.title,description:w.description,severity:w.severity,status:w.status||"open",date:w.date?new Date(w.date):void 0,time:w.time,location:c?{lat:c.lat,lng:c.lng,address:w.locationAddress||""}:void 0,peopleInvolved:p.filter(ee=>ee.trim()!==""),witnesses:I.filter(ee=>ee.trim()!==""),vehicleInfo:w.vehicleInfo,weatherConditions:w.weatherConditions,reportedBy:w.reportedBy,contactInfo:w.contactInfo,emergencyServices:w.emergencyServices||!1,policeReportNumber:w.policeReportNumber,insuranceClaim:w.insuranceClaim||!1,estimatedDamages:w.estimatedDamages,followUpRequired:w.followUpRequired||!1,attachments:d,...w};await r(W),s({title:"Incident Reported",description:"Your incident report has been submitted successfully."})}catch(W){console.error("Error submitting incident:",W),s({title:"Error",description:"Failed to submit incident report. Please try again.",variant:"destructive"})}finally{a(!1)}},$=()=>{switch(t){case"transportation":return e.jsx(ls,{form:h,selectedDate:_,selectedTime:T});case"school":return e.jsx(cs,{form:h,selectedDate:_,selectedTime:T});case"wedding":return e.jsx(os,{form:h,selectedDate:_,selectedTime:T});case"airport":return e.jsx(ds,{form:h,selectedDate:_,selectedTime:T});case"privateJob":return e.jsx(hs,{form:h,selectedDate:_,selectedTime:T});default:return null}};return e.jsxs(P,{className:"w-full max-w-4xl mx-auto",children:[e.jsxs(M,{children:[e.jsxs(U,{children:["Report ",t.charAt(0).toUpperCase()+t.slice(1)," Incident"]}),e.jsx(Se,{children:"Please provide detailed information about the incident"})]}),e.jsxs(D,{children:[e.jsx(Fe,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(R),className:"space-y-6",children:[e.jsx(We,{form:h}),$(),e.jsx(Je,{selectedLocation:c,onLocationPickerOpen:()=>l(!0)}),e.jsx(He,{peopleInvolved:p,setPeopleInvolved:S,witnesses:I,setWitnesses:k}),e.jsx(Ze,{attachments:d,setAttachments:m}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-6",children:[e.jsx(E,{type:"button",variant:"outline",onClick:n,disabled:i,children:"Cancel"}),e.jsx(E,{type:"submit",disabled:i,children:i?"Submitting...":"Submit Report"})]})]})}),x&&e.jsx(is,{open:x,onOpenChange:l,onLocationSelect:w=>{o(w),l(!1)}})]})]})},ge=()=>{const{profile:t}=ue(),r=()=>{if(!(t!=null&&t.organization_id))throw new Error("User must belong to an organization");return t.organization_id},n=s=>{const i=r();if(s&&s!==i)throw new Error("Access denied: Different organization");return i};return{organizationId:t==null?void 0:t.organization_id,getOrganizationId:r,ensureOrganizationAccess:n}},ps=()=>{const{organizationId:t}=ge();return Me({queryKey:["incidents",t],queryFn:async()=>{if(!t)return[];console.log("Fetching incidents from database for organization:",t);const{data:r,error:n}=await J.from("incidents").select("*").eq("organization_id",t).order("created_at",{ascending:!1});if(n)throw console.error("Error fetching incidents:",n),n;const s=[...new Set((r==null?void 0:r.filter(l=>l.reported_by).map(l=>l.reported_by))||[])],i=[...new Set((r==null?void 0:r.filter(l=>l.vehicle_id).map(l=>l.vehicle_id))||[])];let a=[],c=[];if(s.length>0){const{data:l}=await J.from("profiles").select("id, first_name, last_name, email").in("id",s);a=l||[]}if(i.length>0){const{data:l}=await J.from("vehicles").select("id, vehicle_number, make, model").in("id",i);c=l||[]}const o=new Map(a.map(l=>[l.id,l])),x=new Map(c.map(l=>[l.id,l]));return r==null?void 0:r.map(l=>({...l,profiles:l.reported_by&&o.has(l.reported_by)?o.get(l.reported_by):null,vehicles:l.vehicle_id&&x.has(l.vehicle_id)?x.get(l.vehicle_id):null}))},enabled:!!t})},us=()=>{const t=Ie(),{toast:r}=pe(),{getOrganizationId:n}=ge();return Ue({mutationFn:async s=>{var o,x,l,d;const i={incident_type:s.incident_type,title:s.title,description:s.description,severity:s.severity,status:s.status||"open",organization_id:n(),incident_date:s.date?s.date.toISOString().split("T")[0]:null,incident_time:s.time||null,location_lat:((o=s.location)==null?void 0:o.lat)||null,location_lng:((x=s.location)==null?void 0:x.lng)||null,location_address:((l=s.location)==null?void 0:l.address)||null,people_involved:s.peopleInvolved||[],witnesses:s.witnesses||[],vehicle_id:s.vehicleId||null,driver_id:s.driverId||null,reported_by:s.reported_by,attachments:((d=s.attachments)==null?void 0:d.map(m=>({name:m.name,size:m.size})))||[],additional_data:s},{data:a,error:c}=await J.from("incidents").insert(i).select().single();if(c)throw c;return a},onSuccess:()=>{t.invalidateQueries({queryKey:["incidents"]}),r({title:"Success",description:"Incident reported successfully"})},onError:s=>{r({title:"Error",description:s.message||"Failed to report incident",variant:"destructive"})}})},Ts=()=>{const{user:t,profile:r,loading:n}=ue(),[s,i]=C.useState(!1),[a,c]=C.useState(null),{data:o=[],isLoading:x,error:l}=ps(),d=us();if(n)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:"Loading..."});if(!t||!r)return e.jsx(Ce,{to:"/auth",replace:!0});const m=h=>{c(h)},p=async h=>{try{await d.mutateAsync({...h,incident_type:a,reported_by:t.id}),c(null)}catch(_){console.error("Error creating incident:",_)}},S=()=>{c(null)},I=h=>{switch(h){case"open":return e.jsx(se,{className:"w-4 h-4"});case"investigating":return e.jsx(G,{className:"w-4 h-4"});case"resolved":return e.jsx(Ge,{className:"w-4 h-4"});case"closed":return e.jsx(ze,{className:"w-4 h-4"});default:return e.jsx(Ee,{className:"w-4 h-4"})}},k=h=>{switch(h){case"open":return"destructive";case"investigating":return"default";case"resolved":return"default";case"closed":return"secondary";default:return"secondary"}};return a?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsx(ms,{incidentType:a,onSubmit:p,onCancel:S})})}):x?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"text-lg",children:"Loading incidents..."})})})}):l?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsxs(ke,{variant:"destructive",children:[e.jsx(se,{className:"h-4 w-4"}),e.jsxs(_e,{children:["Error loading incidents: ",l.message]})]})})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"container mx-auto px-6 py-8 space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Incident Reports"}),e.jsx("p",{className:"text-gray-600",children:"Manage and track incident reports"})]}),e.jsxs(E,{onClick:()=>i(!0),children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"New Incident Report"]})]}),o.length===0?e.jsx(P,{children:e.jsxs(D,{className:"text-center py-12",children:[e.jsx(se,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"No incidents reported"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Get started by creating your first incident report."}),e.jsxs(E,{onClick:()=>i(!0),children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Create Incident Report"]})]})}):e.jsx("div",{className:"space-y-4",children:o.map(h=>{var _;return e.jsxs(P,{children:[e.jsx(M,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(U,{className:"flex items-center space-x-2 mb-2",children:[e.jsx("span",{children:h.title}),e.jsx(le,{variant:"outline",children:je(h.incident_type)})]}),e.jsx("p",{className:"text-sm text-gray-600",children:h.description})]}),e.jsxs(le,{variant:k(h.status),className:"flex items-center space-x-1",children:[I(h.status),e.jsx("span",{className:"capitalize",children:h.status.replace("_"," ")})]})]})}),e.jsx(D,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-600",children:"Severity"}),e.jsx("p",{className:"capitalize",children:h.severity})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-600",children:"Date"}),e.jsx("p",{children:h.incident_date?new Date(h.incident_date).toLocaleDateString():"Not specified"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-600",children:"People Involved"}),e.jsx("p",{children:((_=h.people_involved)==null?void 0:_.length)||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-600",children:"Reported By"}),e.jsx("p",{children:h.profiles?`${h.profiles.first_name} ${h.profiles.last_name}`:"Unknown"})]})]})})]},h.id)})})]}),e.jsx($e,{open:s,onOpenChange:i,onSelect:m})]})};export{Ts as default};
