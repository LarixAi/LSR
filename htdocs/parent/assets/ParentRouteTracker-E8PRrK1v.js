import{q as f,s as c,j as e,i as h,k as j,l as p,M as r,m as u,n as g,E as _,v as y,a2 as b}from"./main-piTIAPSx.js";import{u as w}from"./useQuery-Dbdyc74j.js";import{P as C}from"./phone-D7pMV1Uy.js";const T=()=>{const{user:t}=f(),{data:l,isLoading:v,error:N}=w({queryKey:["active-routes-tracking",t==null?void 0:t.id],queryFn:async()=>{if(!(t!=null&&t.id))return[];console.log("Fetching active routes for tracking");const s=new Date().toISOString().split("T")[0],{data:d,error:m}=await c.from("route_assignments").select("*").eq("assignment_date",s).eq("status","active").eq("is_active",!0);if(m)throw console.error("Error fetching route assignments:",m),m;const x=[];if(d&&d.length>0)for(const a of d){const{data:i}=await c.from("routes").select("name, start_location, end_location").eq("id",a.route_id).single(),{data:n}=await c.from("profiles").select("first_name, last_name, phone").eq("id",a.driver_id).single(),{data:o}=await c.from("vehicles").select("vehicle_number, license_plate").eq("id",a.vehicle_id).single();i&&n&&o&&x.push({id:a.id,status:a.status||"active",assignment_date:a.assignment_date,start_time:a.start_time||"N/A",end_time:a.end_time||"N/A",route_name:i.name,start_location:i.start_location,end_location:i.end_location,driver_name:`${n.first_name||"Unknown"} ${n.last_name||"Driver"}`,driver_phone:n.phone,vehicle_number:o.vehicle_number,license_plate:o.license_plate})}return console.log("Active routes found:",x.length),x},enabled:!!(t!=null&&t.id)});return v?e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsxs(p,{className:"flex items-center space-x-2",children:[e.jsx(r,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{children:"Live Route Tracking"})]}),e.jsx(u,{children:"Currently active transport routes"})]}),e.jsx(g,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading active routes..."})]})})]}):N?e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsxs(p,{className:"flex items-center space-x-2",children:[e.jsx(r,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{children:"Live Route Tracking"})]}),e.jsx(u,{children:"Currently active transport routes"})]}),e.jsx(g,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-red-600 mb-2",children:"Error loading routes"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Please try again later"})]})})]}):e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsxs(p,{className:"flex items-center space-x-2",children:[e.jsx(r,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{children:"Live Route Tracking"})]}),e.jsx(u,{children:"Currently active transport routes"})]}),e.jsx(g,{children:l&&l.length>0?e.jsx("div",{className:"space-y-4",children:l.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 bg-gradient-to-r from-green-50 to-blue-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold text-lg",children:s.route_name}),e.jsx(_,{className:"bg-green-500 text-white",children:e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),e.jsx("span",{children:"Live"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(r,{className:"w-5 h-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Route"}),e.jsxs("p",{className:"text-gray-600 text-sm",children:[s.start_location," â†’ ",s.end_location]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(y,{className:"w-5 h-5 text-purple-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Time"}),e.jsxs("p",{className:"text-gray-600 text-sm",children:[s.start_time," - ",s.end_time]})]})]})]}),e.jsxs("div",{className:"border-t pt-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Driver:"}),e.jsx("span",{className:"text-sm text-gray-600",children:s.driver_name})]}),s.driver_phone&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(C,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:s.driver_phone})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Vehicle:"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[s.vehicle_number," (",s.license_plate,")"]})]})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(r,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Active Routes"}),e.jsx("p",{className:"text-gray-600",children:"There are currently no active transport routes."})]})})]})};export{T as default};
