import{r as v,q as C,j as s,i as u,k as m,l as p,m as j,n as g,B as T,V as S,A as F,G as A,s as x,a as R}from"./main-piTIAPSx.js";import{C as o}from"./circle-check-big-CD0jvDn0.js";import{C as d}from"./circle-x-CETn4HDx.js";const P=()=>{const[t,a]=v.useState(!1),[c,n]=v.useState(null),[h,r]=v.useState(""),{user:f,profile:y}=C(),E=async()=>{a(!0),r(""),n(null);const i={supabase:!1,edgeFunctions:!1,database:!1,auth:!1};try{console.log("Testing Supabase connection...");const{data:N,error:w}=await x.from("profiles").select("count").limit(1);if(w)throw console.error("Supabase connection failed:",w),new Error(`Supabase connection failed: ${w.message}`);i.supabase=!0,console.log("‚úÖ Supabase connection successful"),console.log("Testing database access...");const{data:k,error:b}=await x.from("profiles").select("id, email").limit(1);if(b)throw console.error("Database access failed:",b),new Error(`Database access failed: ${b.message}`);if(i.database=!0,console.log("‚úÖ Database access successful"),f){console.log("Testing authentication...");const{data:{user:l},error:e}=await x.auth.getUser();if(e)throw console.error("Authentication test failed:",e),new Error(`Authentication failed: ${e.message}`);l&&(i.auth=!0,console.log("‚úÖ Authentication successful"))}else console.log("‚ö†Ô∏è No user logged in, skipping auth test");console.log("Testing Edge Functions...");try{const{data:{session:l}}=await x.auth.getSession();if(l){const e=await fetch("https://dznbihypzmvcmradijqn.supabase.co/functions/v1/change-user-password",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l.access_token}`},body:JSON.stringify({test:"connection"})});if(e.status===401)i.edgeFunctions=!0,console.log("‚úÖ Edge Functions accessible (401 expected without proper auth)");else if(e.ok)i.edgeFunctions=!0,console.log("‚úÖ Edge Functions working");else throw console.error("Edge Functions test failed:",e.status,e.statusText),new Error(`Edge Functions failed: ${e.status} ${e.statusText}`)}else{console.log("‚ö†Ô∏è No session, testing Edge Functions without auth...");const e=await fetch("https://dznbihypzmvcmradijqn.supabase.co/functions/v1/change-user-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:"connection"})});if(e.status===401)i.edgeFunctions=!0,console.log("‚úÖ Edge Functions accessible (401 expected without auth)");else throw new Error(`Edge Functions failed: ${e.status} ${e.statusText}`)}}catch(l){throw console.error("Edge Functions test error:",l),new Error(`Edge Functions test failed: ${l.message}`)}n(i),console.log("üéâ All tests completed successfully!")}catch(N){console.error("Test failed:",N),r(N.message||"Unknown error occurred"),n(i)}finally{a(!1)}};return s.jsxs(u,{className:"w-full max-w-md mx-auto",children:[s.jsxs(m,{children:[s.jsxs(p,{className:"flex items-center gap-2",children:[s.jsx(o,{className:"h-5 w-5 text-green-600"}),"Connection Test"]}),s.jsx(j,{children:"Test the connection to Supabase and Edge Functions"})]}),s.jsxs(g,{className:"space-y-4",children:[s.jsx(T,{onClick:E,disabled:t,className:"w-full",children:t?s.jsxs(s.Fragment,{children:[s.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}),"Testing..."]}):"Run Connection Test"}),h&&s.jsxs(F,{variant:"destructive",children:[s.jsx(d,{className:"h-4 w-4"}),s.jsx(A,{children:h})]}),c&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"font-medium",children:"Test Results:"}),s.jsxs("div",{className:"space-y-1 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[c.supabase?s.jsx(o,{className:"h-4 w-4 text-green-600"}):s.jsx(d,{className:"h-4 w-4 text-red-600"}),s.jsx("span",{children:"Supabase Connection"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[c.database?s.jsx(o,{className:"h-4 w-4 text-green-600"}):s.jsx(d,{className:"h-4 w-4 text-red-600"}),s.jsx("span",{children:"Database Access"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[c.auth?s.jsx(o,{className:"h-4 w-4 text-green-600"}):s.jsx(d,{className:"h-4 w-4 text-red-600"}),s.jsx("span",{children:"Authentication"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[c.edgeFunctions?s.jsx(o,{className:"h-4 w-4 text-green-600"}):s.jsx(d,{className:"h-4 w-4 text-red-600"}),s.jsx("span",{children:"Edge Functions"})]})]})]}),f&&s.jsxs("div",{className:"text-xs text-gray-600",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Current User:"})," ",f.email]}),y&&s.jsxs("p",{children:[s.jsx("strong",{children:"Role:"})," ",y.role]})]})]})]})},U=()=>{const{user:t,profile:a,session:c}=C(),{toast:n}=R(),h=async()=>{if(!t){n({title:"No user logged in",description:"Please log in to test password change",variant:"destructive"});return}try{const{error:r}=await x.auth.updateUser({password:"TestPassword123!"});n(r?{title:"Password change failed",description:r.message,variant:"destructive"}:{title:"Password change successful",description:"Password was updated successfully"})}catch(r){n({title:"Error",description:r.message,variant:"destructive"})}};return s.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Frontend Test Page"}),s.jsx("p",{className:"text-gray-600",children:"Testing all frontend updates and connections"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsx(P,{}),s.jsxs(u,{children:[s.jsxs(m,{children:[s.jsx(p,{children:"Current Status"}),s.jsx(j,{children:"Authentication and user information"})]}),s.jsxs(g,{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Logged In:"}),s.jsx("span",{className:t?"text-green-600":"text-red-600",children:t?"Yes":"No"})]}),t&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Email:"}),s.jsx("span",{className:"text-sm",children:t.email})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"User ID:"}),s.jsx("span",{className:"text-xs font-mono",children:t.id})]})]}),a&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Role:"}),s.jsx("span",{className:"text-sm",children:a.role})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Name:"}),s.jsxs("span",{className:"text-sm",children:[a.first_name," ",a.last_name]})]}),a.organization_id&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Organization:"}),s.jsx("span",{className:"text-xs font-mono",children:a.organization_id})]})]}),c&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Session Active:"}),s.jsx("span",{className:"text-green-600",children:"Yes"})]})]}),s.jsx(T,{onClick:h,variant:"outline",className:"w-full",children:"Test Password Change"})]})]})]}),s.jsxs(u,{children:[s.jsxs(m,{children:[s.jsx(p,{children:"Environment Information"}),s.jsx(j,{children:"Current configuration and settings"})]}),s.jsx(g,{children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Supabase URL:"}),s.jsx("p",{className:"text-xs font-mono break-all",children:"https://dznbihypzmvcmradijqn.supabase.co"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Current Port:"}),s.jsx("p",{className:"text-xs",children:"3001"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Edge Functions:"}),s.jsx("p",{className:"text-xs text-green-600",children:"‚úÖ Redeployed and Active"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"CORS Status:"}),s.jsx("p",{className:"text-xs text-yellow-600",children:"‚ö†Ô∏è Needs update in dashboard"})]})]})})]}),s.jsxs(u,{children:[s.jsxs(m,{children:[s.jsx(p,{children:"Next Steps"}),s.jsx(j,{children:"What you need to do to complete the setup"})]}),s.jsx(g,{children:s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-blue-600",children:"1."}),s.jsxs("span",{children:["Update CORS settings in Supabase dashboard to include ",s.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"http://localhost:3001"})]})]}),s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-blue-600",children:"2."}),s.jsx("span",{children:"Run the connection test above to verify everything is working"})]}),s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-blue-600",children:"3."}),s.jsx("span",{children:"Test the password change functionality in your app"})]}),s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-blue-600",children:"4."}),s.jsx("span",{children:"Clear browser cache if you still see CORS errors"})]})]})})]})]})};export{U as default};
