import{c as We,q as Z,s as L,J as Oe,$ as U,r as Y,j as e,B as k,i as h,a3 as je,n as j,a4 as B,a5 as fe,A as re,C as Xe,G as ne,H as ye,k as y,l as g,S as ge,E as C,v as pe,O as $e,h as Qe,D as Ne,d as ke,e as we,f as _e,g as Je,Y as F,a6 as Ze,I as be}from"./main-piTIAPSx.js";import{T as es,a as ss,b as H,c as K}from"./tabs-N5TLptOb.js";import{T as ve,a as Ce,b as X,c as w,d as Te,e as _}from"./table-CV1HM_JF.js";import{T as le}from"./textarea-mxcr8nPj.js";import{S as ts,a as as,b as rs,c as ns,d as $}from"./select-Brm_N20Q.js";import{P as Q}from"./progress-nJfMQ3MC.js";import{u as ls,a as is,b as ds,c as cs,d as os,e as ms,f as xs,g as us,h as hs,i as js,j as fs,S as ys,M as ie}from"./useDailyRest-DFYrcPfg.js";import{u as Ie}from"./useQuery-Dbdyc74j.js";import{u as qe}from"./useMutation-B8vlA97s.js";import{t as Re,m as gs,f as m,s as oe}from"./format-VbeFDANp.js";import{e as G}from"./endOfWeek-BL7NObWT.js";import{R as Me}from"./refresh-cw-BS9rbMP7.js";import{P as de}from"./play-CKKdwP8m.js";import{C as De}from"./circle-alert-9v4QUdZ6.js";import{C as ps}from"./car-B9KPzxYH.js";import{C as Ee}from"./calendar-days-BsyHwnst.js";import{C as ce}from"./circle-check-big-CD0jvDn0.js";import{C as Ns}from"./circle-x-CETn4HDx.js";import{P as ks}from"./plus-CMGcTuiR.js";import{p as I}from"./parseISO-JZi9Nyn6.js";import"./index-Pp_niZQ8.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=We("Coffee",[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=We("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);function _s(t){return a=>{const n=(t?Math[t]:Math.trunc)(a);return n===0?0:n}}function bs(t,a){return+Re(t)-+Re(a)}function Se(t,a,c){const n=bs(t,a)/gs;return _s(c==null?void 0:c.roundingMethod)(n)}const P={FULL_WEEKLY_REST:45,REDUCED_WEEKLY_REST:24,COMPENSATION_REQUIRED:!0,COMPENSATION_PERIOD:3},vs=t=>{const{profile:a}=Z(),c=t?m(t,"yyyy-MM-dd"):m(oe(new Date,{weekStartsOn:1}),"yyyy-MM-dd"),n=t?m(G(t,{weekStartsOn:1}),"yyyy-MM-dd"):m(G(new Date,{weekStartsOn:1}),"yyyy-MM-dd");return Ie({queryKey:["weekly-rest",a==null?void 0:a.id,c,n],queryFn:async()=>{if(!(a!=null&&a.id))throw new Error("User profile is required");const{data:f,error:x}=await L.from("weekly_rest").select(`
          *,
          profiles!inner(
            first_name,
            last_name,
            email
          )
        `).eq("driver_id",a.id).gte("week_start_date",c).lte("week_end_date",n).order("week_start_date",{ascending:!1});if(x){if(console.error("Error fetching weekly rest:",x),x.code==="PGRST205"||x.code==="42P01")return console.warn("weekly_rest table not found, returning empty data"),[];throw x}return f||[]},enabled:!!(a!=null&&a.id)})},Cs=()=>{const{profile:t}=Z(),a=Oe();return qe({mutationFn:async c=>{if(!(t!=null&&t.id)||!(t!=null&&t.organization_id))throw new Error("User profile and organization information required");const{data:n,error:f}=await L.from("weekly_rest").insert({...c,driver_id:t.id,organization_id:t.organization_id}).select().single();if(f)throw f.code==="PGRST205"||f.code==="42P01"?(console.warn("weekly_rest table not found, cannot create weekly rest record"),new Error("Weekly rest table not found. Please ensure the database is properly set up.")):f;return n},onSuccess:()=>{a.invalidateQueries({queryKey:["weekly-rest"]}),a.invalidateQueries({queryKey:["daily-rest"]}),U.success("Weekly rest recorded successfully")},onError:c=>{console.error("Error creating weekly rest:",c),U.error("Failed to record weekly rest: "+c.message)}})},Ae=async(t,a)=>{const c=G(a,{weekStartsOn:1}),n=m(a,"yyyy-MM-dd"),f=m(c,"yyyy-MM-dd"),{data:x,error:D}=await L.from("time_entries").select("entry_date, total_hours").eq("driver_id",t).gte("entry_date",n).lte("entry_date",f);D&&console.warn("Error fetching time entries for weekly rest analysis:",D);const{data:S,error:u}=await L.from("daily_rest").select("rest_date, duration_hours").eq("driver_id",t).gte("rest_date",n).lte("rest_date",f);u&&(u.code==="PGRST205"||u.code==="42P01")&&console.warn("daily_rest table not found for weekly rest analysis");const{data:N,error:r}=await L.from("weekly_rest").select("*").eq("driver_id",t).gte("week_start_date",n).lte("week_end_date",f).order("week_start_date",{ascending:!1}).limit(1),T=(N==null?void 0:N[0])||null;r&&(r.code==="PGRST205"||r.code==="42P01")&&console.warn("weekly_rest table not found for weekly rest analysis");const W=(x==null?void 0:x.reduce((R,M)=>R+(M.total_hours||0),0))||0,ee=(S==null?void 0:S.reduce((R,M)=>R+(M.duration_hours||0),0))||0,q=(T==null?void 0:T.total_rest_hours)||0;let b="missing",l=!1,p=!1,A;q>=P.FULL_WEEKLY_REST?(b="full",l=!0):q>=P.REDUCED_WEEKLY_REST&&(b="reduced",l=!0,p=!0,T!=null&&T.compensation_date&&(A=new Date(T.compensation_date)));const o=[],O=[];return W>60?O.push(`Weekly working time (${W}h) exceeds WTD limit (60h)`):W>55&&o.push(`Weekly working time (${W}h) approaching WTD limit (60h)`),b==="missing"?O.push("No weekly rest period recorded"):b==="reduced"&&!p&&o.push("Reduced weekly rest requires compensation"),p&&!A&&o.push("Compensation for reduced weekly rest not scheduled"),{weekStart:a,weekEnd:c,totalWorkHours:W,totalRestHours:ee,requiredWeeklyRest:P.FULL_WEEKLY_REST,actualRestHours:q,restCompliance:l,restType:b,compensationRequired:p,compensationDate:A,warnings:o,violations:O}},Ts=t=>{const{profile:a}=Z();return Ie({queryKey:["weekly-rest-analysis",a==null?void 0:a.id,t.toISOString()],queryFn:async()=>{if(!(a!=null&&a.id))throw new Error("User profile is required");return Ae(a.id,t)},enabled:!!(a!=null&&a.id)})},Rs=()=>{const{profile:t}=Z(),a=Oe(),c=Cs();return qe({mutationFn:async n=>{if(!(t!=null&&t.id))throw new Error("User profile is required");const f=await Ae(t.id,n),x=G(n,{weekStartsOn:1}),{data:D}=await L.from("weekly_rest").select("id").eq("driver_id",t.id).gte("week_start_date",m(n,"yyyy-MM-dd")).lte("week_end_date",m(x,"yyyy-MM-dd")).limit(1);if(D==null?void 0:D[0])return{message:"Weekly rest already recorded for this week",analysis:f};let u="full_weekly_rest",N=!1;return f.totalWorkHours>60&&(u="reduced_weekly_rest",N=!0),await c.mutateAsync({week_start_date:m(n,"yyyy-MM-dd"),week_end_date:m(x,"yyyy-MM-dd"),total_rest_hours:f.actualRestHours||P.FULL_WEEKLY_REST,rest_type:u,compensation_required:N,notes:"Automatically recorded weekly rest period"}),{message:"Weekly rest recorded successfully",analysis:f}},onSuccess:n=>{a.invalidateQueries({queryKey:["weekly-rest"]}),a.invalidateQueries({queryKey:["weekly-rest-analysis"]}),a.invalidateQueries({queryKey:["daily-rest"]}),n.message.includes("already recorded")?U.info(n.message):U.success(n.message)},onError:n=>{console.error("Error auto-recording weekly rest:",n),U.error("Failed to auto-record weekly rest: "+n.message)}})},Ms=()=>{const t=oe(new Date,{weekStartsOn:1});return Ts(t)};function et(){const[t,a]=Y.useState(new Date),[c,n]=Y.useState(!1),[f,x]=Y.useState(!1),[D,S]=Y.useState(""),[u,N]=Y.useState({start_date:"",end_date:"",request_type:"annual_leave",reason:"",notes:""}),{data:r,isLoading:T}=ls(),{data:W=[],isLoading:ee}=is(),{data:q=[]}=ds(),b=cs(),{analysis:l,limits:p}=os(t||new Date),{data:A=[]}=vs(t),{data:o}=Ms(),O=Rs(),R=ms(),M=xs(),se=us(),te=hs(),ae=js(),Fe=fs(),me=()=>{if(!(r!=null&&r.clock_in_time)||r.status==="completed")return 0;const s=new Date,[d,v,E]=r.clock_in_time.split(":").map(Number),He=new Date(s.getFullYear(),s.getMonth(),s.getDate(),d,v,E),ue=new Date,he=Se(ue,He);if(r.break_start_time&&!r.break_end_time){const[Ke,Ue,Ge]=r.break_start_time.split(":").map(Number),Ve=new Date(s.getFullYear(),s.getMonth(),s.getDate(),Ke,Ue,Ge),ze=Se(ue,Ve);return Math.max(0,he-ze)}return he},V=s=>{const d=Math.floor(s/60),v=s%60;return`${d.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}`},xe=async()=>{try{let s="Unknown";navigator.geolocation&&navigator.geolocation.getCurrentPosition(d=>{s=`${d.coords.latitude.toFixed(4)}, ${d.coords.longitude.toFixed(4)}`},()=>{}),await R.mutateAsync(s)}catch(s){console.error("Clock in error:",s)}},Le=async()=>{try{let s="Unknown";navigator.geolocation&&navigator.geolocation.getCurrentPosition(E=>{s=`${E.coords.latitude.toFixed(4)}, ${E.coords.longitude.toFixed(4)}`},()=>{}),await M.mutateAsync(s);const d=oe(new Date,{weekStartsOn:1}),v=G(new Date,{weekStartsOn:1});try{await Fe.mutateAsync({startDate:d,endDate:v})}catch(E){console.error("Error auto-recording rest days:",E)}x(!1),S("")}catch(s){console.error("Clock out error:",s)}},Pe=async()=>{try{await se.mutateAsync()}catch(s){console.error("Start break error:",s)}},Ye=async()=>{try{await te.mutateAsync()}catch(s){console.error("End break error:",s)}},Be=async()=>{try{await ae.mutateAsync(u),n(!1),N({start_date:"",end_date:"",request_type:"annual_leave",reason:"",notes:""})}catch(s){console.error("Time off request error:",s)}};l.criticalViolations.length>0?{status:"critical",color:"text-red-600",bgColor:"bg-red-100"}:l.warnings.length>0?{status:"warning",color:"text-yellow-600",bgColor:"bg-yellow-100"}:{status:"compliant",color:"text-green-600",bgColor:"bg-green-100"};const i=r?r.status==="completed"?"signed_off":r.break_start_time&&!r.break_end_time?"on_break":"on_duty":"off_duty",z=(()=>{const s=new Date;return q.filter(d=>{const v=I(d.start_date),E=I(d.end_date);return v<=s&&E>=s})})();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Time Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Track your working hours and manage time off requests"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(k,{variant:"outline",size:"sm",children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Refresh"]})})]}),e.jsx(h,{className:je("border-2",i==="on_duty"&&"border-green-200 bg-green-50",i==="on_break"&&"border-yellow-200 bg-yellow-50",i==="signed_off"&&"border-blue-200 bg-blue-50",i==="off_duty"&&"border-gray-200 bg-gray-50"),children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:je("p-3 rounded-full",i==="on_duty"&&"bg-green-100",i==="on_break"&&"bg-yellow-100",i==="signed_off"&&"bg-blue-100",i==="off_duty"&&"bg-gray-100"),children:[i==="on_duty"&&e.jsx(ys,{className:"w-6 h-6 text-green-600"}),i==="on_break"&&e.jsx(J,{className:"w-6 h-6 text-yellow-600"}),i==="signed_off"&&e.jsx(B,{className:"w-6 h-6 text-blue-600"}),i==="off_duty"&&e.jsx(fe,{className:"w-6 h-6 text-gray-600"})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold",children:[i==="on_duty"&&"Currently On Duty",i==="on_break"&&"Currently On Break",i==="signed_off"&&"Signed Off for the Day",i==="off_duty"&&"Off Duty"]}),e.jsxs("p",{className:"text-muted-foreground",children:[i==="on_duty"&&"You are currently working. Remember to take breaks and monitor your WTD compliance.",i==="on_break"&&"You are currently on break. Take your time to rest properly.",i==="signed_off"&&"You have successfully signed off for the day. Have a good rest!",i==="off_duty"&&'You are not currently on duty. Click "Clock In" to start your work day.']})]})]}),e.jsxs("div",{className:"text-right",children:[i==="on_duty"&&e.jsxs(k,{onClick:()=>x(!0),className:"bg-red-600 hover:bg-red-700",size:"lg",children:[e.jsx(B,{className:"w-5 h-5 mr-2"}),"Sign Off Work"]}),i==="off_duty"&&e.jsxs(k,{onClick:xe,disabled:R.isPending,className:"bg-green-600 hover:bg-green-700",size:"lg",children:[e.jsx(de,{className:"w-5 h-5 mr-2"}),R.isPending?"Clocking In...":"Clock In"]})]})]})})}),z.length>0&&e.jsxs(re,{className:"border-blue-200 bg-blue-50",children:[e.jsx(Xe,{className:"h-4 w-4 text-blue-600"}),e.jsxs(ne,{className:"text-blue-800",children:[e.jsx("strong",{children:"You are currently on approved time off:"})," ",z[0].request_type.replace("_"," "),"from ",m(I(z[0].start_date),"MMM dd")," to ",m(I(z[0].end_date),"MMM dd")]})]}),l.criticalViolations.length>0&&e.jsx(h,{className:"border-red-200 bg-red-50",children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ye,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-red-900",children:"Working Time Directive Violations"}),e.jsx("ul",{className:"mt-1 text-sm text-red-700",children:l.criticalViolations.map((s,d)=>e.jsxs("li",{children:["• ",s]},d))})]})]})})}),l.warnings.length>0&&l.criticalViolations.length===0&&e.jsx(h,{className:"border-yellow-200 bg-yellow-50",children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(De,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-yellow-900",children:"Working Time Directive Warnings"}),e.jsx("ul",{className:"mt-1 text-sm text-yellow-700",children:l.warnings.map((s,d)=>e.jsxs("li",{children:["• ",s]},d))})]})]})})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(h,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Daily Working Time"}),e.jsx(ge,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[l.dailyWorkingTime.toFixed(1),"h"]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(Q,{value:l.dailyWorkingTime/p.MAX_DAILY_WORKING_TIME*100,className:"flex-1"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[p.MAX_DAILY_WORKING_TIME,"h limit"]})]}),l.dailyWorkingTime>p.MAX_DAILY_WORKING_TIME&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Exceeds limit"})]})]}),e.jsxs(h,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Daily Driving Time"}),e.jsx(ps,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[l.dailyDrivingTime.toFixed(1),"h"]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(Q,{value:l.dailyDrivingTime/p.MAX_DAILY_DRIVING_TIME*100,className:"flex-1"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[p.MAX_DAILY_DRIVING_TIME,"h limit"]})]}),l.dailyDrivingTime>p.MAX_DAILY_DRIVING_TIME&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Exceeds limit"})]})]}),e.jsxs(h,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Weekly Working Time"}),e.jsx(Ee,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[l.weeklyWorkingTime.toFixed(1),"h"]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(Q,{value:l.weeklyWorkingTime/p.MAX_WEEKLY_WORKING_TIME*100,className:"flex-1"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[p.MAX_WEEKLY_WORKING_TIME,"h limit"]})]}),l.weeklyWorkingTime>p.MAX_WEEKLY_WORKING_TIME&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Exceeds limit"})]})]}),e.jsxs(h,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Compliance Score"}),e.jsx(ce,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[l.complianceScore,"%"]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(Q,{value:l.complianceScore,className:"flex-1"}),e.jsx(C,{variant:l.overallCompliance?"default":"destructive",children:l.overallCompliance?"Compliant":"Non-Compliant"})]})]})]})]}),e.jsxs(h,{children:[e.jsx(y,{children:e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(J,{className:"w-5 h-5"}),e.jsx("span",{children:"Break Compliance"})]})}),e.jsxs(j,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[l.takenBreaks.toFixed(1),"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Breaks Taken"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[l.requiredBreaks.toFixed(1),"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Breaks Required"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:l.breakCompliance?e.jsx(ce,{className:"w-8 h-8 text-green-600 mx-auto"}):e.jsx(Ns,{className:"w-8 h-8 text-red-600 mx-auto"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Compliance Status"})]})]}),l.breakWarnings.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"Break Warnings:"}),e.jsx("ul",{className:"text-sm text-yellow-700",children:l.breakWarnings.map((s,d)=>e.jsxs("li",{children:["• ",s]},d))})]})]})]}),e.jsxs(es,{defaultValue:"today",className:"space-y-4",children:[e.jsxs(ss,{className:"grid w-full grid-cols-5",children:[e.jsx(H,{value:"today",children:"Today's Work"}),e.jsx(H,{value:"history",children:"History"}),e.jsx(H,{value:"time-off",children:"Time Off"}),e.jsx(H,{value:"weekly-rest",children:"Weekly Rest"}),e.jsx(H,{value:"statistics",children:"Statistics"})]}),e.jsx(K,{value:"today",className:"space-y-4",children:e.jsxs(h,{children:[e.jsx(y,{children:e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(pe,{className:"w-5 h-5"}),e.jsx("span",{children:"Current Session"})]})}),e.jsx(j,{children:T?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{children:"Loading current session..."})]}):r?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:V(me())}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Current Session"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:r.total_hours?V(r.total_hours*60):"00:00"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Today"})]})]}),e.jsx("div",{className:"flex justify-center space-x-4",children:r.status==="active"?e.jsxs(e.Fragment,{children:[e.jsxs(k,{onClick:()=>x(!0),disabled:M.isPending,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),M.isPending?"Signing Off...":"Sign Off Work"]}),r.break_start_time&&!r.break_end_time?e.jsxs(k,{onClick:Ye,disabled:te.isPending,variant:"outline",children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),te.isPending?"Ending Break...":"End Break"]}):e.jsxs(k,{onClick:Pe,disabled:se.isPending,variant:"outline",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),se.isPending?"Starting Break...":"Start Break"]})]}):e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-4",children:[e.jsx(ce,{className:"w-6 h-6 text-green-600"}),e.jsx("span",{className:"text-lg font-medium text-green-600",children:"Successfully Signed Off"})]}),e.jsx("p",{className:"text-muted-foreground",children:"You have completed your work day. Have a good rest!"})]})}),r.status==="active"&&e.jsx("div",{className:"text-center",children:e.jsx(C,{variant:r.break_start_time&&!r.break_end_time?"secondary":"default",children:r.break_start_time&&!r.break_end_time?"On Break":"Working"})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fe,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"You are off duty"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:'Click "Clock In" to start your work day'}),e.jsxs(k,{onClick:xe,disabled:R.isPending,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),R.isPending?"Clocking In...":"Clock In"]})]})})]})}),e.jsx(K,{value:"history",className:"space-y-4",children:e.jsxs(h,{children:[e.jsx(y,{children:e.jsx(g,{children:"Time Entry History"})}),e.jsx(j,{children:ee?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{children:"Loading time entries..."})]}):e.jsxs(ve,{children:[e.jsx(Ce,{children:e.jsxs(X,{children:[e.jsx(w,{children:"Date"}),e.jsx(w,{children:"Clock In"}),e.jsx(w,{children:"Clock Out"}),e.jsx(w,{children:"Total Hours"}),e.jsx(w,{children:"Break Time"}),e.jsx(w,{children:"Status"})]})}),e.jsx(Te,{children:W.map(s=>{var d,v;return e.jsxs(X,{children:[e.jsx(_,{children:s.entry_date?m(I(s.entry_date),"MMM dd, yyyy"):"N/A"}),e.jsx(_,{children:s.clock_in_time?s.clock_in_time:"-"}),e.jsx(_,{children:s.clock_out_time?s.clock_out_time:"-"}),e.jsxs(_,{children:[((d=s.total_hours)==null?void 0:d.toFixed(2))||"0.00","h"]}),e.jsxs(_,{children:[((v=s.break_hours)==null?void 0:v.toFixed(2))||"0.00","h"]}),e.jsx(_,{children:e.jsx(C,{variant:s.status==="completed"?"default":"secondary",children:s.status==="completed"?"Signed Off":s.status})})]},s.id)})})]})})]})}),e.jsx(K,{value:"time-off",className:"space-y-4",children:e.jsxs(h,{children:[e.jsx(y,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(g,{children:"Time Off Requests"}),e.jsxs(k,{onClick:()=>n(!0),children:[e.jsx(ks,{className:"w-4 h-4 mr-2"}),"Request Time Off"]})]})}),e.jsx(j,{children:e.jsxs(ve,{children:[e.jsx(Ce,{children:e.jsxs(X,{children:[e.jsx(w,{children:"Type"}),e.jsx(w,{children:"Start Date"}),e.jsx(w,{children:"End Date"}),e.jsx(w,{children:"Status"}),e.jsx(w,{children:"Reason"})]})}),e.jsx(Te,{children:q.map(s=>e.jsxs(X,{children:[e.jsx(_,{className:"capitalize",children:s.request_type.replace("_"," ")}),e.jsx(_,{children:m(I(s.start_date),"MMM dd, yyyy")}),e.jsx(_,{children:m(I(s.end_date),"MMM dd, yyyy")}),e.jsx(_,{children:e.jsx(C,{variant:s.status==="approved"?"default":s.status==="rejected"?"destructive":"secondary",children:s.status})}),e.jsx(_,{className:"max-w-xs truncate",children:s.reason})]},s.id))})]})})]})}),e.jsx(K,{value:"statistics",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(h,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Total Hours"}),e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[b.totalHours.toFixed(1),"h"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This period"})]})]}),e.jsxs(h,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Overtime"}),e.jsx($e,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[b.totalOvertime.toFixed(1),"h"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Extra hours worked"})]})]}),e.jsxs(h,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Break Time"}),e.jsx(J,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[b.totalBreaks.toFixed(1),"h"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total breaks taken"})]})]}),e.jsxs(h,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Average/Day"}),e.jsx(Qe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[b.averageHoursPerDay.toFixed(1),"h"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Daily average"})]})]})]})}),e.jsxs(K,{value:"weekly-rest",className:"space-y-4",children:[o&&e.jsxs(h,{children:[e.jsx(y,{children:e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(ie,{className:"w-5 h-5"}),e.jsx("span",{children:"Weekly Rest Compliance"}),e.jsx(C,{variant:o.restCompliance?"default":"destructive",children:o.restCompliance?"Compliant":"Non-Compliant"})]})}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[o.actualRestHours.toFixed(1),"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Actual Rest"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[o.requiredWeeklyRest,"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Required Rest"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[o.totalWorkHours.toFixed(1),"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Work Hours"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Rest Type:"}),e.jsx(C,{variant:"outline",className:"capitalize",children:o.restType.replace("_"," ")})]}),o.compensationRequired&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Compensation Required:"}),e.jsx(C,{variant:"destructive",children:"Yes"})]}),o.compensationDate&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Compensation Date:"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:m(o.compensationDate,"MMM dd, yyyy")})]})]}),o.violations.length>0&&e.jsxs(re,{className:"border-red-200 bg-red-50",children:[e.jsx(ye,{className:"h-4 w-4 text-red-600"}),e.jsxs(ne,{className:"text-red-800",children:[e.jsx("strong",{children:"Violations:"})," ",o.violations.join(", ")]})]}),o.warnings.length>0&&e.jsxs(re,{className:"border-yellow-200 bg-yellow-50",children:[e.jsx(De,{className:"h-4 w-4 text-yellow-600"}),e.jsxs(ne,{className:"text-yellow-800",children:[e.jsx("strong",{children:"Warnings:"})," ",o.warnings.join(", ")]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(k,{onClick:()=>O.mutate(t||new Date),disabled:O.isPending,className:"flex-1",children:O.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"w-4 h-4 mr-2 animate-spin"}),"Recording..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Record Weekly Rest"]})})})]})})]}),e.jsxs(h,{children:[e.jsx(y,{children:e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(Ee,{className:"w-5 h-5"}),e.jsx("span",{children:"Weekly Rest History"})]})}),e.jsx(j,{children:A.length>0?e.jsx("div",{className:"space-y-4",children:A.map(s=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"font-medium",children:["Week of ",m(new Date(s.week_start_date),"MMM dd, yyyy")]}),e.jsx(C,{variant:"outline",className:"capitalize",children:s.rest_type.replace("_"," ")})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.total_rest_hours,"h rest"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Period:"}),e.jsxs("div",{children:[m(new Date(s.week_start_date),"MMM dd")," - ",m(new Date(s.week_end_date),"MMM dd, yyyy")]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Compensation:"}),e.jsx("div",{children:s.compensation_required?e.jsx(C,{variant:"destructive",className:"text-xs",children:"Required"}):e.jsx(C,{variant:"default",className:"text-xs",children:"Not Required"})})]})]}),s.notes&&e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",s.notes]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ie,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No weekly rest records found"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:'Click "Record Weekly Rest" to create your first rest record'})]})})]}),e.jsxs(h,{children:[e.jsx(y,{children:e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(ge,{className:"w-5 h-5"}),e.jsx("span",{children:"WTD Weekly Rest Requirements"})]})}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Full Weekly Rest"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[P.FULL_WEEKLY_REST,"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Minimum uninterrupted rest"})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Reduced Weekly Rest"}),e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[P.REDUCED_WEEKLY_REST,"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Once per week maximum"})]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Important Information"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"• Weekly rest must be taken every 6 x 24-hour periods"}),e.jsx("li",{children:"• Reduced rest requires compensation within 3 weeks"}),e.jsx("li",{children:"• Rest periods must be uninterrupted"}),e.jsx("li",{children:"• Compliance is monitored automatically"})]})]})]})})]})]})]}),e.jsx(Ne,{open:f,onOpenChange:x,children:e.jsxs(ke,{children:[e.jsxs(we,{children:[e.jsxs(_e,{className:"flex items-center space-x-2",children:[e.jsx(B,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{children:"Sign Off Work"})]}),e.jsx(Je,{children:"You are about to sign off work for the day. This action will record your end time and complete your work session."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(ws,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900",children:"Session Summary"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Current Session:"}),e.jsx("div",{className:"font-semibold text-blue-900",children:V(me())})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Total Today:"}),e.jsx("div",{className:"font-semibold text-blue-900",children:r!=null&&r.total_hours?V(r.total_hours*60):"00:00"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"sign-off-reason",children:"End of Day Notes (Optional)"}),e.jsx(le,{id:"sign-off-reason",placeholder:"Any notes about your work day, issues encountered, or important information...",value:D,onChange:s=>S(s.target.value),rows:3})]})]}),e.jsxs(Ze,{children:[e.jsx(k,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsxs(k,{onClick:Le,disabled:M.isPending,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),M.isPending?"Signing Off...":"Confirm Sign Off"]})]})]})}),e.jsx(Ne,{open:c,onOpenChange:n,children:e.jsxs(ke,{children:[e.jsx(we,{children:e.jsx(_e,{children:"Request Time Off"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"start-date",children:"Start Date"}),e.jsx(be,{id:"start-date",type:"date",value:u.start_date,onChange:s=>N({...u,start_date:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"end-date",children:"End Date"}),e.jsx(be,{id:"end-date",type:"date",value:u.end_date,onChange:s=>N({...u,end_date:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"request-type",children:"Request Type"}),e.jsxs(ts,{value:u.request_type,onValueChange:s=>N({...u,request_type:s}),children:[e.jsx(as,{children:e.jsx(rs,{})}),e.jsxs(ns,{children:[e.jsx($,{value:"annual_leave",children:"Annual Leave"}),e.jsx($,{value:"sick_leave",children:"Sick Leave"}),e.jsx($,{value:"personal_leave",children:"Personal Leave"}),e.jsx($,{value:"bereavement",children:"Bereavement"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"reason",children:"Reason"}),e.jsx(le,{id:"reason",placeholder:"Please provide a reason for your time off request...",value:u.reason,onChange:s=>N({...u,reason:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"notes",children:"Additional Notes"}),e.jsx(le,{id:"notes",placeholder:"Any additional information...",value:u.notes,onChange:s=>N({...u,notes:s.target.value})})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(k,{variant:"outline",onClick:()=>n(!1),children:"Cancel"}),e.jsx(k,{onClick:Be,disabled:ae.isPending,children:ae.isPending?"Submitting...":"Submit Request"})]})]})]})})]})}export{et as default};
