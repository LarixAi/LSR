import{q,s as _,r as C,j as e,N as E,bj as V,D as Z,b as J,B as f,d as $,e as ee,f as se,Y as u,I as g,i as j,n as m,aA as B,H as re,v as O,O as te,k as D,l as I,ax as ae,E as o}from"./main-piTIAPSx.js";import{u as K}from"./useQuery-Dbdyc74j.js";import{S as z,a as L,b as R,c as F,d}from"./select-Brm_N20Q.js";import{T as H,a as Q,b,c as a,d as G,e as i}from"./table-CV1HM_JF.js";import{T as ie,a as ne,b as M,c as P}from"./tabs-N5TLptOb.js";import{P as le}from"./plus-CMGcTuiR.js";import{S as ce}from"./search-HDsNrIL9.js";import{C as de}from"./circle-check-big-CD0jvDn0.js";import"./index-Pp_niZQ8.js";const U=()=>{const{user:h,profile:t}=q();return K({queryKey:["tire_inventory",t==null?void 0:t.organization_id],queryFn:async()=>{if(!(t!=null&&t.organization_id))throw new Error("Organization ID is required");console.log("Fetching tire inventory from database...");try{const{data:n,error:s}=await _.from("tire_inventory").select("*").eq("organization_id",t.organization_id).order("created_at",{ascending:!1});if(s){if(console.error("Error fetching tire inventory:",s),s.code==="42P01"||s.code==="PGRST205")return console.warn("tire_inventory table not found, returning empty data"),[];throw s}return console.log("Fetched tire inventory:",n),n||[]}catch(n){return console.error("Error in useTireInventory:",n),[]}},enabled:!!(t!=null&&t.organization_id)})},W=()=>{const{user:h,profile:t}=q();return K({queryKey:["vehicle_tires",t==null?void 0:t.organization_id],queryFn:async()=>{if(!(t!=null&&t.organization_id))throw new Error("Organization ID is required");console.log("Fetching vehicle tires from database...");try{const{data:n,error:s}=await _.from("vehicle_tires").select("*").eq("organization_id",t.organization_id).order("created_at",{ascending:!1});if(s){if(console.error("Error fetching vehicle tires:",s),s.code==="42P01"||s.code==="PGRST205")return console.warn("vehicle_tires table not found, returning empty data"),[];throw s}if(!n||n.length===0)return[];const l=n.filter(c=>c.vehicle_id).map(c=>c.vehicle_id),v=n.filter(c=>c.tire_inventory_id).map(c=>c.tire_inventory_id),[T,w]=await Promise.all([l.length>0?_.from("vehicles").select("id, vehicle_number, make, model").in("id",l):Promise.resolve({data:[],error:null}),v.length>0?_.from("tire_inventory").select("*").in("id",v):Promise.resolve({data:[],error:null})]),y=n.map(c=>{var N,x;const S=(N=T.data)==null?void 0:N.find(p=>p.id===c.vehicle_id),k=(x=w.data)==null?void 0:x.find(p=>p.id===c.tire_inventory_id);return{...c,vehicle:S||null,tire_inventory:k||null}});return console.log("Fetched vehicle tires with relations:",y),y||[]}catch(n){return console.error("Error in useVehicleTires:",n),[]}},enabled:!!(t!=null&&t.organization_id)})},oe=()=>{const{data:h=[]}=U(),{data:t=[]}=W();return{total_inventory:h.length,low_stock_items:h.filter(s=>s.stock_quantity<=s.minimum_stock).length,total_stock_value:h.reduce((s,l)=>s+(l.cost_per_tire||0)*l.stock_quantity,0),total_installed_tires:t.length,tires_due_inspection:t.filter(s=>s.next_inspection_due?new Date(s.next_inspection_due)<=new Date:!1).length,worn_tires:t.filter(s=>s.status==="worn").length,damaged_tires:t.filter(s=>s.status==="damaged").length,by_position:t.reduce((s,l)=>(s[l.position]=(s[l.position]||0)+1,s),{}),by_status:t.reduce((s,l)=>(s[l.status]=(s[l.status]||0)+1,s),{})}},Ne=()=>{const{user:h,profile:t,loading:n}=q(),[s,l]=C.useState(""),[v,T]=C.useState(""),[w,y]=C.useState(!1),{data:c=[],isLoading:S}=U(),{data:k=[],isLoading:N}=W(),x=oe();if(n||S||N)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading tire management..."})]})});if(!h||!t)return e.jsx(E,{to:"/auth",replace:!0});if(!["admin","council"].includes(t.role))return e.jsx(E,{to:"/unauthorized",replace:!0});const p=(r,A)=>r<=A?"critical":r<=A*1.5?"low":"good",X=r=>{switch(r){case"good":return e.jsx(o,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"Good"});case"worn":return e.jsx(o,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"Worn"});case"critical":return e.jsx(o,{className:"bg-red-100 text-red-800 hover:bg-red-100",children:"Replace"});default:return e.jsx(o,{variant:"secondary",children:r})}},Y=r=>{switch(r){case"good":return e.jsx(o,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"In Stock"});case"low":return e.jsx(o,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"Low Stock"});case"critical":return e.jsx(o,{className:"bg-red-100 text-red-800 hover:bg-red-100",children:"Critical"});default:return e.jsx(o,{variant:"secondary",children:r})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(V,{className:"w-8 h-8 text-red-600"}),"Tire Management"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage tire inventory and vehicle tire tracking"})]}),e.jsxs(Z,{open:w,onOpenChange:y,children:[e.jsx(J,{asChild:!0,children:e.jsxs(f,{className:"bg-red-600 hover:bg-red-700",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Add Tire Stock"]})}),e.jsxs($,{className:"max-w-md",children:[e.jsx(ee,{children:e.jsx(se,{children:"Add Tire Stock"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"brand",children:"Brand"}),e.jsx(g,{id:"brand",placeholder:"e.g., Michelin"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"model",children:"Model"}),e.jsx(g,{id:"model",placeholder:"e.g., XZE"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"size",children:"Size"}),e.jsx(g,{id:"size",placeholder:"e.g., 295/80R22.5"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"type",children:"Type"}),e.jsxs(z,{children:[e.jsx(L,{children:e.jsx(R,{placeholder:"Select tire type"})}),e.jsxs(F,{children:[e.jsx(d,{value:"steer",children:"Steer"}),e.jsx(d,{value:"drive",children:"Drive"}),e.jsx(d,{value:"trailer",children:"Trailer"}),e.jsx(d,{value:"all_position",children:"All Position"})]})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"quantity",children:"Quantity"}),e.jsx(g,{id:"quantity",type:"number",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"cost",children:"Cost Per Tire"}),e.jsx(g,{id:"cost",type:"number",step:"0.01",placeholder:"0.00"})]}),e.jsx(f,{className:"w-full bg-red-600 hover:bg-red-700",children:"Add to Inventory"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(j,{children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Stock"}),e.jsx("p",{className:"text-2xl font-bold",children:x.total_inventory})]})]})})}),e.jsx(j,{children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Low Stock Items"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:x.low_stock_items})]})]})})}),e.jsx(j,{children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{className:"w-8 h-8 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Due for Replacement"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:x.tires_due_inspection})]})]})})}),e.jsx(j,{children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Monthly Cost"}),e.jsxs("p",{className:"text-2xl font-bold",children:["£",x.total_stock_value.toLocaleString()]})]})]})})})]}),e.jsxs(ie,{defaultValue:"inventory",className:"space-y-6",children:[e.jsxs(ne,{className:"grid w-full grid-cols-3",children:[e.jsx(M,{value:"inventory",children:"Inventory Management"}),e.jsx(M,{value:"vehicle-tires",children:"Vehicle Tires"}),e.jsx(M,{value:"maintenance",children:"Tire Maintenance"})]}),e.jsx(P,{value:"inventory",className:"space-y-4",children:e.jsxs(j,{children:[e.jsxs(D,{children:[e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),"Tire Inventory"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(g,{placeholder:"Search tires...",value:s,onChange:r=>l(r.target.value),className:"pl-10"})]}),e.jsxs(z,{children:[e.jsx(L,{className:"w-48",children:e.jsx(R,{placeholder:"Filter by type"})}),e.jsxs(F,{children:[e.jsx(d,{value:"all",children:"All Types"}),e.jsx(d,{value:"steer",children:"Steer Tires"}),e.jsx(d,{value:"drive",children:"Drive Tires"}),e.jsx(d,{value:"trailer",children:"Trailer Tires"})]})]})]})]}),e.jsx(m,{children:e.jsxs(H,{children:[e.jsx(Q,{children:e.jsxs(b,{children:[e.jsx(a,{children:"Brand & Model"}),e.jsx(a,{children:"Size"}),e.jsx(a,{children:"Type"}),e.jsx(a,{children:"Stock"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Cost/Unit"}),e.jsx(a,{children:"Supplier"}),e.jsx(a,{children:"Location"})]})}),e.jsx(G,{children:c.map(r=>e.jsxs(b,{children:[e.jsxs(i,{className:"font-medium",children:[r.brand," ",r.model]}),e.jsx(i,{children:r.size}),e.jsx(i,{className:"capitalize",children:r.type}),e.jsxs(i,{children:[r.stockQuantity," / ",r.minimumStock," min"]}),e.jsx(i,{children:Y(p(r.stockQuantity,r.minimumStock))}),e.jsxs(i,{children:["£",r.costPerTire.toFixed(2)]}),e.jsx(i,{children:r.supplier}),e.jsx(i,{children:r.location})]},r.id))})]})})]})}),e.jsx(P,{value:"vehicle-tires",className:"space-y-4",children:e.jsxs(j,{children:[e.jsxs(D,{children:[e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Vehicle Tire Tracking"]}),e.jsx("div",{className:"flex gap-4",children:e.jsxs(z,{value:v,onValueChange:T,children:[e.jsx(L,{className:"w-48",children:e.jsx(R,{placeholder:"Filter by vehicle"})}),e.jsxs(F,{children:[e.jsx(d,{value:"all",children:"All Vehicles"}),e.jsx(d,{value:"LSR-001",children:"LSR-001"}),e.jsx(d,{value:"LSR-002",children:"LSR-002"}),e.jsx(d,{value:"LSR-003",children:"LSR-003"})]})]})})]}),e.jsx(m,{children:e.jsxs(H,{children:[e.jsx(Q,{children:e.jsxs(b,{children:[e.jsx(a,{children:"Vehicle"}),e.jsx(a,{children:"Position"}),e.jsx(a,{children:"Tire Model"}),e.jsx(a,{children:"Installation Date"}),e.jsx(a,{children:"Tread Depth (mm)"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Next Inspection"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(G,{children:k.map(r=>e.jsxs(b,{children:[e.jsx(i,{className:"font-medium",children:r.vehicleNumber}),e.jsx(i,{children:r.position}),e.jsx(i,{children:r.tireModel}),e.jsx(i,{children:r.installationDate}),e.jsx(i,{children:r.currentTread}),e.jsx(i,{children:X(r.status)}),e.jsx(i,{children:r.nextInspection}),e.jsx(i,{children:e.jsxs(f,{variant:"outline",size:"sm",children:[e.jsx(ae,{className:"w-4 h-4 mr-1"}),"Replace"]})})]},r.id))})]})})]})}),e.jsx(P,{value:"maintenance",className:"space-y-4",children:e.jsxs(j,{children:[e.jsx(D,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5"}),"Tire Maintenance Schedule"]})}),e.jsx(m,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(O,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Maintenance Tracking"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Set up automatic reminders for tire rotations, inspections, and replacements."}),e.jsx(f,{className:"bg-red-600 hover:bg-red-700",children:"Configure Maintenance Schedule"})]})})]})})]})]})};export{Ne as default};
