import{q as z,r as o,$ as x,s as I,a as J,j as e,a2 as O,S as $,p as G,o as K,i as w,k as j,af as Q,ag as W,ah as X,E as V,B as u,l as N,m as y,n as P,Y as l,I as c,ac as U,a0 as k}from"./main-piTIAPSx.js";import{T as Z,a as ee,b,c as C}from"./tabs-N5TLptOb.js";import{S as se}from"./square-pen-DnuZJKej.js";import{S as q}from"./save-4i_nN9Q9.js";const ae=()=>{const{user:f,profile:s,refreshProfile:d}=z(),[_,g]=o.useState(!1);return{updating:_,updateProfile:async m=>{if(!f||!s)return x.error("You must be logged in to update your profile"),{error:new Error("Not authenticated")};g(!0);try{const{error:r}=await I.from("profiles").update(m).eq("id",f.id);if(r)throw r;return await d(),x.success("Profile updated successfully"),{error:null}}catch(r){return console.error("Error updating profile:",r),x.error("Failed to update profile: "+r.message),{error:r}}finally{g(!1)}},updatePassword:async m=>{if(!f)return x.error("You must be logged in to update your password"),{error:new Error("Not authenticated")};try{const{error:r}=await I.auth.updateUser({password:m});if(r)throw r;return x.success("Password updated successfully"),{error:null}}catch(r){return console.error("Error updating password:",r),x.error("Failed to update password: "+r.message),{error:r}}}}},le=()=>{var T,A;const{user:f,profile:s}=z(),{updating:d,updateProfile:_,updatePassword:g}=ae(),{toast:p}=J(),[i,m]=o.useState(!1),[r,B]=o.useState(!1),[S,L]=o.useState(!1),[E,Y]=o.useState(!1),[h,F]=o.useState({first_name:(s==null?void 0:s.first_name)||"",last_name:(s==null?void 0:s.last_name)||"",phone:""}),[n,v]=o.useState({currentPassword:"",newPassword:"",confirmPassword:""}),M=async()=>{if(!h.first_name.trim()||!h.last_name.trim()){p({title:"Validation Error",description:"First name and last name are required.",variant:"destructive"});return}const{error:a}=await _({first_name:h.first_name.trim(),last_name:h.last_name.trim()});a||m(!1)},R=async()=>{if(!n.newPassword||!n.confirmPassword){p({title:"Validation Error",description:"Please fill in all password fields.",variant:"destructive"});return}if(n.newPassword!==n.confirmPassword){p({title:"Validation Error",description:"New passwords do not match.",variant:"destructive"});return}if(n.newPassword.length<6){p({title:"Validation Error",description:"Password must be at least 6 characters long.",variant:"destructive"});return}const{error:a}=await g(n.newPassword);a||v({currentPassword:"",newPassword:"",confirmPassword:""})},D=a=>{switch(a){case"admin":return"bg-red-100 text-red-800";case"council":return"bg-blue-100 text-blue-800";case"driver":return"bg-green-100 text-green-800";case"parent":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},H=a=>{switch(a){case"active":return"bg-green-100 text-green-800";case"inactive":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}};return s?e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"User Profile"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage your account settings and preferences"})]}),e.jsxs(Z,{defaultValue:"profile",className:"space-y-6",children:[e.jsxs(ee,{className:"grid w-full grid-cols-4",children:[e.jsxs(b,{value:"profile",className:"flex items-center space-x-2",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsx("span",{children:"Profile"})]}),e.jsxs(b,{value:"security",className:"flex items-center space-x-2",children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{children:"Security"})]}),e.jsxs(b,{value:"notifications",className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:"Notifications"})]}),e.jsxs(b,{value:"preferences",className:"flex items-center space-x-2",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{children:"Preferences"})]})]}),e.jsx(C,{value:"profile",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsx(w,{children:e.jsx(j,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(Q,{className:"w-20 h-20",children:[e.jsx(W,{src:s.avatar_url||""}),e.jsxs(X,{className:"text-lg",children:[(T=s.first_name)==null?void 0:T[0],(A=s.last_name)==null?void 0:A[0]]})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[s.first_name," ",s.last_name]}),e.jsx("p",{className:"text-gray-600",children:s.email}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(V,{className:D(s.role),children:s.role.charAt(0).toUpperCase()+s.role.slice(1)}),e.jsx(V,{className:H(s.employment_status||"inactive"),children:s.employment_status||"Inactive"})]})]})]}),e.jsxs(u,{variant:"outline",onClick:()=>m(!i),className:"flex items-center space-x-2",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{children:i?"Cancel":"Edit"})]})]})})}),e.jsxs(w,{children:[e.jsxs(j,{children:[e.jsx(N,{children:"Personal Information"}),e.jsx(y,{children:"Update your personal details and contact information"})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"first_name",children:"First Name"}),e.jsx(c,{id:"first_name",value:h.first_name,onChange:a=>F(t=>({...t,first_name:a.target.value})),disabled:!i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"last_name",children:"Last Name"}),e.jsx(c,{id:"last_name",value:h.last_name,onChange:a=>F(t=>({...t,last_name:a.target.value})),disabled:!i})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"email",children:"Email"}),e.jsx(c,{id:"email",value:s.email,disabled:!0,className:"bg-gray-50"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Email cannot be changed"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"phone",children:"Phone Number"}),e.jsx(c,{id:"phone",value:"",onChange:a=>F(t=>({...t,phone:a.target.value})),disabled:!i,placeholder:"Phone number not available"})]}),i&&e.jsx("div",{className:"flex space-x-2 pt-4",children:e.jsxs(u,{onClick:M,disabled:d,className:"flex items-center space-x-2",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{children:d?"Saving...":"Save Changes"})]})})]})]})]})}),e.jsx(C,{value:"security",children:e.jsxs(w,{children:[e.jsxs(j,{children:[e.jsx(N,{children:"Security Settings"}),e.jsx(y,{children:"Manage your password and security preferences"})]}),e.jsx(P,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Change Password"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"current_password",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{id:"current_password",type:r?"text":"password",value:n.currentPassword,onChange:a=>v(t=>({...t,currentPassword:a.target.value})),placeholder:"Enter current password"}),e.jsx(u,{type:"button",variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 -translate-y-1/2 h-7 w-7 p-0",onClick:()=>B(!r),children:r?e.jsx(U,{className:"h-4 w-4"}):e.jsx(k,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"new_password",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{id:"new_password",type:S?"text":"password",value:n.newPassword,onChange:a=>v(t=>({...t,newPassword:a.target.value})),placeholder:"Enter new password"}),e.jsx(u,{type:"button",variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 -translate-y-1/2 h-7 w-7 p-0",onClick:()=>L(!S),children:S?e.jsx(U,{className:"h-4 w-4"}):e.jsx(k,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"confirm_password",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{id:"confirm_password",type:E?"text":"password",value:n.confirmPassword,onChange:a=>v(t=>({...t,confirmPassword:a.target.value})),placeholder:"Confirm new password"}),e.jsx(u,{type:"button",variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 -translate-y-1/2 h-7 w-7 p-0",onClick:()=>Y(!E),children:E?e.jsx(U,{className:"h-4 w-4"}):e.jsx(k,{className:"h-4 w-4"})})]})]}),e.jsxs(u,{onClick:R,disabled:d,className:"flex items-center space-x-2",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{children:d?"Updating...":"Update Password"})]})]})})]})}),e.jsx(C,{value:"notifications",children:e.jsxs(w,{children:[e.jsxs(j,{children:[e.jsx(N,{children:"Notification Preferences"}),e.jsx(y,{children:"Choose how you want to be notified about updates and activities"})]}),e.jsx(P,{children:e.jsx("p",{className:"text-gray-500",children:"Notification settings will be available soon."})})]})}),e.jsx(C,{value:"preferences",children:e.jsxs(w,{children:[e.jsxs(j,{children:[e.jsx(N,{children:"Application Preferences"}),e.jsx(y,{children:"Customize your application experience"})]}),e.jsx(P,{children:e.jsx("p",{className:"text-gray-500",children:"Application preferences will be available soon."})})]})})]})]}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{children:"Loading profile..."})})})};export{le as default};
