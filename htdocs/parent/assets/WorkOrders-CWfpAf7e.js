import{q as Ce,J as Ae,s as _,ay as Ve,r as x,j as e,N as Ne,B as y,i as L,k as Q,l as Y,F as _e,n as M,W as qe,H as be,a1 as He,Y as a,I as N,E as A,a0 as Be,D as Z,d as O,e as R,f as ee,g as se,a6 as te,P as D}from"./main-piTIAPSx.js";import{T as $}from"./textarea-mxcr8nPj.js";import{S as u,a as j,b as g,c as v,d as r}from"./select-Brm_N20Q.js";import{T as Pe,a as Ue,b as V,c as Ie}from"./tabs-N5TLptOb.js";import{u as re}from"./useQuery-Dbdyc74j.js";import{u as ie}from"./useMutation-B8vlA97s.js";import{P as Ke}from"./plus-CMGcTuiR.js";import{S as Qe}from"./search-HDsNrIL9.js";import{S as Ye}from"./square-pen-DnuZJKej.js";import{T as $e}from"./trash-2-CMjiaIVh.js";import"./index-Pp_niZQ8.js";const ze=f=>{const{profile:p}=Ce(),q=Ae(),{data:w=[],isLoading:k,error:z}=re({queryKey:["work-orders",f],queryFn:async()=>{if(!f)return[];try{const{data:i,error:h}=await _.from("defect_reports").select("*").order("created_at",{ascending:!1});if(h)return console.error("Error fetching defect reports:",h),[];if(!i||i.length===0)return[];const m=[...new Set(i.map(t=>t.vehicle_id).filter(Boolean))],n=[...new Set(i.map(t=>t.reported_by).filter(Boolean))],C=[...new Set(i.map(t=>t.assigned_mechanic_id).filter(Boolean))],[W,G,T]=await Promise.all([m.length>0?_.from("vehicles").select("id, vehicle_number, make, model, license_plate").in("id",m).eq("organization_id",f):{data:[]},n.length>0?_.from("profiles").select("id, first_name, last_name").in("id",n):{data:[]},C.length>0?_.from("profiles").select("id, first_name, last_name").in("id",C):{data:[]}]),X=new Map((W.data||[]).map(t=>[t.id,t])),E=new Map((G.data||[]).map(t=>[t.id,t])),l=new Map((T.data||[]).map(t=>[t.id,t]));return i.map(t=>({...t,vehicle:X.get(t.vehicle_id),reported_by_profile:E.get(t.reported_by),assigned_mechanic:l.get(t.assigned_mechanic_id)}))}catch(i){return console.error("Error in work orders query:",i),[]}},enabled:!!f&&!!(p!=null&&p.id)}),b=ie({mutationFn:async i=>{const{data:h,error:m}=await _.from("defect_reports").insert([{...i,reported_by:p==null?void 0:p.id,defect_number:`DEF-${new Date().getFullYear()}-${String(Date.now()).slice(-6)}`,reported_date:new Date().toISOString(),estimated_cost:i.estimated_cost||0,actual_cost:0}]).select().single();if(m)throw m;return h},onSuccess:()=>{q.invalidateQueries({queryKey:["work-orders"]})}}),B=ie({mutationFn:async({id:i,data:h})=>{const{data:m,error:n}=await _.from("defect_reports").update(h).eq("id",i).select().single();if(n)throw n;return m},onSuccess:()=>{q.invalidateQueries({queryKey:["work-orders"]})}}),S=ie({mutationFn:async i=>{const{error:h}=await _.from("defect_reports").delete().eq("id",i);if(h)throw h},onSuccess:()=>{q.invalidateQueries({queryKey:["work-orders"]})}}),{data:J}=re({queryKey:["work-order-stats",f],queryFn:async()=>{if(!f)return null;try{const{data:i,error:h}=await _.from("defect_reports").select("status, severity, estimated_cost, actual_cost");return h?(console.error("Error fetching work order stats:",h),null):{total:(i==null?void 0:i.length)||0,byStatus:{reported:(i==null?void 0:i.filter(n=>n.status==="reported").length)||0,investigating:(i==null?void 0:i.filter(n=>n.status==="investigating").length)||0,repairing:(i==null?void 0:i.filter(n=>n.status==="repairing").length)||0,resolved:(i==null?void 0:i.filter(n=>n.status==="resolved").length)||0,closed:(i==null?void 0:i.filter(n=>n.status==="closed").length)||0},bySeverity:{low:(i==null?void 0:i.filter(n=>n.severity==="low").length)||0,medium:(i==null?void 0:i.filter(n=>n.severity==="medium").length)||0,high:(i==null?void 0:i.filter(n=>n.severity==="high").length)||0,critical:(i==null?void 0:i.filter(n=>n.severity==="critical").length)||0},totalEstimatedCost:(i==null?void 0:i.reduce((n,C)=>n+(C.estimated_cost||0),0))||0,totalActualCost:(i==null?void 0:i.reduce((n,C)=>n+(C.actual_cost||0),0))||0}}catch(i){return console.error("Error calculating work order stats:",i),null}},enabled:!!f});return{workOrders:w,isLoading:k,error:z,createWorkOrder:b.mutate,updateWorkOrder:B.mutate,deleteWorkOrder:S.mutate,isCreating:b.isPending,isUpdating:B.isPending,isDeleting:S.isPending,workOrderStats:J}},ls=()=>{var xe,ue,je,ge,ve,pe,ye;const{user:f,profile:p,loading:q}=Ce(),{selectedOrganizationId:w}=Ve(),[k,z]=x.useState("all"),[b,B]=x.useState(""),[S,J]=x.useState("all"),[i,h]=x.useState("all"),[m,n]=x.useState("all"),[C,W]=x.useState(!1),[G,T]=x.useState(!1),[X,E]=x.useState(!1),[l,P]=x.useState(null);x.useState(null);const[t,c]=x.useState({title:"",description:"",vehicle_id:"",defect_type:"mechanical",severity:"medium",priority:"medium",location:"",estimated_cost:0,estimated_hours:0,work_notes:""}),{workOrders:we,isLoading:Se,error:Fe,createWorkOrder:De,updateWorkOrder:ke,deleteWorkOrder:We,isCreating:ae,isUpdating:le,isDeleting:Je,workOrderStats:d}=ze(w),{data:ne=[]}=re({queryKey:["vehicles",w],queryFn:async()=>{if(!w)return[];const{data:s,error:o}=await _.from("vehicles").select("id, vehicle_number, make, model, license_plate").eq("organization_id",w).order("vehicle_number");return o?(console.error("Error fetching vehicles:",o),[]):s||[]},enabled:!!w});if(q)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-lg",children:"Loading work orders..."})]})});if(!f||!p)return e.jsx(Ne,{to:"/auth",replace:!0});if(p.role!=="mechanic"&&p.role!=="admin")return e.jsx(Ne,{to:"/dashboard",replace:!0});const F=we.filter(s=>{var H,fe;const o=s.title.toLowerCase().includes(b.toLowerCase())||s.defect_number.toLowerCase().includes(b.toLowerCase())||((fe=(H=s.vehicle)==null?void 0:H.vehicle_number)==null?void 0:fe.toLowerCase().includes(b.toLowerCase())),U=S==="all"||s.severity===S,I=i==="all"||s.status===i,K=m==="all"||s.defect_type===m;return o&&U&&I&&K}),ce=s=>{switch(s){case"reported":return F.filter(o=>o.status==="reported");case"investigating":return F.filter(o=>o.status==="investigating");case"repairing":return F.filter(o=>o.status==="repairing");case"resolved":return F.filter(o=>o.status==="resolved");case"closed":return F.filter(o=>o.status==="closed");default:return F}},de=s=>{switch(s){case"reported":return"bg-blue-100 text-blue-800";case"investigating":return"bg-yellow-100 text-yellow-800";case"repairing":return"bg-orange-100 text-orange-800";case"resolved":return"bg-green-100 text-green-800";case"closed":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},oe=s=>{switch(s){case"critical":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},he=s=>{switch(s){case"safety":return"bg-red-100 text-red-800";case"mechanical":return"bg-blue-100 text-blue-800";case"electrical":return"bg-purple-100 text-purple-800";case"cosmetic":return"bg-gray-100 text-gray-800";case"other":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},Te=()=>{if(!t.title||!t.vehicle_id){D({title:"Error",description:"Please fill in all required fields",variant:"destructive"});return}De(t,{onSuccess:()=>{D({title:"Success",description:"Work order created successfully"}),W(!1),c({title:"",description:"",vehicle_id:"",defect_type:"mechanical",severity:"medium",priority:"medium",location:"",estimated_cost:0,estimated_hours:0,work_notes:""})},onError:s=>{D({title:"Error",description:"Failed to create work order",variant:"destructive"})}})},Ee=()=>{l&&ke({id:l.id,data:t},{onSuccess:()=>{D({title:"Success",description:"Work order updated successfully"}),T(!1),P(null)},onError:s=>{D({title:"Error",description:"Failed to update work order",variant:"destructive"})}})},Le=s=>{confirm("Are you sure you want to delete this work order?")&&We(s,{onSuccess:()=>{D({title:"Success",description:"Work order deleted successfully"})},onError:o=>{D({title:"Error",description:"Failed to delete work order",variant:"destructive"})}})},me=s=>{P(s),c({title:s.title,description:s.description||"",vehicle_id:s.vehicle_id,defect_type:s.defect_type,severity:s.severity,priority:s.priority||"medium",location:s.location||"",estimated_cost:s.estimated_cost,estimated_hours:s.estimated_hours||0,work_notes:s.work_notes||""}),T(!0)},Me=s=>{P(s),E(!0)};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Work Orders"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage vehicle defects and repairs"})]}),e.jsxs(y,{onClick:()=>W(!0),children:[e.jsx(Ke,{className:"h-4 w-4 mr-2"}),"New Work Order"]})]}),d&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs(L,{children:[e.jsxs(Q,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Y,{className:"text-sm font-medium",children:"Total Work Orders"}),e.jsx(_e,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(M,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All time"})]})]}),e.jsxs(L,{children:[e.jsxs(Q,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Y,{className:"text-sm font-medium",children:"In Progress"}),e.jsx(qe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(M,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.byStatus.investigating+d.byStatus.repairing}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Investigating & Repairing"})]})]}),e.jsxs(L,{children:[e.jsxs(Q,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Y,{className:"text-sm font-medium",children:"Critical Issues"}),e.jsx(be,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(M,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.bySeverity.critical}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Safety priority"})]})]}),e.jsxs(L,{children:[e.jsxs(Q,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Y,{className:"text-sm font-medium",children:"Total Cost"}),e.jsx(He,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(M,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["£",d.totalEstimatedCost.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Estimated total"})]})]})]}),e.jsx(L,{className:"mb-6",children:e.jsx(M,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"search",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(N,{id:"search",placeholder:"Search work orders...",value:b,onChange:s=>B(s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"severity",children:"Severity"}),e.jsxs(u,{value:S,onValueChange:J,children:[e.jsx(j,{children:e.jsx(g,{placeholder:"All severities"})}),e.jsxs(v,{children:[e.jsx(r,{value:"all",children:"All Severities"}),e.jsx(r,{value:"low",children:"Low"}),e.jsx(r,{value:"medium",children:"Medium"}),e.jsx(r,{value:"high",children:"High"}),e.jsx(r,{value:"critical",children:"Critical"})]})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"status",children:"Status"}),e.jsxs(u,{value:i,onValueChange:h,children:[e.jsx(j,{children:e.jsx(g,{placeholder:"All statuses"})}),e.jsxs(v,{children:[e.jsx(r,{value:"all",children:"All Statuses"}),e.jsx(r,{value:"reported",children:"Reported"}),e.jsx(r,{value:"investigating",children:"Investigating"}),e.jsx(r,{value:"repairing",children:"Repairing"}),e.jsx(r,{value:"resolved",children:"Resolved"}),e.jsx(r,{value:"closed",children:"Closed"})]})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"defectType",children:"Defect Type"}),e.jsxs(u,{value:m,onValueChange:n,children:[e.jsx(j,{children:e.jsx(g,{placeholder:"All types"})}),e.jsxs(v,{children:[e.jsx(r,{value:"all",children:"All Types"}),e.jsx(r,{value:"safety",children:"Safety"}),e.jsx(r,{value:"mechanical",children:"Mechanical"}),e.jsx(r,{value:"electrical",children:"Electrical"}),e.jsx(r,{value:"cosmetic",children:"Cosmetic"}),e.jsx(r,{value:"other",children:"Other"})]})]})]})]})})}),e.jsxs(Pe,{value:k,onValueChange:z,className:"space-y-6",children:[e.jsxs(Ue,{className:"grid w-full grid-cols-6",children:[e.jsxs(V,{value:"all",children:["All (",F.length,")"]}),e.jsxs(V,{value:"reported",children:["Reported (",(d==null?void 0:d.byStatus.reported)||0,")"]}),e.jsxs(V,{value:"investigating",children:["Investigating (",(d==null?void 0:d.byStatus.investigating)||0,")"]}),e.jsxs(V,{value:"repairing",children:["Repairing (",(d==null?void 0:d.byStatus.repairing)||0,")"]}),e.jsxs(V,{value:"resolved",children:["Resolved (",(d==null?void 0:d.byStatus.resolved)||0,")"]}),e.jsxs(V,{value:"closed",children:["Closed (",(d==null?void 0:d.byStatus.closed)||0,")"]})]}),e.jsx(Ie,{value:k,className:"space-y-6",children:Se?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),e.jsx("p",{children:"Loading work orders..."})]}):Fe?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(be,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600",children:"Error loading work orders"})]}):ce(k).length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_e,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Work Orders"}),e.jsx("p",{className:"text-gray-600",children:b||S!=="all"||i!=="all"||m!=="all"?"No work orders match your current filters":"No work orders found. Create your first work order to get started."})]}):e.jsx("div",{className:"space-y-4",children:ce(k).map(s=>{var o,U,I,K,H;return e.jsx(L,{className:"hover:shadow-md transition-shadow",children:e.jsx(M,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:s.title}),e.jsx(A,{className:de(s.status),children:s.status}),e.jsx(A,{className:oe(s.severity),children:s.severity}),e.jsx(A,{className:he(s.defect_type),children:s.defect_type})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Defect #:"})," ",s.defect_number]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Vehicle:"})," ",((o=s.vehicle)==null?void 0:o.vehicle_number)||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Reported:"})," ",new Date(s.reported_date).toLocaleDateString()]})]}),s.description&&e.jsx("p",{className:"text-gray-700 mb-4",children:s.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Estimated Cost:"})," £",s.estimated_cost.toFixed(2)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Actual Cost:"})," £",s.actual_cost.toFixed(2)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Reported By:"})," ",(U=s.reported_by_profile)==null?void 0:U.first_name," ",(I=s.reported_by_profile)==null?void 0:I.last_name]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Assigned To:"})," ",(K=s.assigned_mechanic)==null?void 0:K.first_name," ",(H=s.assigned_mechanic)==null?void 0:H.last_name," || 'Unassigned'"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx(y,{variant:"outline",size:"sm",onClick:()=>Me(s),children:e.jsx(Be,{className:"h-4 w-4"})}),e.jsx(y,{variant:"outline",size:"sm",onClick:()=>me(s),children:e.jsx(Ye,{className:"h-4 w-4"})}),e.jsx(y,{variant:"outline",size:"sm",onClick:()=>Le(s.id),children:e.jsx($e,{className:"h-4 w-4"})})]})]})})},s.id)})})})]}),e.jsx(Z,{open:C,onOpenChange:W,children:e.jsxs(O,{className:"max-w-2xl",children:[e.jsxs(R,{children:[e.jsx(ee,{children:"Create New Work Order"}),e.jsx(se,{children:"Report a new vehicle defect or maintenance issue"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(a,{htmlFor:"title",children:"Title *"}),e.jsx(N,{id:"title",value:t.title,onChange:s=>c({...t,title:s.target.value}),placeholder:"Brief description of the issue"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(a,{htmlFor:"description",children:"Description"}),e.jsx($,{id:"description",value:t.description,onChange:s=>c({...t,description:s.target.value}),placeholder:"Detailed description of the problem",rows:3})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"vehicle",children:"Vehicle *"}),e.jsxs(u,{value:t.vehicle_id,onValueChange:s=>c({...t,vehicle_id:s}),children:[e.jsx(j,{children:e.jsx(g,{placeholder:"Select vehicle"})}),e.jsx(v,{children:ne.map(s=>e.jsxs(r,{value:s.id,children:[s.vehicle_number," - ",s.make," ",s.model]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"defectType",children:"Defect Type"}),e.jsxs(u,{value:t.defect_type,onValueChange:s=>c({...t,defect_type:s}),children:[e.jsx(j,{children:e.jsx(g,{})}),e.jsxs(v,{children:[e.jsx(r,{value:"safety",children:"Safety"}),e.jsx(r,{value:"mechanical",children:"Mechanical"}),e.jsx(r,{value:"electrical",children:"Electrical"}),e.jsx(r,{value:"cosmetic",children:"Cosmetic"}),e.jsx(r,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"severity",children:"Severity"}),e.jsxs(u,{value:t.severity,onValueChange:s=>c({...t,severity:s}),children:[e.jsx(j,{children:e.jsx(g,{})}),e.jsxs(v,{children:[e.jsx(r,{value:"low",children:"Low"}),e.jsx(r,{value:"medium",children:"Medium"}),e.jsx(r,{value:"high",children:"High"}),e.jsx(r,{value:"critical",children:"Critical"})]})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"priority",children:"Priority"}),e.jsxs(u,{value:t.priority,onValueChange:s=>c({...t,priority:s}),children:[e.jsx(j,{children:e.jsx(g,{})}),e.jsxs(v,{children:[e.jsx(r,{value:"low",children:"Low"}),e.jsx(r,{value:"medium",children:"Medium"}),e.jsx(r,{value:"high",children:"High"}),e.jsx(r,{value:"urgent",children:"Urgent"})]})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"location",children:"Location"}),e.jsx(N,{id:"location",value:t.location,onChange:s=>c({...t,location:s.target.value}),placeholder:"Where is the issue located?"})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"estimatedCost",children:"Estimated Cost (£)"}),e.jsx(N,{id:"estimatedCost",type:"number",value:t.estimated_cost,onChange:s=>c({...t,estimated_cost:parseFloat(s.target.value)||0}),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"estimatedHours",children:"Estimated Hours"}),e.jsx(N,{id:"estimatedHours",type:"number",value:t.estimated_hours,onChange:s=>c({...t,estimated_hours:parseFloat(s.target.value)||0}),placeholder:"0.0"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(a,{htmlFor:"workNotes",children:"Work Notes"}),e.jsx($,{id:"workNotes",value:t.work_notes,onChange:s=>c({...t,work_notes:s.target.value}),placeholder:"Additional notes for mechanics",rows:2})]})]}),e.jsxs(te,{children:[e.jsx(y,{variant:"outline",onClick:()=>W(!1),children:"Cancel"}),e.jsx(y,{onClick:Te,disabled:ae,children:ae?"Creating...":"Create Work Order"})]})]})}),e.jsx(Z,{open:G,onOpenChange:T,children:e.jsxs(O,{className:"max-w-2xl",children:[e.jsxs(R,{children:[e.jsx(ee,{children:"Edit Work Order"}),e.jsx(se,{children:"Update work order details"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(a,{htmlFor:"edit-title",children:"Title *"}),e.jsx(N,{id:"edit-title",value:t.title,onChange:s=>c({...t,title:s.target.value}),placeholder:"Brief description of the issue"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(a,{htmlFor:"edit-description",children:"Description"}),e.jsx($,{id:"edit-description",value:t.description,onChange:s=>c({...t,description:s.target.value}),placeholder:"Detailed description of the problem",rows:3})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"edit-vehicle",children:"Vehicle *"}),e.jsxs(u,{value:t.vehicle_id,onValueChange:s=>c({...t,vehicle_id:s}),children:[e.jsx(j,{children:e.jsx(g,{placeholder:"Select vehicle"})}),e.jsx(v,{children:ne.map(s=>e.jsxs(r,{value:s.id,children:[s.vehicle_number," - ",s.make," ",s.model]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"edit-defectType",children:"Defect Type"}),e.jsxs(u,{value:t.defect_type,onValueChange:s=>c({...t,defect_type:s}),children:[e.jsx(j,{children:e.jsx(g,{})}),e.jsxs(v,{children:[e.jsx(r,{value:"safety",children:"Safety"}),e.jsx(r,{value:"mechanical",children:"Mechanical"}),e.jsx(r,{value:"electrical",children:"Electrical"}),e.jsx(r,{value:"cosmetic",children:"Cosmetic"}),e.jsx(r,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"edit-severity",children:"Severity"}),e.jsxs(u,{value:t.severity,onValueChange:s=>c({...t,severity:s}),children:[e.jsx(j,{children:e.jsx(g,{})}),e.jsxs(v,{children:[e.jsx(r,{value:"low",children:"Low"}),e.jsx(r,{value:"medium",children:"Medium"}),e.jsx(r,{value:"high",children:"High"}),e.jsx(r,{value:"critical",children:"Critical"})]})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"edit-priority",children:"Priority"}),e.jsxs(u,{value:t.priority,onValueChange:s=>c({...t,priority:s}),children:[e.jsx(j,{children:e.jsx(g,{})}),e.jsxs(v,{children:[e.jsx(r,{value:"low",children:"Low"}),e.jsx(r,{value:"medium",children:"Medium"}),e.jsx(r,{value:"high",children:"High"}),e.jsx(r,{value:"urgent",children:"Urgent"})]})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"edit-location",children:"Location"}),e.jsx(N,{id:"edit-location",value:t.location,onChange:s=>c({...t,location:s.target.value}),placeholder:"Where is the issue located?"})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"edit-estimatedCost",children:"Estimated Cost (£)"}),e.jsx(N,{id:"edit-estimatedCost",type:"number",value:t.estimated_cost,onChange:s=>c({...t,estimated_cost:parseFloat(s.target.value)||0}),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"edit-estimatedHours",children:"Estimated Hours"}),e.jsx(N,{id:"edit-estimatedHours",type:"number",value:t.estimated_hours,onChange:s=>c({...t,estimated_hours:parseFloat(s.target.value)||0}),placeholder:"0.0"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(a,{htmlFor:"edit-workNotes",children:"Work Notes"}),e.jsx($,{id:"edit-workNotes",value:t.work_notes,onChange:s=>c({...t,work_notes:s.target.value}),placeholder:"Additional notes for mechanics",rows:2})]})]}),e.jsxs(te,{children:[e.jsx(y,{variant:"outline",onClick:()=>T(!1),children:"Cancel"}),e.jsx(y,{onClick:Ee,disabled:le,children:le?"Updating...":"Update Work Order"})]})]})}),e.jsx(Z,{open:X,onOpenChange:E,children:e.jsxs(O,{className:"max-w-2xl",children:[e.jsxs(R,{children:[e.jsx(ee,{children:"Work Order Details"}),e.jsx(se,{children:"View complete work order information"})]}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{className:"font-medium",children:"Title"}),e.jsx("p",{className:"text-gray-700",children:l.title})]}),e.jsxs("div",{children:[e.jsx(a,{className:"font-medium",children:"Defect Number"}),e.jsx("p",{className:"text-gray-700",children:l.defect_number})]}),e.jsxs("div",{children:[e.jsx(a,{className:"font-medium",children:"Vehicle"}),e.jsxs("p",{className:"text-gray-700",children:[(xe=l.vehicle)==null?void 0:xe.vehicle_number," - ",(ue=l.vehicle)==null?void 0:ue.make," ",(je=l.vehicle)==null?void 0:je.model]})]}),e.jsxs("div",{children:[e.jsx(a,{className:"font-medium",children:"Status"}),e.jsx(A,{className:de(l.status),children:l.status})]}),e.jsxs("div",{children:[e.jsx(a,{className:"font-medium",children:"Severity"}),e.jsx(A,{className:oe(l.severity),children:l.severity})]}),e.jsxs("div",{children:[e.jsx(a,{className:"font-medium",children:"Defect Type"}),e.jsx(A,{className:he(l.defect_type),children:l.defect_type})]}),e.jsxs("div",{children:[e.jsx(a,{className:"font-medium",children:"Reported Date"}),e.jsx("p",{className:"text-gray-700",children:new Date(l.reported_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx(a,{className:"font-medium",children:"Reported By"}),e.jsxs("p",{className:"text-gray-700",children:[(ge=l.reported_by_profile)==null?void 0:ge.first_name," ",(ve=l.reported_by_profile)==null?void 0:ve.last_name]})]}),e.jsxs("div",{children:[e.jsx(a,{className:"font-medium",children:"Assigned To"}),e.jsxs("p",{className:"text-gray-700",children:[(pe=l.assigned_mechanic)==null?void 0:pe.first_name," ",(ye=l.assigned_mechanic)==null?void 0:ye.last_name," || 'Unassigned'"]})]}),e.jsxs("div",{children:[e.jsx(a,{className:"font-medium",children:"Location"}),e.jsx("p",{className:"text-gray-700",children:l.location||"Not specified"})]}),e.jsxs("div",{children:[e.jsx(a,{className:"font-medium",children:"Estimated Cost"}),e.jsxs("p",{className:"text-gray-700",children:["£",l.estimated_cost.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx(a,{className:"font-medium",children:"Actual Cost"}),e.jsxs("p",{className:"text-gray-700",children:["£",l.actual_cost.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx(a,{className:"font-medium",children:"Estimated Hours"}),e.jsxs("p",{className:"text-gray-700",children:[l.estimated_hours||0," hours"]})]}),e.jsxs("div",{children:[e.jsx(a,{className:"font-medium",children:"Actual Hours"}),e.jsxs("p",{className:"text-gray-700",children:[l.actual_hours||0," hours"]})]})]}),l.description&&e.jsxs("div",{children:[e.jsx(a,{className:"font-medium",children:"Description"}),e.jsx("p",{className:"text-gray-700",children:l.description})]}),l.work_notes&&e.jsxs("div",{children:[e.jsx(a,{className:"font-medium",children:"Work Notes"}),e.jsx("p",{className:"text-gray-700",children:l.work_notes})]})]}),e.jsxs(te,{children:[e.jsx(y,{variant:"outline",onClick:()=>E(!1),children:"Close"}),l&&e.jsx(y,{onClick:()=>{E(!1),me(l)},children:"Edit Work Order"})]})]})})]})};export{ls as default};
