import{u as d}from"./useQuery-Dbdyc74j.js";import{q as u,s as i,J as c,$ as o}from"./main-piTIAPSx.js";import{u as l}from"./useMutation-B8vlA97s.js";const g=()=>{const{user:a,profile:t}=u();return d({queryKey:["vehicles",t==null?void 0:t.organization_id],queryFn:async()=>{if(!(t!=null&&t.organization_id))throw console.log("âŒ No organization ID available"),new Error("Organization ID is required");console.log("ðŸš— Fetching vehicles from database..."),console.log("ðŸ” Organization ID:",t.organization_id);try{const{data:e,error:r}=await i.from("vehicles").select("*").eq("organization_id",t.organization_id).order("vehicle_number",{ascending:!0});if(r)throw console.error("âŒ Database error fetching vehicles:",r),r;if(console.log("âœ… Raw vehicles data from database:",e),console.log("ðŸ“Š Number of vehicles found:",(e==null?void 0:e.length)||0),!e||e.length===0)return console.log("âš ï¸ No vehicles found in database for organization:",t.organization_id),console.log("ðŸ’¡ This is normal if you haven't added any vehicles yet"),[];const n=e.map(s=>(console.log("ðŸ”„ Transforming vehicle:",s),{...s,status:s.status||"active",capacity:0,is_active:s.status==="active",fuel_type:s.fuel_type||"unknown",mileage:0,type:"bus",seating_capacity:0,requires_maintenance:s.status==="maintenance",last_maintenance:s.updated_at,next_maintenance:s.updated_at,mot_expiry:s.updated_at,next_service_date:s.updated_at,service_interval_months:6}));return console.log("âœ… Transformed vehicles:",n),n}catch(e){throw console.error("ðŸ’¥ Error in useVehicles:",e),e}},enabled:!!(t!=null&&t.organization_id)})},m=()=>{const{profile:a}=u(),t=c();return l({mutationFn:async e=>{if(!(a!=null&&a.organization_id))throw new Error("Organization ID is required");const{data:r,error:n}=await i.from("vehicles").insert({...e,organization_id:a.organization_id}).select().single();if(n)throw n;return r},onSuccess:()=>{t.invalidateQueries({queryKey:["vehicles"]}),o.success("Vehicle created successfully")},onError:e=>{console.error("Error creating vehicle:",e),o.error("Failed to create vehicle: "+e.message)}})},v=()=>{const a=c();return l({mutationFn:async({id:t,updates:e})=>{const{data:r,error:n}=await i.from("vehicles").update(e).eq("id",t).select().single();if(n)throw n;return r},onSuccess:()=>{a.invalidateQueries({queryKey:["vehicles"]}),o.success("Vehicle updated successfully")},onError:t=>{console.error("Error updating vehicle:",t),o.error("Failed to update vehicle: "+t.message)}})},f=()=>{const a=c();return l({mutationFn:async t=>{const{error:e}=await i.from("vehicles").delete().eq("id",t);if(e)throw e},onSuccess:()=>{a.invalidateQueries({queryKey:["vehicles"]}),o.success("Vehicle deleted successfully")},onError:t=>{console.error("Error deleting vehicle:",t),o.error("Failed to delete vehicle: "+t.message)}})},p=()=>{const{data:a=[]}=g();return{total:a.length,active:a.filter(e=>e.status==="active"||e.is_active).length,maintenance:a.filter(e=>e.status==="maintenance").length,out_of_service:a.filter(e=>e.status==="out_of_service"||!e.is_active).length,average_age:a.length>0?Math.round(a.reduce((e,r)=>e+(new Date().getFullYear()-(r.year||2020)),0)/a.length):0,by_type:a.reduce((e,r)=>{const n=r.type||"unknown";return e[n]=(e[n]||0)+1,e},{})}};export{m as a,g as b,f as c,p as d,v as u};
